<div class="container-fluid py-3">
  <div class="flex flex-wrap items-center justify-between gap-2 mb-6">
    <div class="flex items-center gap-2">
      <svg class="sa-icon sa-icon-2x text-primary" style="stroke: currentColor">
        <use href="/assets/icons/sprite.svg#lock"></use>
      </svg>
      <h4 class="mb-0">權限管理</h4>
    </div>
    <a routerLink="new" class="btn btn-primary inline-flex items-center gap-1">
      <svg class="sa-icon" style="stroke: currentColor"><use href="/assets/icons/sprite.svg#plus"></use></svg>
      新增權限
    </a>
  </div>

  @if (permissions$ | async; as perms) {
    @for (module of (modules$ | async) ?? []; track module) {
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-[--bg-base] fw-600 flex items-center">
          <svg class="sa-icon mr-2 text-primary" style="stroke: currentColor">
            <use href="/assets/icons/sprite.svg#folder"></use>
          </svg>
          {{ module }}
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0" style="table-layout: fixed">
              <thead class="table-light">
                <tr>
                  <th class="w-[30%]">代碼</th>
                  <th class="w-[25%]">名稱</th>
                  <th class="w-[35%] hidden md:table-cell">描述</th>
                  <th class="w-[10%] text-right">操作</th>
                </tr>
              </thead>
              <tbody>
                @for (perm of getByModule(perms, module); track perm.id) {
                  <tr>
                    <td class="w-[30%]"><code class="text-primary">{{ perm.code }}</code></td>
                    <td class="w-[25%] fw-500">{{ perm.name }}</td>
                    <td class="w-[35%] text-muted hidden md:table-cell">{{ perm.description ?? '—' }}</td>
                    <td class="w-[10%] text-right whitespace-nowrap">
                      <div class="flex justify-end gap-1">
                        <a [routerLink]="[perm.id, 'edit']" class="btn btn-sm btn-ghost-primary inline-flex items-center">
                          <svg class="sa-icon" style="stroke: currentColor"><use href="/assets/icons/sprite.svg#edit"></use></svg>
                        </a>
                        <button class="btn btn-sm btn-ghost-danger inline-flex items-center" (click)="delete(perm)">
                          <svg class="sa-icon" style="stroke: currentColor"><use href="/assets/icons/sprite.svg#trash"></use></svg>
                        </button>
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>
    } @empty {
      <div class="text-center text-muted py-8">尚無權限資料。</div>
    }
  }
</div>
