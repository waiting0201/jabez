import{A as xe,B as ee,C as te,D as Mt,E as G,c as jt,e as le,g as ve,h as N,k as $i,l as Y,m as w,n as W,o as K,p as Z,q as be,r as Ke,s as Ui,t as Gi,u as Q,v as X,w as we,x as De,y as ke,z as Hi}from"./chunk-GIVLTAB7.js";import{a as Vt}from"./chunk-WE7B5E7A.js";import{Fc as Ne,G as xi,Gb as D,Gc as ge,Hc as Te,Ib as x,Ic as qi,Kb as m,N as ue,Na as Ye,Oa as Pt,P as Pi,Pc as ce,Qa as l,R as hi,Sc as T,Tb as O,U as pe,Ub as re,Vb as a,Wb as v,Xb as E,Yb as z,Z as g,Zb as Fe,a as me,b as Pe,bc as ji,c as Li,ca as S,cb as V,cc as Mi,d as Lt,da as C,dc as Vi,e as de,ea as f,fa as y,g as Jn,ga as Ri,gc as ae,hc as Ni,ia as It,jc as R,kc as Re,l as Ve,lb as Rt,lc as q,m as Ii,mc as Oi,nb as u,ob as Bt,pa as M,pb as p,qa as Bi,qc as $,ra as Si,rb as _e,sb as L,tb as I,ub as b,uc as We,vb as i,wb as r,xb as d}from"./chunk-BW6ZNTK5.js";var Zi=de((pp,yi)=>{"use strict";var Ei=(function(n){"use strict";var t=Object.prototype,e=t.hasOwnProperty,o=Object.defineProperty||function(A,_,h){A[_]=h.value},s,c=typeof Symbol=="function"?Symbol:{},F=c.iterator||"@@iterator",P=c.asyncIterator||"@@asyncIterator",B=c.toStringTag||"@@toStringTag";function J(A,_,h){return Object.defineProperty(A,_,{value:h,enumerable:!0,configurable:!0,writable:!0}),A[_]}try{J({},"")}catch{J=function(_,h,j){return _[h]=j}}function je(A,_,h,j){var k=_&&_.prototype instanceof Ie?_:Ie,U=Object.create(k.prototype),oe=new ct(j||[]);return o(U,"_invoke",{value:ut(A,h,oe)}),U}n.wrap=je;function ie(A,_,h){try{return{type:"normal",arg:A.call(_,h)}}catch(j){return{type:"throw",arg:j}}}var fe="suspendedStart",Me="suspendedYield",$e="executing",he="completed",ne={};function Ie(){}function Ee(){}function Je(){}var mt={};J(mt,F,function(){return this});var dt=Object.getPrototypeOf,nt=dt&&dt(dt(vt([])));nt&&nt!==t&&e.call(nt,F)&&(mt=nt);var ze=Je.prototype=Ie.prototype=Object.create(mt);Ee.prototype=Je,o(ze,"constructor",{value:Je,configurable:!0}),o(Je,"constructor",{value:Ee,configurable:!0}),Ee.displayName=J(Je,B,"GeneratorFunction");function wt(A){["next","throw","return"].forEach(function(_){J(A,_,function(h){return this._invoke(_,h)})})}n.isGeneratorFunction=function(A){var _=typeof A=="function"&&A.constructor;return _?_===Ee||(_.displayName||_.name)==="GeneratorFunction":!1},n.mark=function(A){return Object.setPrototypeOf?Object.setPrototypeOf(A,Je):(A.__proto__=Je,J(A,B,"GeneratorFunction")),A.prototype=Object.create(ze),A},n.awrap=function(A){return{__await:A}};function Qe(A,_){function h(U,oe,ye,Se){var Ce=ie(A[U],A,oe);if(Ce.type==="throw")Se(Ce.arg);else{var bi=Ce.arg,ft=bi.value;return ft&&typeof ft=="object"&&e.call(ft,"__await")?_.resolve(ft.__await).then(function(Xe){h("next",Xe,ye,Se)},function(Xe){h("throw",Xe,ye,Se)}):_.resolve(ft).then(function(Xe){bi.value=Xe,ye(bi)},function(Xe){return h("throw",Xe,ye,Se)})}}var j;function k(U,oe){function ye(){return new _(function(Se,Ce){h(U,oe,Se,Ce)})}return j=j?j.then(ye,ye):ye()}o(this,"_invoke",{value:k})}wt(Qe.prototype),J(Qe.prototype,P,function(){return this}),n.AsyncIterator=Qe,n.async=function(A,_,h,j,k){k===void 0&&(k=Promise);var U=new Qe(je(A,_,h,j),k);return n.isGeneratorFunction(_)?U:U.next().then(function(oe){return oe.done?oe.value:U.next()})};function ut(A,_,h){var j=fe;return function(U,oe){if(j===$e)throw new Error("Generator is already running");if(j===he){if(U==="throw")throw oe;return kt()}for(h.method=U,h.arg=oe;;){var ye=h.delegate;if(ye){var Se=Dt(ye,h);if(Se){if(Se===ne)continue;return Se}}if(h.method==="next")h.sent=h._sent=h.arg;else if(h.method==="throw"){if(j===fe)throw j=he,h.arg;h.dispatchException(h.arg)}else h.method==="return"&&h.abrupt("return",h.arg);j=$e;var Ce=ie(A,_,h);if(Ce.type==="normal"){if(j=h.done?he:Me,Ce.arg===ne)continue;return{value:Ce.arg,done:h.done}}else Ce.type==="throw"&&(j=he,h.method="throw",h.arg=Ce.arg)}}}function Dt(A,_){var h=_.method,j=A.iterator[h];if(j===s)return _.delegate=null,h==="throw"&&A.iterator.return&&(_.method="return",_.arg=s,Dt(A,_),_.method==="throw")||h!=="return"&&(_.method="throw",_.arg=new TypeError("The iterator does not provide a '"+h+"' method")),ne;var k=ie(j,A.iterator,_.arg);if(k.type==="throw")return _.method="throw",_.arg=k.arg,_.delegate=null,ne;var U=k.arg;if(!U)return _.method="throw",_.arg=new TypeError("iterator result is not an object"),_.delegate=null,ne;if(U.done)_[A.resultName]=U.value,_.next=A.nextLoc,_.method!=="return"&&(_.method="next",_.arg=s);else return U;return _.delegate=null,ne}wt(ze),J(ze,B,"Generator"),J(ze,F,function(){return this}),J(ze,"toString",function(){return"[object Generator]"});function gi(A){var _={tryLoc:A[0]};1 in A&&(_.catchLoc=A[1]),2 in A&&(_.finallyLoc=A[2],_.afterLoc=A[3]),this.tryEntries.push(_)}function pt(A){var _=A.completion||{};_.type="normal",delete _.arg,A.completion=_}function ct(A){this.tryEntries=[{tryLoc:"root"}],A.forEach(gi,this),this.reset(!0)}n.keys=function(A){var _=Object(A),h=[];for(var j in _)h.push(j);return h.reverse(),function k(){for(;h.length;){var U=h.pop();if(U in _)return k.value=U,k.done=!1,k}return k.done=!0,k}};function vt(A){if(A){var _=A[F];if(_)return _.call(A);if(typeof A.next=="function")return A;if(!isNaN(A.length)){var h=-1,j=function k(){for(;++h<A.length;)if(e.call(A,h))return k.value=A[h],k.done=!1,k;return k.value=s,k.done=!0,k};return j.next=j}}return{next:kt}}n.values=vt;function kt(){return{value:s,done:!0}}return ct.prototype={constructor:ct,reset:function(A){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(pt),!A)for(var _ in this)_.charAt(0)==="t"&&e.call(this,_)&&!isNaN(+_.slice(1))&&(this[_]=s)},stop:function(){this.done=!0;var A=this.tryEntries[0],_=A.completion;if(_.type==="throw")throw _.arg;return this.rval},dispatchException:function(A){if(this.done)throw A;var _=this;function h(Se,Ce){return U.type="throw",U.arg=A,_.next=Se,Ce&&(_.method="next",_.arg=s),!!Ce}for(var j=this.tryEntries.length-1;j>=0;--j){var k=this.tryEntries[j],U=k.completion;if(k.tryLoc==="root")return h("end");if(k.tryLoc<=this.prev){var oe=e.call(k,"catchLoc"),ye=e.call(k,"finallyLoc");if(oe&&ye){if(this.prev<k.catchLoc)return h(k.catchLoc,!0);if(this.prev<k.finallyLoc)return h(k.finallyLoc)}else if(oe){if(this.prev<k.catchLoc)return h(k.catchLoc,!0)}else if(ye){if(this.prev<k.finallyLoc)return h(k.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(A,_){for(var h=this.tryEntries.length-1;h>=0;--h){var j=this.tryEntries[h];if(j.tryLoc<=this.prev&&e.call(j,"finallyLoc")&&this.prev<j.finallyLoc){var k=j;break}}k&&(A==="break"||A==="continue")&&k.tryLoc<=_&&_<=k.finallyLoc&&(k=null);var U=k?k.completion:{};return U.type=A,U.arg=_,k?(this.method="next",this.next=k.finallyLoc,ne):this.complete(U)},complete:function(A,_){if(A.type==="throw")throw A.arg;return A.type==="break"||A.type==="continue"?this.next=A.arg:A.type==="return"?(this.rval=this.arg=A.arg,this.method="return",this.next="end"):A.type==="normal"&&_&&(this.next=_),ne},finish:function(A){for(var _=this.tryEntries.length-1;_>=0;--_){var h=this.tryEntries[_];if(h.finallyLoc===A)return this.complete(h.completion,h.afterLoc),pt(h),ne}},catch:function(A){for(var _=this.tryEntries.length-1;_>=0;--_){var h=this.tryEntries[_];if(h.tryLoc===A){var j=h.completion;if(j.type==="throw"){var k=j.arg;pt(h)}return k}}throw new Error("illegal catch attempt")},delegateYield:function(A,_,h){return this.delegate={iterator:vt(A),resultName:_,nextLoc:h},this.method==="next"&&(this.arg=s),ne}},n})(typeof yi=="object"?yi.exports:{});try{regeneratorRuntime=Ei}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=Ei:Function("r","regeneratorRuntime = r")(Ei)}});var Xt=de((cp,Qi)=>{"use strict";Qi.exports=(n,t)=>`${n}-${t}-${Math.random().toString(16).slice(3,8)}`});var Ai=de((vp,en)=>{"use strict";var ro=Xt(),Xi=0;en.exports=({id:n,action:t,payload:e={}})=>{let o=n;return typeof o>"u"&&(o=ro("Job",Xi),Xi+=1),{id:o,action:t,payload:e}}});var ei=de(Ct=>{"use strict";var Fi=!1;Ct.logging=Fi;Ct.setLogging=n=>{Fi=n};Ct.log=(...n)=>Fi?console.log.apply(Ct,n):null});var an=de((nn,rn)=>{"use strict";var ao=Ai(),{log:ti}=ei(),oo=Xt(),tn=0;rn.exports=()=>{let n=oo("Scheduler",tn),t={},e={},o=[];tn+=1;let s=()=>o.length,c=()=>Object.keys(t).length,F=()=>{if(o.length!==0){let ie=Object.keys(t);for(let fe=0;fe<ie.length;fe+=1)if(typeof e[ie[fe]]>"u"){o[0](t[ie[fe]]);break}}},P=(ie,fe)=>new Promise((Me,$e)=>{let he=ao({action:ie,payload:fe});o.push(async ne=>{o.shift(),e[ne.id]=he;try{Me(await ne[ie].apply(nn,[...fe,he.id]))}catch(Ie){$e(Ie)}finally{delete e[ne.id],F()}}),ti(`[${n}]: Add ${he.id} to JobQueue`),ti(`[${n}]: JobQueue length=${o.length}`),F()});return{addWorker:ie=>(t[ie.id]=ie,ti(`[${n}]: Add ${ie.id}`),ti(`[${n}]: Number of workers=${c()}`),F(),ie.id),addJob:async(ie,...fe)=>{if(c()===0)throw Error(`[${n}]: You need to have at least one worker before adding jobs`);return P(ie,fe)},terminate:async()=>{Object.keys(t).forEach(async ie=>{await t[ie].terminate()}),o=[]},getQueueLen:s,getNumWorkers:c}}});var ln=de((_p,on)=>{"use strict";on.exports=n=>{let t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof Li=="function"&&(t.type="node"),typeof n>"u"?t:t[n]}});var mn=de((bp,sn)=>{"use strict";var lo=ln()("type")==="browser",so=lo?n=>new URL(n,window.location.href).href:n=>n;sn.exports=n=>{let t=me({},n);return["corePath","workerPath","langPath"].forEach(e=>{n[e]&&(t[e]=so(t[e]))}),t}});var Ti=de((hp,dn)=>{"use strict";dn.exports={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}});var un=de((Sp,mo)=>{mo.exports={name:"tesseract.js",version:"7.0.0",description:"Pure Javascript Multilingual OCR",main:"src/index.js",type:"commonjs",types:"src/index.d.ts",unpkg:"dist/tesseract.min.js",jsdelivr:"dist/tesseract.min.js",scripts:{start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js && rollup -c scripts/rollup.esm.mjs","profile:tesseract":"webpack-bundle-analyzer dist/tesseract-stats.json","profile:worker":"webpack-bundle-analyzer dist/worker-stats.json",prepublishOnly:"npm run build",wait:"rimraf dist && wait-on http://localhost:3000/dist/tesseract.min.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser test:node:all","test:browser":"karma start karma.conf.js","test:node":"nyc mocha --exit --bail --require ./scripts/test-helper.mjs","test:node:all":"npm run test:node -- ./tests/*.test.mjs",lint:"eslint src","lint:fix":"eslint --fix src",postinstall:"opencollective-postinstall || true"},browser:{"./src/worker/node/index.js":"./src/worker/browser/index.js"},author:"",contributors:["jeromewu"],license:"Apache-2.0",devDependencies:{"@babel/core":"^7.21.4","@babel/eslint-parser":"^7.21.3","@babel/preset-env":"^7.21.4","@rollup/plugin-commonjs":"^24.1.0",acorn:"^8.8.2","babel-loader":"^9.1.2",buffer:"^6.0.3",cors:"^2.8.5",eslint:"^7.32.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.27.5","expect.js":"^0.3.1",express:"^4.18.2",mocha:"^10.2.0","npm-run-all":"^4.1.5",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-webpack":"^5.0.0",nyc:"^15.1.0",rimraf:"^5.0.0",rollup:"^3.20.7","wait-on":"^7.0.1",webpack:"^5.79.0","webpack-bundle-analyzer":"^4.8.0","webpack-cli":"^5.0.1","webpack-dev-middleware":"^6.0.2","rollup-plugin-sourcemaps":"^0.6.3"},dependencies:{"bmp-js":"^0.1.0","idb-keyval":"^6.2.0","is-url":"^1.2.4","node-fetch":"^2.6.9","opencollective-postinstall":"^2.0.3","regenerator-runtime":"^0.13.3","tesseract.js-core":"^7.0.0","wasm-feature-detect":"^1.8.0",zlibjs:"^0.3.1"},overrides:{"@rollup/pluginutils":"^5.0.2"},repository:{type:"git",url:"https://github.com/naptha/tesseract.js.git"},bugs:{url:"https://github.com/naptha/tesseract.js/issues"},homepage:"https://github.com/naptha/tesseract.js",collective:{type:"opencollective",url:"https://opencollective.com/tesseractjs"}}});var cn=de((Cp,pn)=>{"use strict";pn.exports={workerBlobURL:!0,logger:()=>{}}});var fn=de((Ep,vn)=>{"use strict";var uo=un().version,po=cn();vn.exports=Pe(me({},po),{workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${uo}/dist/worker.min.js`})});var gn=de((Ap,_n)=>{"use strict";_n.exports=({workerPath:n,workerBlobURL:t})=>{let e;if(Blob&&URL&&t){let o=new Blob([`importScripts("${n}");`],{type:"application/javascript"});e=new Worker(URL.createObjectURL(o))}else e=new Worker(n);return e}});var xn=de((Fp,bn)=>{"use strict";bn.exports=n=>{n.terminate()}});var Sn=de((Tp,hn)=>{"use strict";hn.exports=(n,t)=>{n.onmessage=({data:e})=>{t(e)}}});var En=de((wp,Cn)=>{"use strict";Cn.exports=async(n,t)=>{n.postMessage(t)}});var An=de((Dp,yn)=>{"use strict";var wi=n=>new Promise((t,e)=>{let o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=({target:{error:{code:s}}})=>{e(Error(`File could not be read! Code=${s}`))},o.readAsArrayBuffer(n)}),Di=async n=>{let t=n;if(typeof n>"u")return"undefined";if(typeof n=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(n)?t=atob(n.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(n)).arrayBuffer();else if(typeof HTMLElement<"u"&&n instanceof HTMLElement)n.tagName==="IMG"&&(t=await Di(n.src)),n.tagName==="VIDEO"&&(t=await Di(n.poster)),n.tagName==="CANVAS"&&await new Promise(e=>{n.toBlob(async o=>{t=await wi(o),e()})});else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas){let e=await n.convertToBlob();t=await wi(e)}else(n instanceof File||n instanceof Blob)&&(t=await wi(n));return new Uint8Array(t)};yn.exports=Di});var Tn=de((kp,Fn)=>{"use strict";var co=fn(),vo=gn(),fo=xn(),_o=Sn(),go=En(),bo=An();Fn.exports={defaultOptions:co,spawnWorker:vo,terminateWorker:fo,onMessage:_o,send:go,loadImage:bo}});var ki=de((Lp,Ln)=>{"use strict";var xo=mn(),He=Ai(),{log:wn}=ei(),ho=Xt(),it=Ti(),{defaultOptions:So,spawnWorker:Co,terminateWorker:Eo,onMessage:yo,loadImage:Dn,send:Ao}=Tn(),kn=0;Ln.exports=async(n="eng",t=it.LSTM_ONLY,e={},o={})=>{let s=ho("Worker",kn),A=xo(me(me({},So),e)),{logger:c,errorHandler:F}=A,P=Lt(A,["logger","errorHandler"]),B={},J=typeof n=="string"?n.split("+"):n,je=t,ie=o,fe=[it.DEFAULT,it.LSTM_ONLY].includes(t)&&!P.legacyCore,Me,$e,he=new Promise((_,h)=>{$e=_,Me=h}),ne=_=>{Me(_.message)},Ie=Co(P);Ie.onerror=ne,kn+=1;let Ee=({id:_,action:h,payload:j})=>new Promise((k,U)=>{wn(`[${s}]: Start ${_}, action=${h}`);let oe=`${h}-${_}`;B[oe]={resolve:k,reject:U},Ao(Ie,{workerId:s,jobId:_,action:h,payload:j})}),Je=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),mt=_=>Ee(He({id:_,action:"load",payload:{options:{lstmOnly:fe,corePath:P.corePath,logging:P.logging}}})),dt=(_,h,j)=>Ee(He({id:j,action:"FS",payload:{method:"writeFile",args:[_,h]}})),nt=(_,h)=>Ee(He({id:h,action:"FS",payload:{method:"readFile",args:[_,{encoding:"utf8"}]}})),ze=(_,h)=>Ee(He({id:h,action:"FS",payload:{method:"unlink",args:[_]}})),wt=(_,h,j)=>Ee(He({id:j,action:"FS",payload:{method:_,args:h}})),Qe=(_,h)=>Ee(He({id:h,action:"loadLanguage",payload:{langs:_,options:{langPath:P.langPath,dataPath:P.dataPath,cachePath:P.cachePath,cacheMethod:P.cacheMethod,gzip:P.gzip,lstmOnly:[it.DEFAULT,it.LSTM_ONLY].includes(je)&&!P.legacyLang}}})),ut=(_,h,j,k)=>Ee(He({id:k,action:"initialize",payload:{langs:_,oem:h,config:j}})),Dt=(_="eng",h,j,k)=>{if(fe&&[it.TESSERACT_ONLY,it.TESSERACT_LSTM_COMBINED].includes(h))throw Error("Legacy model requested but code missing.");let U=h||je;je=U;let oe=j||ie;ie=oe;let Se=(typeof _=="string"?_.split("+"):_).filter(Ce=>!J.includes(Ce));return J.push(...Se),Se.length>0?Qe(Se,k).then(()=>ut(_,U,oe,k)):ut(_,U,oe,k)},gi=(_={},h)=>Ee(He({id:h,action:"setParameters",payload:{params:_}})),pt=async(_,h={},j={text:!0},k)=>Ee(He({id:k,action:"recognize",payload:{image:await Dn(_),options:h,output:j}})),ct=async(_,h)=>{if(fe)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return Ee(He({id:h,action:"detect",payload:{image:await Dn(_)}}))},vt=async()=>(Ie!==null&&(Eo(Ie),Ie=null),Promise.resolve());yo(Ie,({workerId:_,jobId:h,status:j,action:k,data:U})=>{let oe=`${k}-${h}`;if(j==="resolve")wn(`[${_}]: Complete ${h}`),B[oe].resolve({jobId:h,data:U}),delete B[oe];else if(j==="reject")if(B[oe].reject(U),delete B[oe],k==="load"&&Me(U),F)F(U);else throw Error(U);else j==="progress"&&c(Pe(me({},U),{userJobId:h}))});let kt={id:s,worker:Ie,load:Je,writeText:dt,readText:nt,removeFile:ze,FS:wt,reinitialize:Dt,setParameters:gi,recognize:pt,detect:ct,terminate:vt};return mt().then(()=>Qe(n)).then(()=>ut(n,t,o)).then(()=>$e(kt)).catch(()=>{}),he}});var Rn=de((Pp,Pn)=>{"use strict";var In=ki(),Fo=async(n,t,e)=>{let o=await In(t,1,e);return o.recognize(n).finally(async()=>{await o.terminate()})},To=async(n,t)=>{let e=await In("osd",0,t);return e.detect(n).finally(async()=>{await e.terminate()})};Pn.exports={recognize:Fo,detect:To}});var jn=de((Rp,Bn)=>{"use strict";Bn.exports={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}});var Vn=de((Bp,Mn)=>{"use strict";Mn.exports={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}});var On=de((jp,Nn)=>{"use strict";Zi();var wo=an(),Do=ki(),ko=Rn(),Lo=jn(),Io=Ti(),Po=Vn(),{setLogging:Ro}=ei();Nn.exports=me({languages:Lo,OEM:Io,PSM:Po,createScheduler:wo,createWorker:Do,setLogging:Ro},ko)});function Le(n,t){let e=t?.injector??g(Ri),o=new Ii(1),s=Bi(()=>{let c;try{c=n()}catch(F){Si(()=>o.error(F));return}Si(()=>o.next(c))},{injector:e,manualCleanup:!0});return e.get(It).onDestroy(()=>{s.destroy(),o.complete()}),o.asObservable()}function Ae(n,t){let o=!t?.manualCleanup?t?.injector?.get(It)??g(It):null,s=zn(t?.equal),c;t?.requireSync?c=M({kind:0},{equal:s}):c=M({kind:1,value:t?.initialValue},{equal:s});let F,P=n.subscribe({next:B=>c.set({kind:1,value:B}),error:B=>{c.set({kind:2,error:B}),F?.()},complete:()=>{F?.()}});if(t?.requireSync&&c().kind===0)throw new hi(601,!1);return F=o?.onDestroy(P.unsubscribe.bind(P)),$(()=>{let B=c();switch(B.kind){case 1:return B.value;case 2:throw B.error;case 0:throw new hi(601,!1)}},{equal:t?.equal})}function zn(n=Object.is){return(t,e)=>t.kind===1&&e.kind===1&&n(t.value,e.value)}var rt=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/users`)}getPaged(t,e){return this.http.get(`${T.apiUrl}/users`,{params:{page:t,pageSize:e}})}getById(t){return this.http.get(`${T.apiUrl}/users/${t}`)}create(t){return this.http.post(`${T.apiUrl}/users`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/users/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/users/${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ue=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/roles`)}getById(t){return this.http.get(`${T.apiUrl}/roles/${t}`)}create(t){return this.http.post(`${T.apiUrl}/roles`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/roles/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/roles/${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var Yn=n=>[n,"edit"],Wn=n=>[n],Kn=(n,t)=>t.id;function Zn(n,t){if(n&1&&(i(0,"div",21),a(1),r()),n&2){let e=m().$implicit;l(),E("\u4EE3\u7406\u4EBA\uFF1A",e.agentName)}}function Qn(n,t){if(n&1&&(i(0,"div",24),a(1),R(2,"date"),r()),n&2){let e=m().$implicit;l(),E("\u96E2\u8077\uFF1A",q(2,1,e.resignDate,"yyyy-MM-dd"))}}function Xn(n,t){if(n&1&&(i(0,"span",25),a(1),r()),n&2){let e=t.$implicit,o=m(2);l(),v(o.getRoleNames(ae(1,Wn,e)))}}function er(n,t){if(n&1){let e=D();i(0,"tr")(1,"td")(2,"div",20),a(3),r(),u(4,Zn,2,1,"div",21),r(),i(5,"td",22),a(6),r(),i(7,"td",15),a(8),r(),i(9,"td",15),a(10),r(),i(11,"td",23),a(12),R(13,"date"),u(14,Qn,3,4,"div",24),r(),i(15,"td",16),a(16),R(17,"currency"),r(),i(18,"td"),L(19,Xn,2,3,"span",25,_e),r(),i(21,"td",17)(22,"span",26),a(23),r()(),i(24,"td",27)(25,"div",28)(26,"a",29),f(),i(27,"svg",7),d(28,"use",30),r()(),y(),i(29,"button",31),x("click",function(){let s=S(e).$implicit,c=m();return C(c.delete(s))}),f(),i(30,"svg",7),d(31,"use",32),r()()()()()}if(n&2){let e=t.$implicit;l(3),v(e.name),l(),p(e.agentName?4:-1),l(2),v(e.email),l(2),E(" ",e.departmentName||"\u2014"," "),l(2),E(" ",e.jobTitleName||"\u2014"," "),l(2),E(" ",e.hireDate?q(13,14,e.hireDate,"yyyy-MM-dd"):"\u2014"," "),l(2),p(e.resignDate?14:-1),l(2),E(" ",e.baseSalary?Oi(17,17,e.baseSalary,"TWD","symbol","1.0-0"):"\u2014"," "),l(3),I(e.roleIds),l(3),O("bg-success",e.status==="active")("bg-secondary",e.status==="inactive"),l(),E(" ",e.status==="active"?"\u5728\u8077":"\u96E2\u8077"," "),l(3),b("routerLink",ae(22,Yn,e.id))}}function tr(n,t){n&1&&(i(0,"tr")(1,"td",33),a(2,"\u5C1A\u7121\u54E1\u5DE5\u8CC7\u6599\u3002"),r()())}function ir(n,t){n&1&&(i(0,"li",41)(1,"span",43),a(2,"\u2026"),r()())}function nr(n,t){if(n&1){let e=D();i(0,"li",39)(1,"button",40),x("click",function(){S(e);let s=m().$implicit,c=m(2);return C(c.goTo(s))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);O("active",e===o.page()),l(2),v(e)}}function rr(n,t){if(n&1&&u(0,ir,3,0,"li",41)(1,nr,3,3,"li",42),n&2){let e=t.$implicit;p(e===-1?0:1)}}function ar(n,t){if(n&1){let e=D();i(0,"div",19)(1,"span",34),a(2),r(),i(3,"div",35)(4,"button",36),x("click",function(){S(e);let s=m();return C(s.prev())}),a(5,"\u2039"),r(),i(6,"span",37),a(7),r(),i(8,"button",36),x("click",function(){S(e);let s=m();return C(s.next())}),a(9,"\u203A"),r()(),i(10,"ul",38)(11,"li",39)(12,"button",40),x("click",function(){S(e);let s=m();return C(s.prev())}),a(13,"\u2039"),r()(),L(14,rr,2,1,null,null,_e),i(16,"li",39)(17,"button",40),x("click",function(){S(e);let s=m();return C(s.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();l(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),l(2),O("disabled",e.page()===1),l(3),z("",e.page()," / ",e.totalPages()),l(),O("disabled",e.page()===e.totalPages()),l(3),O("disabled",e.page()===1),l(3),I(e.pageNumbers()),l(2),O("disabled",e.page()===e.totalPages())}}var Nt=class n{userService=g(rt);roleService=g(Ue);roles=Ae(this.roleService.getAll(),{initialValue:[]});PAGE_SIZE=20;page=M(1);refresh=M(0);result=Ae(Le($(()=>({page:this.page(),refresh:this.refresh()}))).pipe(ue(({page:t})=>this.userService.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedUsers=$(()=>this.result().items);totalCount=$(()=>this.result().totalCount);totalPages=$(()=>this.result().totalPages);pageNumbers=$(()=>or(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}getRoleNames(t){let e=this.roles();return t.map(o=>e.find(s=>s.id===o)?.name??o).join(", ")}delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u54E1\u5DE5\u300C${t.name}\u300D\u55CE\uFF1F`)&&this.userService.delete(t.id).subscribe(()=>this.refresh.update(e=>e+1))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-user-list"]],decls:40,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#user"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"hidden","xl:table-cell"],[1,"hidden","sm:table-cell"],[1,"text-right"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500"],[1,"text-muted","small"],[1,"text-muted","hidden","md:table-cell"],[1,"text-muted","small","hidden","xl:table-cell"],[1,"text-danger"],[1,"badge","bg-secondary","me-1"],[1,"badge"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","9",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u54E1\u5DE5\u7BA1\u7406"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u54E1\u5DE5 "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u59D3\u540D"),r(),i(19,"th",14),a(20,"Email"),r(),i(21,"th",15),a(22,"\u90E8\u9580"),r(),i(23,"th",15),a(24,"\u8077\u7A31"),r(),i(25,"th",16),a(26,"\u5165\u8077\u65E5"),r(),i(27,"th",16),a(28,"\u5E95\u85AA"),r(),i(29,"th"),a(30,"\u89D2\u8272"),r(),i(31,"th",17),a(32,"\u72C0\u614B"),r(),i(33,"th",18),a(34,"\u64CD\u4F5C"),r()()(),i(35,"tbody"),L(36,er,32,24,"tr",null,Kn,!1,tr,3,0,"tr"),r()()(),u(39,ar,19,13,"div",19),r()()()),e&2&&(l(36),I(o.pagedUsers()),l(3),p(o.totalPages()>1?39:-1))},dependencies:[N,ge,qi],encapsulation:2})};function or(n,t){if(t<=9)return Array.from({length:t},(s,c)=>c+1);let e=[],o=0;for(let s=1;s<=t;s++)(s===1||s===t||s>=n-2&&s<=n+2)&&(o&&s-o>1&&e.push(-1),e.push(s),o=s);return e}var Oe=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/departments`)}getById(t){return this.http.get(`${T.apiUrl}/departments/${t}`)}create(t){return this.http.post(`${T.apiUrl}/departments`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/departments/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/departments/${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ge=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/job-titles`)}getById(t){return this.http.get(`${T.apiUrl}/job-titles/${t}`)}create(t){return this.http.post(`${T.apiUrl}/job-titles`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/job-titles/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/job-titles/${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ot=(n,t)=>t.id;function lr(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",39),d(2,"use",40),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function sr(n,t){n&1&&(i(0,"div",18),a(1,"\u8ACB\u8F38\u5165\u59D3\u540D\u3002"),r())}function mr(n,t){n&1&&(i(0,"div",18),a(1,"\u8ACB\u8F38\u5165\u6709\u6548\u7684\u96FB\u5B50\u90F5\u4EF6\u3002"),r())}function dr(n,t){if(n&1&&(i(0,"div",24),d(1,"input",41),i(2,"label",42),a(3),r()()),n&2){let e=t.$implicit;l(),b("id","role-"+e.id)("value",e.id),l(),b("for","role-"+e.id),l(),v(e.name)}}function ur(n,t){n&1&&(i(0,"div",18),a(1,"\u8ACB\u9078\u64C7\u89D2\u8272\u3002"),r())}function pr(n,t){if(n&1&&(i(0,"option",26),a(1),r()),n&2){let e=t.$implicit;b("ngValue",e.id),l(),v(e.name)}}function cr(n,t){if(n&1&&(i(0,"option",26),a(1),r()),n&2){let e=t.$implicit;b("ngValue",e.id),l(),z("",e.name,"\uFF08L",e.level,"\uFF09")}}function vr(n,t){if(n&1&&(i(0,"option",35),a(1),r()),n&2){let e=t.$implicit;b("value",e.id),l(),v(e.name)}}var _t=class n{fb=g(ee);userService=g(rt);roleService=g(Ue);deptService=g(Oe);jtService=g(Ge);route=g(le);router=g(ve);roles=[];departments=[];jobTitles=[];allUsers=[];isEdit=!1;userId="";errorMsg=M("");form=this.fb.group({name:["",w.required],email:["",[w.required,w.email]],roleId:["",w.required],status:["active",w.required],departmentId:[null],jobTitleId:[null],hireDate:[""],resignDate:[""],baseSalary:[null],agentUserId:[""]});ngOnInit(){this.roleService.getAll().subscribe(t=>this.roles=t),this.deptService.getAll().subscribe(t=>this.departments=t),this.jtService.getAll().subscribe(t=>this.jobTitles=t),this.userService.getAll().subscribe(t=>this.allUsers=t),this.userId=this.route.snapshot.paramMap.get("id")??"",this.userId&&(this.isEdit=!0,this.userService.getById(this.userId).subscribe(t=>{t&&this.form.patchValue(Pe(me({},t),{roleId:t.roleIds[0]??"",departmentId:t.departmentId??null,jobTitleId:t.jobTitleId??null,hireDate:t.hireDate?this.toDateString(t.hireDate):"",resignDate:t.resignDate?this.toDateString(t.resignDate):"",baseSalary:t.baseSalary??null,agentUserId:t.agentUserId??""}))}))}getAvailableAgents(){return this.allUsers.filter(t=>t.id!==this.userId)}toDateString(t){return new Date(t).toISOString().substring(0,10)}submit(){if(this.form.invalid)return;let he=this.form.value,{roleId:t,hireDate:e,resignDate:o,departmentId:s,jobTitleId:c,agentUserId:F}=he,P=Lt(he,["roleId","hireDate","resignDate","departmentId","jobTitleId","agentUserId"]),B=s||void 0,J=c||void 0,je=B?this.departments.find(ne=>ne.id===B)?.name:void 0,ie=J?this.jobTitles.find(ne=>ne.id===J)?.name:void 0,fe=F?this.allUsers.find(ne=>ne.id===F):void 0,Me=Pe(me({},P),{roleIds:t?[t]:[],departmentId:B,departmentName:je,jobTitleId:J,jobTitleName:ie,hireDate:e?new Date(e):void 0,resignDate:o?new Date(o):void 0,agentUserId:F||void 0,agentName:fe?.name}),$e=this.isEdit?this.userService.update(this.userId,Me):this.userService.create(Me);this.errorMsg.set(""),$e.subscribe({next:()=>this.router.navigate(["/admin/users"]),error:ne=>{this.errorMsg.set(ne.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-user-form"]],decls:96,vars:10,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/users",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[1,"row"],[1,"col-12","col-xl-8"],[3,"ngSubmit","formGroup"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-header","bg-transparent","fw-500"],[1,"card-body"],[1,"row","g-3"],[1,"col-12","col-md-6"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u8ACB\u8F38\u5165\u59D3\u540D",1,"form-control"],[1,"text-danger","small","mt-1"],["type","email","formControlName","email","placeholder","user@example.com",1,"form-control"],["formControlName","status",1,"form-select"],["value","active"],["value","inactive"],[1,"flex","flex-wrap","gap-4","mt-1"],[1,"form-check"],["formControlName","departmentId",1,"form-select"],[3,"ngValue"],["formControlName","jobTitleId",1,"form-select"],["type","date","formControlName","hireDate",1,"form-control"],["type","date","formControlName","resignDate",1,"form-control"],[1,"input-group"],[1,"input-group-text"],["type","number","formControlName","baseSalary","placeholder","\u4F8B\u5982\uFF1A50000","min","0",1,"form-control"],["formControlName","agentUserId",1,"form-select"],["value",""],[3,"value"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/users",1,"btn","btn-outline-secondary"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"],["type","radio","name","roleId","formControlName","roleId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,lr,4,1,"div",6),i(8,"div",7)(9,"div",8)(10,"form",9),x("ngSubmit",function(){return o.submit()}),i(11,"div",10)(12,"div",11),a(13,"\u57FA\u672C\u8CC7\u6599"),r(),i(14,"div",12)(15,"div",13)(16,"div",14)(17,"label",15),a(18,"\u59D3\u540D "),i(19,"span",16),a(20,"*"),r()(),d(21,"input",17),u(22,sr,2,0,"div",18),r(),i(23,"div",14)(24,"label",15),a(25,"Email "),i(26,"span",16),a(27,"*"),r()(),d(28,"input",19),u(29,mr,2,0,"div",18),r(),i(30,"div",14)(31,"label",15),a(32,"\u72C0\u614B"),r(),i(33,"select",20)(34,"option",21),a(35,"\u5728\u8077"),r(),i(36,"option",22),a(37,"\u96E2\u8077"),r()()(),i(38,"div",14)(39,"label",15),a(40,"\u89D2\u8272 "),i(41,"span",16),a(42,"*"),r()(),i(43,"div",23),L(44,dr,4,4,"div",24,Ot),r(),u(46,ur,2,0,"div",18),r()()()(),i(47,"div",10)(48,"div",11),a(49,"\u54E1\u5DE5\u8CC7\u8A0A"),r(),i(50,"div",12)(51,"div",13)(52,"div",14)(53,"label",15),a(54,"\u90E8\u9580"),r(),i(55,"select",25)(56,"option",26),a(57,"\u2014 \u672A\u6307\u5B9A \u2014"),r(),L(58,pr,2,2,"option",26,Ot),r()(),i(60,"div",14)(61,"label",15),a(62,"\u8077\u7A31"),r(),i(63,"select",27)(64,"option",26),a(65,"\u2014 \u672A\u6307\u5B9A \u2014"),r(),L(66,cr,2,3,"option",26,Ot),r()(),i(68,"div",14)(69,"label",15),a(70,"\u5165\u8077\u65E5"),r(),d(71,"input",28),r(),i(72,"div",14)(73,"label",15),a(74,"\u96E2\u8077\u65E5"),r(),d(75,"input",29),r(),i(76,"div",14)(77,"label",15),a(78,"\u5E95\u85AA"),r(),i(79,"div",30)(80,"span",31),a(81,"NT$"),r(),d(82,"input",32),r()(),i(83,"div",14)(84,"label",15),a(85,"\u8077\u52D9\u4EE3\u7406\u4EBA"),r(),i(86,"select",33)(87,"option",34),a(88,"\u2014 \u7121\u4EE3\u7406\u4EBA \u2014"),r(),L(89,vr,2,2,"option",35,Ot),r()()()()(),i(91,"div",36)(92,"button",37),a(93),r(),i(94,"a",38),a(95,"\u53D6\u6D88"),r()()()()()()),e&2){let s,c,F;l(6),v(o.isEdit?"\u7DE8\u8F2F\u54E1\u5DE5":"\u65B0\u589E\u54E1\u5DE5"),l(),p(o.errorMsg()?7:-1),l(3),b("formGroup",o.form),l(12),p((s=o.form.get("name"))!=null&&s.invalid&&((s=o.form.get("name"))!=null&&s.touched)?22:-1),l(7),p((c=o.form.get("email"))!=null&&c.invalid&&((c=o.form.get("email"))!=null&&c.touched)?29:-1),l(15),I(o.roles),l(2),p((F=o.form.get("roleId"))!=null&&F.invalid&&((F=o.form.get("roleId"))!=null&&F.touched)?46:-1),l(10),b("ngValue",null),l(2),I(o.departments),l(6),b("ngValue",null),l(2),I(o.jobTitles),l(23),I(o.getAvailableAgents()),l(3),b("disabled",o.form.invalid),l(),E(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[te,Z,De,ke,Y,be,we,Ke,W,K,xe,X,Q,N],encapsulation:2})};var fr=n=>[n,"edit"],_r=(n,t)=>t.id;function gr(n,t){if(n&1){let e=D();i(0,"tr")(1,"td",17),a(2),r(),i(3,"td",18),a(4),r(),i(5,"td")(6,"span",19),a(7),r()(),i(8,"td",20),a(9),R(10,"date"),r(),i(11,"td",21)(12,"div",22)(13,"a",23),f(),i(14,"svg",7),d(15,"use",24),r()(),y(),i(16,"button",25),x("click",function(){let s=S(e).$implicit,c=m();return C(c.delete(s))}),f(),i(17,"svg",7),d(18,"use",26),r()()()()()}if(n&2){let e=t.$implicit;l(2),v(e.name),l(2),v(e.description),l(3),E("",e.permissionCodes.length," \u500B\u6B0A\u9650"),l(2),v(q(10,5,e.createdAt,"yyyy-MM-dd")),l(4),b("routerLink",ae(8,fr,e.id))}}function br(n,t){n&1&&(i(0,"tr")(1,"td",27),a(2,"\u5C1A\u7121\u89D2\u8272\u8CC7\u6599\u3002"),r()())}var qt=class n{roleService=g(Ue);refresh$=new Ve(void 0);roles$=this.refresh$.pipe(ue(()=>this.roleService.getAll()));delete(t){confirm(`Delete role "${t.name}"?`)&&this.roleService.delete(t.id).subscribe(()=>this.refresh$.next())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-role-list"]],decls:32,vars:3,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#shield"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"text-right"],[1,"fw-500"],[1,"text-muted","hidden","md:table-cell"],[1,"badge","bg-info"],[1,"text-muted","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","5",1,"text-center","text-muted","py-4"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u89D2\u8272\u7BA1\u7406"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u89D2\u8272 "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u540D\u7A31"),r(),i(19,"th",14),a(20,"\u63CF\u8FF0"),r(),i(21,"th"),a(22,"\u6B0A\u9650"),r(),i(23,"th",15),a(24,"\u5EFA\u7ACB\u65E5\u671F"),r(),i(25,"th",16),a(26,"\u64CD\u4F5C"),r()()(),i(27,"tbody"),L(28,gr,19,10,"tr",null,_r,!1,br,3,0,"tr"),R(31,"async"),r()()()()()()),e&2&&(l(28),I(Re(31,1,o.roles$)))},dependencies:[N,Ne,ge],encapsulation:2})};var Ze=class n{http=g(ce);items$=new Ve([]);getAll(){return this.http.get(`${T.apiUrl}/permissions`).pipe(Pi(t=>this.items$.next(t)))}getById(t){return this.http.get(`${T.apiUrl}/permissions/${t}`)}getModules(){return[...new Set(this.items$.getValue().map(t=>t.module))]}create(t){return this.http.post(`${T.apiUrl}/permissions`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/permissions/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/permissions/${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var xr=(n,t)=>t.id;function hr(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",24),d(2,"use",25),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function Sr(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31\u3002"),r())}function Cr(n,t){if(n&1){let e=D();i(0,"div",30)(1,"input",27),x("change",function(){let s=S(e).$implicit,c=m(2);return C(c.togglePermission(s.code))}),r(),i(2,"label",31),a(3),r()()}if(n&2){let e=t.$implicit,o=m(2);l(),b("id","perm-"+e.id)("checked",o.isPermissionSelected(e.code)),l(),b("for","perm-"+e.id),l(),v(e.name)}}function Er(n,t){if(n&1){let e=D();i(0,"div",12)(1,"div",26)(2,"input",27),x("change",function(s){let c=S(e).$implicit,F=m();return C(F.toggleModule(c,s.target.checked))}),r(),i(3,"label",28),a(4),r()(),i(5,"div",29),L(6,Cr,4,4,"div",30,xr),r()()}if(n&2){let e=t.$implicit,o=m();l(2),b("id","module-"+e)("checked",o.isModuleAllSelected(e)),l(),b("for","module-"+e),l(),v(e),l(2),I(o.getPermissionsByModule(e))}}var gt=class n{fb=g(ee);roleService=g(Ue);permissionService=g(Ze);route=g(le);router=g(ve);permissions=[];modules=[];isEdit=!1;roleId="";errorMsg=M("");form=this.fb.group({name:["",w.required],description:[""],permissionCodes:[[]]});ngOnInit(){this.permissionService.getAll().subscribe(t=>{this.permissions=t,this.modules=this.permissionService.getModules()}),this.roleId=this.route.snapshot.paramMap.get("id")??"",this.roleId&&(this.isEdit=!0,this.roleService.getById(this.roleId).subscribe(t=>{t&&this.form.patchValue(me({},t))}))}getPermissionsByModule(t){return this.permissions.filter(e=>e.module===t)}isPermissionSelected(t){return(this.form.value.permissionCodes??[]).includes(t)}togglePermission(t){let e=this.form.value.permissionCodes??[],o=e.includes(t)?e.filter(s=>s!==t):[...e,t];this.form.patchValue({permissionCodes:o})}toggleModule(t,e){let o=this.getPermissionsByModule(t).map(F=>F.code),s=this.form.value.permissionCodes??[],c=e?[...new Set([...s,...o])]:s.filter(F=>!o.includes(F));this.form.patchValue({permissionCodes:c})}isModuleAllSelected(t){return this.getPermissionsByModule(t).map(o=>o.code).every(o=>this.isPermissionSelected(o))}submit(){if(this.form.invalid)return;let t=this.form.value,e=this.isEdit?this.roleService.update(this.roleId,t):this.roleService.create(t);this.errorMsg.set(""),e.subscribe({next:()=>this.router.navigate(["/admin/roles"]),error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-role-form"]],decls:37,vars:7,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/roles",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-xl-10"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u4F8B\u5982\uFF1A\u4E3B\u7BA1",1,"form-control"],[1,"text-danger","small","mt-1"],[1,"mb-6"],["type","text","formControlName","description","placeholder","\u7C21\u77ED\u63CF\u8FF0",1,"form-control"],[1,"border","rounded","p-4"],[1,"text-muted","small","mt-1"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/roles",1,"btn","btn-outline-secondary"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"],[1,"flex","items-center","gap-2","mb-2"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label","fw-600",3,"for"],[1,"flex","flex-wrap","gap-4","ms-4"],[1,"form-check"],[1,"form-check-label","small",3,"for"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,hr,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.submit()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),a(15,"\u89D2\u8272\u540D\u7A31 "),i(16,"span",14),a(17,"*"),r()(),d(18,"input",15),u(19,Sr,2,0,"div",16),r(),i(20,"div",17)(21,"label",13),a(22,"\u63CF\u8FF0"),r(),d(23,"input",18),r(),i(24,"div",5)(25,"label",13),a(26,"\u6B0A\u9650"),r(),i(27,"div",19),L(28,Er,8,4,"div",12,_e),r(),i(30,"div",20),a(31),r()()()(),i(32,"div",21)(33,"button",22),a(34),r(),i(35,"a",23),a(36,"\u53D6\u6D88"),r()()()()()()),e&2){let s;l(6),v(o.isEdit?"\u7DE8\u8F2F\u89D2\u8272":"\u65B0\u589E\u89D2\u8272"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(11),p((s=o.form.get("name"))!=null&&s.invalid&&((s=o.form.get("name"))!=null&&s.touched)?19:-1),l(9),I(o.modules),l(3),E(" \u5DF2\u9078\u53D6 ",(o.form.value.permissionCodes==null?null:o.form.value.permissionCodes.length)??0," \u500B\u6B0A\u9650 "),l(2),b("disabled",o.form.invalid),l(),E(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[te,Z,Y,W,K,X,Q,N],encapsulation:2})};var yr=n=>[n,"edit"],Ar=(n,t)=>t.id;function Fr(n,t){if(n&1){let e=D();i(0,"tr")(1,"td")(2,"code",19),a(3),r()(),i(4,"td",20),a(5),r(),i(6,"td",21),a(7),r(),i(8,"td",22)(9,"div",23)(10,"a",24),f(),i(11,"svg",7),d(12,"use",25),r()(),y(),i(13,"button",26),x("click",function(){let s=S(e).$implicit,c=m(2);return C(c.delete(s))}),f(),i(14,"svg",7),d(15,"use",27),r()()()()()}if(n&2){let e=t.$implicit;l(3),v(e.code),l(2),v(e.name),l(2),v(e.description??"\u2014"),l(3),b("routerLink",ae(4,yr,e.id))}}function Tr(n,t){if(n&1&&(i(0,"div",9)(1,"div",10),f(),i(2,"svg",11),d(3,"use",12),r(),a(4),r(),y(),i(5,"div",13)(6,"div",14)(7,"table",15)(8,"thead",16)(9,"tr")(10,"th"),a(11,"\u4EE3\u78BC"),r(),i(12,"th"),a(13,"\u540D\u7A31"),r(),i(14,"th",17),a(15,"\u63CF\u8FF0"),r(),i(16,"th",18),a(17,"\u64CD\u4F5C"),r()()(),i(18,"tbody"),L(19,Fr,16,6,"tr",null,Ar),r()()()()()),n&2){let e=t.$implicit,o=m();l(4),E(" ",e," "),l(15),I(o.getByModule(e))}}var $t=class n{permissionService=g(Ze);modules=this.permissionService.getModules();allPermissions=[];constructor(){this.load()}getByModule(t){return this.allPermissions.filter(e=>e.module===t)}delete(t){confirm(`Delete permission "${t.name}"?`)&&this.permissionService.delete(t.id).subscribe(()=>this.load())}load(){this.permissionService.getAll().subscribe(t=>this.allPermissions=t)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-permission-list"]],decls:13,vars:0,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#lock"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-header","bg-[--bg-base]","fw-600","flex","items-center"],[1,"sa-icon","mr-2","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#folder"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"text-right"],[1,"text-primary"],[1,"fw-500"],[1,"text-muted","hidden","md:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u6B0A\u9650\u7BA1\u7406"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u6B0A\u9650 "),r()(),L(11,Tr,21,1,"div",9,_e),r()),e&2&&(l(11),I(o.modules))},dependencies:[N],encapsulation:2})};function wr(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",23),d(2,"use",24),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}var bt=class n{fb=g(ee);service=g(Ze);route=g(le);router=g(ve);isEdit=!1;permId="";errorMsg=M("");form=this.fb.group({code:["",w.required],name:["",w.required],module:["",w.required],description:[""]});ngOnInit(){this.permId=this.route.snapshot.paramMap.get("id")??"",this.permId&&(this.isEdit=!0,this.service.getById(this.permId).subscribe(t=>{t&&this.form.patchValue(me({},t))}))}submit(){if(this.form.invalid)return;let t=this.form.value,e=this.isEdit?this.service.update(this.permId,t):this.service.create(t);this.errorMsg.set(""),e.subscribe({next:()=>this.router.navigate(["/admin/permissions"]),error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-permission-form"]],decls:47,vars:5,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/permissions",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-8","col-xl-6"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","code","placeholder","module:action",1,"form-control","font-monospace"],[1,"text-muted","small","mt-1"],["type","text","formControlName","name","placeholder","\u986F\u793A\u540D\u7A31",1,"form-control"],["type","text","formControlName","module","placeholder","\u4F8B\u5982\uFF1AUsers\u3001Roles",1,"form-control"],["type","text","formControlName","description","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/permissions",1,"btn","btn-outline-secondary"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,wr,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.submit()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),a(15,"\u4EE3\u78BC "),i(16,"span",14),a(17,"*"),r()(),d(18,"input",15),i(19,"div",16),a(20,"\u4F8B\u5982\uFF1A"),i(21,"code"),a(22,"users:read"),r(),a(23,"\u3001"),i(24,"code"),a(25,"roles:write"),r()()(),i(26,"div",12)(27,"label",13),a(28,"\u540D\u7A31 "),i(29,"span",14),a(30,"*"),r()(),d(31,"input",17),r(),i(32,"div",12)(33,"label",13),a(34,"\u6A21\u7D44 "),i(35,"span",14),a(36,"*"),r()(),d(37,"input",18),r(),i(38,"div",5)(39,"label",13),a(40,"\u63CF\u8FF0"),r(),d(41,"input",19),r()()(),i(42,"div",20)(43,"button",21),a(44),r(),i(45,"a",22),a(46,"\u53D6\u6D88"),r()()()()()()),e&2&&(l(6),v(o.isEdit?"\u7DE8\u8F2F\u6B0A\u9650":"\u65B0\u589E\u6B0A\u9650"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(35),b("disabled",o.form.invalid),l(),E(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," "))},dependencies:[te,Z,Y,W,K,X,Q,N],encapsulation:2})};var Ut=class n{http=g(ce);get(){return this.http.get(`${T.apiUrl}/settings`)}save(t){return this.http.patch(`${T.apiUrl}/settings`,t)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};function Dr(n,t){if(n&1&&(i(0,"div",5),f(),i(1,"svg",25),d(2,"use",27),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function kr(n,t){n&1&&(i(0,"div",6),f(),i(1,"svg",25),d(2,"use",28),r(),a(3," \u8A2D\u5B9A\u5DF2\u5132\u5B58\u6210\u529F\u3002 "),r())}function Lr(n,t){n&1&&(i(0,"div",22),a(1,"\u8ACB\u8F38\u5165 0 \u5230 200 \u4E4B\u9593\u7684\u6578\u503C\u3002"),r())}var Gt=class n{fb=g(ee);settingsService=g(Ut);saved=!1;errorMsg=M("");form=this.fb.group({workStartTime:["09:00",w.required],workEndTime:["18:00",w.required],monthlyOvertimeLimit:[46,[w.required,w.min(0),w.max(200)]]});ngOnInit(){this.settingsService.get().subscribe(t=>this.form.patchValue(t))}submit(){this.form.invalid||(this.errorMsg.set(""),this.settingsService.save(this.form.value).subscribe({next:()=>{this.saved=!0,setTimeout(()=>this.saved=!1,3e3)},error:t=>{this.errorMsg.set(t.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-settings"]],decls:41,vars:5,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#settings"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],["role","alert",1,"alert","alert-success","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-md-6","col-xl-4"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#clock"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","time","formControlName","workStartTime",1,"form-control"],["type","time","formControlName","workEndTime",1,"form-control"],[1,"text-muted","font-normal"],["type","number","formControlName","monthlyOvertimeLimit","min","0","max","200",1,"form-control"],[1,"text-danger","small","mt-1"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary","inline-flex","items-center","gap-1",3,"disabled"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#save"],["href","/assets/icons/sprite.svg#alert-triangle"],["href","/assets/icons/sprite.svg#check-circle"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1),f(),i(2,"svg",2),d(3,"use",3),r(),y(),i(4,"h4",4),a(5,"\u7CFB\u7D71\u8A2D\u5B9A"),r()(),u(6,Dr,4,1,"div",5),u(7,kr,4,0,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.submit()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11),f(),i(13,"svg",12),d(14,"use",13),r(),a(15," \u5DE5\u4F5C\u6642\u9593 "),r(),y(),i(16,"div",14)(17,"div",15)(18,"label",16),a(19,"\u4E0A\u73ED\u6642\u9593 "),i(20,"span",17),a(21,"*"),r()(),d(22,"input",18),r(),i(23,"div",15)(24,"label",16),a(25,"\u4E0B\u73ED\u6642\u9593 "),i(26,"span",17),a(27,"*"),r()(),d(28,"input",19),r(),i(29,"div",4)(30,"label",16),a(31,"\u6BCF\u6708\u52A0\u73ED\u6642\u6578\u9650\u5236 "),i(32,"span",20),a(33,"\uFF08\u5C0F\u6642\uFF09"),r()(),d(34,"input",21),u(35,Lr,2,0,"div",22),r()()()()(),i(36,"div",23)(37,"button",24),f(),i(38,"svg",25),d(39,"use",26),r(),a(40," \u5132\u5B58\u8A2D\u5B9A "),r()()()()),e&2){let s;l(6),p(o.errorMsg()?6:-1),l(),p(o.saved?7:-1),l(),b("formGroup",o.form),l(27),p((s=o.form.get("monthlyOvertimeLimit"))!=null&&s.invalid&&((s=o.form.get("monthlyOvertimeLimit"))!=null&&s.touched)?35:-1),l(2),b("disabled",o.form.invalid)}},dependencies:[te,Z,Y,be,W,K,xe,Hi,X,Q],encapsulation:2})};var Ir=n=>[n,"edit"],Pr=(n,t)=>t.id;function Rr(n,t){n&1&&(i(0,"span",18),a(1,"\u2514"),r())}function Br(n,t){if(n&1){let e=D();i(0,"tr")(1,"td",17),u(2,Rr,2,0,"span",18),a(3),r(),i(4,"td",19)(5,"code"),a(6),r()(),i(7,"td",20),a(8),r(),i(9,"td",20),a(10),r(),i(11,"td")(12,"span",21),a(13),r()(),i(14,"td",22)(15,"div",23)(16,"a",24),f(),i(17,"svg",7),d(18,"use",25),r()(),y(),i(19,"button",26),x("click",function(){let s=S(e).$implicit,c=m();return C(c.delete(s))}),f(),i(20,"svg",7),d(21,"use",27),r()()()()()}if(n&2){let e=t.$implicit;l(2),p(e.parentId?2:-1),l(),E(" ",e.name," "),l(3),v(e.code??"\u2014"),l(2),v(e.parentName??"\u2014"),l(2),v(e.description??"\u2014"),l(3),E("",e.employeeCount," \u4EBA"),l(3),b("routerLink",ae(7,Ir,e.id))}}function jr(n,t){n&1&&(i(0,"tr")(1,"td",28),a(2,"\u5C1A\u7121\u90E8\u9580\u8CC7\u6599\u3002"),r()())}var Ht=class n{deptService=g(Oe);refresh$=new Ve(void 0);departments$=this.refresh$.pipe(ue(()=>this.deptService.getAll()));delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u90E8\u9580\u300C${t.name}\u300D\u55CE\uFF1F`)&&this.deptService.delete(t.id).subscribe(()=>this.refresh$.next())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-department-list"]],decls:34,vars:3,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#git-branch"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","sm:table-cell"],[1,"hidden","md:table-cell"],[1,"text-right"],[1,"fw-500"],[1,"text-muted","me-1"],[1,"text-muted","hidden","sm:table-cell"],[1,"text-muted","hidden","md:table-cell"],[1,"badge","bg-info"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","6",1,"text-center","text-muted","py-4"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u90E8\u9580\u7BA1\u7406"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u90E8\u9580 "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u90E8\u9580\u540D\u7A31"),r(),i(19,"th",14),a(20,"\u4EE3\u78BC"),r(),i(21,"th",15),a(22,"\u6BCD\u90E8\u9580"),r(),i(23,"th",15),a(24,"\u63CF\u8FF0"),r(),i(25,"th"),a(26,"\u4EBA\u6578"),r(),i(27,"th",16),a(28,"\u64CD\u4F5C"),r()()(),i(29,"tbody"),L(30,Br,22,9,"tr",null,Pr,!1,jr,3,0,"tr"),R(33,"async"),r()()()()()()),e&2&&(l(30),I(Re(33,1,o.departments$)))},dependencies:[N,Ne],encapsulation:2})};var Mr=(n,t)=>t.id;function Vr(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",26),d(2,"use",27),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function Nr(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165\u90E8\u9580\u540D\u7A31\u3002"),r())}function Or(n,t){if(n&1&&(i(0,"option",19),a(1),r()),n&2){let e=t.$implicit;b("ngValue",e.id),l(),v(e.name)}}var xt=class n{fb=g(ee);deptService=g(Oe);route=g(le);router=g(ve);departments=[];isEdit=!1;deptId=0;errorMsg=M("");form=this.fb.group({name:["",w.required],code:[""],description:[""],parentId:[null],sortOrder:[0]});ngOnInit(){this.deptService.getAll().subscribe(e=>this.departments=e);let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.deptId=+t,this.deptService.getById(this.deptId).subscribe(e=>{e&&this.form.patchValue(Pe(me({},e),{parentId:e.parentId??null}))}))}getAvailableParents(){return this.departments.filter(t=>t.id!==this.deptId)}submit(){if(this.form.invalid)return;let t=this.form.value,e=this.isEdit?this.deptService.update(this.deptId,t):this.deptService.create(t);this.errorMsg.set(""),e.subscribe({next:()=>this.router.navigate(["/admin/departments"]),error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-department-form"]],decls:47,vars:7,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/departments",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-8","col-xl-6"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u4F8B\u5982\uFF1A\u7814\u767C\u90E8",1,"form-control"],[1,"text-danger","small","mt-1"],["type","text","formControlName","code","placeholder","\u4F8B\u5982\uFF1ARD",1,"form-control","font-monospace"],["formControlName","parentId",1,"form-select"],[3,"ngValue"],["type","number","formControlName","sortOrder","min","0",1,"form-control"],[1,"text-muted","small","mt-1"],["formControlName","description","rows","2","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/departments",1,"btn","btn-outline-secondary"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,Vr,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.submit()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),a(15,"\u90E8\u9580\u540D\u7A31 "),i(16,"span",14),a(17,"*"),r()(),d(18,"input",15),u(19,Nr,2,0,"div",16),r(),i(20,"div",12)(21,"label",13),a(22,"\u90E8\u9580\u4EE3\u78BC"),r(),d(23,"input",17),r(),i(24,"div",12)(25,"label",13),a(26,"\u4E0A\u5C64\u90E8\u9580"),r(),i(27,"select",18)(28,"option",19),a(29,"\u2014 \u7121\uFF08\u9802\u5C64\u90E8\u9580\uFF09\u2014"),r(),L(30,Or,2,2,"option",19,Mr),r()(),i(32,"div",12)(33,"label",13),a(34,"\u6392\u5E8F\u865F"),r(),d(35,"input",20),i(36,"div",21),a(37,"\u6578\u5B57\u8D8A\u5C0F\u6392\u8D8A\u524D\u9762\u3002"),r()(),i(38,"div",5)(39,"label",13),a(40,"\u63CF\u8FF0"),r(),d(41,"textarea",22),r()()(),i(42,"div",23)(43,"button",24),a(44),r(),i(45,"a",25),a(46,"\u53D6\u6D88"),r()()()()()()),e&2){let s;l(6),v(o.isEdit?"\u7DE8\u8F2F\u90E8\u9580":"\u65B0\u589E\u90E8\u9580"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(11),p((s=o.form.get("name"))!=null&&s.invalid&&((s=o.form.get("name"))!=null&&s.touched)?19:-1),l(9),b("ngValue",null),l(2),I(o.getAvailableParents()),l(13),b("disabled",o.form.invalid),l(),E(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[te,Z,De,ke,Y,be,we,W,K,xe,X,Q,N],encapsulation:2})};var qr=n=>[n,"edit"],$r=(n,t)=>t.id;function Ur(n,t){if(n&1){let e=D();i(0,"tr")(1,"td",17),a(2),r(),i(3,"td")(4,"span",18),a(5),r()(),i(6,"td",19),a(7),r(),i(8,"td"),a(9),r(),i(10,"td",20),a(11),R(12,"date"),r(),i(13,"td",21)(14,"div",22)(15,"a",23),f(),i(16,"svg",7),d(17,"use",24),r()(),y(),i(18,"button",25),x("click",function(){let s=S(e).$implicit,c=m();return C(c.delete(s))}),f(),i(19,"svg",7),d(20,"use",26),r()()()()()}if(n&2){let e=t.$implicit;l(2),v(e.name),l(3),E("L",e.level),l(2),v(e.description||"\u2014"),l(2),v(e.employeeCount),l(2),v(q(12,6,e.createdAt,"yyyy-MM-dd")),l(4),b("routerLink",ae(9,qr,e.id))}}function Gr(n,t){n&1&&(i(0,"tr")(1,"td",27),a(2,"\u5C1A\u7121\u8077\u7A31\u8CC7\u6599\u3002"),r()())}var Jt=class n{jobTitleService=g(Ge);refresh$=new Ve(void 0);jobTitles$=this.refresh$.pipe(ue(()=>this.jobTitleService.getAll()));delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u8077\u7A31\u300C${t.name}\u300D\u55CE\uFF1F`)&&this.jobTitleService.delete(t.id).subscribe(()=>this.refresh$.next())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-job-title-list"]],decls:34,vars:3,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#briefcase"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"text-right"],[1,"fw-500"],[1,"badge","bg-secondary-subtle","text-secondary"],[1,"text-muted","hidden","md:table-cell"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","6",1,"text-center","text-muted","py-4"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u8077\u7A31\u7BA1\u7406"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u8077\u7A31 "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u8077\u7A31\u540D\u7A31"),r(),i(19,"th"),a(20,"\u7B49\u7D1A"),r(),i(21,"th",14),a(22,"\u63CF\u8FF0"),r(),i(23,"th"),a(24,"\u54E1\u5DE5\u4EBA\u6578"),r(),i(25,"th",15),a(26,"\u5EFA\u7ACB\u6642\u9593"),r(),i(27,"th",16),a(28,"\u64CD\u4F5C"),r()()(),i(29,"tbody"),L(30,Ur,21,11,"tr",null,$r,!1,Gr,3,0,"tr"),R(33,"async"),r()()()()()()),e&2&&(l(30),I(Re(33,1,o.jobTitles$)))},dependencies:[N,Ne,ge],encapsulation:2})};function Hr(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",23),d(2,"use",24),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function Jr(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165\u8077\u7A31\u540D\u7A31\u3002"),r())}function zr(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165\u6709\u6548\u7B49\u7D1A\uFF08\u6700\u5C0F\u503C\u70BA 1\uFF09\u3002"),r())}var ht=class n{fb=g(ee);jobTitleService=g(Ge);route=g(le);router=g(ve);isEdit=!1;jobTitleId=0;errorMsg=M("");form=this.fb.group({name:["",w.required],level:[1,[w.required,w.min(1)]],description:[""]});ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.jobTitleId=+t,this.jobTitleService.getById(this.jobTitleId).subscribe(e=>{e&&this.form.patchValue(e)}))}submit(){if(this.form.invalid)return;let t=this.form.value,e=this.isEdit?this.jobTitleService.update(this.jobTitleId,t):this.jobTitleService.create(t);this.errorMsg.set(""),e.subscribe({next:()=>this.router.navigate(["/admin/job-titles"]),error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-job-title-form"]],decls:38,vars:7,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/job-titles",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-6","col-xl-4"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u4F8B\u5982\uFF1A\u8CC7\u6DF1\u5DE5\u7A0B\u5E2B",1,"form-control"],[1,"text-danger","small","mt-1"],["type","number","formControlName","level","min","1","placeholder","\u4F8B\u5982\uFF1A2",1,"form-control"],[1,"text-muted","small","mt-1"],["formControlName","description","rows","2","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/job-titles",1,"btn","btn-outline-secondary"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,Hr,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.submit()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),a(15,"\u8077\u7A31\u540D\u7A31 "),i(16,"span",14),a(17,"*"),r()(),d(18,"input",15),u(19,Jr,2,0,"div",16),r(),i(20,"div",12)(21,"label",13),a(22,"\u7B49\u7D1A "),i(23,"span",14),a(24,"*"),r()(),d(25,"input",17),i(26,"div",18),a(27,"\u6578\u5B57\u8D8A\u5927\u7B49\u7D1A\u8D8A\u9AD8\u3002"),r(),u(28,zr,2,0,"div",16),r(),i(29,"div",5)(30,"label",13),a(31,"\u63CF\u8FF0"),r(),d(32,"textarea",19),r()()(),i(33,"div",20)(34,"button",21),a(35),r(),i(36,"a",22),a(37,"\u53D6\u6D88"),r()()()()()()),e&2){let s,c;l(6),v(o.isEdit?"\u7DE8\u8F2F\u8077\u7A31":"\u65B0\u589E\u8077\u7A31"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(11),p((s=o.form.get("name"))!=null&&s.invalid&&((s=o.form.get("name"))!=null&&s.touched)?19:-1),l(9),p((c=o.form.get("level"))!=null&&c.invalid&&((c=o.form.get("level"))!=null&&c.touched)?28:-1),l(6),b("disabled",o.form.invalid),l(),E(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[te,Z,Y,be,W,K,xe,X,Q,N],encapsulation:2})};var at=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/approval-items`)}getById(t){return this.http.get(`${T.apiUrl}/approval-items/${t}`)}create(t){return this.http.post(`${T.apiUrl}/approval-items`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/approval-items/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/approval-items/${t}`)}addStep(t,e){return this.http.post(`${T.apiUrl}/approval-items/${t}/steps`,e)}updateStep(t,e,o){return this.http.patch(`${T.apiUrl}/approval-items/${t}/steps/${e}`,o)}deleteStep(t,e){return this.http.delete(`${T.apiUrl}/approval-items/${t}/steps/${e}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var et={payment_request:"\u8ACB\u6B3E\u7533\u8ACB",leave:"\u8ACB\u5047\u7533\u8ACB",travel:"\u51FA\u5DEE\u7533\u8ACB",overtime:"\u52A0\u73ED\u7533\u8ACB"},tt={payment_request:"bg-info-subtle text-info",leave:"bg-success-subtle text-success",travel:"bg-primary-subtle text-primary",overtime:"bg-warning-subtle text-warning-emphasis"};var Yr=n=>[n,"flow"],Wr=(n,t)=>t.id,Kr=(n,t)=>t.value;function Zr(n,t){if(n&1&&(i(0,"div",9),f(),i(1,"svg",7),d(2,"use",20),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function Qr(n,t){n&1&&(i(0,"div",32),a(1,"\u8ACB\u8F38\u5165\u9805\u76EE\u540D\u7A31\u3002"),r())}function Xr(n,t){n&1&&(i(0,"div",32),a(1,"\u8ACB\u8F38\u5165\u4EE3\u78BC\u3002"),r())}function ea(n,t){if(n&1&&(i(0,"option",37),a(1),r()),n&2){let e=t.$implicit,o=m(),s=m(2);b("value",e.value)("disabled",s.isTypeDisabled(e.value,o)),l(),z(" ",e.label,"",s.isTypeDisabled(e.value,o)?"\uFF08\u5DF2\u8A2D\u5B9A\uFF09":""," ")}}function ta(n,t){if(n&1&&(i(0,"div",24)(1,"div",28)(2,"label",29),a(3,"\u9805\u76EE\u540D\u7A31 "),i(4,"span",30),a(5,"*"),r()(),d(6,"input",31),u(7,Qr,2,0,"div",32),r(),i(8,"div",33)(9,"label",29),a(10,"\u4EE3\u78BC "),i(11,"span",30),a(12,"*"),r()(),d(13,"input",34),u(14,Xr,2,0,"div",32),r(),i(15,"div",28)(16,"label",29),a(17,"\u63CF\u8FF0"),r(),d(18,"input",35),r(),i(19,"div",28)(20,"label",29),a(21,"\u9069\u7528\u985E\u578B"),r(),i(22,"select",36),L(23,ea,2,4,"option",37,Kr),r()(),i(25,"div",38)(26,"div",39),d(27,"input",40),i(28,"label",41),a(29,"\u555F\u7528"),r()()()()),n&2){let e,o,s=m(2);l(7),p((e=s.form.get("name"))!=null&&e.invalid&&((e=s.form.get("name"))!=null&&e.touched)?7:-1),l(7),p((o=s.form.get("code"))!=null&&o.invalid&&((o=s.form.get("code"))!=null&&o.touched)?14:-1),l(9),I(s.appTypeOptions)}}function ia(n,t){if(n&1){let e=D();i(0,"div",10)(1,"div",21),a(2),r(),i(3,"div",22)(4,"form",23),x("ngSubmit",function(){S(e);let s=m();return C(s.submit())}),u(5,ta,30,2,"div",24),R(6,"async"),i(7,"div",25)(8,"button",26),a(9),r(),i(10,"button",27),x("click",function(){S(e);let s=m();return C(s.closeForm())}),a(11,"\u53D6\u6D88"),r()()()()()}if(n&2){let e,o=m();l(2),E(" ",o.editItem?"\u7DE8\u8F2F\u7C3D\u6838\u9805\u76EE":"\u65B0\u589E\u7C3D\u6838\u9805\u76EE"," "),l(2),b("formGroup",o.form),l(),p((e=Re(6,5,o.items$))?5:-1,e),l(3),b("disabled",o.form.invalid),l(),E(" ",o.editItem?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}}function na(n,t){if(n&1&&(i(0,"span"),a(1),r()),n&2){let e=m().$implicit,o=m();re("badge "+o.appTypeClasses[e.applicationType]),l(),E(" ",o.appTypeLabels[e.applicationType]," ")}}function ra(n,t){n&1&&(i(0,"span",43),a(1,"\u901A\u7528"),r())}function aa(n,t){if(n&1){let e=D();i(0,"tr")(1,"td",42),a(2),r(),i(3,"td")(4,"code",43),a(5),r()(),i(6,"td",16),u(7,na,2,3,"span",44)(8,ra,2,0,"span",43),r(),i(9,"td",45),a(10),r(),i(11,"td")(12,"span",46),a(13),r()(),i(14,"td")(15,"span"),a(16),r()(),i(17,"td",47),a(18),R(19,"date"),r(),i(20,"td",48)(21,"div",49)(22,"a",50),f(),i(23,"svg",7),d(24,"use",51),r()(),y(),i(25,"button",52),x("click",function(){let s=S(e).$implicit,c=m();return C(c.openEdit(s))}),f(),i(26,"svg",7),d(27,"use",53),r()(),y(),i(28,"button",54),x("click",function(){let s=S(e).$implicit,c=m();return C(c.delete(s))}),f(),i(29,"svg",7),d(30,"use",55),r()()()()()}if(n&2){let e=t.$implicit;l(2),v(e.name),l(3),v(e.code),l(2),p(e.applicationType?7:8),l(3),v(e.description||"\u2014"),l(3),E("",e.steps.length," \u6B65"),l(2),re("badge "+(e.isActive?"bg-success-subtle text-success":"bg-secondary-subtle text-secondary")),l(),E(" ",e.isActive?"\u555F\u7528":"\u505C\u7528"," "),l(2),v(q(19,10,e.createdAt,"yyyy-MM-dd")),l(4),b("routerLink",ae(13,Yr,e.id))}}function oa(n,t){n&1&&(i(0,"tr")(1,"td",56),a(2,"\u5C1A\u7121\u7C3D\u6838\u9805\u76EE\u3002"),r()())}var zt=class n{approvalService=g(at);fb=g(ee);refresh$=new Ve(void 0);items$=this.refresh$.pipe(ue(()=>this.approvalService.getAll()));showForm=!1;editItem=null;errorMsg=M("");appTypeLabels=et;appTypeClasses=tt;appTypeOptions=[{value:"",label:"\u901A\u7528\uFF08\u4E0D\u7D81\u5B9A\uFF09"},{value:"payment_request",label:"\u8ACB\u6B3E\u7533\u8ACB"},{value:"leave",label:"\u8ACB\u5047\u7533\u8ACB"},{value:"travel",label:"\u51FA\u5DEE\u7533\u8ACB"}];form=this.fb.group({name:["",w.required],code:["",w.required],description:[""],isActive:[!0],applicationType:[""]});openCreate(){this.editItem=null,this.errorMsg.set(""),this.form.reset({isActive:!0,applicationType:""}),this.showForm=!0}openEdit(t){this.editItem=t,this.errorMsg.set(""),this.form.patchValue(Pe(me({},t),{applicationType:t.applicationType??""})),this.showForm=!0}closeForm(){this.showForm=!1}isTypeDisabled(t,e){return t?e.some(o=>o.applicationType===t&&o.id!==this.editItem?.id):!1}submit(){if(this.form.invalid)return;let t=this.form.value,e=Pe(me({},t),{applicationType:t.applicationType||void 0}),o=this.editItem?this.approvalService.update(this.editItem.id,e):this.approvalService.create(e);this.errorMsg.set(""),o.subscribe({next:()=>{this.showForm=!1,this.refresh$.next()},error:s=>{this.errorMsg.set(s.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u7C3D\u6838\u9805\u76EE\u300C${t.name}\u300D\u55CE\uFF1F`)&&this.approvalService.delete(t.id).subscribe(()=>this.refresh$.next())}toggleActive(t){this.approvalService.update(t.id,{isActive:!t.isActive}).subscribe(()=>this.refresh$.next())}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-approval-list"]],decls:40,vars:5,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#check-square"],[1,"mb-0"],[1,"btn","btn-primary","inline-flex","items-center","gap-1",3,"click"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[1,"card","border-0","shadow-sm","mb-6"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","xl:table-cell"],[1,"hidden","lg:table-cell"],[1,"text-right"],["href","/assets/icons/sprite.svg#alert-triangle"],[1,"card-header","bg-transparent","fw-500"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"flex","gap-2","mt-4"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"col-12","col-md-3"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u4F8B\u5982\uFF1A\u8ACB\u5047\u7533\u8ACB",1,"form-control"],[1,"text-danger","small","mt-1"],[1,"col-12","col-md-2"],["type","text","formControlName","code","placeholder","\u4F8B\u5982\uFF1Aleave_request",1,"form-control","font-monospace"],["type","text","formControlName","description","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],["formControlName","applicationType",1,"form-select"],[3,"value","disabled"],[1,"col-12","col-md-1","flex","items-end"],[1,"form-check"],["type","checkbox","formControlName","isActive","id","isActive",1,"form-check-input"],["for","isActive",1,"form-check-label"],[1,"fw-500"],[1,"text-muted","small"],[3,"class"],[1,"text-muted","hidden","xl:table-cell"],[1,"badge","bg-info-subtle","text-info"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u7BA1\u7406\u6D41\u7A0B",1,"btn","btn-sm","btn-ghost-info","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#git-merge"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","8",1,"text-center","text-muted","py-4"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u7C3D\u6838\u7BA1\u7406"),r()(),i(7,"button",6),x("click",function(){return o.openCreate()}),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u9805\u76EE "),r()(),u(11,Zr,4,1,"div",9),u(12,ia,12,7,"div",10),y(),i(13,"div",11)(14,"div",12)(15,"div",13)(16,"table",14)(17,"thead",15)(18,"tr")(19,"th"),a(20,"\u9805\u76EE\u540D\u7A31"),r(),i(21,"th"),a(22,"\u4EE3\u78BC"),r(),i(23,"th",16),a(24,"\u9069\u7528\u985E\u578B"),r(),i(25,"th",17),a(26,"\u63CF\u8FF0"),r(),i(27,"th"),a(28,"\u6B65\u9A5F\u6578"),r(),i(29,"th"),a(30,"\u72C0\u614B"),r(),i(31,"th",18),a(32,"\u5EFA\u7ACB\u6642\u9593"),r(),i(33,"th",19),a(34,"\u64CD\u4F5C"),r()()(),i(35,"tbody"),L(36,aa,31,15,"tr",null,Wr,!1,oa,3,0,"tr"),R(39,"async"),r()()()()()()),e&2&&(l(11),p(o.errorMsg()?11:-1),l(),p(o.showForm?12:-1),l(24),I(Re(39,3,o.items$)))},dependencies:[N,te,Z,De,ke,Y,$i,we,W,K,X,Q,Ne,ge],encapsulation:2})};var Ci=(n,t)=>t.id;function la(n,t){if(n&1&&(i(0,"div",10),f(),i(1,"svg",15),d(2,"use",20),r(),a(3),r()),n&2){let e=m(2);l(3),E(" ",e.errorMsg()," ")}}function sa(n,t){if(n&1&&(i(0,"p",11),a(1),r()),n&2){let e=m();l(),v(e.description)}}function ma(n,t){if(n&1&&(i(0,"option",31),a(1),r()),n&2){let e=t.$implicit;b("ngValue",e.id),l(),v(e.name)}}function da(n,t){if(n&1&&(i(0,"option",31),a(1),r()),n&2){let e=t.$implicit;b("ngValue",e.id),l(),z("",e.name,"\uFF08L",e.level,"\uFF09")}}function ua(n,t){if(n&1){let e=D();i(0,"div",17)(1,"div",21),a(2),r(),i(3,"div",22)(4,"form",23),x("ngSubmit",function(){S(e);let s=m(2);return C(s.submitStep())}),i(5,"div",24)(6,"div",25)(7,"label",26),a(8,"\u6B65\u9A5F\u9806\u5E8F "),i(9,"span",27),a(10,"*"),r()(),d(11,"input",28),r(),i(12,"div",29)(13,"label",26),a(14,"\u90E8\u9580"),r(),i(15,"select",30)(16,"option",31),a(17,"\u2014 \u4E0D\u9650\u90E8\u9580 \u2014"),r(),L(18,ma,2,2,"option",31,Ci),r()(),i(20,"div",29)(21,"label",26),a(22,"\u8077\u7A31"),r(),i(23,"select",32)(24,"option",31),a(25,"\u2014 \u4E0D\u9650\u8077\u7A31 \u2014"),r(),L(26,da,2,3,"option",31,Ci),r()(),i(28,"div",33)(29,"label",26),a(30,"\u6B65\u9A5F\u8AAA\u660E"),r(),d(31,"input",34),r()(),i(32,"div",35),a(33,"\u90E8\u9580\u6216\u8077\u7A31\u81F3\u5C11\u9078\u4E00\u3002"),r(),i(34,"div",36)(35,"button",37),a(36),r(),i(37,"button",38),x("click",function(){S(e);let s=m(2);return C(s.closeStepForm())}),a(38,"\u53D6\u6D88"),r()()()()()}if(n&2){let e=m(2);l(2),E(" ",e.editStep?"\u7DE8\u8F2F\u6B65\u9A5F":"\u65B0\u589E\u6B65\u9A5F"," "),l(2),b("formGroup",e.stepForm),l(12),b("ngValue",null),l(2),I(e.departments),l(6),b("ngValue",null),l(2),I(e.jobTitles),l(10),E(" ",e.editStep?"\u66F4\u65B0":"\u65B0\u589E"," ")}}function pa(n,t){n&1&&(i(0,"div",18)(1,"div",39),a(2,"\u5C1A\u672A\u8A2D\u5B9A\u4EFB\u4F55\u6B65\u9A5F"),r()())}function ca(n,t){if(n&1&&(i(0,"span",47),f(),i(1,"svg",55),d(2,"use",56),r(),a(3),r()),n&2){let e=m().$implicit;l(3),E(" ",e.departmentName," ")}}function va(n,t){if(n&1&&(i(0,"span",48),f(),i(1,"svg",55),d(2,"use",57),r(),a(3),r()),n&2){let e=m().$implicit;l(3),E(" ",e.jobTitleName," ")}}function fa(n,t){if(n&1&&(i(0,"span",49),a(1),r()),n&2){let e=m().$implicit;l(),v(e.note)}}function _a(n,t){if(n&1){let e=D();i(0,"div",40)(1,"div",41)(2,"div",42),a(3),r()(),i(4,"div",43)(5,"div",44)(6,"div",45)(7,"div",46),u(8,ca,4,1,"span",47),u(9,va,4,1,"span",48),u(10,fa,2,1,"span",49),r(),i(11,"div",50)(12,"button",51),x("click",function(){let s=S(e).$implicit,c=m(3);return C(c.openEditStep(s))}),f(),i(13,"svg",15),d(14,"use",52),r()(),y(),i(15,"button",53),x("click",function(){let s=S(e).$implicit,c=m(3);return C(c.deleteStep(s))}),f(),i(16,"svg",15),d(17,"use",54),r()()()()()()()}if(n&2){let e=t.$implicit;l(3),E(" ",e.stepOrder," "),l(5),p(e.departmentName?8:-1),l(),p(e.jobTitleName?9:-1),l(),p(e.note?10:-1)}}function ga(n,t){if(n&1&&(i(0,"div",19),L(1,_a,18,4,"div",40,Ci),r()),n&2){let e=m();l(),I(e.steps)}}function ba(n,t){if(n&1){let e=D();i(0,"div",2)(1,"div",3)(2,"a",4),f(),i(3,"svg",5),d(4,"use",6),r()(),i(5,"svg",7),d(6,"use",8),r(),y(),i(7,"h4",9),a(8),r(),i(9,"span"),a(10),r()()(),u(11,la,4,1,"div",10),u(12,sa,2,1,"p",11),i(13,"div",12)(14,"h6",13),a(15),r(),i(16,"button",14),x("click",function(){S(e);let s=m();return C(s.openAddStep())}),f(),i(17,"svg",15),d(18,"use",16),r(),a(19," \u65B0\u589E\u6B65\u9A5F "),r()(),u(20,ua,39,5,"div",17),u(21,pa,3,0,"div",18)(22,ga,3,0,"div",19)}if(n&2){let e=t,o=m();l(8),E("",e.name,"\uFF5C\u7C3D\u6838\u6D41\u7A0B"),l(),re("badge "+(e.isActive?"bg-success-subtle text-success":"bg-secondary-subtle text-secondary")),l(),E(" ",e.isActive?"\u555F\u7528":"\u505C\u7528"," "),l(),p(o.errorMsg()?11:-1),l(),p(e.description?12:-1),l(3),E("\u7C3D\u6838\u6B65\u9A5F\uFF08\u5171 ",e.steps.length," \u6B65\uFF09"),l(5),p(o.showStepForm?20:-1),l(),p(e.steps.length===0?21:22)}}function xa(n,t){n&1&&(i(0,"p",1),a(1,"\u627E\u4E0D\u5230\u7C3D\u6838\u9805\u76EE\u3002"),r())}var Yt=class n{route=g(le);approvalService=g(at);deptService=g(Oe);jobTitleService=g(Ge);fb=g(ee);itemId=0;item$=new Ve(void 0);departments=[];jobTitles=[];errorMsg=M("");showStepForm=!1;editStep=null;stepForm=this.fb.group({stepOrder:[1,[w.required,w.min(1)]],departmentId:[null],jobTitleId:[null],note:[""]});ngOnInit(){this.itemId=+(this.route.snapshot.paramMap.get("id")??0),this.approvalService.getById(this.itemId).subscribe(t=>this.item$.next(t)),this.deptService.getAll().pipe(xi(1)).subscribe(t=>this.departments=t),this.jobTitleService.getAll().pipe(xi(1)).subscribe(t=>this.jobTitles=t)}openAddStep(){this.editStep=null;let t=(this.item$.getValue()?.steps.length??0)+1;this.stepForm.reset({stepOrder:t,departmentId:null,jobTitleId:null,note:""}),this.showStepForm=!0}openEditStep(t){this.editStep=t,this.stepForm.patchValue({stepOrder:t.stepOrder,departmentId:t.departmentId??null,jobTitleId:t.jobTitleId??null,note:t.note??""}),this.showStepForm=!0}closeStepForm(){this.showStepForm=!1}submitStep(){if(this.stepForm.invalid)return;let t=this.stepForm.value,e=t.departmentId||void 0,o=t.jobTitleId||void 0;if(!e&&!o){alert("\u90E8\u9580\u6216\u8077\u7A31\u81F3\u5C11\u9078\u4E00\u3002");return}let s=e?this.departments.find(B=>B.id===e)?.name:void 0,c=o?this.jobTitles.find(B=>B.id===o)?.name:void 0,F={stepOrder:t.stepOrder,departmentId:e,departmentName:s,jobTitleId:o,jobTitleName:c,note:t.note??""},P=this.editStep?this.approvalService.updateStep(this.itemId,this.editStep.id,F):this.approvalService.addStep(this.itemId,F);this.errorMsg.set(""),P.subscribe({next:B=>{this.item$.next(B),this.showStepForm=!1},error:B=>{this.errorMsg.set(B.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}deleteStep(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6B65\u9A5F ${t.stepOrder} \u55CE\uFF1F`)&&(this.errorMsg.set(""),this.approvalService.deleteStep(this.itemId,t.id).subscribe({next:e=>this.item$.next(e),error:e=>{this.errorMsg.set(e.error?.message||"\u522A\u9664\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}}))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-approval-flow"]],decls:4,vars:3,consts:[[1,"container-fluid","py-3"],[1,"text-muted"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],["routerLink","/admin/approvals",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#git-merge"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[1,"text-muted","small","mb-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"mb-0","text-muted"],[1,"btn","btn-outline-primary","btn-sm","inline-flex","items-center","gap-1",3,"click"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm","mb-6"],[1,"card","border-0","shadow-sm"],[1,"flex","flex-col","gap-2"],["href","/assets/icons/sprite.svg#alert-triangle"],[1,"card-header","bg-transparent","fw-500"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"col-6","col-md-2"],[1,"form-label","fw-500"],[1,"text-danger"],["type","number","formControlName","stepOrder","min","1",1,"form-control"],[1,"col-12","col-md-4"],["formControlName","departmentId",1,"form-select"],[3,"ngValue"],["formControlName","jobTitleId",1,"form-select"],[1,"col-12","col-md-6"],["type","text","formControlName","note","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],[1,"text-muted","small","mt-2"],[1,"flex","gap-2","mt-4"],["type","submit",1,"btn","btn-primary","btn-sm"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"card-body","text-center","text-muted","py-5"],[1,"flex","gap-3","items-center"],[1,"flex","flex-col","items-center","shrink-0",2,"width","36px"],[1,"rounded-circle","bg-primary","text-white","flex","items-center","justify-center","font-bold",2,"width","32px","height","32px","font-size",".85rem"],[1,"card","border-0","shadow-sm","grow","min-w-0","mb-0"],[1,"card-body","py-2","px-3"],[1,"flex","items-center","justify-between","flex-wrap","gap-2"],[1,"flex","flex-wrap","gap-2","items-center"],[1,"badge","bg-primary-subtle","text-primary","inline-flex","items-center","gap-1",2,"white-space","nowrap"],[1,"badge","bg-warning-subtle","text-warning-emphasis","inline-flex","items-center","gap-1",2,"white-space","nowrap"],[1,"text-muted","small"],[1,"flex","gap-1"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],[1,"sa-icon",2,"width","12px","height","12px","flex-shrink","0","stroke","currentColor"],["href","/assets/icons/sprite.svg#git-branch"],["href","/assets/icons/sprite.svg#briefcase"]],template:function(e,o){if(e&1&&(i(0,"div",0),u(1,ba,23,9),R(2,"async"),Bt(3,xa,2,0,"p",1),r()),e&2){let s;l(),p((s=Re(2,1,o.item$))?1:3,s)}},dependencies:[N,te,Z,De,ke,Y,be,we,W,K,xe,X,Q,Ne],encapsulation:2})};var qe=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/projects`)}getPaged(t,e){return this.http.get(`${T.apiUrl}/projects`,{params:{page:t,pageSize:e}})}getById(t){return this.http.get(`${T.apiUrl}/projects/${t}`)}create(t){return this.http.post(`${T.apiUrl}/projects`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/projects/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/projects/${t}`)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ji={active:"\u9032\u884C\u4E2D",closed:"\u5DF2\u7D50\u6848"},zi={active:"bg-success-subtle text-success",closed:"bg-secondary-subtle text-secondary"};var ha=n=>[n,"edit"],Sa=(n,t)=>t.id;function Ca(n,t){if(n&1&&(i(0,"span",18),a(1),r()),n&2){let e=m().$implicit;l(),v(e.departmentName)}}function Ea(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function ya(n,t){if(n&1&&(a(0),R(1,"number")),n&2){let e=m().$implicit;E(" ",q(1,1,e.budgetAmount,"1.0-0")," ")}}function Aa(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function Fa(n,t){if(n&1&&(a(0),R(1,"number")),n&2){let e=m().$implicit;E(" ",q(1,1,e.actualAmount,"1.0-0")," ")}}function Ta(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function wa(n,t){if(n&1&&(a(0),R(1,"number")),n&2){let e=m().$implicit;E(" ",q(1,1,e.businessAmount,"1.0-0")," ")}}function Da(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function ka(n,t){if(n&1&&(i(0,"a",20),f(),i(1,"svg",27),d(2,"use",28),r(),a(3," \u958B\u555F "),r()),n&2){let e=m().$implicit;b("href",e.googleDriveUrl,Ye)}}function La(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function Ia(n,t){if(n&1){let e=D();i(0,"tr")(1,"td",17),a(2),r(),i(3,"td")(4,"span"),a(5),r()(),i(6,"td"),u(7,Ca,2,1,"span",18)(8,Ea,2,0,"span",19),r(),i(9,"td",14),u(10,ya,2,4)(11,Aa,2,0,"span",19),r(),i(12,"td",14),u(13,Fa,2,4)(14,Ta,2,0,"span",19),r(),i(15,"td",14),u(16,wa,2,4)(17,Da,2,0,"span",19),r(),i(18,"td",15),u(19,ka,4,1,"a",20)(20,La,2,0,"span",19),r(),i(21,"td",21)(22,"div",22)(23,"a",23),f(),i(24,"svg",7),d(25,"use",24),r()(),y(),i(26,"button",25),x("click",function(){let s=S(e).$implicit,c=m();return C(c.delete(s))}),f(),i(27,"svg",7),d(28,"use",26),r()()()()()}if(n&2){let e=t.$implicit,o=m();l(2),v(e.code),l(2),re("badge "+o.statusClass[e.status]),l(),v(o.statusLabel[e.status]),l(2),p(e.departmentName?7:8),l(3),p(e.budgetAmount!=null?10:11),l(3),p(e.actualAmount!=null?13:14),l(3),p(e.businessAmount!=null?16:17),l(3),p(e.googleDriveUrl?19:20),l(4),b("routerLink",ae(10,ha,e.id))}}function Pa(n,t){n&1&&(i(0,"tr")(1,"td",29),a(2,"\u5C1A\u7121\u5C08\u6848\u8CC7\u6599\u3002"),r()())}function Ra(n,t){n&1&&(i(0,"li",37)(1,"span",39),a(2,"\u2026"),r()())}function Ba(n,t){if(n&1){let e=D();i(0,"li",35)(1,"button",36),x("click",function(){S(e);let s=m().$implicit,c=m(2);return C(c.goTo(s))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);O("active",e===o.page()),l(2),v(e)}}function ja(n,t){if(n&1&&u(0,Ra,3,0,"li",37)(1,Ba,3,3,"li",38),n&2){let e=t.$implicit;p(e===-1?0:1)}}function Ma(n,t){if(n&1){let e=D();i(0,"div",16)(1,"span",30),a(2),r(),i(3,"div",31)(4,"button",32),x("click",function(){S(e);let s=m();return C(s.prev())}),a(5,"\u2039"),r(),i(6,"span",33),a(7),r(),i(8,"button",32),x("click",function(){S(e);let s=m();return C(s.next())}),a(9,"\u203A"),r()(),i(10,"ul",34)(11,"li",35)(12,"button",36),x("click",function(){S(e);let s=m();return C(s.prev())}),a(13,"\u2039"),r()(),L(14,ja,2,1,null,null,_e),i(16,"li",35)(17,"button",36),x("click",function(){S(e);let s=m();return C(s.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();l(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),l(2),O("disabled",e.page()===1),l(3),z("",e.page()," / ",e.totalPages()),l(),O("disabled",e.page()===e.totalPages()),l(3),O("disabled",e.page()===1),l(3),I(e.pageNumbers()),l(2),O("disabled",e.page()===e.totalPages())}}var Wt=class n{projectService=g(qe);PAGE_SIZE=20;page=M(1);refresh=M(0);result=Ae(Le($(()=>({page:this.page(),refresh:this.refresh()}))).pipe(ue(({page:t})=>this.projectService.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedProjects=$(()=>this.result().items);totalCount=$(()=>this.result().totalCount);totalPages=$(()=>this.result().totalPages);pageNumbers=$(()=>Va(this.page(),this.totalPages()));statusLabel=Ji;statusClass=zi;goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u5C08\u6848\u300C${t.code}\u300D\u55CE\uFF1F`)&&this.projectService.delete(t.id).subscribe(()=>{this.refresh.update(e=>e+1)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-project-list"]],decls:38,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#folder"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500","font-monospace"],[1,"badge","bg-primary-subtle","text-primary"],[1,"text-muted"],["target","_blank","rel","noopener",1,"inline-flex","items-center","gap-1","text-decoration-none","text-muted","small",3,"href"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],[1,"sa-icon",2,"stroke","currentColor","width","14px","height","14px"],["href","/assets/icons/sprite.svg#external-link"],["colspan","8",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u5C08\u6848\u7BA1\u7406"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u5C08\u6848 "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u7DE8\u865F"),r(),i(19,"th"),a(20,"\u72C0\u614B"),r(),i(21,"th"),a(22,"\u90E8\u9580"),r(),i(23,"th",14),a(24,"\u9810\u5B9A\u91D1\u984D"),r(),i(25,"th",14),a(26,"\u5BE6\u969B\u91D1\u984D"),r(),i(27,"th",14),a(28,"\u696D\u52D9\u91D1\u984D"),r(),i(29,"th",15),a(30,"Google Drive"),r(),i(31,"th",14),a(32,"\u64CD\u4F5C"),r()()(),i(33,"tbody"),L(34,Ia,29,12,"tr",null,Sa,!1,Pa,3,0,"tr"),r()()(),u(37,Ma,19,13,"div",16),r()()()),e&2&&(l(34),I(o.pagedProjects()),l(3),p(o.totalPages()>1?37:-1))},dependencies:[N,Te],encapsulation:2})};function Va(n,t){if(t<=9)return Array.from({length:t},(s,c)=>c+1);let e=[],o=0;for(let s=1;s<=t;s++)(s===1||s===t||s>=n-2&&s<=n+2)&&(o&&s-o>1&&e.push(-1),e.push(s),o=s);return e}var Na=(n,t)=>t.id;function Oa(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",29),d(2,"use",30),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function qa(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165\u5C08\u6848\u7DE8\u865F\u3002"),r())}function $a(n,t){if(n&1&&(i(0,"option",21),a(1),r()),n&2){let e=t.$implicit;b("ngValue",e.id),l(),v(e.name)}}function Ua(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u9078\u64C7\u90E8\u9580\u3002"),r())}function Ga(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165\u9810\u5B9A\u91D1\u984D\uFF08\u4E0D\u53EF\u70BA\u8CA0\u6578\uFF09\u3002"),r())}function Ha(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165\u5BE6\u969B\u91D1\u984D\uFF08\u4E0D\u53EF\u70BA\u8CA0\u6578\uFF09\u3002"),r())}function Ja(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165\u696D\u52D9\u91D1\u984D\uFF08\u4E0D\u53EF\u70BA\u8CA0\u6578\uFF09\u3002"),r())}function za(n,t){n&1&&(i(0,"div",16),a(1,"\u8ACB\u8F38\u5165 Google Drive \u9023\u7D50\u3002"),r())}var St=class n{fb=g(ee);projectService=g(qe);deptService=g(Oe);route=g(le);router=g(ve);cdr=g(We);departments=[];loadingDepts=!0;isEdit=!1;projectId=0;errorMsg=M("");form=this.fb.group({code:["",w.required],status:["active",w.required],departmentId:[{value:null,disabled:!0},w.required],budgetAmount:[null,[w.required,w.min(0)]],actualAmount:[null,[w.required,w.min(0)]],businessAmount:[null,[w.required,w.min(0)]],googleDriveUrl:["",w.required]});ngOnInit(){this.deptService.getAll().subscribe({next:e=>{this.departments=e,this.loadingDepts=!1,this.form.get("departmentId").enable(),this.cdr.markForCheck()},error:()=>{this.loadingDepts=!1,this.form.get("departmentId").enable(),this.errorMsg.set("\u8F09\u5165\u90E8\u9580\u8CC7\u6599\u5931\u6557\u3002")}});let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.projectId=+t,this.projectService.getById(this.projectId).subscribe({next:e=>{e&&this.form.patchValue({code:e.code,status:e.status,departmentId:e.departmentId??null,budgetAmount:e.budgetAmount??null,actualAmount:e.actualAmount??null,businessAmount:e.businessAmount??null,googleDriveUrl:e.googleDriveUrl??""})},error:()=>this.errorMsg.set("\u8F09\u5165\u5C08\u6848\u8CC7\u6599\u5931\u6557\u3002")}))}submit(){if(this.form.invalid)return;let t=this.form.getRawValue(),e=this.departments.find(c=>c.id===t.departmentId),o={code:t.code,status:t.status,departmentId:t.departmentId??void 0,departmentName:e?.name,budgetAmount:t.budgetAmount??void 0,actualAmount:t.actualAmount??void 0,businessAmount:t.businessAmount??void 0,googleDriveUrl:t.googleDriveUrl||void 0},s=this.isEdit?this.projectService.update(this.projectId,o):this.projectService.create(o);this.errorMsg.set(""),s.subscribe({next:()=>this.router.navigate(["/admin/projects"]),error:c=>{this.errorMsg.set(c.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-project-form"]],decls:74,vars:13,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/projects",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-8","col-xl-6"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","code","placeholder","\u4F8B\u5982\uFF1AP2025-001",1,"form-control","font-monospace"],[1,"text-danger","small","mt-1"],["formControlName","status",1,"form-select"],["value","active"],["value","closed"],["formControlName","departmentId",1,"form-select"],[3,"ngValue"],["type","number","formControlName","budgetAmount","min","0",1,"form-control"],["type","number","formControlName","actualAmount","min","0",1,"form-control"],["type","number","formControlName","businessAmount","min","0",1,"form-control"],["type","url","formControlName","googleDriveUrl","placeholder","https://drive.google.com/drive/folders/...",1,"form-control"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/projects",1,"btn","btn-outline-secondary"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,Oa,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.submit()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),a(15,"\u5C08\u6848\u7DE8\u865F "),i(16,"span",14),a(17,"*"),r()(),d(18,"input",15),u(19,qa,2,0,"div",16),r(),i(20,"div",12)(21,"label",13),a(22,"\u72C0\u614B "),i(23,"span",14),a(24,"*"),r()(),i(25,"select",17)(26,"option",18),a(27,"\u9032\u884C\u4E2D"),r(),i(28,"option",19),a(29,"\u5DF2\u7D50\u6848"),r()()(),i(30,"div",12)(31,"label",13),a(32,"\u90E8\u9580 "),i(33,"span",14),a(34,"*"),r()(),i(35,"select",20)(36,"option",21),a(37),r(),L(38,$a,2,2,"option",21,Na),r(),u(40,Ua,2,0,"div",16),r(),i(41,"div",12)(42,"label",13),a(43,"\u9810\u5B9A\u91D1\u984D "),i(44,"span",14),a(45,"*"),r()(),d(46,"input",22),u(47,Ga,2,0,"div",16),r(),i(48,"div",12)(49,"label",13),a(50,"\u5BE6\u969B\u91D1\u984D "),i(51,"span",14),a(52,"*"),r()(),d(53,"input",23),u(54,Ha,2,0,"div",16),r(),i(55,"div",12)(56,"label",13),a(57,"\u696D\u52D9\u91D1\u984D "),i(58,"span",14),a(59,"*"),r()(),d(60,"input",24),u(61,Ja,2,0,"div",16),r(),i(62,"div",5)(63,"label",13),a(64,"Google Drive \u9023\u7D50 "),i(65,"span",14),a(66,"*"),r()(),d(67,"input",25),u(68,za,2,0,"div",16),r()()(),i(69,"div",26)(70,"button",27),a(71),r(),i(72,"a",28),a(73,"\u53D6\u6D88"),r()()()()()()),e&2){let s,c,F,P,B,J;l(6),v(o.isEdit?"\u7DE8\u8F2F\u5C08\u6848":"\u65B0\u589E\u5C08\u6848"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(11),p((s=o.form.get("code"))!=null&&s.invalid&&((s=o.form.get("code"))!=null&&s.touched)?19:-1),l(17),b("ngValue",null),l(),v(o.loadingDepts?"\u8F09\u5165\u4E2D\u2026":"\u2014 \u8ACB\u9078\u64C7\u90E8\u9580 \u2014"),l(),I(o.departments),l(2),p((c=o.form.get("departmentId"))!=null&&c.invalid&&((c=o.form.get("departmentId"))!=null&&c.touched)?40:-1),l(7),p((F=o.form.get("budgetAmount"))!=null&&F.invalid&&((F=o.form.get("budgetAmount"))!=null&&F.touched)?47:-1),l(7),p((P=o.form.get("actualAmount"))!=null&&P.invalid&&((P=o.form.get("actualAmount"))!=null&&P.touched)?54:-1),l(7),p((B=o.form.get("businessAmount"))!=null&&B.invalid&&((B=o.form.get("businessAmount"))!=null&&B.touched)?61:-1),l(7),p((J=o.form.get("googleDriveUrl"))!=null&&J.invalid&&((J=o.form.get("googleDriveUrl"))!=null&&J.touched)?68:-1),l(2),b("disabled",o.form.invalid),l(),E(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[te,Z,De,ke,Y,be,we,W,K,xe,X,Q,N],encapsulation:2})};var ot=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/payment-requests`)}getPaged(t,e){return this.http.get(`${T.apiUrl}/payment-requests`,{params:{page:t,pageSize:e}})}getById(t){return this.http.get(`${T.apiUrl}/payment-requests/${t}`)}createWithFiles(t){return this.http.post(`${T.apiUrl}/payment-requests`,t)}updateWithFiles(t,e){return this.http.patch(`${T.apiUrl}/payment-requests/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/payment-requests/${t}`)}submit(t){return this.http.patch(`${T.apiUrl}/payment-requests/${t}/submit`,{})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var Yi={vendor:"\u5EE0\u5546\u8ACB\u6B3E",travel:"\u54E1\u5DE5\u5DEE\u65C5",advance:"\u54E1\u5DE5\u9810\u652F"},Wi={vendor:"bg-info-subtle text-info",travel:"bg-primary-subtle text-primary",advance:"bg-warning-subtle text-warning-emphasis"},Kt={draft:"\u8349\u7A3F",pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},Zt={draft:"bg-blue-subtle text-blue-emphasis",pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"};var Ki=n=>[n,"edit"],Ya=(n,t)=>t.id;function Wa(n,t){if(n&1){let e=D();i(0,"a",24),f(),i(1,"svg",7),d(2,"use",25),r()(),y(),i(3,"button",26),x("click",function(){S(e);let s=m().$implicit,c=m();return C(c.delete(s))}),f(),i(4,"svg",7),d(5,"use",27),r()()}if(n&2){let e=m().$implicit;b("routerLink",ae(1,Ki,e.id))}}function Ka(n,t){if(n&1&&(i(0,"a",23),f(),i(1,"svg",7),d(2,"use",28),r()()),n&2){let e=m().$implicit;b("routerLink",ae(1,Ki,e.id))}}function Za(n,t){if(n&1&&(i(0,"tr")(1,"td")(2,"span"),a(3),r()(),i(4,"td",17),a(5),r(),i(6,"td")(7,"span",18),a(8),r()(),i(9,"td",19),a(10),R(11,"number"),r(),i(12,"td")(13,"span"),a(14),r()(),i(15,"td",20),a(16),R(17,"date"),r(),i(18,"td",21)(19,"div",22),u(20,Wa,6,3)(21,Ka,3,3,"a",23),r()()()),n&2){let e=t.$implicit,o=m();l(2),re("badge "+o.typeClass[e.type]),l(),v(o.typeLabel[e.type]),l(2),v(e.projectCode),l(3),E("",e.invoices.length," \u5F35"),l(2),v(q(11,11,e.totalAmount,"1.0-0")),l(3),re("badge "+o.statusClass[e.approvalStatus]),l(),v(o.statusLabel[e.approvalStatus]),l(2),v(q(17,14,e.createdAt,"yyyy-MM-dd")),l(4),p(e.approvalStatus==="pending"||e.approvalStatus==="returned"?20:21)}}function Qa(n,t){n&1&&(i(0,"tr")(1,"td",29),a(2,"\u5C1A\u7121\u8ACB\u6B3E\u7533\u8ACB\u3002"),r()())}function Xa(n,t){n&1&&(i(0,"li",37)(1,"span",39),a(2,"\u2026"),r()())}function eo(n,t){if(n&1){let e=D();i(0,"li",35)(1,"button",36),x("click",function(){S(e);let s=m().$implicit,c=m(2);return C(c.goTo(s))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);O("active",e===o.page()),l(2),v(e)}}function to(n,t){if(n&1&&u(0,Xa,3,0,"li",37)(1,eo,3,3,"li",38),n&2){let e=t.$implicit;p(e===-1?0:1)}}function io(n,t){if(n&1){let e=D();i(0,"div",16)(1,"span",30),a(2),r(),i(3,"div",31)(4,"button",32),x("click",function(){S(e);let s=m();return C(s.prev())}),a(5,"\u2039"),r(),i(6,"span",33),a(7),r(),i(8,"button",32),x("click",function(){S(e);let s=m();return C(s.next())}),a(9,"\u203A"),r()(),i(10,"ul",34)(11,"li",35)(12,"button",36),x("click",function(){S(e);let s=m();return C(s.prev())}),a(13,"\u2039"),r()(),L(14,to,2,1,null,null,_e),i(16,"li",35)(17,"button",36),x("click",function(){S(e);let s=m();return C(s.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();l(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),l(2),O("disabled",e.page()===1),l(3),z("",e.page()," / ",e.totalPages()),l(),O("disabled",e.page()===e.totalPages()),l(3),O("disabled",e.page()===1),l(3),I(e.pageNumbers()),l(2),O("disabled",e.page()===e.totalPages())}}var Qt=class n{service=g(ot);PAGE_SIZE=20;page=M(1);refresh=M(0);result=Ae(Le($(()=>({page:this.page(),refresh:this.refresh()}))).pipe(ue(({page:t})=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedRequests=$(()=>this.result().items);totalCount=$(()=>this.result().totalCount);totalPages=$(()=>this.result().totalPages);pageNumbers=$(()=>no(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}typeLabel=Yi;typeClass=Wi;statusLabel=Kt;statusClass=Zt;delete(t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u8ACB\u6B3E\u7533\u8ACB\u55CE\uFF1F")&&this.service.delete(t.id).subscribe(()=>this.refresh.update(e=>e+1))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-payment-list"]],decls:36,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprites.svg#dollar-sign"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500","font-monospace"],[1,"badge","bg-secondary-subtle","text-secondary"],[1,"text-right","fw-500"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u6AA2\u8996",1,"btn","btn-sm","btn-ghost-secondary","inline-flex","items-center",3,"routerLink"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["href","/assets/icons/sprite.svg#eye"],["colspan","7",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u8ACB\u6B3E\u7533\u8ACB"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u7533\u8ACB "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u985E\u578B"),r(),i(19,"th"),a(20,"\u5C08\u6848\u7DE8\u865F"),r(),i(21,"th"),a(22,"\u767C\u7968\u6578"),r(),i(23,"th",14),a(24,"\u7E3D\u91D1\u984D"),r(),i(25,"th"),a(26,"\u7C3D\u6838\u72C0\u614B"),r(),i(27,"th",15),a(28,"\u5EFA\u7ACB\u6642\u9593"),r(),i(29,"th",14),a(30,"\u64CD\u4F5C"),r()()(),i(31,"tbody"),L(32,Za,22,17,"tr",null,Ya,!1,Qa,3,0,"tr"),r()()(),u(35,io,19,13,"div",16),r()()()),e&2&&(l(32),I(o.pagedRequests()),l(3),p(o.totalPages()>1?35:-1))},dependencies:[N,Te,ge],encapsulation:2})};function no(n,t){if(t<=9)return Array.from({length:t},(s,c)=>c+1);let e=[],o=0;for(let s=1;s<=t;s++)(s===1||s===t||s>=n-2&&s<=n+2)&&(o&&s-o>1&&e.push(-1),e.push(s),o=s);return e}var Et=Jn(On());function Bo(n,t){let e;return(e=t.get("id"))==null?null:e.value}var jo=(n,t)=>t.id;function Mo(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",40),d(2,"use",41),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function Vo(n,t){if(n&1&&(i(0,"p",26),a(1),r()),n&2){let e=m();l(),v(e.projectCode||"\u2014")}}function No(n,t){if(n&1&&(i(0,"option",43),a(1),r()),n&2){let e=t.$implicit;b("ngValue",e.id),l(),z("",e.code,"",e.departmentName?"\uFF08"+e.departmentName+"\uFF09":"")}}function Oo(n,t){n&1&&(i(0,"div",44),a(1,"\u8ACB\u9078\u64C7\u5C08\u6848\u3002"),r())}function qo(n,t){if(n&1&&(i(0,"select",42)(1,"option",43),a(2),r(),L(3,No,2,3,"option",43,jo),r(),u(5,Oo,2,0,"div",44)),n&2){let e,o=m();l(),b("ngValue",null),l(),v(o.loadingProjects?"\u8F09\u5165\u4E2D\u2026":"\u2014 \u8ACB\u9078\u64C7\u5C08\u6848 \u2014"),l(),I(o.projects),l(2),p((e=o.form.get("projectId"))!=null&&e.invalid&&((e=o.form.get("projectId"))!=null&&e.touched)?5:-1)}}function $o(n,t){if(n&1&&(i(0,"div",5)(1,"label",16),a(2,"\u7C3D\u6838\u72C0\u614B"),r(),i(3,"div")(4,"span",45),a(5),r()()()),n&2){let e=m();l(4),re(e.statusClass[e.approvalStatus]),l(),E(" ",e.statusLabel[e.approvalStatus]," ")}}function Uo(n,t){n&1&&(i(0,"div",52),a(1,"\u8ACB\u81F3\u5C11\u4E0A\u50B3\u4E00\u5F35\u767C\u7968\u3002"),r())}function Go(n,t){if(n&1){let e=D();i(0,"label",46),f(),i(1,"svg",47),d(2,"use",48),r(),y(),i(3,"span",49),a(4,"\u9EDE\u64CA\u4E0A\u50B3\u767C\u7968\u5716\u6A94"),r(),i(5,"span",50),a(6,"\u652F\u63F4 JPG\u3001PNG\u3001PDF\uFF0C\u53EF\u591A\u9078"),r(),i(7,"input",51),x("change",function(s){S(e);let c=m();return C(c.onFilesSelected(s))}),r()(),u(8,Uo,2,0,"div",52)}if(n&2){let e=m();l(8),p(e.showInvoiceError?8:-1)}}function Ho(n,t){n&1&&d(0,"th",34)}function Jo(n,t){if(n&1){let e=D();i(0,"button",64),x("click",function(){let s;S(e);let c=m().$implicit,F=m();return C(F.openPreview((s=c.get("fileName"))==null?null:s.value,((s=c.get("previewUrl"))==null?null:s.value)||((s=c.get("fileUrl"))==null?null:s.value)))}),f(),i(1,"svg",65),d(2,"use",28),r(),a(3),r()}if(n&2){let e,o=m().$implicit;l(3),E(" ",(e=o.get("fileName"))==null?null:e.value," ")}}function zo(n,t){if(n&1&&(i(0,"span",55),f(),i(1,"svg",65),d(2,"use",28),r(),a(3),r()),n&2){let e,o=m().$implicit;l(3),E(" ",(e=o.get("fileName"))==null?null:e.value," ")}}function Yo(n,t){if(n&1&&(i(0,"span",57),a(1),r()),n&2){let e,o=m().$implicit;l(),v(((e=o.get("invoiceNo"))==null?null:e.value)||"\u2014")}}function Wo(n,t){n&1&&(i(0,"div",58),d(1,"span",66),a(2," \u8B58\u5225\u4E2D\u2026 "),r())}function Ko(n,t){n&1&&d(0,"input",59)}function Zo(n,t){if(n&1&&(i(0,"span",60),a(1),R(2,"number"),r()),n&2){let e,o=m().$implicit;l(),v(q(2,1,(e=o.get("amount"))==null?null:e.value,"1.0-0"))}}function Qo(n,t){n&1&&(i(0,"div",61),a(1,"\u2014"),r())}function Xo(n,t){n&1&&d(0,"input",62)}function el(n,t){if(n&1){let e=D();i(0,"td",63)(1,"button",67),x("click",function(){S(e);let s=m().$index,c=m();return C(c.removeInvoice(s))}),f(),i(2,"svg",40),d(3,"use",68),r()()()}if(n&2){m();let e=Vi(0);l(),b("disabled",e)}}function tl(n,t){if(n&1&&(ji(0),i(1,"tr",36)(2,"td",53),u(3,Jo,4,1,"button",54)(4,zo,4,1,"span",55),r(),i(5,"td",56),u(6,Yo,2,1,"span",57)(7,Wo,3,0,"div",58)(8,Ko,1,0,"input",59),r(),i(9,"td",56),u(10,Zo,3,4,"span",60)(11,Qo,2,0,"div",61)(12,Xo,1,0,"input",62),r(),u(13,el,4,1,"td",63),r()),n&2){let e,o,s=t.$implicit,c=t.$index,F=m(),P=Mi(F.ocrLoadingIds.has((e=s.get("id"))==null?null:e.value));l(),b("formGroupName",c),l(2),p((o=s.get("previewUrl"))!=null&&o.value||(o=s.get("fileUrl"))!=null&&o.value?3:4),l(3),p(F.isReadOnly?6:P?7:8),l(4),p(F.isReadOnly?10:P?11:12),l(3),p(F.isReadOnly?-1:13)}}function il(n,t){if(n&1&&(i(0,"tr")(1,"td",69),a(2,"\u5C1A\u672A\u65B0\u589E\u767C\u7968"),r()()),n&2){let e=m();l(),Rt("colspan",e.isReadOnly?3:4)}}function nl(n,t){n&1&&d(0,"td")}function rl(n,t){if(n&1&&(i(0,"tfoot")(1,"tr",31)(2,"td",70),a(3,"\u5408\u8A08"),r(),i(4,"td",71),a(5),R(6,"number"),r(),u(7,nl,1,0,"td"),r()()),n&2){let e=m();l(5),v(q(6,2,e.totalAmount,"1.0-0")),l(2),p(e.isReadOnly?-1:7)}}function al(n,t){n&1&&d(0,"span",76)}function ol(n,t){if(n&1){let e=D();i(0,"button",75),u(1,al,1,0,"span",76),a(2),r(),i(3,"button",77),x("click",function(){S(e);let s=m(2);return C(s.submitForApproval())}),a(4," \u9001\u51FA\u7533\u8ACB "),r()}if(n&2){let e=m(2);b("disabled",e.form.invalid||e.isAnyOcrPending),l(),p(e.isAnyOcrPending?1:-1),l(),E(" ",e.isEdit?"\u5132\u5B58":"\u5132\u5B58\u8349\u7A3F"," "),l(),b("disabled",e.form.invalid||e.isAnyOcrPending)}}function ll(n,t){if(n&1){let e=D();i(0,"button",77),x("click",function(){S(e);let s=m(2);return C(s.submitForApproval())}),a(1," \u4FEE\u6539\u4E26\u91CD\u9001 "),r()}if(n&2){let e=m(2);b("disabled",e.form.invalid||e.isAnyOcrPending)}}function sl(n,t){n&1&&d(0,"span",76)}function ml(n,t){if(n&1&&(i(0,"button",73),u(1,sl,1,0,"span",76),a(2," \u66F4\u65B0 "),r()),n&2){let e=m(2);b("disabled",e.form.invalid||e.isAnyOcrPending),l(),p(e.isAnyOcrPending?1:-1)}}function dl(n,t){if(n&1&&(i(0,"div",37),u(1,ol,5,4)(2,ll,2,1,"button",72)(3,ml,3,2,"button",73),i(4,"a",74),a(5,"\u53D6\u6D88"),r()()),n&2){let e=m();l(),p(!e.isEdit||e.isDraft?1:e.isReturned?2:3)}}function ul(n,t){n&1&&(i(0,"div",38)(1,"a",74),a(2,"\u8FD4\u56DE\u5217\u8868"),r()())}function pl(n,t){if(n&1&&d(0,"img",85),n&2){let e=m(2);b("src",e.previewFile.url,Ye)}}function cl(n,t){if(n&1&&d(0,"iframe",86),n&2){let e=m(2);b("src",e.previewFile.safeUrl,Pt)}}function vl(n,t){if(n&1&&(i(0,"div",87)(1,"a",88),f(),i(2,"svg",89),d(3,"use",90),r(),a(4," \u4E0B\u8F09\u6A94\u6848 "),r()()),n&2){let e=m(2);l(),b("href",e.previewFile.url,Ye)("download",e.previewFile.name)}}function fl(n,t){if(n&1){let e=D();i(0,"div",78),x("click",function(){S(e);let s=m();return C(s.closePreview())}),i(1,"div",79),x("click",function(s){return S(e),C(s.stopPropagation())}),i(2,"div",80)(3,"div",81)(4,"h6",82),a(5),r(),i(6,"button",83),x("click",function(){S(e);let s=m();return C(s.closePreview())}),r()(),i(7,"div",84),u(8,pl,1,1,"img",85)(9,cl,1,1,"iframe",86)(10,vl,5,2,"div",87),r()()()()}if(n&2){let e=m();l(5),v(e.previewFile.name),l(3),p(e.isImageFile(e.previewFile.name)?8:e.isPdfFile(e.previewFile.name)?9:10)}}var yt=class n{fb=g(ee);service=g(ot);projects$=g(qe);route=g(le);router=g(ve);cdr=g(We);sanitizer=g(jt);projects=[];isEdit=!1;isReturned=!1;isReadOnly=!1;requestId=0;showInvoiceError=!1;errorMsg=M("");approvalStatus="draft";isDraft=!0;projectCode="";fileMap=new Map;ocrLoadingIds=new Set;get isAnyOcrPending(){return this.ocrLoadingIds.size>0}previewFile=null;openPreview(t,e){this.previewFile={name:t,url:e,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(e)}}closePreview(){this.previewFile=null}isImageFile(t){return/\.(jpe?g|png|gif|webp|bmp)$/i.test(t)}isPdfFile(t){return/\.pdf$/i.test(t)}statusLabel=Kt;statusClass=Zt;form=this.fb.group({type:["vendor",w.required],projectId:[null,w.required],invoices:this.fb.array([])});get invoiceArray(){return this.form.get("invoices")}get invoiceControls(){return this.invoiceArray.controls}get totalAmount(){return this.invoiceArray.controls.reduce((t,e)=>t+(+e.get("amount")?.value||0),0)}loadingProjects=!0;ngOnInit(){this.projects$.getAll().subscribe({next:e=>{this.projects=e.filter(o=>o.status==="active"),this.loadingProjects=!1,this.cdr.markForCheck()},error:()=>{this.loadingProjects=!1,this.errorMsg.set("\u8F09\u5165\u5C08\u6848\u8CC7\u6599\u5931\u6557\u3002")}});let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.requestId=+t,this.service.getById(this.requestId).subscribe(e=>{e&&(this.approvalStatus=e.approvalStatus,this.isDraft=e.approvalStatus==="draft",this.isReturned=e.approvalStatus==="returned",this.isReadOnly=!["draft","pending","returned"].includes(e.approvalStatus),this.projectCode=e.projectCode??"",this.isReadOnly&&this.form.disable(),this.form.patchValue({type:e.type,projectId:e.projectId}),e.invoices.forEach(o=>this.invoiceArray.push(this._invoiceGroup(String(o.id),o.fileName,o.invoiceNo,o.amount,o.fileUrl??"",o.fileUrl??""))),this.cdr.markForCheck())}))}async onFilesSelected(t){let e=t.target;if(!e.files?.length)return;let o=Array.from(e.files);e.value="",this.showInvoiceError=!1;let s=o.map(P=>{let B=`${Date.now()}-${Math.random().toString(36).slice(2)}`,J=URL.createObjectURL(P);return this.ocrLoadingIds.add(B),this.fileMap.set(B,P),this.invoiceArray.push(this._invoiceGroup(B,P.name,"",0,J)),{id:B,file:P}}),[c,F]=await Promise.all([(0,Et.createWorker)(["eng","chi_tra"]),(0,Et.createWorker)(["eng","chi_tra"])]);await F.setParameters({tessedit_pageseg_mode:Et.PSM.SPARSE_TEXT});try{for(let{id:P,file:B}of s)try{let[{data:{text:J}},{data:{text:je}}]=await Promise.all([c.recognize(B),F.recognize(B)]);console.log("[OCR AUTO]",J),console.log("[OCR SPARSE]",je);let ie=this._extractInvoiceData(J),fe=this._extractInvoiceData(je),Me=ie.invoiceNo||fe.invoiceNo,$e=ie.amount||fe.amount,he=this.invoiceArray.controls.findIndex(ne=>ne.get("id")?.value===P);he>=0&&this.invoiceArray.controls[he].patchValue({invoiceNo:Me,amount:$e})}catch{}finally{this.ocrLoadingIds.delete(P),this.cdr.markForCheck()}}finally{await Promise.all([c.terminate(),F.terminate()])}}removeInvoice(t){let e=this.invoiceArray.at(t),o=e.get("id")?.value,s=e.get("previewUrl")?.value;s?.startsWith("blob:")&&URL.revokeObjectURL(s),this.fileMap.delete(o),this.invoiceArray.removeAt(t)}save(){if(this.form.invalid)return;if(this.invoiceArray.length===0){this.showInvoiceError=!0;return}this.showInvoiceError=!1;let t=this._buildFormData(),e=this.isEdit?this.service.updateWithFiles(this.requestId,t):this.service.createWithFiles(t);this.errorMsg.set(""),e.subscribe({next:o=>{this.isEdit||(this.requestId=o.id),this.router.navigate(["/admin/payment-requests"])},error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}submitForApproval(){if(this.form.invalid)return;if(this.invoiceArray.length===0){this.showInvoiceError=!0;return}this.showInvoiceError=!1;let t=this._buildFormData(),e=this.isEdit?this.service.updateWithFiles(this.requestId,t):this.service.createWithFiles(t);this.errorMsg.set(""),e.subscribe({next:o=>{this.service.submit(o.id).subscribe({next:()=>this.router.navigate(["/admin/payment-requests"]),error:s=>{this.errorMsg.set(s.error?.message||"\u9001\u51FA\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})},error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}_buildFormData(){let t=new FormData;t.append("type",this.form.get("type").value),t.append("projectId",String(this.form.get("projectId").value));let e=[],o=0;for(let s of this.invoiceArray.controls){let c=s.get("id")?.value,F=this.fileMap.get(c),P={fileName:s.get("fileName")?.value,invoiceNo:s.get("invoiceNo")?.value,amount:+(s.get("amount")?.value||0),fileUrl:s.get("fileUrl")?.value||null,fileIndex:F?o:-1};F&&(t.append("files",F,F.name),o++),e.push(P)}return t.append("invoices",JSON.stringify(e)),t}_invoiceGroup(t,e,o,s,c="",F=""){return this.fb.group({id:[t],fileName:[e],invoiceNo:[o,w.required],amount:[s,[w.required,w.min(0)]],previewUrl:[c],fileUrl:[F]})}_extractInvoiceData(t){let e=t.match(/[A-Z]{2}[-\s]?\d{8}/),o="";e&&(o=e[0].replace(/[-\s]/g,""));let s=[/(?:|||||)[^0-9]{0,20}([\d,]+)/,/(?:\s*|\s*|\s*\s*|\s*\s*\s*|\s*\s*\s*|\s*)[^0-9]{0,20}([\d,]+)/,/[^0-9]{0,10}([\d,]+)/,/\s*[^0-9]{0,10}([\d,]+)/,/(?:Amount|Total)[^0-9]{0,10}([\d,]+)/i,/NT\$\s*([\d,]+)/,/\$\s*([\d,]+)/],c=0;for(let F of s){let P=t.match(F);if(P){c=parseInt(P[1].replace(/,/g,""),10);break}}return{invoiceNo:o,amount:c}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-payment-form"]],decls:69,vars:11,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/payment-requests",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#dollar-sign"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],[1,"flex","flex-wrap","gap-4","mt-1"],[1,"form-check"],["type","radio","formControlName","type","value","vendor","id","typeVendor",1,"form-check-input"],["for","typeVendor",1,"form-check-label"],["type","radio","formControlName","type","value","travel","id","typeTravel",1,"form-check-input"],["for","typeTravel",1,"form-check-label"],["type","radio","formControlName","type","value","advance","id","typeAdvance",1,"form-check-input"],["for","typeAdvance",1,"form-check-label"],[1,"form-control-plaintext","fw-500","font-monospace","mb-0"],[1,"card","border-0","shadow-sm","mt-6"],["href","/assets/icons/sprite.svg#file-text"],[1,"table-responsive"],[1,"table","table-sm","mb-0"],[1,"table-light"],[2,"min-width","160px"],[2,"min-width","120px"],[2,"width","48px"],["formArrayName","invoices"],[3,"formGroupName"],[1,"mt-6","flex","gap-2"],[1,"mt-6"],["tabindex","-1",1,"modal",2,"display","block","background","rgba(0,0,0,.6)"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"],["formControlName","projectId",1,"form-select"],[3,"ngValue"],[1,"text-danger","small","mt-1"],[1,"badge","rounded-pill","px-3","py-2"],[1,"flex","flex-col","items-center","justify-center","rounded-3","py-4","px-4","mb-4","text-center",2,"cursor","pointer","border","2px dashed var(--bs-border-color)"],[1,"sa-icon","sa-icon-2x","text-muted","mb-2",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#upload"],[1,"fw-500"],[1,"text-muted","small","mt-1"],["type","file","multiple","","accept","image/*,application/pdf",1,"hidden",3,"change"],[1,"alert","alert-warning","py-2","small","mb-4"],[1,"align-middle","small",2,"max-width","200px","overflow","hidden","text-overflow","ellipsis","white-space","nowrap"],["type","button",1,"btn","btn-link","p-0","text-muted","small","inline-flex","items-center","gap-1",2,"text-decoration","none","max-width","100%","overflow","hidden","text-overflow","ellipsis"],[1,"text-muted","inline-flex","items-center","gap-1"],[1,"align-middle"],[1,"font-monospace","small"],[1,"flex","items-center","gap-2","text-muted","small","py-1"],["formControlName","invoiceNo","placeholder","AB12345678",1,"form-control","form-control-sm","font-monospace"],[1,"small"],[1,"py-1"],["type","number","formControlName","amount","min","0","placeholder","0",1,"form-control","form-control-sm"],[1,"text-right","align-middle"],["type","button",1,"btn","btn-link","p-0","text-muted","small","inline-flex","items-center","gap-1",2,"text-decoration","none","max-width","100%","overflow","hidden","text-overflow","ellipsis",3,"click"],[1,"sa-icon","shrink-0",2,"width","14px","height","14px","stroke","currentColor"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["type","button",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click","disabled"],["href","/assets/icons/sprite.svg#x"],[1,"text-center","text-muted","py-4","small"],["colspan","2",1,"text-right","fw-500","small"],[1,"fw-600"],["type","button",1,"btn","btn-primary",3,"disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/payment-requests",1,"btn","btn-outline-secondary"],["type","submit",1,"btn","btn-outline-secondary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["tabindex","-1",1,"modal",2,"display","block","background","rgba(0,0,0,.6)",3,"click"],[1,"modal-dialog","modal-lg","modal-dialog-centered",3,"click"],[1,"modal-content"],[1,"modal-header","py-2"],[1,"modal-title","mb-0","text-truncate"],["type","button",1,"btn-close",3,"click"],[1,"modal-body","p-0","text-center","bg-[--bg-base]"],[1,"img-fluid",2,"max-height","75vh","object-fit","contain",3,"src"],[2,"width","100%","height","75vh","border","0",3,"src"],[1,"p-5"],[1,"btn","btn-primary",3,"href","download"],[1,"sa-icon","me-1",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#download"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,Mo,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.save()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11),f(),i(13,"svg",12),d(14,"use",13),r(),a(15," \u57FA\u672C\u8CC7\u8A0A "),r(),y(),i(16,"div",14)(17,"div",15)(18,"label",16),a(19,"\u8ACB\u6B3E\u985E\u578B "),i(20,"span",17),a(21,"*"),r()(),i(22,"div",18)(23,"div",19),d(24,"input",20),i(25,"label",21),a(26,"\u5EE0\u5546\u8ACB\u6B3E"),r()(),i(27,"div",19),d(28,"input",22),i(29,"label",23),a(30,"\u54E1\u5DE5\u5DEE\u65C5"),r()(),i(31,"div",19),d(32,"input",24),i(33,"label",25),a(34,"\u54E1\u5DE5\u9810\u652F"),r()()()(),i(35,"div",15)(36,"label",16),a(37,"\u5C08\u6848 "),i(38,"span",17),a(39,"*"),r()(),u(40,Vo,2,1,"p",26)(41,qo,6,3),r(),u(42,$o,6,3,"div",5),r()(),i(43,"div",27)(44,"div",11),f(),i(45,"svg",12),d(46,"use",28),r(),a(47," \u767C\u7968 "),r(),y(),i(48,"div",14),u(49,Go,9,1),i(50,"div",29)(51,"table",30)(52,"thead",31)(53,"tr")(54,"th"),a(55,"\u6A94\u6848\u540D\u7A31"),r(),i(56,"th",32),a(57,"\u767C\u7968\u865F\u78BC"),r(),i(58,"th",33),a(59,"\u91D1\u984D"),r(),u(60,Ho,1,0,"th",34),r()(),i(61,"tbody",35),L(62,tl,14,6,"tr",36,Bo,!1,il,3,1,"tr"),r(),u(65,rl,8,5,"tfoot"),r()()()(),u(66,dl,6,1,"div",37)(67,ul,3,0,"div",38),r()()()(),u(68,fl,11,2,"div",39)),e&2&&(l(6),v(o.isEdit?o.isReadOnly?"\u6AA2\u8996\u8ACB\u6B3E\u7533\u8ACB":o.isReturned?"\u4FEE\u6539\u8ACB\u6B3E\u7533\u8ACB\uFF08\u9000\u56DE\uFF09":o.isDraft?"\u7DE8\u8F2F\u8ACB\u6B3E\u8349\u7A3F":"\u7DE8\u8F2F\u8ACB\u6B3E\u7533\u8ACB":"\u65B0\u589E\u8ACB\u6B3E\u7533\u8ACB"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(32),p(o.isReadOnly?40:41),l(2),p(o.isEdit?42:-1),l(7),p(o.isReadOnly?-1:49),l(11),p(o.isReadOnly?-1:60),l(2),I(o.invoiceControls),l(3),p(o.invoiceControls.length>0?65:-1),l(),p(o.isReadOnly?67:66),l(2),p(o.previewFile?68:-1))},dependencies:[te,Z,De,ke,Y,be,we,Ke,W,K,xe,X,Q,Ui,Gi,N,Te],encapsulation:2})};var ii={pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},ni={pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"},ri={vendor:"\u5EE0\u5546\u8ACB\u6B3E",travel:"\u54E1\u5DE5\u5DEE\u65C5",advance:"\u54E1\u5DE5\u9810\u652F"},ai={annual:"\u5E74\u5047",personal:"\u4E8B\u5047",sick:"\u75C5\u5047",compensatory:"\u88DC\u4F11"};var _l=(n,t)=>[n,t,"review"],gl=(n,t)=>t.applicationType+t.id;function bl(n,t){if(n&1&&(i(0,"tr")(1,"td")(2,"span"),a(3),r()(),i(4,"td",14),a(5),r(),i(6,"td",15),a(7),r(),i(8,"td")(9,"span"),a(10),r()(),i(11,"td",16),a(12),R(13,"date"),r(),i(14,"td",17)(15,"a",18),f(),i(16,"svg",19),d(17,"use"),r()()()()),n&2){let e=t.$implicit,o=m();l(2),re("badge "+o.appTypeClass[e.applicationType]),l(),E(" ",o.appTypeLabel[e.applicationType]," "),l(2),v(e.submittedBy),l(2),v(o.getSummary(e)),l(2),re("badge "+o.statusClass[e.status]),l(),v(o.statusLabel[e.status]),l(2),v(q(13,13,e.submittedAt,"yyyy-MM-dd")),l(3),re("btn btn-sm inline-flex items-center "+(e.status==="pending"?"btn-ghost-primary":"btn-ghost-secondary")),b("routerLink",Ni(16,_l,e.applicationType,e.id)),l(2),Rt("href",e.status==="pending"?"/assets/icons/sprite.svg#edit":"/assets/icons/sprite.svg#eye")}}function xl(n,t){n&1&&(i(0,"tr")(1,"td",20),a(2,"\u5C1A\u7121\u7C3D\u6838\u4F5C\u696D\u3002"),r()())}function hl(n,t){n&1&&(i(0,"li",28)(1,"span",30),a(2,"\u2026"),r()())}function Sl(n,t){if(n&1){let e=D();i(0,"li",26)(1,"button",27),x("click",function(){S(e);let s=m().$implicit,c=m(2);return C(c.goTo(s))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);O("active",e===o.page()),l(2),v(e)}}function Cl(n,t){if(n&1&&u(0,hl,3,0,"li",28)(1,Sl,3,3,"li",29),n&2){let e=t.$implicit;p(e===-1?0:1)}}function El(n,t){if(n&1){let e=D();i(0,"div",13)(1,"span",21),a(2),r(),i(3,"div",22)(4,"button",23),x("click",function(){S(e);let s=m();return C(s.prev())}),a(5,"\u2039"),r(),i(6,"span",24),a(7),r(),i(8,"button",23),x("click",function(){S(e);let s=m();return C(s.next())}),a(9,"\u203A"),r()(),i(10,"ul",25)(11,"li",26)(12,"button",27),x("click",function(){S(e);let s=m();return C(s.prev())}),a(13,"\u2039"),r()(),L(14,Cl,2,1,null,null,_e),i(16,"li",26)(17,"button",27),x("click",function(){S(e);let s=m();return C(s.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();l(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),l(2),O("disabled",e.page()===1),l(3),z("",e.page()," / ",e.totalPages()),l(),O("disabled",e.page()===e.totalPages()),l(3),O("disabled",e.page()===1),l(3),I(e.pageNumbers()),l(2),O("disabled",e.page()===e.totalPages())}}var oi=class n{service=g(Mt);PAGE_SIZE=20;page=M(1);result=Ae(Le(this.page).pipe(ue(t=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedTasks=$(()=>this.result().items);totalCount=$(()=>this.result().totalCount);totalPages=$(()=>this.result().totalPages);pageNumbers=$(()=>yl(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}statusLabel=ii;statusClass=ni;appTypeLabel=et;appTypeClass=tt;payTypeLabel=ri;leaveTypeLabel=ai;getSummary(t){return t.paymentDetail?`${this.payTypeLabel[t.paymentDetail.paymentType]}\u30FB${t.paymentDetail.projectCode}\uFF08${t.paymentDetail.totalAmount.toLocaleString()} \u5143\uFF09`:t.leaveDetail?`${this.leaveTypeLabel[t.leaveDetail.leaveType]}\u30FB${t.leaveDetail.days} \u5929`:t.travelDetail?`${t.travelDetail.destination}\uFF08${t.travelDetail.estimatedCost.toLocaleString()} \u5143\uFF09`:t.overtimeDetail?`${new Date(t.overtimeDetail.overtimeDate).toLocaleDateString("zh-TW")}\u30FB${t.overtimeDetail.estimatedHours} \u5C0F\u6642\u30FB${t.overtimeDetail.reason}`:"\u2014"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-approval-task-list"]],decls:29,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#check-square"],[1,"mb-0"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"text-right"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500"],[1,"text-muted","small","hidden","md:table-cell"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[3,"routerLink"],[1,"sa-icon",2,"stroke","currentColor"],["colspan","6",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1),f(),i(2,"svg",2),d(3,"use",3),r(),y(),i(4,"h4",4),a(5,"\u7C3D\u6838\u4F5C\u696D"),r()(),i(6,"div",5)(7,"div",6)(8,"div",7)(9,"table",8)(10,"thead",9)(11,"tr")(12,"th"),a(13,"\u985E\u578B"),r(),i(14,"th"),a(15,"\u7533\u8ACB\u4EBA"),r(),i(16,"th",10),a(17,"\u6458\u8981"),r(),i(18,"th"),a(19,"\u72C0\u614B"),r(),i(20,"th",11),a(21,"\u7533\u8ACB\u6642\u9593"),r(),i(22,"th",12),a(23,"\u64CD\u4F5C"),r()()(),i(24,"tbody"),L(25,bl,18,19,"tr",null,gl,!1,xl,3,0,"tr"),r()()(),u(28,El,19,13,"div",13),r()()()),e&2&&(l(25),I(o.pagedTasks()),l(3),p(o.totalPages()>1?28:-1))},dependencies:[N,ge],encapsulation:2})};function yl(n,t){if(t<=9)return Array.from({length:t},(s,c)=>c+1);let e=[],o=0;for(let s=1;s<=t;s++)(s===1||s===t||s>=n-2&&s<=n+2)&&(o&&s-o>1&&e.push(-1),e.push(s),o=s);return e}var Al=(n,t)=>t.id,Fl=(n,t)=>t.stepOrder;function Tl(n,t){if(n&1&&(i(0,"div",10),f(),i(1,"svg",14),d(2,"use",15),r(),a(3),r()),n&2){let e=m(2);l(3),E(" ",e.errorMsg()," ")}}function wl(n,t){if(n&1){let e=D();i(0,"button",41),x("click",function(){S(e);let s=m().$implicit,c=m(4);return C(c.openPreview(s.fileName,s.previewUrl))}),f(),i(1,"svg",42),d(2,"use",28),r(),a(3),r()}if(n&2){let e=m().$implicit;l(3),E(" ",e.fileName," ")}}function Dl(n,t){if(n&1&&(i(0,"span",38),f(),i(1,"svg",42),d(2,"use",28),r(),a(3),r()),n&2){let e=m().$implicit;l(3),E(" ",e.fileName," ")}}function kl(n,t){if(n&1&&(i(0,"tr")(1,"td",36),u(2,wl,4,1,"button",37)(3,Dl,4,1,"span",38),r(),i(4,"td",39),a(5),r(),i(6,"td",40),a(7),R(8,"number"),r()()),n&2){let e=t.$implicit;l(2),p(e.previewUrl?2:3),l(3),v(e.invoiceNo),l(2),v(q(8,3,e.amount,"1.0-0"))}}function Ll(n,t){if(n&1&&(i(0,"div",16)(1,"div",17),f(),i(2,"svg",18),d(3,"use",19),r(),a(4," \u8ACB\u6B3E\u7533\u8ACB\u8CC7\u8A0A "),r(),y(),i(5,"div",20)(6,"div",21)(7,"div",22)(8,"div",23),a(9,"\u8ACB\u6B3E\u985E\u578B"),r(),i(10,"span",24),a(11),r()(),i(12,"div",22)(13,"div",23),a(14,"\u5C08\u6848\u7DE8\u865F"),r(),i(15,"span",25),a(16),r()(),i(17,"div",22)(18,"div",23),a(19,"\u7533\u8ACB\u4EBA"),r(),i(20,"span",24),a(21),r()(),i(22,"div",22)(23,"div",23),a(24,"\u7533\u8ACB\u6642\u9593"),r(),i(25,"span",26),a(26),R(27,"date"),r()(),i(28,"div",22)(29,"div",23),a(30,"\u7E3D\u91D1\u984D"),r(),i(31,"span",27),a(32),R(33,"number"),r()()()()(),i(34,"div",13)(35,"div",17),f(),i(36,"svg",18),d(37,"use",28),r(),a(38," \u767C\u7968\u660E\u7D30 "),r(),y(),i(39,"div",29)(40,"div",30)(41,"table",31)(42,"thead",32)(43,"tr")(44,"th"),a(45,"\u6A94\u6848\u540D\u7A31"),r(),i(46,"th"),a(47,"\u767C\u7968\u865F\u78BC"),r(),i(48,"th",33),a(49,"\u91D1\u984D"),r()()(),i(50,"tbody"),L(51,kl,9,6,"tr",null,Al),r(),i(53,"tfoot")(54,"tr",32)(55,"td",34),a(56,"\u5408\u8A08"),r(),i(57,"td",35),a(58),R(59,"number"),r()()()()()()()),n&2){let e=t,o=m(2),s=m();l(11),v(s.payTypeLabel[e.paymentType]),l(5),v(e.projectCode),l(5),v(o.submittedBy),l(5),v(q(27,6,o.submittedAt,"yyyy-MM-dd")),l(6),v(q(33,9,e.totalAmount,"1.0-0")),l(19),I(e.invoices),l(7),v(q(59,12,e.totalAmount,"1.0-0"))}}function Il(n,t){if(n&1&&u(0,Ll,60,15),n&2){let e,o=m();p((e=o.paymentDetail)?0:-1,e)}}function Pl(n,t){if(n&1&&(i(0,"div",16)(1,"div",17),f(),i(2,"svg",18),d(3,"use",43),r(),a(4," \u8ACB\u5047\u7533\u8ACB\u8CC7\u8A0A "),r(),y(),i(5,"div",20)(6,"div",44)(7,"div",22)(8,"div",23),a(9,"\u5047\u5225"),r(),i(10,"span",24),a(11),r()(),i(12,"div",22)(13,"div",23),a(14,"\u7533\u8ACB\u4EBA"),r(),i(15,"span",24),a(16),r()(),i(17,"div",22)(18,"div",23),a(19,"\u5929\u6578"),r(),i(20,"span",27),a(21),r()(),i(22,"div",22)(23,"div",23),a(24,"\u958B\u59CB\u65E5\u671F"),r(),i(25,"span",26),a(26),R(27,"date"),r()(),i(28,"div",22)(29,"div",23),a(30,"\u7D50\u675F\u65E5\u671F"),r(),i(31,"span",26),a(32),R(33,"date"),r()(),i(34,"div",45)(35,"div",23),a(36,"\u8ACB\u5047\u539F\u56E0"),r(),i(37,"div",46),a(38),r()()()()()),n&2){let e=t,o=m(2),s=m();l(11),v(s.leaveTypeLabel[e.leaveType]),l(5),v(o.submittedBy),l(5),E("",e.days," \u5929"),l(5),v(q(27,6,e.startDate,"yyyy-MM-dd")),l(6),v(q(33,9,e.endDate,"yyyy-MM-dd")),l(6),v(e.reason)}}function Rl(n,t){if(n&1&&u(0,Pl,39,12,"div",16),n&2){let e,o=m();p((e=o.leaveDetail)?0:-1,e)}}function Bl(n,t){if(n&1&&(i(0,"div",22)(1,"div",23),a(2,"\u95DC\u806F\u5C08\u6848"),r(),i(3,"span",48),a(4),r()()),n&2){let e=m();l(4),v(e.projectCode)}}function jl(n,t){if(n&1&&(i(0,"div",16)(1,"div",17),f(),i(2,"svg",18),d(3,"use",47),r(),a(4," \u51FA\u5DEE\u7533\u8ACB\u8CC7\u8A0A "),r(),y(),i(5,"div",20)(6,"div",44)(7,"div",22)(8,"div",23),a(9,"\u51FA\u5DEE\u5730\u9EDE"),r(),i(10,"span",24),a(11),r()(),i(12,"div",22)(13,"div",23),a(14,"\u7533\u8ACB\u4EBA"),r(),i(15,"span",24),a(16),r()(),i(17,"div",22)(18,"div",23),a(19,"\u9810\u4F30\u8CBB\u7528"),r(),i(20,"span",27),a(21),R(22,"number"),r()(),i(23,"div",22)(24,"div",23),a(25,"\u51FA\u767C\u65E5\u671F"),r(),i(26,"span",26),a(27),R(28,"date"),r()(),i(29,"div",22)(30,"div",23),a(31,"\u8FD4\u56DE\u65E5\u671F"),r(),i(32,"span",26),a(33),R(34,"date"),r()(),u(35,Bl,5,1,"div",22),i(36,"div",45)(37,"div",23),a(38,"\u51FA\u5DEE\u76EE\u7684"),r(),i(39,"div",46),a(40),r()()()()()),n&2){let e=t,o=m(2);l(11),v(e.destination),l(5),v(o.submittedBy),l(5),E("",q(22,7,e.estimatedCost,"1.0-0")," \u5143"),l(6),v(q(28,10,e.startDate,"yyyy-MM-dd")),l(6),v(q(34,13,e.endDate,"yyyy-MM-dd")),l(2),p(e.projectCode?35:-1),l(5),v(e.purpose)}}function Ml(n,t){if(n&1&&u(0,jl,41,16,"div",16),n&2){let e,o=m();p((e=o.travelDetail)?0:-1,e)}}function Vl(n,t){if(n&1&&(i(0,"span",52),a(1),r()),n&2){let e=t.$implicit;l(),v(e)}}function Nl(n,t){if(n&1&&(i(0,"div",50)(1,"div",23),a(2,"\u95DC\u806F\u5C08\u6848"),r(),i(3,"div",51),L(4,Vl,2,1,"span",52,_e),r()()),n&2){let e=m();l(4),I(e.projectCodes)}}function Ol(n,t){if(n&1&&(i(0,"div",16)(1,"div",17),f(),i(2,"svg",18),d(3,"use",49),r(),a(4," \u52A0\u73ED\u7533\u8ACB\u8CC7\u8A0A "),r(),y(),i(5,"div",20)(6,"div",44)(7,"div",22)(8,"div",23),a(9,"\u52A0\u73ED\u65E5\u671F"),r(),i(10,"span",24),a(11),R(12,"date"),r()(),i(13,"div",22)(14,"div",23),a(15,"\u7533\u8ACB\u4EBA"),r(),i(16,"span",24),a(17),r()(),i(18,"div",22)(19,"div",23),a(20,"\u9810\u8A08\u52A0\u73ED\u6642\u6578"),r(),i(21,"span",27),a(22),r()(),u(23,Nl,6,0,"div",50),i(24,"div",45)(25,"div",23),a(26,"\u52A0\u73ED\u539F\u56E0"),r(),i(27,"div",46),a(28),r()()()()()),n&2){let e=t,o=m(2);l(11),v(q(12,5,e.overtimeDate,"yyyy-MM-dd")),l(6),v(o.submittedBy),l(5),E("",e.estimatedHours," \u5C0F\u6642"),l(),p(e.projectCodes&&e.projectCodes.length>0?23:-1),l(5),v(e.reason)}}function ql(n,t){if(n&1&&u(0,Ol,29,8,"div",16),n&2){let e,o=m();p((e=o.overtimeDetail)?0:-1,e)}}function $l(n,t){n&1&&(i(0,"span",62),a(1,"\u2713"),r())}function Ul(n,t){n&1&&(i(0,"span",63),a(1,"\u2717"),r())}function Gl(n,t){n&1&&u(0,$l,2,0,"span",62)(1,Ul,2,0,"span",63),n&2&&p(t.action==="approved"?0:1)}function Hl(n,t){if(n&1&&(i(0,"span",57),a(1),r()),n&2){let e=m().$implicit;l(),v(e.stepOrder)}}function Jl(n,t){if(n&1&&(i(0,"span",58),a(1),r()),n&2){let e=m().$implicit;l(),v(e.stepOrder)}}function zl(n,t){if(n&1&&(i(0,"span",60),a(1),r()),n&2){let e=m().$implicit;l(),E("\uFF08",e.departmentName,"\uFF09")}}function Yl(n,t){if(n&1&&(i(0,"div",26),a(1),r()),n&2){let e=m().$implicit;l(),v(e.note)}}function Wl(n,t){n&1&&(i(0,"span",65),a(1,"\u5DF2\u6838\u51C6"),r())}function Kl(n,t){n&1&&(i(0,"span",66),a(1,"\u9000\u56DE\u4FEE\u6539"),r())}function Zl(n,t){n&1&&(i(0,"span",67),a(1,"\u5DF2\u62D2\u7D55"),r())}function Ql(n,t){if(n&1&&(i(0,"div",68),a(1),r()),n&2){let e=m();l(),E("\u300C",e.reviewNote,"\u300D")}}function Xl(n,t){if(n&1&&(i(0,"div",64),a(1),R(2,"date"),u(3,Wl,2,0,"span",65)(4,Kl,2,0,"span",66)(5,Zl,2,0,"span",67),r(),u(6,Ql,2,1,"div",68)),n&2){let e=t;l(),z(" ",e.reviewedBy," \xB7 ",q(2,4,e.reviewedAt,"yyyy-MM-dd")," \xB7 "),l(2),p(e.action==="approved"?3:e.action==="returned"?4:5),l(3),p(e.reviewNote?6:-1)}}function es(n,t){n&1&&(i(0,"div",61),a(1,"\u5BE9\u6838\u4E2D\u2026"),r())}function ts(n,t){if(n&1&&(i(0,"li",56),u(1,Gl,2,1)(2,Hl,2,1,"span",57)(3,Jl,2,1,"span",58),i(4,"div",59)(5,"div",24),a(6),u(7,zl,2,1,"span",60),r(),u(8,Yl,2,1,"div",26),u(9,Xl,7,7)(10,es,2,0,"div",61),r()()),n&2){let e,o,s=t.$implicit,c=t.$index,F=t.$count,P=m(2),B=m();O("mb-6",c!==F-1),l(),p((e=B.getRecord(P.approvalRecords,s.stepOrder))?1:P.currentStepOrder===s.stepOrder&&P.status==="pending"?2:3,e),l(5),E(" ",s.jobTitleName||"\u2014"," "),l(),p(s.departmentName?7:-1),l(),p(s.note?8:-1),l(),p((o=B.getRecord(P.approvalRecords,s.stepOrder))?9:P.currentStepOrder===s.stepOrder&&P.status==="pending"?10:-1,o)}}function is(n,t){if(n&1&&(i(0,"div",13)(1,"div",17),f(),i(2,"svg",18),d(3,"use",53),r(),a(4," \u7C3D\u6838\u6D41\u7A0B "),r(),y(),i(5,"div",20)(6,"ol",54),L(7,ts,11,7,"li",55,Fl),r()()()),n&2){let e=m();l(7),I(e.flow.steps)}}function ns(n,t){n&1&&(i(0,"span",67),a(1,"*"),r())}function rs(n,t){n&1&&(i(0,"div",81),a(1,"\u9000\u56DE\u4FEE\u6539\u6216\u62D2\u7D55\u6642\u8ACB\u586B\u5BEB\u539F\u56E0\u3002"),r())}function as(n,t){if(n&1){let e=D();i(0,"div",13)(1,"div",17),f(),i(2,"svg",18),d(3,"use",8),r(),a(4," \u5BE9\u6838 "),r(),y(),i(5,"div",20)(6,"form",69),x("ngSubmit",function(){S(e);let s=m(2);return C(s.submit())}),i(7,"div",70)(8,"label",71),a(9,"\u5BE9\u6838\u7D50\u679C "),i(10,"span",67),a(11,"*"),r()(),i(12,"div",72)(13,"div",73),d(14,"input",74),i(15,"label",75),a(16,"\u6838\u51C6"),r()(),i(17,"div",73),d(18,"input",76),i(19,"label",77),a(20,"\u9000\u56DE\u4FEE\u6539"),r()(),i(21,"div",73),d(22,"input",78),i(23,"label",79),a(24,"\u62D2\u7D55\uFF08\u7D42\u6B62\uFF09"),r()()()(),i(25,"div",70)(26,"label",71),a(27," \u5BE9\u6838\u610F\u898B "),u(28,ns,2,0,"span",67),r(),d(29,"textarea",80),u(30,rs,2,0,"div",81),r(),i(31,"div",82)(32,"button",83),a(33,"\u63D0\u4EA4\u5BE9\u6838"),r(),i(34,"a",84),a(35,"\u53D6\u6D88"),r()()()()()}if(n&2){let e,o=m(2);l(6),b("formGroup",o.form),l(22),p(((e=o.form.get("action"))==null?null:e.value)==="rejected"||((e=o.form.get("action"))==null?null:e.value)==="returned"?28:-1),l(2),p(o.showNoteError?30:-1)}}function os(n,t){if(n&1&&(i(0,"div",89),a(1,"\u9000\u56DE\u539F\u56E0\uFF1A"),r(),i(2,"div",90),a(3),r()),n&2){let e=m(2);l(3),v(e.reviewNote)}}function ls(n,t){if(n&1&&(i(0,"div",13)(1,"div",85),f(),i(2,"svg",14),d(3,"use",86),r(),a(4," \u9000\u56DE\u4FEE\u6539 "),r(),y(),i(5,"div",20)(6,"p",87),a(7,"\u6B64\u7533\u8ACB\u5DF2\u9000\u56DE\uFF0C\u5F85\u7533\u8ACB\u4EBA\u4FEE\u6539\u5F8C\u91CD\u65B0\u9001\u51FA\u3002"),r(),u(8,os,4,1),i(9,"div",88)(10,"a",84),a(11,"\u8FD4\u56DE\u5217\u8868"),r()()()()),n&2){let e=m();l(8),p(e.reviewNote?8:-1)}}function ss(n,t){if(n&1&&(i(0,"div",45)(1,"div",23),a(2,"\u5BE9\u6838\u610F\u898B"),r(),i(3,"div",46),a(4),r()()),n&2){let e=m(2);l(4),v(e.reviewNote)}}function ms(n,t){if(n&1&&(i(0,"div",13)(1,"div",17),f(),i(2,"svg",18),d(3,"use",8),r(),a(4," \u5BE9\u6838\u7D50\u679C "),r(),y(),i(5,"div",20)(6,"div",44)(7,"div",22)(8,"div",23),a(9,"\u5BE9\u6838\u7D50\u679C"),r(),i(10,"span"),a(11),r()(),i(12,"div",22)(13,"div",23),a(14,"\u5BE9\u6838\u6642\u9593"),r(),i(15,"span",26),a(16),R(17,"date"),r()(),u(18,ss,5,1,"div",45),r(),i(19,"div",91)(20,"a",84),a(21,"\u8FD4\u56DE\u5217\u8868"),r()()()()),n&2){let e=m(),o=m();l(10),re("badge px-3 py-2 rounded-full "+o.statusClass[e.status]),l(),E(" ",o.statusLabel[e.status]," "),l(5),v(q(17,5,e.reviewedAt,"yyyy-MM-dd")),l(2),p(e.reviewNote?18:-1)}}function ds(n,t){if(n&1&&(i(0,"div",3)(1,"a",4),f(),i(2,"svg",5),d(3,"use",6),r()(),i(4,"svg",7),d(5,"use",8),r(),y(),i(6,"h4",9),a(7,"\u7C3D\u6838\u5BE9\u6838"),r(),i(8,"span"),a(9),r(),i(10,"span"),a(11),r()(),u(12,Tl,4,1,"div",10),i(13,"div",11)(14,"div",12),u(15,Il,1,1)(16,Rl,1,1)(17,Ml,1,1)(18,ql,1,1),u(19,is,9,0,"div",13),u(20,as,36,3,"div",13)(21,ls,12,1,"div",13)(22,ms,22,8,"div",13),r()()),n&2){let e,o=t,s=m();l(8),re("badge "+s.appTypeClass[o.applicationType]),l(),v(s.appTypeLabel[o.applicationType]),l(),re("badge "+s.statusClass[o.status]),l(),v(s.statusLabel[o.status]),l(),p(s.errorMsg()?12:-1),l(3),p((e=o.applicationType)==="payment_request"?15:e==="leave"?16:e==="travel"?17:e==="overtime"?18:-1),l(4),p(o.flow?19:-1),l(),p(o.status==="pending"?20:o.status==="returned"?21:22)}}function us(n,t){n&1&&(i(0,"p",1),a(1,"\u627E\u4E0D\u5230\u6B64\u7C3D\u6838\u4F5C\u696D\u3002"),r())}function ps(n,t){if(n&1&&d(0,"img",99),n&2){let e=m(2);b("src",e.previewFile.url,Ye)}}function cs(n,t){if(n&1&&d(0,"iframe",100),n&2){let e=m(2);b("src",e.previewFile.safeUrl,Pt)}}function vs(n,t){if(n&1&&(i(0,"div",101)(1,"a",102),f(),i(2,"svg",103),d(3,"use",104),r(),a(4," \u4E0B\u8F09\u6A94\u6848 "),r()()),n&2){let e=m(2);l(),b("href",e.previewFile.url,Ye)("download",e.previewFile.name)}}function fs(n,t){if(n&1){let e=D();i(0,"div",92),x("click",function(){S(e);let s=m();return C(s.closePreview())}),i(1,"div",93),x("click",function(s){return S(e),C(s.stopPropagation())}),i(2,"div",94)(3,"div",95)(4,"h6",96),a(5),r(),i(6,"button",97),x("click",function(){S(e);let s=m();return C(s.closePreview())}),r()(),i(7,"div",98),u(8,ps,1,1,"img",99)(9,cs,1,1,"iframe",100)(10,vs,5,2,"div",101),r()()()()}if(n&2){let e=m();l(5),v(e.previewFile.name),l(3),p(e.isImageFile(e.previewFile.name)?8:e.isPdfFile(e.previewFile.name)?9:10)}}var li=class n{service=g(Mt);route=g(le);router=g(ve);fb=g(ee);sanitizer=g(jt);task$;taskId=0;applicationType="";errorMsg=M("");showNoteError=!1;previewFile=null;openPreview(t,e){this.previewFile={name:t,url:e,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(e)}}closePreview(){this.previewFile=null}isImageFile(t){return/\.(jpe?g|png|gif|webp|bmp)$/i.test(t)}isPdfFile(t){return/\.pdf$/i.test(t)}statusLabel=ii;statusClass=ni;appTypeLabel=et;appTypeClass=tt;payTypeLabel=ri;leaveTypeLabel=ai;form=this.fb.group({action:["approved",w.required],reviewNote:[""]});ngOnInit(){this.applicationType=this.route.snapshot.paramMap.get("applicationType")??"",this.taskId=+this.route.snapshot.paramMap.get("id"),this.task$=this.service.getById(this.taskId,this.applicationType)}getRecord(t,e){return t.find(o=>o.stepOrder===e)}submit(){let t=this.form.value.action,e=this.form.value.reviewNote?.trim()??"";if((t==="rejected"||t==="returned")&&!e){this.showNoteError=!0;return}this.showNoteError=!1,this.errorMsg.set(""),this.service.review(this.taskId,this.applicationType,t,e).subscribe({next:()=>this.router.navigate(["/admin/approval-tasks"]),error:o=>{this.errorMsg.set(o.error?.message||"\u5BE9\u6838\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-approval-task-review"]],decls:5,vars:4,consts:[[1,"container-fluid","py-3"],[1,"text-muted"],["tabindex","-1",1,"modal",2,"background","rgba(0,0,0,.6)"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/approval-tasks",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#check-square"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm","mt-6"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#dollar-sign"],[1,"card-body"],[1,"row","g-3","mb-0"],[1,"col-6","col-md-4"],[1,"text-muted","small","mb-1"],[1,"fw-500"],[1,"fw-500","font-monospace"],[1,"text-muted","small"],[1,"fw-600","fs-5"],["href","/assets/icons/sprite.svg#file-text"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-sm","mb-0"],[1,"table-light"],[1,"text-right"],["colspan","2",1,"text-right","fw-500","small"],[1,"text-right","fw-600"],[1,"small",2,"max-width","200px","overflow","hidden","text-overflow","ellipsis","white-space","nowrap"],["type","button",1,"btn","btn-link","p-0","text-muted","small","inline-flex","items-center","gap-1",2,"text-decoration","none","max-width","100%","overflow","hidden","text-overflow","ellipsis"],[1,"text-muted","inline-flex","items-center","gap-1"],[1,"font-monospace","small"],[1,"text-right","fw-500"],["type","button",1,"btn","btn-link","p-0","text-muted","small","inline-flex","items-center","gap-1",2,"text-decoration","none","max-width","100%","overflow","hidden","text-overflow","ellipsis",3,"click"],[1,"sa-icon","shrink-0",2,"width","14px","height","14px","stroke","currentColor"],["href","/assets/icons/sprite.svg#calendar"],[1,"row","g-3"],[1,"col-12"],[1,"border","rounded","p-4","bg-[--bg-base]","small"],["href","/assets/icons/sprite.svg#map-pin"],[1,"font-monospace","fw-500"],["href","/assets/icons/sprite.svg#clock"],[1,"col-12","col-md-8"],[1,"flex","flex-wrap","gap-1"],[1,"badge","bg-[--bg-base]","text-[--text-muted]","font-monospace"],["href","/assets/icons/sprite.svg#git-merge"],[1,"list-none","p-0","mb-0"],[1,"flex","items-start","gap-3",3,"mb-6"],[1,"flex","items-start","gap-3"],[1,"badge","bg-primary","rounded-circle","flex","items-center","justify-center","shrink-0",2,"width","28px","height","28px","min-width","28px","font-size",".75rem"],[1,"badge","bg-[--bg-base]","text-[--text-muted]","rounded-circle","flex","items-center","justify-center","shrink-0",2,"width","28px","height","28px","min-width","28px","font-size",".75rem"],[1,"grow"],[1,"text-muted","font-normal"],[1,"text-primary","small","mt-1"],[1,"badge","bg-success","rounded-circle","flex","items-center","justify-center","shrink-0",2,"width","28px","height","28px","min-width","28px","font-size",".85rem"],[1,"badge","bg-danger","rounded-circle","flex","items-center","justify-center","shrink-0",2,"width","28px","height","28px","min-width","28px","font-size",".85rem"],[1,"text-muted","small","mt-1"],[1,"text-success"],[1,"text-[--yellow]"],[1,"text-danger"],[1,"text-muted","small","italic","mt-1"],[3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"flex","flex-wrap","gap-4","mt-1"],[1,"form-check"],["type","radio","formControlName","action","value","approved","id","actionApprove",1,"form-check-input"],["for","actionApprove",1,"form-check-label","fw-500","text-success"],["type","radio","formControlName","action","value","returned","id","actionReturn",1,"form-check-input"],["for","actionReturn",1,"form-check-label","fw-500","text-[--yellow]"],["type","radio","formControlName","action","value","rejected","id","actionReject",1,"form-check-input"],["for","actionReject",1,"form-check-label","fw-500","text-danger"],["formControlName","reviewNote","rows","3","placeholder","\u586B\u5BEB\u5BE9\u6838\u610F\u898B\uFF08\u9000\u56DE\u4FEE\u6539\u6216\u62D2\u7D55\u6642\u5FC5\u586B\uFF09...",1,"form-control"],[1,"text-danger","small","mt-1"],[1,"flex","gap-2"],["type","submit",1,"btn","btn-primary"],["routerLink","/admin/approval-tasks",1,"btn","btn-outline-secondary"],[1,"card-header","bg-[rgba(184,137,42,0.08)]","border-bottom","flex","items-center","gap-2","fw-600","text-[--yellow]"],["href","/assets/icons/sprite.svg#rotate-ccw"],[1,"text-muted","small","mb-2"],[1,"mt-2"],[1,"text-muted","small","mb-1","fw-500"],[1,"border","rounded","p-4","bg-[--bg-base]","small","mb-4"],[1,"mt-4"],["tabindex","-1",1,"modal",2,"background","rgba(0,0,0,.6)",3,"click"],[1,"modal-dialog","modal-lg","modal-dialog-centered",3,"click"],[1,"modal-content"],[1,"modal-header","py-2"],[1,"modal-title","mb-0","text-truncate"],["type","button",1,"btn-close",3,"click"],[1,"modal-body","p-0","text-center","bg-[--bg-base]"],[1,"max-w-full",2,"max-height","75vh","object-fit","contain",3,"src"],[2,"width","100%","height","75vh","border","0",3,"src"],[1,"p-5"],[1,"btn","btn-primary",3,"href","download"],[1,"sa-icon","mr-1",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#download"]],template:function(e,o){if(e&1&&(i(0,"div",0),u(1,ds,23,10),R(2,"async"),Bt(3,us,2,0,"p",1),r(),u(4,fs,11,2,"div",2)),e&2){let s;l(),p((s=Re(2,2,o.task$))?1:3,s),l(3),p(o.previewFile?4:-1)}},dependencies:[N,te,Z,Y,Ke,W,K,X,Q,Ne,ge,Te],encapsulation:2})};var lt=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/leave-requests`)}getPaged(t,e){return this.http.get(`${T.apiUrl}/leave-requests`,{params:{page:t,pageSize:e}})}getById(t){return this.http.get(`${T.apiUrl}/leave-requests/${t}`)}create(t){return this.http.post(`${T.apiUrl}/leave-requests`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/leave-requests/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/leave-requests/${t}`)}submit(t){return this.http.patch(`${T.apiUrl}/leave-requests/${t}/submit`,{})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var qn={annual:"\u5E74\u5047",personal:"\u4E8B\u5047",sick:"\u75C5\u5047",compensatory:"\u88DC\u4F11"},$n={annual:"bg-primary-subtle text-primary",personal:"bg-info-subtle text-info",sick:"bg-warning-subtle text-warning-emphasis",compensatory:"bg-secondary-subtle text-secondary"},si={draft:"\u8349\u7A3F",pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},mi={draft:"bg-blue-subtle text-blue-emphasis",pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"};var Un=n=>[n,"edit"],_s=(n,t)=>t.id;function gs(n,t){if(n&1){let e=D();i(0,"a",25),f(),i(1,"svg",7),d(2,"use",26),r()(),y(),i(3,"button",27),x("click",function(){S(e);let s=m().$implicit,c=m();return C(c.delete(s))}),f(),i(4,"svg",7),d(5,"use",28),r()()}if(n&2){let e=m().$implicit;b("routerLink",ae(1,Un,e.id))}}function bs(n,t){if(n&1&&(i(0,"a",24),f(),i(1,"svg",7),d(2,"use",29),r()()),n&2){let e=m().$implicit;b("routerLink",ae(1,Un,e.id))}}function xs(n,t){if(n&1&&(i(0,"tr")(1,"td")(2,"span"),a(3),r()(),i(4,"td",18),a(5),R(6,"date"),r(),i(7,"td",18),a(8),R(9,"date"),r(),i(10,"td",19),a(11),R(12,"number"),r(),i(13,"td",20),a(14),r(),i(15,"td")(16,"span"),a(17),r()(),i(18,"td",21),a(19),R(20,"date"),r(),i(21,"td",22)(22,"div",23),u(23,gs,6,3)(24,bs,3,3,"a",24),r()()()),n&2){let e=t.$implicit,o=m();l(2),re("badge "+o.typeClass[e.leaveType]),l(),v(o.typeLabel[e.leaveType]),l(2),v(q(6,12,e.startDate,"yyyy-MM-dd")),l(3),v(q(9,15,e.endDate,"yyyy-MM-dd")),l(3),E("",q(12,18,e.days,"1.0-1")," \u5929"),l(3),v(e.reason),l(2),re("badge "+o.statusClass[e.approvalStatus]),l(),v(o.statusLabel[e.approvalStatus]),l(2),v(q(20,21,e.createdAt,"yyyy-MM-dd")),l(4),p(e.approvalStatus==="pending"||e.approvalStatus==="returned"?23:24)}}function hs(n,t){n&1&&(i(0,"tr")(1,"td",30),a(2,"\u5C1A\u7121\u8ACB\u5047\u7533\u8ACB\u3002"),r()())}function Ss(n,t){n&1&&(i(0,"li",38)(1,"span",40),a(2,"\u2026"),r()())}function Cs(n,t){if(n&1){let e=D();i(0,"li",36)(1,"button",37),x("click",function(){S(e);let s=m().$implicit,c=m(2);return C(c.goTo(s))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);O("active",e===o.page()),l(2),v(e)}}function Es(n,t){if(n&1&&u(0,Ss,3,0,"li",38)(1,Cs,3,3,"li",39),n&2){let e=t.$implicit;p(e===-1?0:1)}}function ys(n,t){if(n&1){let e=D();i(0,"div",17)(1,"span",31),a(2),r(),i(3,"div",32)(4,"button",33),x("click",function(){S(e);let s=m();return C(s.prev())}),a(5,"\u2039"),r(),i(6,"span",34),a(7),r(),i(8,"button",33),x("click",function(){S(e);let s=m();return C(s.next())}),a(9,"\u203A"),r()(),i(10,"ul",35)(11,"li",36)(12,"button",37),x("click",function(){S(e);let s=m();return C(s.prev())}),a(13,"\u2039"),r()(),L(14,Es,2,1,null,null,_e),i(16,"li",36)(17,"button",37),x("click",function(){S(e);let s=m();return C(s.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();l(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),l(2),O("disabled",e.page()===1),l(3),z("",e.page()," / ",e.totalPages()),l(),O("disabled",e.page()===e.totalPages()),l(3),O("disabled",e.page()===1),l(3),I(e.pageNumbers()),l(2),O("disabled",e.page()===e.totalPages())}}var di=class n{service=g(lt);PAGE_SIZE=20;page=M(1);refresh=M(0);result=Ae(Le($(()=>({page:this.page(),refresh:this.refresh()}))).pipe(ue(({page:t})=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedRequests=$(()=>this.result().items);totalCount=$(()=>this.result().totalCount);totalPages=$(()=>this.result().totalPages);pageNumbers=$(()=>As(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}typeLabel=qn;typeClass=$n;statusLabel=si;statusClass=mi;delete(t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u8ACB\u5047\u7533\u8ACB\u55CE\uFF1F")&&this.service.delete(t.id).subscribe(()=>this.refresh.update(e=>e+1))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-leave-request-list"]],decls:38,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#calendar"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"text-muted","small"],[1,"text-right","fw-500"],[1,"text-muted","small","hidden","md:table-cell"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u6AA2\u8996",1,"btn","btn-sm","btn-ghost-secondary","inline-flex","items-center",3,"routerLink"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["href","/assets/icons/sprite.svg#eye"],["colspan","8",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u8ACB\u5047\u7533\u8ACB"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u7533\u8ACB "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u5047\u5225"),r(),i(19,"th"),a(20,"\u958B\u59CB\u65E5\u671F"),r(),i(21,"th"),a(22,"\u7D50\u675F\u65E5\u671F"),r(),i(23,"th",14),a(24,"\u5929\u6578"),r(),i(25,"th",15),a(26,"\u539F\u56E0"),r(),i(27,"th"),a(28,"\u72C0\u614B"),r(),i(29,"th",16),a(30,"\u7533\u8ACB\u6642\u9593"),r(),i(31,"th",14),a(32,"\u64CD\u4F5C"),r()()(),i(33,"tbody"),L(34,xs,25,24,"tr",null,_s,!1,hs,3,0,"tr"),r()()(),u(37,ys,19,13,"div",17),r()()()),e&2&&(l(34),I(o.pagedRequests()),l(3),p(o.totalPages()>1?37:-1))},dependencies:[N,ge,Te],encapsulation:2})};function As(n,t){if(t<=9)return Array.from({length:t},(s,c)=>c+1);let e=[],o=0;for(let s=1;s<=t;s++)(s===1||s===t||s>=n-2&&s<=n+2)&&(o&&s-o>1&&e.push(-1),e.push(s),o=s);return e}function Fs(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",38),d(2,"use",39),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function Ts(n,t){if(n&1&&(i(0,"div",28),f(),i(1,"svg",40),d(2,"use",41),r(),y(),i(3,"span",42),a(4,"\u76EE\u524D\u53EF\u88DC\u4F11\u6642\u6578\uFF1A"),i(5,"strong"),a(6),r()()()),n&2){let e=m();l(6),E("",e.overtimeHours," \u5C0F\u6642")}}function ws(n,t){n&1&&(i(0,"div",32),a(1,"\u8ACB\u9078\u64C7\u958B\u59CB\u65E5\u671F\u3002"),r())}function Ds(n,t){n&1&&(i(0,"div",32),a(1,"\u8ACB\u9078\u64C7\u7D50\u675F\u65E5\u671F\u3002"),r())}function ks(n,t){n&1&&(i(0,"div",32),a(1,"\u8ACB\u8F38\u5165\u6709\u6548\u5929\u6578\uFF08\u6700\u5C11 0.5\uFF09\u3002"),r())}function Ls(n,t){n&1&&(i(0,"div",32),a(1,"\u8ACB\u586B\u5BEB\u8ACB\u5047\u539F\u56E0\u3002"),r())}function Is(n,t){if(n&1){let e=D();i(0,"button",46),a(1),r(),i(2,"button",47),x("click",function(){S(e);let s=m(2);return C(s.submitForApproval())}),a(3," \u9001\u51FA\u7533\u8ACB "),r()}if(n&2){let e=m(2);b("disabled",e.form.invalid),l(),E(" ",e.isEdit?"\u5132\u5B58":"\u5132\u5B58\u8349\u7A3F"," "),l(),b("disabled",e.form.invalid)}}function Ps(n,t){if(n&1){let e=D();i(0,"button",47),x("click",function(){S(e);let s=m(2);return C(s.submitForApproval())}),a(1," \u4FEE\u6539\u4E26\u91CD\u9001 "),r()}if(n&2){let e=m(2);b("disabled",e.form.invalid)}}function Rs(n,t){if(n&1&&(i(0,"button",44),a(1," \u66F4\u65B0 "),r()),n&2){let e=m(2);b("disabled",e.form.invalid)}}function Bs(n,t){if(n&1&&(i(0,"div",36),u(1,Is,4,3)(2,Ps,2,1,"button",43)(3,Rs,2,1,"button",44),i(4,"a",45),a(5,"\u53D6\u6D88"),r()()),n&2){let e=m();l(),p(!e.isEdit||e.isDraft?1:e.isReturned?2:3)}}function js(n,t){n&1&&(i(0,"div",37)(1,"a",45),a(2,"\u8FD4\u56DE\u5217\u8868"),r()())}var At=class n{fb=g(ee);service=g(lt);route=g(le);router=g(ve);isEdit=!1;requestId=0;isReadOnly=!1;isReturned=!1;isDraft=!0;approvalStatus="draft";errorMsg=M("");overtimeHours=16;statusLabel=si;statusClass=mi;form=this.fb.group({leaveType:["annual",w.required],startDate:["",w.required],endDate:["",w.required],days:[1,[w.required,w.min(.5)]],reason:["",w.required]});ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.requestId=+t,this.service.getById(this.requestId).subscribe(e=>{e&&(this.approvalStatus=e.approvalStatus,this.isDraft=e.approvalStatus==="draft",this.isReturned=e.approvalStatus==="returned",this.isReadOnly=!["draft","pending","returned"].includes(e.approvalStatus),this.form.patchValue({leaveType:e.leaveType,startDate:e.startDate instanceof Date?e.startDate.toISOString().split("T")[0]:String(e.startDate),endDate:e.endDate instanceof Date?e.endDate.toISOString().split("T")[0]:String(e.endDate),days:e.days,reason:e.reason}),this.isReadOnly&&this.form.disable())}))}save(){if(this.form.invalid||this.isReadOnly)return;let t=this._buildPayload(),e=this.isEdit?this.service.update(this.requestId,t):this.service.create(t);this.errorMsg.set(""),e.subscribe({next:o=>{this.isEdit||(this.requestId=o.id),this.router.navigate(["/admin/leave-requests"])},error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}submitForApproval(){if(this.form.invalid||this.isReadOnly)return;let t=this._buildPayload(),e=this.isEdit?this.service.update(this.requestId,t):this.service.create(t);this.errorMsg.set(""),e.subscribe({next:o=>{this.service.submit(o.id).subscribe({next:()=>this.router.navigate(["/admin/leave-requests"]),error:s=>{this.errorMsg.set(s.error?.message||"\u9001\u51FA\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})},error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}_buildPayload(){let t=this.form.value;return{leaveType:t.leaveType,startDate:new Date(t.startDate),endDate:new Date(t.endDate),days:+t.days,reason:t.reason}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-leave-request-form"]],decls:71,vars:9,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/leave-requests",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#calendar"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],[1,"flex","flex-wrap","gap-4","mt-1"],[1,"form-check"],["type","radio","formControlName","leaveType","value","annual","id","typeAnnual",1,"form-check-input"],["for","typeAnnual",1,"form-check-label"],["type","radio","formControlName","leaveType","value","personal","id","typePersonal",1,"form-check-input"],["for","typePersonal",1,"form-check-label"],["type","radio","formControlName","leaveType","value","sick","id","typeSick",1,"form-check-input"],["for","typeSick",1,"form-check-label"],["type","radio","formControlName","leaveType","value","compensatory","id","typeComp",1,"form-check-input"],["for","typeComp",1,"form-check-label"],[1,"alert","alert-info","flex","items-center","gap-2","py-2","mt-2","mb-0"],[1,"row","g-3","mb-4"],[1,"col-12","col-md-4"],["type","date","formControlName","startDate",1,"form-control"],[1,"text-danger","small","mt-1"],["type","date","formControlName","endDate",1,"form-control"],["type","number","formControlName","days","min","0.5","step","0.5","placeholder","1",1,"form-control"],["formControlName","reason","rows","3","placeholder","\u8ACB\u586B\u5BEB\u8ACB\u5047\u539F\u56E0...",1,"form-control"],[1,"mt-6","flex","gap-2"],[1,"mt-6"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"],[1,"sa-icon","shrink-0",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#clock"],[1,"small"],["type","button",1,"btn","btn-primary",3,"disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/leave-requests",1,"btn","btn-outline-secondary"],["type","submit",1,"btn","btn-outline-secondary",3,"disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,Fs,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.save()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11),f(),i(13,"svg",12),d(14,"use",13),r(),a(15," \u8ACB\u5047\u8CC7\u8A0A "),r(),y(),i(16,"div",14)(17,"div",15)(18,"label",16),a(19,"\u5047\u5225 "),i(20,"span",17),a(21,"*"),r()(),i(22,"div",18)(23,"div",19),d(24,"input",20),i(25,"label",21),a(26,"\u5E74\u5047"),r()(),i(27,"div",19),d(28,"input",22),i(29,"label",23),a(30,"\u4E8B\u5047"),r()(),i(31,"div",19),d(32,"input",24),i(33,"label",25),a(34,"\u75C5\u5047"),r()(),i(35,"div",19),d(36,"input",26),i(37,"label",27),a(38,"\u88DC\u4F11"),r()()(),u(39,Ts,7,1,"div",28),r(),i(40,"div",29)(41,"div",30)(42,"label",16),a(43,"\u958B\u59CB\u65E5\u671F "),i(44,"span",17),a(45,"*"),r()(),d(46,"input",31),u(47,ws,2,0,"div",32),r(),i(48,"div",30)(49,"label",16),a(50,"\u7D50\u675F\u65E5\u671F "),i(51,"span",17),a(52,"*"),r()(),d(53,"input",33),u(54,Ds,2,0,"div",32),r(),i(55,"div",30)(56,"label",16),a(57,"\u5929\u6578 "),i(58,"span",17),a(59,"*"),r()(),d(60,"input",34),u(61,ks,2,0,"div",32),r()(),i(62,"div",15)(63,"label",16),a(64,"\u8ACB\u5047\u539F\u56E0 "),i(65,"span",17),a(66,"*"),r()(),d(67,"textarea",35),u(68,Ls,2,0,"div",32),r()()(),u(69,Bs,6,1,"div",36)(70,js,3,0,"div",37),r()()()()),e&2){let s,c,F,P,B;l(6),v(o.isEdit?o.isReadOnly?"\u6AA2\u8996\u8ACB\u5047\u7533\u8ACB":o.isReturned?"\u4FEE\u6539\u8ACB\u5047\u7533\u8ACB\uFF08\u9000\u56DE\uFF09":o.isDraft?"\u7DE8\u8F2F\u8ACB\u5047\u8349\u7A3F":"\u7DE8\u8F2F\u8ACB\u5047\u7533\u8ACB":"\u65B0\u589E\u8ACB\u5047\u7533\u8ACB"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(31),p(((s=o.form.get("leaveType"))==null?null:s.value)==="compensatory"?39:-1),l(8),p((c=o.form.get("startDate"))!=null&&c.invalid&&((c=o.form.get("startDate"))!=null&&c.touched)?47:-1),l(7),p((F=o.form.get("endDate"))!=null&&F.invalid&&((F=o.form.get("endDate"))!=null&&F.touched)?54:-1),l(7),p((P=o.form.get("days"))!=null&&P.invalid&&((P=o.form.get("days"))!=null&&P.touched)?61:-1),l(7),p((B=o.form.get("reason"))!=null&&B.invalid&&((B=o.form.get("reason"))!=null&&B.touched)?68:-1),l(),p(o.isReadOnly?70:69)}},dependencies:[te,Z,Y,be,Ke,W,K,xe,X,Q,N],encapsulation:2})};var st=class n{http=g(ce);getAll(){return this.http.get(`${T.apiUrl}/travel-requests`)}getPaged(t,e){return this.http.get(`${T.apiUrl}/travel-requests`,{params:{page:t,pageSize:e}})}getById(t){return this.http.get(`${T.apiUrl}/travel-requests/${t}`)}create(t){return this.http.post(`${T.apiUrl}/travel-requests`,t)}update(t,e){return this.http.patch(`${T.apiUrl}/travel-requests/${t}`,e)}delete(t){return this.http.delete(`${T.apiUrl}/travel-requests/${t}`)}submit(t){return this.http.patch(`${T.apiUrl}/travel-requests/${t}/submit`,{})}static \u0275fac=function(e){return new(e||n)};static \u0275prov=pe({token:n,factory:n.\u0275fac,providedIn:"root"})};var ui={draft:"\u8349\u7A3F",pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},pi={draft:"bg-blue-subtle text-blue-emphasis",pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"};var Gn=n=>[n,"edit"],Ms=(n,t)=>t.id;function Vs(n,t){if(n&1){let e=D();i(0,"a",26),f(),i(1,"svg",7),d(2,"use",27),r()(),y(),i(3,"button",28),x("click",function(){S(e);let s=m().$implicit,c=m();return C(c.delete(s))}),f(),i(4,"svg",7),d(5,"use",29),r()()}if(n&2){let e=m().$implicit;b("routerLink",ae(1,Gn,e.id))}}function Ns(n,t){if(n&1&&(i(0,"a",25),f(),i(1,"svg",7),d(2,"use",30),r()()),n&2){let e=m().$implicit;b("routerLink",ae(1,Gn,e.id))}}function Os(n,t){if(n&1&&(i(0,"tr")(1,"td",18),a(2),r(),i(3,"td",19),a(4),R(5,"date"),r(),i(6,"td",19),a(7),R(8,"date"),r(),i(9,"td",20),a(10),R(11,"number"),r(),i(12,"td",21),a(13),r(),i(14,"td",22),a(15),r(),i(16,"td")(17,"span"),a(18),r()(),i(19,"td",23)(20,"div",24),u(21,Vs,6,3)(22,Ns,3,3,"a",25),r()()()),n&2){let e=t.$implicit,o=m();l(2),v(e.destination),l(2),v(q(5,10,e.startDate,"yyyy-MM-dd")),l(3),v(q(8,13,e.endDate,"yyyy-MM-dd")),l(3),v(q(11,16,e.estimatedCost,"1.0-0")),l(3),v(e.purpose),l(2),v(e.projectCode||"\u2014"),l(2),re("badge "+o.statusClass[e.approvalStatus]),l(),v(o.statusLabel[e.approvalStatus]),l(3),p(e.approvalStatus==="pending"||e.approvalStatus==="returned"?21:22)}}function qs(n,t){n&1&&(i(0,"tr")(1,"td",31),a(2,"\u5C1A\u7121\u51FA\u5DEE\u7533\u8ACB\u3002"),r()())}function $s(n,t){n&1&&(i(0,"li",39)(1,"span",41),a(2,"\u2026"),r()())}function Us(n,t){if(n&1){let e=D();i(0,"li",37)(1,"button",38),x("click",function(){S(e);let s=m().$implicit,c=m(2);return C(c.goTo(s))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);O("active",e===o.page()),l(2),v(e)}}function Gs(n,t){if(n&1&&u(0,$s,3,0,"li",39)(1,Us,3,3,"li",40),n&2){let e=t.$implicit;p(e===-1?0:1)}}function Hs(n,t){if(n&1){let e=D();i(0,"div",17)(1,"span",32),a(2),r(),i(3,"div",33)(4,"button",34),x("click",function(){S(e);let s=m();return C(s.prev())}),a(5,"\u2039"),r(),i(6,"span",35),a(7),r(),i(8,"button",34),x("click",function(){S(e);let s=m();return C(s.next())}),a(9,"\u203A"),r()(),i(10,"ul",36)(11,"li",37)(12,"button",38),x("click",function(){S(e);let s=m();return C(s.prev())}),a(13,"\u2039"),r()(),L(14,Gs,2,1,null,null,_e),i(16,"li",37)(17,"button",38),x("click",function(){S(e);let s=m();return C(s.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();l(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),l(2),O("disabled",e.page()===1),l(3),z("",e.page()," / ",e.totalPages()),l(),O("disabled",e.page()===e.totalPages()),l(3),O("disabled",e.page()===1),l(3),I(e.pageNumbers()),l(2),O("disabled",e.page()===e.totalPages())}}var ci=class n{service=g(st);PAGE_SIZE=20;page=M(1);refresh=M(0);result=Ae(Le($(()=>({page:this.page(),refresh:this.refresh()}))).pipe(ue(({page:t})=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedRequests=$(()=>this.result().items);totalCount=$(()=>this.result().totalCount);totalPages=$(()=>this.result().totalPages);pageNumbers=$(()=>Js(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}statusLabel=ui;statusClass=pi;delete(t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u51FA\u5DEE\u7533\u8ACB\u55CE\uFF1F")&&this.service.delete(t.id).subscribe(()=>this.refresh.update(e=>e+1))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-travel-request-list"]],decls:38,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#map-pin"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500"],[1,"text-muted","small"],[1,"text-right","fw-500"],[1,"text-muted","small","hidden","md:table-cell"],[1,"font-monospace","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u6AA2\u8996",1,"btn","btn-sm","btn-ghost-secondary","inline-flex","items-center",3,"routerLink"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["href","/assets/icons/sprite.svg#eye"],["colspan","8",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u51FA\u5DEE\u7533\u8ACB"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u7533\u8ACB "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u51FA\u5DEE\u5730\u9EDE"),r(),i(19,"th"),a(20,"\u958B\u59CB\u65E5\u671F"),r(),i(21,"th"),a(22,"\u7D50\u675F\u65E5\u671F"),r(),i(23,"th",14),a(24,"\u9810\u4F30\u8CBB\u7528"),r(),i(25,"th",15),a(26,"\u76EE\u7684"),r(),i(27,"th",16),a(28,"\u5C08\u6848"),r(),i(29,"th"),a(30,"\u72C0\u614B"),r(),i(31,"th",14),a(32,"\u64CD\u4F5C"),r()()(),i(33,"tbody"),L(34,Os,23,19,"tr",null,Ms,!1,qs,3,0,"tr"),r()()(),u(37,Hs,19,13,"div",17),r()()()),e&2&&(l(34),I(o.pagedRequests()),l(3),p(o.totalPages()>1?37:-1))},dependencies:[N,ge,Te],encapsulation:2})};function Js(n,t){if(t<=9)return Array.from({length:t},(s,c)=>c+1);let e=[],o=0;for(let s=1;s<=t;s++)(s===1||s===t||s>=n-2&&s<=n+2)&&(o&&s-o>1&&e.push(-1),e.push(s),o=s);return e}var zs=(n,t)=>t.id;function Ys(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",31),d(2,"use",32),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function Ws(n,t){n&1&&(i(0,"div",20),a(1,"\u8ACB\u586B\u5BEB\u51FA\u5DEE\u5730\u9EDE\u3002"),r())}function Ks(n,t){n&1&&(i(0,"div",20),a(1,"\u8ACB\u8F38\u5165\u9810\u4F30\u8CBB\u7528\u3002"),r())}function Zs(n,t){n&1&&(i(0,"div",20),a(1,"\u8ACB\u9078\u64C7\u51FA\u767C\u65E5\u671F\u3002"),r())}function Qs(n,t){n&1&&(i(0,"div",20),a(1,"\u8ACB\u9078\u64C7\u8FD4\u56DE\u65E5\u671F\u3002"),r())}function Xs(n,t){if(n&1&&(i(0,"option",26),a(1),r()),n&2){let e=t.$implicit;b("ngValue",e.id),l(),z("",e.code,"",e.departmentName?"\uFF08"+e.departmentName+"\uFF09":"")}}function e0(n,t){n&1&&(i(0,"div",20),a(1,"\u8ACB\u586B\u5BEB\u51FA\u5DEE\u76EE\u7684\u3002"),r())}function t0(n,t){if(n&1){let e=D();i(0,"button",36),a(1),r(),i(2,"button",37),x("click",function(){S(e);let s=m(2);return C(s.submitForApproval())}),a(3," \u9001\u51FA\u7533\u8ACB "),r()}if(n&2){let e=m(2);b("disabled",e.form.invalid),l(),E(" ",e.isEdit?"\u5132\u5B58":"\u5132\u5B58\u8349\u7A3F"," "),l(),b("disabled",e.form.invalid)}}function i0(n,t){if(n&1){let e=D();i(0,"button",37),x("click",function(){S(e);let s=m(2);return C(s.submitForApproval())}),a(1," \u4FEE\u6539\u4E26\u91CD\u9001 "),r()}if(n&2){let e=m(2);b("disabled",e.form.invalid)}}function n0(n,t){if(n&1&&(i(0,"button",34),a(1," \u66F4\u65B0 "),r()),n&2){let e=m(2);b("disabled",e.form.invalid)}}function r0(n,t){if(n&1&&(i(0,"div",29),u(1,t0,4,3)(2,i0,2,1,"button",33)(3,n0,2,1,"button",34),i(4,"a",35),a(5,"\u53D6\u6D88"),r()()),n&2){let e=m();l(),p(!e.isEdit||e.isDraft?1:e.isReturned?2:3)}}function a0(n,t){n&1&&(i(0,"div",30)(1,"a",35),a(2,"\u8FD4\u56DE\u5217\u8868"),r()())}var Ft=class n{fb=g(ee);service=g(st);projects$=g(qe);route=g(le);router=g(ve);cdr=g(We);isEdit=!1;requestId=0;isReadOnly=!1;isReturned=!1;isDraft=!0;approvalStatus="draft";errorMsg=M("");projects=[];statusLabel=ui;statusClass=pi;form=this.fb.group({destination:["",w.required],startDate:["",w.required],endDate:["",w.required],estimatedCost:[0,[w.required,w.min(0)]],purpose:["",w.required],projectId:[null]});loadingProjects=!0;ngOnInit(){this.projects$.getAll().subscribe({next:e=>{this.projects=e.filter(o=>o.status==="active"),this.loadingProjects=!1,this.cdr.markForCheck()},error:()=>{this.loadingProjects=!1,this.errorMsg.set("\u8F09\u5165\u5C08\u6848\u8CC7\u6599\u5931\u6557\u3002")}});let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.requestId=+t,this.service.getById(this.requestId).subscribe(e=>{e&&(this.approvalStatus=e.approvalStatus,this.isDraft=e.approvalStatus==="draft",this.isReturned=e.approvalStatus==="returned",this.isReadOnly=!["draft","pending","returned"].includes(e.approvalStatus),this.form.patchValue({destination:e.destination,startDate:e.startDate instanceof Date?e.startDate.toISOString().split("T")[0]:String(e.startDate),endDate:e.endDate instanceof Date?e.endDate.toISOString().split("T")[0]:String(e.endDate),estimatedCost:e.estimatedCost,purpose:e.purpose,projectId:e.projectId??null}),this.isReadOnly&&this.form.disable(),this.cdr.markForCheck())}))}save(){if(this.form.invalid||this.isReadOnly)return;let t=this._buildPayload(),e=this.isEdit?this.service.update(this.requestId,t):this.service.create(t);this.errorMsg.set(""),e.subscribe({next:o=>{this.isEdit||(this.requestId=o.id),this.router.navigate(["/admin/travel-requests"])},error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}submitForApproval(){if(this.form.invalid||this.isReadOnly)return;let t=this._buildPayload(),e=this.isEdit?this.service.update(this.requestId,t):this.service.create(t);this.errorMsg.set(""),e.subscribe({next:o=>{this.service.submit(o.id).subscribe({next:()=>this.router.navigate(["/admin/travel-requests"]),error:s=>{this.errorMsg.set(s.error?.message||"\u9001\u51FA\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})},error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}_buildPayload(){let t=this.form.value,e=this.projects.find(o=>o.id===t.projectId);return{destination:t.destination,startDate:new Date(t.startDate),endDate:new Date(t.endDate),estimatedCost:+t.estimatedCost,purpose:t.purpose,projectId:t.projectId??void 0,projectCode:e?.code}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-travel-request-form"]],decls:64,vars:11,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/travel-requests",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#map-pin"],[1,"card-body"],[1,"row","g-3","mb-4"],[1,"col-12","col-md-6"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","destination","placeholder","\u4F8B\u5982\uFF1A\u53F0\u5357\u3001\u53F0\u4E2D",1,"form-control"],[1,"text-danger","small","mt-1"],["type","number","formControlName","estimatedCost","min","0","placeholder","0",1,"form-control"],[1,"col-12","col-md-4"],["type","date","formControlName","startDate",1,"form-control"],["type","date","formControlName","endDate",1,"form-control"],["formControlName","projectId",1,"form-select"],[3,"ngValue"],[1,"mb-4"],["formControlName","purpose","rows","3","placeholder","\u8ACB\u586B\u5BEB\u51FA\u5DEE\u76EE\u7684...",1,"form-control"],[1,"mt-6","flex","gap-2"],[1,"mt-6"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"],["type","button",1,"btn","btn-primary",3,"disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/travel-requests",1,"btn","btn-outline-secondary"],["type","submit",1,"btn","btn-outline-secondary",3,"disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,Ys,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.save()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11),f(),i(13,"svg",12),d(14,"use",13),r(),a(15," \u51FA\u5DEE\u8CC7\u8A0A "),r(),y(),i(16,"div",14)(17,"div",15)(18,"div",16)(19,"label",17),a(20,"\u51FA\u5DEE\u5730\u9EDE "),i(21,"span",18),a(22,"*"),r()(),d(23,"input",19),u(24,Ws,2,0,"div",20),r(),i(25,"div",16)(26,"label",17),a(27,"\u9810\u4F30\u8CBB\u7528\uFF08\u5143\uFF09"),i(28,"span",18),a(29,"*"),r()(),d(30,"input",21),u(31,Ks,2,0,"div",20),r()(),i(32,"div",15)(33,"div",22)(34,"label",17),a(35,"\u51FA\u767C\u65E5\u671F "),i(36,"span",18),a(37,"*"),r()(),d(38,"input",23),u(39,Zs,2,0,"div",20),r(),i(40,"div",22)(41,"label",17),a(42,"\u8FD4\u56DE\u65E5\u671F "),i(43,"span",18),a(44,"*"),r()(),d(45,"input",24),u(46,Qs,2,0,"div",20),r(),i(47,"div",22)(48,"label",17),a(49,"\u95DC\u806F\u5C08\u6848\uFF08\u9078\u586B\uFF09"),r(),i(50,"select",25)(51,"option",26),a(52),r(),L(53,Xs,2,3,"option",26,zs),r()()(),i(55,"div",27)(56,"label",17),a(57,"\u51FA\u5DEE\u76EE\u7684 "),i(58,"span",18),a(59,"*"),r()(),d(60,"textarea",28),u(61,e0,2,0,"div",20),r()()(),u(62,r0,6,1,"div",29)(63,a0,3,0,"div",30),r()()()()),e&2){let s,c,F,P,B;l(6),v(o.isEdit?o.isReadOnly?"\u6AA2\u8996\u51FA\u5DEE\u7533\u8ACB":o.isReturned?"\u4FEE\u6539\u51FA\u5DEE\u7533\u8ACB\uFF08\u9000\u56DE\uFF09":o.isDraft?"\u7DE8\u8F2F\u51FA\u5DEE\u8349\u7A3F":"\u7DE8\u8F2F\u51FA\u5DEE\u7533\u8ACB":"\u65B0\u589E\u51FA\u5DEE\u7533\u8ACB"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(16),p((s=o.form.get("destination"))!=null&&s.invalid&&((s=o.form.get("destination"))!=null&&s.touched)?24:-1),l(7),p((c=o.form.get("estimatedCost"))!=null&&c.invalid&&((c=o.form.get("estimatedCost"))!=null&&c.touched)?31:-1),l(8),p((F=o.form.get("startDate"))!=null&&F.invalid&&((F=o.form.get("startDate"))!=null&&F.touched)?39:-1),l(7),p((P=o.form.get("endDate"))!=null&&P.invalid&&((P=o.form.get("endDate"))!=null&&P.touched)?46:-1),l(5),b("ngValue",null),l(),v(o.loadingProjects?"\u8F09\u5165\u4E2D\u2026":"\u2014 \u4E0D\u95DC\u806F\u5C08\u6848 \u2014"),l(),I(o.projects),l(8),p((B=o.form.get("purpose"))!=null&&B.invalid&&((B=o.form.get("purpose"))!=null&&B.touched)?61:-1),l(),p(o.isReadOnly?63:62)}},dependencies:[te,Z,De,ke,Y,be,we,W,K,xe,X,Q,N],encapsulation:2})};var vi={draft:"\u8349\u7A3F",pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},fi={draft:"bg-blue-subtle text-blue-emphasis",pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"};var Hn=n=>[n,"edit"],o0=(n,t)=>t.id;function l0(n,t){if(n&1){let e=D();i(0,"a",26),f(),i(1,"svg",7),d(2,"use",27),r()(),y(),i(3,"button",28),x("click",function(){S(e);let s=m().$implicit,c=m();return C(c.delete(s))}),f(),i(4,"svg",7),d(5,"use",29),r()()}if(n&2){let e=m().$implicit;b("routerLink",ae(1,Hn,e.id))}}function s0(n,t){if(n&1&&(i(0,"a",25),f(),i(1,"svg",7),d(2,"use",30),r()()),n&2){let e=m().$implicit;b("routerLink",ae(1,Hn,e.id))}}function m0(n,t){if(n&1&&(i(0,"tr")(1,"td",18),a(2),R(3,"date"),r(),i(4,"td",19),a(5),r(),i(6,"td",20),a(7),R(8,"number"),r(),i(9,"td",21),a(10),r(),i(11,"td")(12,"span"),a(13),r()(),i(14,"td",22),a(15),R(16,"date"),r(),i(17,"td",23)(18,"div",24),u(19,l0,6,3)(20,s0,3,3,"a",25),r()()()),n&2){let e=t.$implicit,o=m();l(2),v(q(3,9,e.overtimeDate,"yyyy-MM-dd")),l(3),v((e.projectCodes==null?null:e.projectCodes.join(", "))||"\u2014"),l(2),E("",q(8,12,e.estimatedHours,"1.1-1")," h"),l(3),v(e.reason),l(2),re("badge "+o.statusClass[e.approvalStatus]),l(),v(o.statusLabel[e.approvalStatus]),l(2),v(q(16,15,e.createdAt,"yyyy-MM-dd HH:mm")),l(4),p(e.approvalStatus==="pending"||e.approvalStatus==="returned"?19:20)}}function d0(n,t){n&1&&(i(0,"tr")(1,"td",31),a(2,"\u5C1A\u7121\u52A0\u73ED\u7533\u8ACB\u3002"),r()())}function u0(n,t){n&1&&(i(0,"li",39)(1,"span",41),a(2,"\u2026"),r()())}function p0(n,t){if(n&1){let e=D();i(0,"li",37)(1,"button",38),x("click",function(){S(e);let s=m().$implicit,c=m(2);return C(c.goTo(s))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);O("active",e===o.page()),l(2),v(e)}}function c0(n,t){if(n&1&&u(0,u0,3,0,"li",39)(1,p0,3,3,"li",40),n&2){let e=t.$implicit;p(e===-1?0:1)}}function v0(n,t){if(n&1){let e=D();i(0,"div",17)(1,"span",32),a(2),r(),i(3,"div",33)(4,"button",34),x("click",function(){S(e);let s=m();return C(s.prev())}),a(5,"\u2039"),r(),i(6,"span",35),a(7),r(),i(8,"button",34),x("click",function(){S(e);let s=m();return C(s.next())}),a(9,"\u203A"),r()(),i(10,"ul",36)(11,"li",37)(12,"button",38),x("click",function(){S(e);let s=m();return C(s.prev())}),a(13,"\u2039"),r()(),L(14,c0,2,1,null,null,_e),i(16,"li",37)(17,"button",38),x("click",function(){S(e);let s=m();return C(s.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();l(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),l(2),O("disabled",e.page()===1),l(3),z("",e.page()," / ",e.totalPages()),l(),O("disabled",e.page()===e.totalPages()),l(3),O("disabled",e.page()===1),l(3),I(e.pageNumbers()),l(2),O("disabled",e.page()===e.totalPages())}}var _i=class n{service=g(Vt);PAGE_SIZE=20;page=M(1);refresh=M(0);result=Ae(Le($(()=>({page:this.page(),refresh:this.refresh()}))).pipe(ue(({page:t})=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedRequests=$(()=>this.result().items);totalCount=$(()=>this.result().totalCount);totalPages=$(()=>this.result().totalPages);pageNumbers=$(()=>f0(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}statusLabel=vi;statusClass=fi;delete(t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u52A0\u73ED\u7533\u8ACB\u55CE\uFF1F")&&this.service.delete(t.id).subscribe(()=>this.refresh.update(e=>e+1))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-overtime-request-list"]],decls:36,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#zap"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500"],[1,"font-monospace","small"],[1,"text-right","fw-500"],[1,"text-muted","small","hidden","md:table-cell"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u6AA2\u8996",1,"btn","btn-sm","btn-ghost-secondary","inline-flex","items-center",3,"routerLink"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["href","/assets/icons/sprite.svg#eye"],["colspan","7",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),f(),i(3,"svg",3),d(4,"use",4),r(),y(),i(5,"h4",5),a(6,"\u52A0\u73ED\u7533\u8ACB"),r()(),i(7,"a",6),f(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u7533\u8ACB "),r()(),y(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u52A0\u73ED\u65E5\u671F"),r(),i(19,"th"),a(20,"\u5C08\u6848"),r(),i(21,"th",14),a(22,"\u9810\u4F30\u6642\u6578"),r(),i(23,"th",15),a(24,"\u539F\u56E0"),r(),i(25,"th"),a(26,"\u72C0\u614B"),r(),i(27,"th",16),a(28,"\u7533\u8ACB\u6642\u9593"),r(),i(29,"th",14),a(30,"\u64CD\u4F5C"),r()()(),i(31,"tbody"),L(32,m0,21,18,"tr",null,o0,!1,d0,3,0,"tr"),r()()(),u(35,v0,19,13,"div",17),r()()()),e&2&&(l(32),I(o.pagedRequests()),l(3),p(o.totalPages()>1?35:-1))},dependencies:[N,ge,Te],encapsulation:2})};function f0(n,t){if(t<=9)return Array.from({length:t},(s,c)=>c+1);let e=[],o=0;for(let s=1;s<=t;s++)(s===1||s===t||s>=n-2&&s<=n+2)&&(o&&s-o>1&&e.push(-1),e.push(s),o=s);return e}var _0=(n,t)=>t.id;function g0(n,t){if(n&1&&(i(0,"div",6),f(),i(1,"svg",29),d(2,"use",30),r(),a(3),r()),n&2){let e=m();l(3),E(" ",e.errorMsg()," ")}}function b0(n,t){n&1&&(i(0,"div",20),a(1,"\u8ACB\u9078\u64C7\u52A0\u73ED\u65E5\u671F\u3002"),r())}function x0(n,t){n&1&&(i(0,"div",20),a(1,"\u8ACB\u8F38\u5165\u9810\u4F30\u6642\u6578\uFF08\u81F3\u5C11 0.5\uFF09\u3002"),r())}function h0(n,t){if(n&1&&(i(0,"p",23),a(1),r()),n&2){let e=m();l(),v(e.displayProjectCodes.join(", ")||"\u2014")}}function S0(n,t){n&1&&(i(0,"p",24),a(1,"\u8F09\u5165\u4E2D\u2026"),r())}function C0(n,t){if(n&1){let e=D();i(0,"label",32)(1,"input",33),x("change",function(){let s=S(e).$implicit,c=m(2);return C(c.toggleProject(s.id))}),r(),i(2,"span",34),a(3),r()()}if(n&2){let e=t.$implicit,o=m(2);O("border-primary",o.selectedProjectIds.has(e.id))("bg-primary-subtle",o.selectedProjectIds.has(e.id)),l(),b("checked",o.selectedProjectIds.has(e.id)),l(2),z("",e.code,"",e.departmentName?"\uFF08"+e.departmentName+"\uFF09":"")}}function E0(n,t){if(n&1&&(i(0,"div",25),L(1,C0,4,7,"label",31,_0),r()),n&2){let e=m();l(),I(e.projects)}}function y0(n,t){n&1&&(i(0,"div",20),a(1,"\u8ACB\u586B\u5BEB\u52A0\u73ED\u539F\u56E0\u3002"),r())}function A0(n,t){if(n&1){let e=D();i(0,"button",38),a(1),r(),i(2,"button",39),x("click",function(){S(e);let s=m(2);return C(s.submitForApproval())}),a(3," \u9001\u51FA\u7533\u8ACB "),r()}if(n&2){let e=m(2);b("disabled",e.form.invalid),l(),E(" ",e.isEdit?"\u5132\u5B58":"\u5132\u5B58\u8349\u7A3F"," "),l(),b("disabled",e.form.invalid)}}function F0(n,t){if(n&1){let e=D();i(0,"button",39),x("click",function(){S(e);let s=m(2);return C(s.submitForApproval())}),a(1," \u4FEE\u6539\u4E26\u91CD\u9001 "),r()}if(n&2){let e=m(2);b("disabled",e.form.invalid)}}function T0(n,t){if(n&1&&(i(0,"button",36),a(1," \u66F4\u65B0 "),r()),n&2){let e=m(2);b("disabled",e.form.invalid)}}function w0(n,t){if(n&1&&(i(0,"div",27),u(1,A0,4,3)(2,F0,2,1,"button",35)(3,T0,2,1,"button",36),i(4,"a",37),a(5,"\u53D6\u6D88"),r()()),n&2){let e=m();l(),p(!e.isEdit||e.isDraft?1:e.isReturned?2:3)}}function D0(n,t){n&1&&(i(0,"div",28)(1,"a",37),a(2,"\u8FD4\u56DE\u5217\u8868"),r()())}var Tt=class n{fb=g(ee);service=g(Vt);projects$=g(qe);route=g(le);router=g(ve);cdr=g(We);isEdit=!1;requestId=0;isReadOnly=!1;isReturned=!1;isDraft=!0;approvalStatus="draft";errorMsg=M("");projects=[];selectedProjectIds=new Set;displayProjectCodes=[];statusLabel=vi;statusClass=fi;form=this.fb.group({overtimeDate:["",w.required],estimatedHours:[1,[w.required,w.min(.5)]],reason:["",w.required]});loadingProjects=!0;ngOnInit(){this.projects$.getAll().subscribe({next:e=>{this.projects=e.filter(o=>o.status==="active"),this.loadingProjects=!1,this.cdr.markForCheck()},error:()=>{this.loadingProjects=!1,this.errorMsg.set("\u8F09\u5165\u5C08\u6848\u8CC7\u6599\u5931\u6557\u3002")}});let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.requestId=+t,this.service.getById(this.requestId).subscribe(e=>{e&&(this.approvalStatus=e.approvalStatus,this.isDraft=e.approvalStatus==="draft",this.isReturned=e.approvalStatus==="returned",this.isReadOnly=!["draft","pending","returned"].includes(e.approvalStatus),this.form.patchValue({overtimeDate:e.overtimeDate instanceof Date?e.overtimeDate.toISOString().split("T")[0]:String(e.overtimeDate),estimatedHours:e.estimatedHours,reason:e.reason}),e.projectIds&&e.projectIds.forEach(o=>this.selectedProjectIds.add(o)),e.projectCodes&&(this.displayProjectCodes=e.projectCodes),this.isReadOnly&&this.form.disable(),this.cdr.markForCheck())}))}toggleProject(t){this.isReadOnly||(this.selectedProjectIds.has(t)?this.selectedProjectIds.delete(t):this.selectedProjectIds.add(t))}save(){if(this.form.invalid||this.isReadOnly)return;let t=this._buildPayload(),e=this.isEdit?this.service.update(this.requestId,t):this.service.create(t);this.errorMsg.set(""),e.subscribe({next:o=>{this.isEdit||(this.requestId=o.id),this.router.navigate(["/admin/overtime-requests"])},error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}submitForApproval(){if(this.form.invalid||this.isReadOnly)return;let t=this._buildPayload(),e=this.isEdit?this.service.update(this.requestId,t):this.service.create(t);this.errorMsg.set(""),e.subscribe({next:o=>{this.service.submit(o.id).subscribe({next:()=>this.router.navigate(["/admin/overtime-requests"]),error:s=>{this.errorMsg.set(s.error?.message||"\u9001\u51FA\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})},error:o=>{this.errorMsg.set(o.error?.message||"\u5132\u5B58\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002")}})}_buildPayload(){let t=this.form.value,e=Array.from(this.selectedProjectIds),o=e.map(s=>this.projects.find(c=>c.id===s)?.code).filter(Boolean);return{overtimeDate:new Date(t.overtimeDate),projectIds:e.length>0?e:void 0,projectCodes:o.length>0?o:void 0,estimatedHours:+t.estimatedHours,reason:t.reason}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=V({type:n,selectors:[["app-overtime-request-form"]],decls:47,vars:8,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/overtime-requests",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],["role","alert",1,"alert","alert-danger","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#zap"],[1,"card-body"],[1,"row","g-3","mb-4"],[1,"col-12","col-md-6"],[1,"form-label","fw-500"],[1,"text-danger"],["type","date","formControlName","overtimeDate",1,"form-control"],[1,"text-danger","small","mt-1"],["type","number","formControlName","estimatedHours","min","0.5","step","0.5","placeholder","1",1,"form-control"],[1,"mb-4"],[1,"form-control-plaintext","fw-500","font-monospace","mb-0"],[1,"text-muted","small","mb-0"],[1,"flex","flex-wrap","gap-2"],["formControlName","reason","rows","3","placeholder","\u8ACB\u586B\u5BEB\u52A0\u73ED\u539F\u56E0...",1,"form-control"],[1,"mt-6","flex","gap-2"],[1,"mt-6"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#alert-triangle"],[1,"inline-flex","items-center","gap-2","px-3","py-2","rounded-lg","border","cursor-pointer",3,"border-primary","bg-primary-subtle"],[1,"inline-flex","items-center","gap-2","px-3","py-2","rounded-lg","border","cursor-pointer"],["type","checkbox",1,"form-check-input","m-0",3,"change","checked"],[1,"small","fw-500"],["type","button",1,"btn","btn-primary",3,"disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/overtime-requests",1,"btn","btn-outline-secondary"],["type","submit",1,"btn","btn-outline-secondary",3,"disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),f(),i(3,"svg",3),d(4,"use",4),r()(),y(),i(5,"h4",5),a(6),r()(),u(7,g0,4,1,"div",6),i(8,"form",7),x("ngSubmit",function(){return o.save()}),i(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11),f(),i(13,"svg",12),d(14,"use",13),r(),a(15," \u52A0\u73ED\u8CC7\u8A0A "),r(),y(),i(16,"div",14)(17,"div",15)(18,"div",16)(19,"label",17),a(20,"\u52A0\u73ED\u65E5\u671F "),i(21,"span",18),a(22,"*"),r()(),d(23,"input",19),u(24,b0,2,0,"div",20),r(),i(25,"div",16)(26,"label",17),a(27,"\u9810\u4F30\u6642\u6578\uFF08\u5C0F\u6642\uFF09"),i(28,"span",18),a(29,"*"),r()(),d(30,"input",21),u(31,x0,2,0,"div",20),r()(),i(32,"div",22)(33,"label",17),a(34,"\u95DC\u806F\u5C08\u6848\uFF08\u53EF\u591A\u9078\uFF09"),r(),u(35,h0,2,1,"p",23)(36,S0,2,0,"p",24)(37,E0,3,0,"div",25),r(),i(38,"div",22)(39,"label",17),a(40,"\u52A0\u73ED\u539F\u56E0 "),i(41,"span",18),a(42,"*"),r()(),d(43,"textarea",26),u(44,y0,2,0,"div",20),r()()(),u(45,w0,6,1,"div",27)(46,D0,3,0,"div",28),r()()()()),e&2){let s,c,F;l(6),v(o.isEdit?o.isReadOnly?"\u6AA2\u8996\u52A0\u73ED\u7533\u8ACB":o.isReturned?"\u4FEE\u6539\u52A0\u73ED\u7533\u8ACB\uFF08\u9000\u56DE\uFF09":o.isDraft?"\u7DE8\u8F2F\u52A0\u73ED\u8349\u7A3F":"\u7DE8\u8F2F\u52A0\u73ED\u7533\u8ACB":"\u65B0\u589E\u52A0\u73ED\u7533\u8ACB"),l(),p(o.errorMsg()?7:-1),l(),b("formGroup",o.form),l(16),p((s=o.form.get("overtimeDate"))!=null&&s.invalid&&((s=o.form.get("overtimeDate"))!=null&&s.touched)?24:-1),l(7),p((c=o.form.get("estimatedHours"))!=null&&c.invalid&&((c=o.form.get("estimatedHours"))!=null&&c.touched)?31:-1),l(4),p(o.isReadOnly?35:o.loadingProjects?36:37),l(9),p((F=o.form.get("reason"))!=null&&F.invalid&&((F=o.form.get("reason"))!=null&&F.touched)?44:-1),l(),p(o.isReadOnly?46:45)}},dependencies:[te,Z,Y,be,W,K,xe,X,Q,N],encapsulation:2})};var bv=[{path:"",redirectTo:"users",pathMatch:"full"},{path:"users",component:Nt,canActivate:[G],data:{title:"\u54E1\u5DE5\u7BA1\u7406",permission:"users:read"}},{path:"users/new",component:_t,canActivate:[G],data:{title:"\u65B0\u589E\u54E1\u5DE5",permission:"users:write"}},{path:"users/:id/edit",component:_t,canActivate:[G],data:{title:"\u7DE8\u8F2F\u54E1\u5DE5",permission:"users:write"}},{path:"departments",component:Ht,canActivate:[G],data:{title:"\u90E8\u9580\u7BA1\u7406",permission:"departments:read"}},{path:"departments/new",component:xt,canActivate:[G],data:{title:"\u65B0\u589E\u90E8\u9580",permission:"departments:write"}},{path:"departments/:id/edit",component:xt,canActivate:[G],data:{title:"\u7DE8\u8F2F\u90E8\u9580",permission:"departments:write"}},{path:"job-titles",component:Jt,canActivate:[G],data:{title:"\u8077\u7A31\u7BA1\u7406",permission:"job-titles:read"}},{path:"job-titles/new",component:ht,canActivate:[G],data:{title:"\u65B0\u589E\u8077\u7A31",permission:"job-titles:write"}},{path:"job-titles/:id/edit",component:ht,canActivate:[G],data:{title:"\u7DE8\u8F2F\u8077\u7A31",permission:"job-titles:write"}},{path:"approvals",component:zt,canActivate:[G],data:{title:"\u7C3D\u6838\u7BA1\u7406",permission:"approvals:read"}},{path:"approvals/:id/flow",component:Yt,canActivate:[G],data:{title:"\u7C3D\u6838\u6D41\u7A0B",permission:"approvals:read"}},{path:"roles",component:qt,canActivate:[G],data:{title:"\u89D2\u8272\u7BA1\u7406",permission:"superadmin"}},{path:"roles/new",component:gt,canActivate:[G],data:{title:"\u65B0\u589E\u89D2\u8272",permission:"superadmin"}},{path:"roles/:id/edit",component:gt,canActivate:[G],data:{title:"\u7DE8\u8F2F\u89D2\u8272",permission:"superadmin"}},{path:"permissions",component:$t,canActivate:[G],data:{title:"\u6B0A\u9650\u7BA1\u7406",permission:"superadmin"}},{path:"permissions/new",component:bt,canActivate:[G],data:{title:"\u65B0\u589E\u6B0A\u9650",permission:"superadmin"}},{path:"permissions/:id/edit",component:bt,canActivate:[G],data:{title:"\u7DE8\u8F2F\u6B0A\u9650",permission:"superadmin"}},{path:"projects",component:Wt,canActivate:[G],data:{title:"\u5C08\u6848\u7BA1\u7406",permission:"projects:read"}},{path:"projects/new",component:St,canActivate:[G],data:{title:"\u65B0\u589E\u5C08\u6848",permission:"projects:write"}},{path:"projects/:id/edit",component:St,canActivate:[G],data:{title:"\u7DE8\u8F2F\u5C08\u6848",permission:"projects:write"}},{path:"payment-requests",component:Qt,canActivate:[G],data:{title:"\u8ACB\u6B3E\u7533\u8ACB",permission:"payment-requests:read"}},{path:"payment-requests/new",component:yt,canActivate:[G],data:{title:"\u65B0\u589E\u8ACB\u6B3E\u7533\u8ACB",permission:"payment-requests:write"}},{path:"payment-requests/:id/edit",component:yt,canActivate:[G],data:{title:"\u7DE8\u8F2F\u8ACB\u6B3E\u7533\u8ACB",permission:"payment-requests:read"}},{path:"leave-requests",component:di,canActivate:[G],data:{title:"\u8ACB\u5047\u7533\u8ACB",permission:"leave-requests:read"}},{path:"leave-requests/new",component:At,canActivate:[G],data:{title:"\u65B0\u589E\u8ACB\u5047\u7533\u8ACB",permission:"leave-requests:write"}},{path:"leave-requests/:id/edit",component:At,canActivate:[G],data:{title:"\u7DE8\u8F2F\u8ACB\u5047\u7533\u8ACB",permission:"leave-requests:read"}},{path:"travel-requests",component:ci,canActivate:[G],data:{title:"\u51FA\u5DEE\u7533\u8ACB",permission:"travel-requests:read"}},{path:"travel-requests/new",component:Ft,canActivate:[G],data:{title:"\u65B0\u589E\u51FA\u5DEE\u7533\u8ACB",permission:"travel-requests:write"}},{path:"travel-requests/:id/edit",component:Ft,canActivate:[G],data:{title:"\u7DE8\u8F2F\u51FA\u5DEE\u7533\u8ACB",permission:"travel-requests:read"}},{path:"overtime-requests",component:_i,canActivate:[G],data:{title:"\u52A0\u73ED\u7533\u8ACB",permission:"overtime-requests:read"}},{path:"overtime-requests/new",component:Tt,canActivate:[G],data:{title:"\u65B0\u589E\u52A0\u73ED\u7533\u8ACB",permission:"overtime-requests:write"}},{path:"overtime-requests/:id/edit",component:Tt,canActivate:[G],data:{title:"\u7DE8\u8F2F\u52A0\u73ED\u7533\u8ACB",permission:"overtime-requests:read"}},{path:"approval-tasks",component:oi,canActivate:[G],data:{title:"\u7C3D\u6838\u4F5C\u696D",permission:"approval-tasks:read"}},{path:"approval-tasks/:applicationType/:id/review",component:li,canActivate:[G],data:{title:"\u5BE9\u6838",permission:"approval-tasks:write"}},{path:"settings",component:Gt,canActivate:[G],data:{title:"\u7CFB\u7D71\u8A2D\u5B9A",permission:"admin:access"}}];export{bv as ADMIN_ROUTES};
