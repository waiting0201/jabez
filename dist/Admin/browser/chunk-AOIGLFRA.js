import{a as J}from"./chunk-MKP3GHMR.js";import{$b as P,Ab as t,Bb as n,Cb as s,Ib as $,Jb as f,Kc as j,Lb as p,Lc as U,Mb as v,Q as b,Sa as d,Tc as z,V as N,Wb as q,Wc as _,Xb as a,Xc as Y,Yb as S,Zb as w,_ as h,_b as G,da as T,ea as k,eb as H,fa as l,ga as c,l as L,mc as A,oc as O,pb as y,qa as u,rb as x,tc as E,ub as V,vb as B}from"./chunk-PPKC6JMY.js";var I=class r{http=h(z);today$=new L(null);getToday(){return this.http.get(`${_.apiUrl}/attendances/today`).pipe(b(e=>this.today$.next(e)))}clockIn(e){return this.http.post(`${_.apiUrl}/attendances/clock-in`,e).pipe(b(i=>this.today$.next(i)))}clockOut(e){return this.http.post(`${_.apiUrl}/attendances/clock-out`,e).pipe(b(i=>this.today$.next(i)))}overtimeStart(e){return this.http.post(`${_.apiUrl}/attendances/overtime-start`,e).pipe(b(i=>this.today$.next(i)))}overtimeEnd(e){return this.http.post(`${_.apiUrl}/attendances/overtime-end`,e).pipe(b(i=>this.today$.next(i)))}static \u0275fac=function(i){return new(i||r)};static \u0275prov=N({token:r,factory:r.\u0275fac,providedIn:"root"})};var Q=(r,e)=>e.id;function W(r,e){if(r&1&&(t(0,"option",47),a(1),A(2,"date"),n()),r&2){let i=e.$implicit,o=v(2);f("value",i.id)("selected",i.id===o.selectedOvertimeId()),d(),P(" ",O(2,5,i.overtimeDate,"MM/dd")," \u2014 ",(i.projectCodes==null?null:i.projectCodes.join(", "))||"\u7121\u5C08\u6848"," (",i.estimatedHours,"h) ")}}function X(r,e){if(r&1){let i=$();t(0,"div",38)(1,"label",45),a(2,"\u9078\u64C7\u52A0\u73ED\u7533\u8ACB\u55AE"),n(),t(3,"select",46),p("change",function(m){T(i);let g=v();return k(g.onOvertimeSelect(m))}),V(4,W,3,8,"option",47,Q),n(),t(6,"div",48)(7,"button",49),p("click",function(){T(i);let m=v();return k(m.confirmOvertimeStart())}),a(8,"\u78BA\u8A8D\u6253\u5361"),n(),t(9,"button",50),p("click",function(){T(i);let m=v();return k(m.cancelOvertimeSelector())}),a(10,"\u53D6\u6D88"),n()()()}if(r&2){let i=v();d(4),B(i.approvedRequests())}}function Z(r,e){r&1&&(t(0,"p",41),a(1,"\u6253\u5361\u6642\u81EA\u52D5\u53D6\u5F97 GPS \u5EA7\u6A19\u3002"),n())}function ee(r,e){r&1&&(t(0,"div",42),s(1,"div",51),t(2,"span",52),a(3,"\u5B9A\u4F4D\u4E2D\u2026"),n()())}function te(r,e){if(r&1&&(t(0,"p",56),a(1),A(2,"number"),A(3,"number"),n()),r&2){let i=v(2);d(),G(" ",O(2,2,i.gpsCoords().lat,"1.6-6"),", ",O(3,5,i.gpsCoords().lng,"1.6-6")," ")}}function ie(r,e){if(r&1&&(t(0,"div",53),l(),t(1,"svg",54),s(2,"use",30),n(),c(),t(3,"span",55),a(4,"\u5B9A\u4F4D\u6210\u529F"),n()(),y(5,te,4,8,"p",56)),r&2){let i=v();d(5),x(i.gpsCoords()?5:-1)}}function ne(r,e){r&1&&(t(0,"div",43),l(),t(1,"svg",54),s(2,"use",57),n(),c(),t(3,"span",55),a(4,"\u7121\u6CD5\u53D6\u5F97\u5B9A\u4F4D\uFF08\u6253\u5361\u4ECD\u6709\u6548\uFF09"),n()())}function oe(r,e){if(r&1&&(t(0,"div",44)(1,"div",58),a(2),n()()),r&2){let i=e;d(),q(i.type==="success"?"bg-success text-white":i.type==="warning"?"bg-warning text-dark":"bg-danger text-white"),d(),w(" ",i.message," ")}}var ae=["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"],M=class r{auth=h(Y);attendanceService=h(I);overtimeService=h(J);timerId=null;now=u(new Date);todayRecord=u(null);approvedRequests=u([]);selectedOvertimeId=u(null);showOvertimeSelector=u(!1);gpsStatus=u("idle");gpsCoords=u(null);loading=u(!1);toast=u(null);userName=E(()=>this.auth.currentUser()?.name??"\u4F7F\u7528\u8005");dateDisplay=E(()=>{let e=this.now(),i=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0");return`${i}/${o}/${m} \u661F\u671F${ae[e.getDay()]}`});timeDisplay=E(()=>{let e=this.now();return[e.getHours(),e.getMinutes(),e.getSeconds()].map(i=>String(i).padStart(2,"0")).join(":")});canClockIn=E(()=>!this.todayRecord()?.clockInTime&&!this.loading());canClockOut=E(()=>{let e=this.todayRecord();return!!e?.clockInTime&&!e?.clockOutTime&&!this.loading()});canOvertimeStart=E(()=>{let e=this.todayRecord();return!!e?.clockOutTime&&!e?.overtimeStartTime&&this.approvedRequests().length>0&&!this.loading()});canOvertimeEnd=E(()=>{let e=this.todayRecord();return!!e?.overtimeStartTime&&!e?.overtimeEndTime&&!this.loading()});ngOnInit(){this.timerId=setInterval(()=>this.now.set(new Date),1e3),this.attendanceService.getToday().subscribe(e=>{e&&this.todayRecord.set(e)}),this.overtimeService.getApprovedForToday().subscribe(e=>{this.approvedRequests.set(e),e.length>0&&this.selectedOvertimeId.set(e[0].id)})}ngOnDestroy(){this.timerId&&clearInterval(this.timerId)}onOvertimeSelect(e){let i=e.target.value;this.selectedOvertimeId.set(i?+i:null)}formatTime(e){if(!e)return"--:--";let i=new Date(e);return[i.getHours(),i.getMinutes()].map(o=>String(o).padStart(2,"0")).join(":")}onOvertimeStartClick(){this.approvedRequests().length!==0&&(this.selectedOvertimeId()||this.selectedOvertimeId.set(this.approvedRequests()[0].id),this.showOvertimeSelector.set(!0))}confirmOvertimeStart(){this.showOvertimeSelector.set(!1),this.performAction("overtime-start")}cancelOvertimeSelector(){this.showOvertimeSelector.set(!1)}performAction(e){this.loading()||(this.loading.set(!0),this.gpsStatus.set("locating"),this._getGps().then(i=>{this.gpsCoords.set(i),this.gpsStatus.set(i?"success":"failed");let o={latitude:i?.lat,longitude:i?.lng,overtimeRequestId:e==="overtime-start"?this.selectedOvertimeId()??void 0:void 0},m;switch(e){case"clock-in":m=this.attendanceService.clockIn(o);break;case"clock-out":m=this.attendanceService.clockOut(o);break;case"overtime-start":m=this.attendanceService.overtimeStart(o);break;case"overtime-end":m=this.attendanceService.overtimeEnd(o);break}m.subscribe({next:g=>{this.todayRecord.set(g),this.loading.set(!1);let D={"clock-in":"\u4E0A\u73ED\u6253\u5361","clock-out":"\u4E0B\u73ED\u6253\u5361","overtime-start":"\u52A0\u73ED\u958B\u59CB","overtime-end":"\u52A0\u73ED\u7D50\u675F"};this.showToast(`${D[e]}\u6210\u529F\uFF01`,i?"success":"warning")},error:()=>{this.loading.set(!1),this.showToast("\u6253\u5361\u5931\u6557\uFF0C\u8ACB\u7A0D\u5F8C\u91CD\u8A66","error")}})}))}showToast(e,i){this.toast.set({message:e,type:i}),setTimeout(()=>this.toast.set(null),3e3)}_getGps(){return new Promise(e=>{if(!navigator.geolocation){e(null);return}navigator.geolocation.getCurrentPosition(i=>e({lat:i.coords.latitude,lng:i.coords.longitude}),()=>e(null),{enableHighAccuracy:!0,timeout:8e3,maximumAge:0})})}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=H({type:r,selectors:[["app-dashboard"]],decls:100,vars:14,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-3","mb-6"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#clock"],[1,"mb-0"],[1,"text-muted","mb-0","small"],[1,"row","g-4"],[1,"col-12","col-lg-8"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-body","text-center","py-5"],[1,"text-muted","mb-2","fw-500"],[1,"mb-0","font-monospace",2,"font-size","3.5rem","font-weight","700","letter-spacing","0.05em","color","var(--text-primary)"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#activity"],[1,"card-body"],[1,"row","g-3","text-center"],[1,"col-6","col-md-3"],[1,"rounded-lg","py-3",2,"background","var(--accent-dim)"],[1,"sa-icon","mb-1",2,"stroke","var(--green)"],["href","/assets/icons/sprite.svg#log-in"],[1,"text-muted","small","mb-1"],[1,"fw-600","font-monospace","mb-0"],[1,"sa-icon","mb-1",2,"stroke","var(--yellow)"],["href","/assets/icons/sprite.svg#log-out"],[1,"sa-icon","mb-1",2,"stroke","var(--purple)"],["href","/assets/icons/sprite.svg#zap"],[1,"sa-icon","mb-1",2,"stroke","var(--red)"],["href","/assets/icons/sprite.svg#zap-off"],[1,"card","border-0","shadow-sm"],["href","/assets/icons/sprite.svg#check-circle"],[1,"row","g-3"],[1,"btn","btn-primary","w-100","py-3","flex","flex-col","items-center","gap-2",3,"click","disabled"],[1,"sa-icon","sa-icon-2x",2,"stroke","currentColor"],[1,"fw-600"],[1,"btn","btn-warning","w-100","py-3","flex","flex-col","items-center","gap-2",3,"click","disabled"],[1,"btn","btn-outline-primary","w-100","py-3","flex","flex-col","items-center","gap-2",3,"click","disabled"],[1,"btn","btn-outline-secondary","w-100","py-3","flex","flex-col","items-center","gap-2",3,"click","disabled"],[1,"mt-4","pt-3","border-t"],[1,"col-12","col-lg-4"],["href","/assets/icons/sprite.svg#map-pin"],[1,"text-muted","small","mb-0"],[1,"flex","items-center","gap-2","text-muted"],[1,"flex","items-center","gap-2",2,"color","var(--yellow)"],[1,"position-fixed","bottom-0","end-0","p-4",2,"z-index","1080"],[1,"form-label","fw-600"],[1,"form-select","mb-3",3,"change"],[3,"value","selected"],[1,"flex","gap-2"],[1,"btn","btn-primary","btn-sm",3,"click"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"spinner-border","spinner-border-sm"],[1,"small"],[1,"flex","items-center","gap-2","mb-2",2,"color","var(--green)"],[1,"sa-icon",2,"stroke","currentColor"],[1,"small","fw-500"],[1,"font-monospace","small","text-muted","mb-0"],["href","/assets/icons/sprite.svg#alert-triangle"],[1,"px-4","py-3","rounded-lg","shadow-lg","fw-500"]],template:function(i,o){if(i&1&&(t(0,"div",0)(1,"div",1),l(),t(2,"svg",2),s(3,"use",3),n(),c(),t(4,"div")(5,"h4",4),a(6,"\u6253\u5361\u7CFB\u7D71"),n(),t(7,"p",5),a(8),n()()(),t(9,"div",6)(10,"div",7)(11,"div",8)(12,"div",9)(13,"p",10),a(14),n(),t(15,"p",11),a(16),n()()(),t(17,"div",8)(18,"div",12),l(),t(19,"svg",13),s(20,"use",14),n(),a(21," \u4ECA\u65E5\u6253\u5361\u7D00\u9304 "),n(),c(),t(22,"div",15)(23,"div",16)(24,"div",17)(25,"div",18),l(),t(26,"svg",19),s(27,"use",20),n(),c(),t(28,"p",21),a(29,"\u4E0A\u73ED"),n(),t(30,"p",22),a(31),n()()(),t(32,"div",17)(33,"div",18),l(),t(34,"svg",23),s(35,"use",24),n(),c(),t(36,"p",21),a(37,"\u4E0B\u73ED"),n(),t(38,"p",22),a(39),n()()(),t(40,"div",17)(41,"div",18),l(),t(42,"svg",25),s(43,"use",26),n(),c(),t(44,"p",21),a(45,"\u52A0\u73ED\u958B\u59CB"),n(),t(46,"p",22),a(47),n()()(),t(48,"div",17)(49,"div",18),l(),t(50,"svg",27),s(51,"use",28),n(),c(),t(52,"p",21),a(53,"\u52A0\u73ED\u7D50\u675F"),n(),t(54,"p",22),a(55),n()()()()()(),t(56,"div",29)(57,"div",12),l(),t(58,"svg",13),s(59,"use",30),n(),a(60," \u6253\u5361\u64CD\u4F5C "),n(),c(),t(61,"div",15)(62,"div",31)(63,"div",17)(64,"button",32),p("click",function(){return o.performAction("clock-in")}),l(),t(65,"svg",33),s(66,"use",20),n(),c(),t(67,"span",34),a(68,"\u4E0A\u73ED\u6253\u5361"),n()()(),t(69,"div",17)(70,"button",35),p("click",function(){return o.performAction("clock-out")}),l(),t(71,"svg",33),s(72,"use",24),n(),c(),t(73,"span",34),a(74,"\u4E0B\u73ED\u6253\u5361"),n()()(),t(75,"div",17)(76,"button",36),p("click",function(){return o.onOvertimeStartClick()}),l(),t(77,"svg",33),s(78,"use",26),n(),c(),t(79,"span",34),a(80,"\u52A0\u73ED\u958B\u59CB"),n()()(),t(81,"div",17)(82,"button",37),p("click",function(){return o.performAction("overtime-end")}),l(),t(83,"svg",33),s(84,"use",28),n(),c(),t(85,"span",34),a(86,"\u52A0\u73ED\u7D50\u675F"),n()()()(),y(87,X,11,0,"div",38),n()()(),t(88,"div",39)(89,"div",29)(90,"div",12),l(),t(91,"svg",13),s(92,"use",40),n(),a(93," \u5B9A\u4F4D\u8CC7\u8A0A "),n(),c(),t(94,"div",15),y(95,Z,2,0,"p",41)(96,ee,4,0,"div",42)(97,ie,6,1)(98,ne,5,0,"div",43),n()()()(),y(99,oe,3,3,"div",44),n()),i&2){let m,g,D,R,C,F;d(8),w("",o.userName(),"\uFF0C\u6B61\u8FCE\u56DE\u4F86"),d(6),S(o.dateDisplay()),d(2),w(" ",o.timeDisplay()," "),d(15),S(o.formatTime((m=o.todayRecord())==null?null:m.clockInTime)),d(8),S(o.formatTime((g=o.todayRecord())==null?null:g.clockOutTime)),d(8),S(o.formatTime((D=o.todayRecord())==null?null:D.overtimeStartTime)),d(8),S(o.formatTime((R=o.todayRecord())==null?null:R.overtimeEndTime)),d(9),f("disabled",!o.canClockIn()),d(6),f("disabled",!o.canClockOut()),d(6),f("disabled",!o.canOvertimeStart()),d(6),f("disabled",!o.canOvertimeEnd()),d(5),x(o.showOvertimeSelector()?87:-1),d(8),x((C=o.gpsStatus())==="idle"?95:C==="locating"?96:C==="success"?97:C==="failed"?98:-1),d(4),x((F=o.toast())?99:-1,F)}},dependencies:[j,U],encapsulation:2,changeDetection:0})};var Te=[{path:"",component:M,data:{title:"Dashboard"}}];export{Te as DASHBOARD_ROUTES};
