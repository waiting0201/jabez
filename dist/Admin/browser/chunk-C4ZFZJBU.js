import{A as _e,B as te,C as ie,D as Vt,E as H,c as jt,e as me,g as ve,h as O,k as $i,l as K,m as D,n as W,o as Z,p as Q,q as ge,r as Ke,s as Gi,t as Ui,u as X,v as ee,w as Ie,x as Le,y as ke,z as Hi}from"./chunk-HTMXJS6W.js";import{a as Nt}from"./chunk-VDKSUFEH.js";import{Fc as Oe,G as xi,Gb as R,Gc as be,Hc as De,Ib as x,Ic as Mi,Kb as m,N as Te,Na as ze,Oa as Pt,Pc as pe,Qa as s,R as hi,Sc as nt,Tb as q,U as ce,Ub as re,Vb as a,Wb as c,Xb as w,Yb as z,Z as v,Zb as Fe,a as T,b as G,bc as Bi,c as Li,ca as y,cb as N,cc as ji,d as Lt,da as A,dc as Vi,e as ue,ea as g,fa as S,g as Jn,ga as Pi,gc as ae,hc as Ni,ia as kt,jc as B,kc as Be,l as se,lb as Rt,lc as M,m as ki,mc as Oi,nb as f,ob as Bt,p as L,pa as he,pb as b,qa as Ri,qc as U,ra as Si,rb as xe,sb as k,tb as P,ub as h,uc as qi,vb as i,wb as r,xb as d}from"./chunk-D3HV4FU7.js";var Zi=ue((nc,yi)=>{"use strict";var Ei=(function(n){"use strict";var t=Object.prototype,e=t.hasOwnProperty,o=Object.defineProperty||function(C,p,_){C[p]=_.value},l,u=typeof Symbol=="function"?Symbol:{},E=u.iterator||"@@iterator",F=u.asyncIterator||"@@asyncIterator",j=u.toStringTag||"@@toStringTag";function Y(C,p,_){return Object.defineProperty(C,p,{value:_,enumerable:!0,configurable:!0,writable:!0}),C[p]}try{Y({},"")}catch{Y=function(p,_,V){return p[_]=V}}function Ve(C,p,_,V){var I=p&&p.prototype instanceof Re?p:Re,$=Object.create(I.prototype),le=new pt(V||[]);return o($,"_invoke",{value:ut(C,_,le)}),$}n.wrap=Ve;function ne(C,p,_){try{return{type:"normal",arg:C.call(p,_)}}catch(V){return{type:"throw",arg:V}}}var fe="suspendedStart",Ne="suspendedYield",$e="executing",Se="completed",oe={};function Re(){}function ye(){}function Je(){}var mt={};Y(mt,E,function(){return this});var dt=Object.getPrototypeOf,it=dt&&dt(dt(vt([])));it&&it!==t&&e.call(it,E)&&(mt=it);var Ye=Je.prototype=Re.prototype=Object.create(mt);ye.prototype=Je,o(Ye,"constructor",{value:Je,configurable:!0}),o(Je,"constructor",{value:ye,configurable:!0}),ye.displayName=Y(Je,j,"GeneratorFunction");function Ft(C){["next","throw","return"].forEach(function(p){Y(C,p,function(_){return this._invoke(p,_)})})}n.isGeneratorFunction=function(C){var p=typeof C=="function"&&C.constructor;return p?p===ye||(p.displayName||p.name)==="GeneratorFunction":!1},n.mark=function(C){return Object.setPrototypeOf?Object.setPrototypeOf(C,Je):(C.__proto__=Je,Y(C,j,"GeneratorFunction")),C.prototype=Object.create(Ye),C},n.awrap=function(C){return{__await:C}};function Ze(C,p){function _($,le,Ae,Ce){var Ee=ne(C[$],C,le);if(Ee.type==="throw")Ce(Ee.arg);else{var _i=Ee.arg,ft=_i.value;return ft&&typeof ft=="object"&&e.call(ft,"__await")?p.resolve(ft.__await).then(function(Qe){_("next",Qe,Ae,Ce)},function(Qe){_("throw",Qe,Ae,Ce)}):p.resolve(ft).then(function(Qe){_i.value=Qe,Ae(_i)},function(Qe){return _("throw",Qe,Ae,Ce)})}}var V;function I($,le){function Ae(){return new p(function(Ce,Ee){_($,le,Ce,Ee)})}return V=V?V.then(Ae,Ae):Ae()}o(this,"_invoke",{value:I})}Ft(Ze.prototype),Y(Ze.prototype,F,function(){return this}),n.AsyncIterator=Ze,n.async=function(C,p,_,V,I){I===void 0&&(I=Promise);var $=new Ze(Ve(C,p,_,V),I);return n.isGeneratorFunction(p)?$:$.next().then(function(le){return le.done?le.value:$.next()})};function ut(C,p,_){var V=fe;return function($,le){if(V===$e)throw new Error("Generator is already running");if(V===Se){if($==="throw")throw le;return It()}for(_.method=$,_.arg=le;;){var Ae=_.delegate;if(Ae){var Ce=Dt(Ae,_);if(Ce){if(Ce===oe)continue;return Ce}}if(_.method==="next")_.sent=_._sent=_.arg;else if(_.method==="throw"){if(V===fe)throw V=Se,_.arg;_.dispatchException(_.arg)}else _.method==="return"&&_.abrupt("return",_.arg);V=$e;var Ee=ne(C,p,_);if(Ee.type==="normal"){if(V=_.done?Se:Ne,Ee.arg===oe)continue;return{value:Ee.arg,done:_.done}}else Ee.type==="throw"&&(V=Se,_.method="throw",_.arg=Ee.arg)}}}function Dt(C,p){var _=p.method,V=C.iterator[_];if(V===l)return p.delegate=null,_==="throw"&&C.iterator.return&&(p.method="return",p.arg=l,Dt(C,p),p.method==="throw")||_!=="return"&&(p.method="throw",p.arg=new TypeError("The iterator does not provide a '"+_+"' method")),oe;var I=ne(V,C.iterator,p.arg);if(I.type==="throw")return p.method="throw",p.arg=I.arg,p.delegate=null,oe;var $=I.arg;if(!$)return p.method="throw",p.arg=new TypeError("iterator result is not an object"),p.delegate=null,oe;if($.done)p[C.resultName]=$.value,p.next=C.nextLoc,p.method!=="return"&&(p.method="next",p.arg=l);else return $;return p.delegate=null,oe}Ft(Ye),Y(Ye,j,"Generator"),Y(Ye,E,function(){return this}),Y(Ye,"toString",function(){return"[object Generator]"});function gi(C){var p={tryLoc:C[0]};1 in C&&(p.catchLoc=C[1]),2 in C&&(p.finallyLoc=C[2],p.afterLoc=C[3]),this.tryEntries.push(p)}function ct(C){var p=C.completion||{};p.type="normal",delete p.arg,C.completion=p}function pt(C){this.tryEntries=[{tryLoc:"root"}],C.forEach(gi,this),this.reset(!0)}n.keys=function(C){var p=Object(C),_=[];for(var V in p)_.push(V);return _.reverse(),function I(){for(;_.length;){var $=_.pop();if($ in p)return I.value=$,I.done=!1,I}return I.done=!0,I}};function vt(C){if(C){var p=C[E];if(p)return p.call(C);if(typeof C.next=="function")return C;if(!isNaN(C.length)){var _=-1,V=function I(){for(;++_<C.length;)if(e.call(C,_))return I.value=C[_],I.done=!1,I;return I.value=l,I.done=!0,I};return V.next=V}}return{next:It}}n.values=vt;function It(){return{value:l,done:!0}}return pt.prototype={constructor:pt,reset:function(C){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(ct),!C)for(var p in this)p.charAt(0)==="t"&&e.call(this,p)&&!isNaN(+p.slice(1))&&(this[p]=l)},stop:function(){this.done=!0;var C=this.tryEntries[0],p=C.completion;if(p.type==="throw")throw p.arg;return this.rval},dispatchException:function(C){if(this.done)throw C;var p=this;function _(Ce,Ee){return $.type="throw",$.arg=C,p.next=Ce,Ee&&(p.method="next",p.arg=l),!!Ee}for(var V=this.tryEntries.length-1;V>=0;--V){var I=this.tryEntries[V],$=I.completion;if(I.tryLoc==="root")return _("end");if(I.tryLoc<=this.prev){var le=e.call(I,"catchLoc"),Ae=e.call(I,"finallyLoc");if(le&&Ae){if(this.prev<I.catchLoc)return _(I.catchLoc,!0);if(this.prev<I.finallyLoc)return _(I.finallyLoc)}else if(le){if(this.prev<I.catchLoc)return _(I.catchLoc,!0)}else if(Ae){if(this.prev<I.finallyLoc)return _(I.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(C,p){for(var _=this.tryEntries.length-1;_>=0;--_){var V=this.tryEntries[_];if(V.tryLoc<=this.prev&&e.call(V,"finallyLoc")&&this.prev<V.finallyLoc){var I=V;break}}I&&(C==="break"||C==="continue")&&I.tryLoc<=p&&p<=I.finallyLoc&&(I=null);var $=I?I.completion:{};return $.type=C,$.arg=p,I?(this.method="next",this.next=I.finallyLoc,oe):this.complete($)},complete:function(C,p){if(C.type==="throw")throw C.arg;return C.type==="break"||C.type==="continue"?this.next=C.arg:C.type==="return"?(this.rval=this.arg=C.arg,this.method="return",this.next="end"):C.type==="normal"&&p&&(this.next=p),oe},finish:function(C){for(var p=this.tryEntries.length-1;p>=0;--p){var _=this.tryEntries[p];if(_.finallyLoc===C)return this.complete(_.completion,_.afterLoc),ct(_),oe}},catch:function(C){for(var p=this.tryEntries.length-1;p>=0;--p){var _=this.tryEntries[p];if(_.tryLoc===C){var V=_.completion;if(V.type==="throw"){var I=V.arg;ct(_)}return I}}throw new Error("illegal catch attempt")},delegateYield:function(C,p,_){return this.delegate={iterator:vt(C),resultName:p,nextLoc:_},this.method==="next"&&(this.arg=l),oe}},n})(typeof yi=="object"?yi.exports:{});try{regeneratorRuntime=Ei}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=Ei:Function("r","regeneratorRuntime = r")(Ei)}});var Xt=ue((rc,Qi)=>{"use strict";Qi.exports=(n,t)=>`${n}-${t}-${Math.random().toString(16).slice(3,8)}`});var Ai=ue((ac,en)=>{"use strict";var ro=Xt(),Xi=0;en.exports=({id:n,action:t,payload:e={}})=>{let o=n;return typeof o>"u"&&(o=ro("Job",Xi),Xi+=1),{id:o,action:t,payload:e}}});var ei=ue(Ct=>{"use strict";var wi=!1;Ct.logging=wi;Ct.setLogging=n=>{wi=n};Ct.log=(...n)=>wi?console.log.apply(Ct,n):null});var an=ue((nn,rn)=>{"use strict";var ao=Ai(),{log:ti}=ei(),oo=Xt(),tn=0;rn.exports=()=>{let n=oo("Scheduler",tn),t={},e={},o=[];tn+=1;let l=()=>o.length,u=()=>Object.keys(t).length,E=()=>{if(o.length!==0){let ne=Object.keys(t);for(let fe=0;fe<ne.length;fe+=1)if(typeof e[ne[fe]]>"u"){o[0](t[ne[fe]]);break}}},F=(ne,fe)=>new Promise((Ne,$e)=>{let Se=ao({action:ne,payload:fe});o.push(async oe=>{o.shift(),e[oe.id]=Se;try{Ne(await oe[ne].apply(nn,[...fe,Se.id]))}catch(Re){$e(Re)}finally{delete e[oe.id],E()}}),ti(`[${n}]: Add ${Se.id} to JobQueue`),ti(`[${n}]: JobQueue length=${o.length}`),E()});return{addWorker:ne=>(t[ne.id]=ne,ti(`[${n}]: Add ${ne.id}`),ti(`[${n}]: Number of workers=${u()}`),E(),ne.id),addJob:async(ne,...fe)=>{if(u()===0)throw Error(`[${n}]: You need to have at least one worker before adding jobs`);return F(ne,fe)},terminate:async()=>{Object.keys(t).forEach(async ne=>{await t[ne].terminate()}),o=[]},getQueueLen:l,getNumWorkers:u}}});var ln=ue((lc,on)=>{"use strict";on.exports=n=>{let t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof Li=="function"&&(t.type="node"),typeof n>"u"?t:t[n]}});var mn=ue((mc,sn)=>{"use strict";var lo=ln()("type")==="browser",so=lo?n=>new URL(n,window.location.href).href:n=>n;sn.exports=n=>{let t=T({},n);return["corePath","workerPath","langPath"].forEach(e=>{n[e]&&(t[e]=so(t[e]))}),t}});var Ti=ue((uc,dn)=>{"use strict";dn.exports={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3}});var un=ue((cc,mo)=>{mo.exports={name:"tesseract.js",version:"7.0.0",description:"Pure Javascript Multilingual OCR",main:"src/index.js",type:"commonjs",types:"src/index.d.ts",unpkg:"dist/tesseract.min.js",jsdelivr:"dist/tesseract.min.js",scripts:{start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js && rollup -c scripts/rollup.esm.mjs","profile:tesseract":"webpack-bundle-analyzer dist/tesseract-stats.json","profile:worker":"webpack-bundle-analyzer dist/worker-stats.json",prepublishOnly:"npm run build",wait:"rimraf dist && wait-on http://localhost:3000/dist/tesseract.min.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser test:node:all","test:browser":"karma start karma.conf.js","test:node":"nyc mocha --exit --bail --require ./scripts/test-helper.mjs","test:node:all":"npm run test:node -- ./tests/*.test.mjs",lint:"eslint src","lint:fix":"eslint --fix src",postinstall:"opencollective-postinstall || true"},browser:{"./src/worker/node/index.js":"./src/worker/browser/index.js"},author:"",contributors:["jeromewu"],license:"Apache-2.0",devDependencies:{"@babel/core":"^7.21.4","@babel/eslint-parser":"^7.21.3","@babel/preset-env":"^7.21.4","@rollup/plugin-commonjs":"^24.1.0",acorn:"^8.8.2","babel-loader":"^9.1.2",buffer:"^6.0.3",cors:"^2.8.5",eslint:"^7.32.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.27.5","expect.js":"^0.3.1",express:"^4.18.2",mocha:"^10.2.0","npm-run-all":"^4.1.5",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-webpack":"^5.0.0",nyc:"^15.1.0",rimraf:"^5.0.0",rollup:"^3.20.7","wait-on":"^7.0.1",webpack:"^5.79.0","webpack-bundle-analyzer":"^4.8.0","webpack-cli":"^5.0.1","webpack-dev-middleware":"^6.0.2","rollup-plugin-sourcemaps":"^0.6.3"},dependencies:{"bmp-js":"^0.1.0","idb-keyval":"^6.2.0","is-url":"^1.2.4","node-fetch":"^2.6.9","opencollective-postinstall":"^2.0.3","regenerator-runtime":"^0.13.3","tesseract.js-core":"^7.0.0","wasm-feature-detect":"^1.8.0",zlibjs:"^0.3.1"},overrides:{"@rollup/pluginutils":"^5.0.2"},repository:{type:"git",url:"https://github.com/naptha/tesseract.js.git"},bugs:{url:"https://github.com/naptha/tesseract.js/issues"},homepage:"https://github.com/naptha/tesseract.js",collective:{type:"opencollective",url:"https://opencollective.com/tesseractjs"}}});var pn=ue((pc,cn)=>{"use strict";cn.exports={workerBlobURL:!0,logger:()=>{}}});var fn=ue((vc,vn)=>{"use strict";var uo=un().version,co=pn();vn.exports=G(T({},co),{workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${uo}/dist/worker.min.js`})});var gn=ue((bc,bn)=>{"use strict";bn.exports=({workerPath:n,workerBlobURL:t})=>{let e;if(Blob&&URL&&t){let o=new Blob([`importScripts("${n}");`],{type:"application/javascript"});e=new Worker(URL.createObjectURL(o))}else e=new Worker(n);return e}});var xn=ue((gc,_n)=>{"use strict";_n.exports=n=>{n.terminate()}});var Sn=ue((_c,hn)=>{"use strict";hn.exports=(n,t)=>{n.onmessage=({data:e})=>{t(e)}}});var En=ue((xc,Cn)=>{"use strict";Cn.exports=async(n,t)=>{n.postMessage(t)}});var An=ue((hc,yn)=>{"use strict";var Fi=n=>new Promise((t,e)=>{let o=new FileReader;o.onload=()=>{t(o.result)},o.onerror=({target:{error:{code:l}}})=>{e(Error(`File could not be read! Code=${l}`))},o.readAsArrayBuffer(n)}),Di=async n=>{let t=n;if(typeof n>"u")return"undefined";if(typeof n=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(n)?t=atob(n.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(n)).arrayBuffer();else if(typeof HTMLElement<"u"&&n instanceof HTMLElement)n.tagName==="IMG"&&(t=await Di(n.src)),n.tagName==="VIDEO"&&(t=await Di(n.poster)),n.tagName==="CANVAS"&&await new Promise(e=>{n.toBlob(async o=>{t=await Fi(o),e()})});else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas){let e=await n.convertToBlob();t=await Fi(e)}else(n instanceof File||n instanceof Blob)&&(t=await Fi(n));return new Uint8Array(t)};yn.exports=Di});var Tn=ue((Sc,wn)=>{"use strict";var po=fn(),vo=gn(),fo=xn(),bo=Sn(),go=En(),_o=An();wn.exports={defaultOptions:po,spawnWorker:vo,terminateWorker:fo,onMessage:bo,send:go,loadImage:_o}});var Ii=ue((Cc,Ln)=>{"use strict";var xo=mn(),He=Ai(),{log:Fn}=ei(),ho=Xt(),tt=Ti(),{defaultOptions:So,spawnWorker:Co,terminateWorker:Eo,onMessage:yo,loadImage:Dn,send:Ao}=Tn(),In=0;Ln.exports=async(n="eng",t=tt.LSTM_ONLY,e={},o={})=>{let l=ho("Worker",In),C=xo(T(T({},So),e)),{logger:u,errorHandler:E}=C,F=Lt(C,["logger","errorHandler"]),j={},Y=typeof n=="string"?n.split("+"):n,Ve=t,ne=o,fe=[tt.DEFAULT,tt.LSTM_ONLY].includes(t)&&!F.legacyCore,Ne,$e,Se=new Promise((p,_)=>{$e=p,Ne=_}),oe=p=>{Ne(p.message)},Re=Co(F);Re.onerror=oe,In+=1;let ye=({id:p,action:_,payload:V})=>new Promise((I,$)=>{Fn(`[${l}]: Start ${p}, action=${_}`);let le=`${_}-${p}`;j[le]={resolve:I,reject:$},Ao(Re,{workerId:l,jobId:p,action:_,payload:V})}),Je=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),mt=p=>ye(He({id:p,action:"load",payload:{options:{lstmOnly:fe,corePath:F.corePath,logging:F.logging}}})),dt=(p,_,V)=>ye(He({id:V,action:"FS",payload:{method:"writeFile",args:[p,_]}})),it=(p,_)=>ye(He({id:_,action:"FS",payload:{method:"readFile",args:[p,{encoding:"utf8"}]}})),Ye=(p,_)=>ye(He({id:_,action:"FS",payload:{method:"unlink",args:[p]}})),Ft=(p,_,V)=>ye(He({id:V,action:"FS",payload:{method:p,args:_}})),Ze=(p,_)=>ye(He({id:_,action:"loadLanguage",payload:{langs:p,options:{langPath:F.langPath,dataPath:F.dataPath,cachePath:F.cachePath,cacheMethod:F.cacheMethod,gzip:F.gzip,lstmOnly:[tt.DEFAULT,tt.LSTM_ONLY].includes(Ve)&&!F.legacyLang}}})),ut=(p,_,V,I)=>ye(He({id:I,action:"initialize",payload:{langs:p,oem:_,config:V}})),Dt=(p="eng",_,V,I)=>{if(fe&&[tt.TESSERACT_ONLY,tt.TESSERACT_LSTM_COMBINED].includes(_))throw Error("Legacy model requested but code missing.");let $=_||Ve;Ve=$;let le=V||ne;ne=le;let Ce=(typeof p=="string"?p.split("+"):p).filter(Ee=>!Y.includes(Ee));return Y.push(...Ce),Ce.length>0?Ze(Ce,I).then(()=>ut(p,$,le,I)):ut(p,$,le,I)},gi=(p={},_)=>ye(He({id:_,action:"setParameters",payload:{params:p}})),ct=async(p,_={},V={text:!0},I)=>ye(He({id:I,action:"recognize",payload:{image:await Dn(p),options:_,output:V}})),pt=async(p,_)=>{if(fe)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return ye(He({id:_,action:"detect",payload:{image:await Dn(p)}}))},vt=async()=>(Re!==null&&(Eo(Re),Re=null),Promise.resolve());yo(Re,({workerId:p,jobId:_,status:V,action:I,data:$})=>{let le=`${I}-${_}`;if(V==="resolve")Fn(`[${p}]: Complete ${_}`),j[le].resolve({jobId:_,data:$}),delete j[le];else if(V==="reject")if(j[le].reject($),delete j[le],I==="load"&&Ne($),E)E($);else throw Error($);else V==="progress"&&u(G(T({},$),{userJobId:_}))});let It={id:l,worker:Re,load:Je,writeText:dt,readText:it,removeFile:Ye,FS:Ft,reinitialize:Dt,setParameters:gi,recognize:ct,detect:pt,terminate:vt};return mt().then(()=>Ze(n)).then(()=>ut(n,t,o)).then(()=>$e(It)).catch(()=>{}),Se}});var Rn=ue((yc,Pn)=>{"use strict";var kn=Ii(),wo=async(n,t,e)=>{let o=await kn(t,1,e);return o.recognize(n).finally(async()=>{await o.terminate()})},To=async(n,t)=>{let e=await kn("osd",0,t);return e.detect(n).finally(async()=>{await e.terminate()})};Pn.exports={recognize:wo,detect:To}});var jn=ue((Ac,Bn)=>{"use strict";Bn.exports={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"}});var Nn=ue((wc,Vn)=>{"use strict";Vn.exports={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"}});var qn=ue((Tc,On)=>{"use strict";Zi();var Fo=an(),Do=Ii(),Io=Rn(),Lo=jn(),ko=Ti(),Po=Nn(),{setLogging:Ro}=ei();On.exports=T({languages:Lo,OEM:ko,PSM:Po,createScheduler:Fo,createWorker:Do,setLogging:Ro},Io)});function Pe(n,t){let e=t?.injector??v(Pi),o=new ki(1),l=Ri(()=>{let u;try{u=n()}catch(E){Si(()=>o.error(E));return}Si(()=>o.next(u))},{injector:e,manualCleanup:!0});return e.get(kt).onDestroy(()=>{l.destroy(),o.complete()}),o.asObservable()}function we(n,t){let o=!t?.manualCleanup?t?.injector?.get(kt)??v(kt):null,l=Yn(t?.equal),u;t?.requireSync?u=he({kind:0},{equal:l}):u=he({kind:1,value:t?.initialValue},{equal:l});let E,F=n.subscribe({next:j=>u.set({kind:1,value:j}),error:j=>{u.set({kind:2,error:j}),E?.()},complete:()=>{E?.()}});if(t?.requireSync&&u().kind===0)throw new hi(601,!1);return E=o?.onDestroy(F.unsubscribe.bind(F)),U(()=>{let j=u();switch(j.kind){case 1:return j.value;case 2:throw j.error;case 0:throw new hi(601,!1)}},{equal:t?.equal})}function Yn(n=Object.is){return(t,e)=>t.kind===1&&e.kind===1&&n(t.value,e.value)}var zn=[{id:"1",name:"Alice Chen",email:"alice@example.com",roleIds:["admin"],status:"active",departmentId:1,departmentName:"\u7BA1\u7406\u90E8",jobTitleId:4,jobTitleName:"\u90E8\u9580\u4E3B\u7BA1",hireDate:new Date("2022-03-01"),baseSalary:8e4,createdAt:new Date("2024-01-01")},{id:"2",name:"Bob Wang",email:"bob@example.com",roleIds:["manager"],status:"active",departmentId:2,departmentName:"\u8CC7\u8A0A\u90E8",jobTitleId:2,jobTitleName:"\u8CC7\u6DF1\u5DE5\u7A0B\u5E2B",hireDate:new Date("2023-06-15"),baseSalary:6e4,agentUserId:"1",agentName:"Alice Chen",createdAt:new Date("2024-02-10")},{id:"3",name:"Carol Liu",email:"carol@example.com",roleIds:["viewer"],status:"inactive",departmentId:3,departmentName:"\u696D\u52D9\u90E8",jobTitleId:1,jobTitleName:"\u5DE5\u7A0B\u5E2B",hireDate:new Date("2023-09-01"),resignDate:new Date("2025-01-31"),baseSalary:5e4,createdAt:new Date("2024-03-05")}],rt=class n{http=v(pe);items$=new se(zn);getAll(){return this.items$.asObservable()}getPaged(t,e){let o=this.items$.getValue(),l=(t-1)*e,u=Math.max(1,Math.ceil(o.length/e));return L({items:o.slice(l,l+e),totalCount:o.length,page:t,pageSize:e,totalPages:u})}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=G(T({},t),{id:Date.now().toString(),createdAt:new Date});return this.items$.next([...this.items$.getValue(),e]),L(e)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var Kn=[{id:"admin",name:"Administrator",description:"Full system access",permissionCodes:["admin:access","users:read","users:write","users:delete","roles:read","roles:write","roles:delete","permissions:read","permissions:write","permissions:delete","departments:read","departments:write","departments:delete","job-titles:read","job-titles:write","job-titles:delete","approvals:read","approvals:write","approvals:delete","projects:read","projects:write","projects:delete","payment-requests:read","payment-requests:write","payment-requests:delete","approval-tasks:read","approval-tasks:write"],createdAt:new Date("2024-01-01")},{id:"manager",name:"Manager",description:"Can manage users and view reports",permissionCodes:["admin:access","users:read","users:write","roles:read"],createdAt:new Date("2024-01-15")},{id:"viewer",name:"Viewer",description:"Read-only access",permissionCodes:["users:read","roles:read","permissions:read"],createdAt:new Date("2024-02-01")}],Ge=class n{http=v(pe);items$=new se(Kn);getAll(){return this.items$.asObservable()}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=G(T({},t),{id:Date.now().toString(),createdAt:new Date});return this.items$.next([...this.items$.getValue(),e]),L(e)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var Wn=n=>[n,"edit"],Zn=n=>[n],Qn=(n,t)=>t.id;function Xn(n,t){if(n&1&&(i(0,"div",21),a(1),r()),n&2){let e=m().$implicit;s(),w("\u4EE3\u7406\u4EBA\uFF1A",e.agentName)}}function er(n,t){if(n&1&&(i(0,"div",24),a(1),B(2,"date"),r()),n&2){let e=m().$implicit;s(),w("\u96E2\u8077\uFF1A",M(2,1,e.resignDate,"yyyy-MM-dd"))}}function tr(n,t){if(n&1&&(i(0,"span",25),a(1),r()),n&2){let e=t.$implicit,o=m(2);s(),c(o.getRoleNames(ae(1,Zn,e)))}}function ir(n,t){if(n&1){let e=R();i(0,"tr")(1,"td")(2,"div",20),a(3),r(),f(4,Xn,2,1,"div",21),r(),i(5,"td",22),a(6),r(),i(7,"td",15),a(8),r(),i(9,"td",15),a(10),r(),i(11,"td",23),a(12),B(13,"date"),f(14,er,3,4,"div",24),r(),i(15,"td",16),a(16),B(17,"currency"),r(),i(18,"td"),k(19,tr,2,3,"span",25,xe),r(),i(21,"td",17)(22,"span",26),a(23),r()(),i(24,"td",27)(25,"div",28)(26,"a",29),g(),i(27,"svg",7),d(28,"use",30),r()(),S(),i(29,"button",31),x("click",function(){let l=y(e).$implicit,u=m();return A(u.delete(l))}),g(),i(30,"svg",7),d(31,"use",32),r()()()()()}if(n&2){let e=t.$implicit;s(3),c(e.name),s(),b(e.agentName?4:-1),s(2),c(e.email),s(2),w(" ",e.departmentName||"\u2014"," "),s(2),w(" ",e.jobTitleName||"\u2014"," "),s(2),w(" ",e.hireDate?M(13,14,e.hireDate,"yyyy-MM-dd"):"\u2014"," "),s(2),b(e.resignDate?14:-1),s(2),w(" ",e.baseSalary?Oi(17,17,e.baseSalary,"TWD","symbol","1.0-0"):"\u2014"," "),s(3),P(e.roleIds),s(3),q("bg-success",e.status==="active")("bg-secondary",e.status==="inactive"),s(),w(" ",e.status==="active"?"\u5728\u8077":"\u96E2\u8077"," "),s(3),h("routerLink",ae(22,Wn,e.id))}}function nr(n,t){n&1&&(i(0,"tr")(1,"td",33),a(2,"\u5C1A\u7121\u54E1\u5DE5\u8CC7\u6599\u3002"),r()())}function rr(n,t){n&1&&(i(0,"li",41)(1,"span",43),a(2,"\u2026"),r()())}function ar(n,t){if(n&1){let e=R();i(0,"li",39)(1,"button",40),x("click",function(){y(e);let l=m().$implicit,u=m(2);return A(u.goTo(l))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);q("active",e===o.page()),s(2),c(e)}}function or(n,t){if(n&1&&f(0,rr,3,0,"li",41)(1,ar,3,3,"li",42),n&2){let e=t.$implicit;b(e===-1?0:1)}}function lr(n,t){if(n&1){let e=R();i(0,"div",19)(1,"span",34),a(2),r(),i(3,"div",35)(4,"button",36),x("click",function(){y(e);let l=m();return A(l.prev())}),a(5,"\u2039"),r(),i(6,"span",37),a(7),r(),i(8,"button",36),x("click",function(){y(e);let l=m();return A(l.next())}),a(9,"\u203A"),r()(),i(10,"ul",38)(11,"li",39)(12,"button",40),x("click",function(){y(e);let l=m();return A(l.prev())}),a(13,"\u2039"),r()(),k(14,or,2,1,null,null,xe),i(16,"li",39)(17,"button",40),x("click",function(){y(e);let l=m();return A(l.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();s(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),s(2),q("disabled",e.page()===1),s(3),z("",e.page()," / ",e.totalPages()),s(),q("disabled",e.page()===e.totalPages()),s(3),q("disabled",e.page()===1),s(3),P(e.pageNumbers()),s(2),q("disabled",e.page()===e.totalPages())}}var Ot=class n{userService=v(rt);roleService=v(Ge);roles=we(this.roleService.getAll(),{initialValue:[]});PAGE_SIZE=20;page=he(1);result=we(Pe(this.page).pipe(Te(t=>this.userService.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedUsers=U(()=>this.result().items);totalCount=U(()=>this.result().totalCount);totalPages=U(()=>this.result().totalPages);pageNumbers=U(()=>sr(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}getRoleNames(t){let e=this.roles();return t.map(o=>e.find(l=>l.id===o)?.name??o).join(", ")}delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u54E1\u5DE5\u300C${t.name}\u300D\u55CE\uFF1F`)&&this.userService.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-user-list"]],decls:40,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#user"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"hidden","xl:table-cell"],[1,"hidden","sm:table-cell"],[1,"text-right"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500"],[1,"text-muted","small"],[1,"text-muted","hidden","md:table-cell"],[1,"text-muted","small","hidden","xl:table-cell"],[1,"text-danger"],[1,"badge","bg-secondary","me-1"],[1,"badge"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","9",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u54E1\u5DE5\u7BA1\u7406"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u54E1\u5DE5 "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u59D3\u540D"),r(),i(19,"th",14),a(20,"Email"),r(),i(21,"th",15),a(22,"\u90E8\u9580"),r(),i(23,"th",15),a(24,"\u8077\u7A31"),r(),i(25,"th",16),a(26,"\u5165\u8077\u65E5"),r(),i(27,"th",16),a(28,"\u5E95\u85AA"),r(),i(29,"th"),a(30,"\u89D2\u8272"),r(),i(31,"th",17),a(32,"\u72C0\u614B"),r(),i(33,"th",18),a(34,"\u64CD\u4F5C"),r()()(),i(35,"tbody"),k(36,ir,32,24,"tr",null,Qn,!1,nr,3,0,"tr"),r()()(),f(39,lr,19,13,"div",19),r()()()),e&2&&(s(36),P(o.pagedUsers()),s(3),b(o.totalPages()>1?39:-1))},dependencies:[O,be,Mi],encapsulation:2})};function sr(n,t){if(t<=9)return Array.from({length:t},(l,u)=>u+1);let e=[],o=0;for(let l=1;l<=t;l++)(l===1||l===t||l>=n-2&&l<=n+2)&&(o&&l-o>1&&e.push(-1),e.push(l),o=l);return e}var mr=[{id:1,name:"\u7BA1\u7406\u90E8",code:"MGT",sortOrder:1,employeeCount:1,createdAt:new Date("2024-01-01")},{id:2,name:"\u8CC7\u8A0A\u90E8",code:"IT",sortOrder:2,employeeCount:1,createdAt:new Date("2024-01-01")},{id:3,name:"\u696D\u52D9\u90E8",code:"SLS",sortOrder:3,employeeCount:1,createdAt:new Date("2024-01-01")}],qe=class n{http=v(pe);items$=new se(mr);getAll(){return this.items$.asObservable()}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=G(T({},t),{id:Date.now(),employeeCount:0,createdAt:new Date});return this.items$.next([...this.items$.getValue(),e]),L(e)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var dr=[{id:1,name:"\u5DE5\u7A0B\u5E2B",level:1,employeeCount:1,createdAt:new Date("2024-01-01")},{id:2,name:"\u8CC7\u6DF1\u5DE5\u7A0B\u5E2B",level:2,employeeCount:1,createdAt:new Date("2024-01-01")},{id:3,name:"\u4E3B\u4EFB\u5DE5\u7A0B\u5E2B",level:3,employeeCount:0,createdAt:new Date("2024-01-01")},{id:4,name:"\u90E8\u9580\u4E3B\u7BA1",level:4,employeeCount:1,createdAt:new Date("2024-01-01")}],Ue=class n{http=v(pe);items$=new se(dr);getAll(){return this.items$.asObservable()}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=G(T({},t),{id:Date.now(),employeeCount:0,createdAt:new Date});return this.items$.next([...this.items$.getValue(),e]),L(e)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var qt=(n,t)=>t.id;function ur(n,t){n&1&&(i(0,"div",17),a(1,"\u8ACB\u8F38\u5165\u59D3\u540D\u3002"),r())}function cr(n,t){n&1&&(i(0,"div",17),a(1,"\u8ACB\u8F38\u5165\u6709\u6548\u7684\u96FB\u5B50\u90F5\u4EF6\u3002"),r())}function pr(n,t){if(n&1&&(i(0,"div",23),d(1,"input",38),i(2,"label",39),a(3),r()()),n&2){let e=t.$implicit;s(),h("id","role-"+e.id)("value",e.id),s(),h("for","role-"+e.id),s(),c(e.name)}}function vr(n,t){n&1&&(i(0,"div",17),a(1,"\u8ACB\u9078\u64C7\u89D2\u8272\u3002"),r())}function fr(n,t){if(n&1&&(i(0,"option",25),a(1),r()),n&2){let e=t.$implicit;h("ngValue",e.id),s(),c(e.name)}}function br(n,t){if(n&1&&(i(0,"option",25),a(1),r()),n&2){let e=t.$implicit;h("ngValue",e.id),s(),z("",e.name,"\uFF08L",e.level,"\uFF09")}}function gr(n,t){if(n&1&&(i(0,"option",34),a(1),r()),n&2){let e=t.$implicit;h("value",e.id),s(),c(e.name)}}var bt=class n{fb=v(te);userService=v(rt);roleService=v(Ge);deptService=v(qe);jtService=v(Ue);route=v(me);router=v(ve);roles=[];departments=[];jobTitles=[];allUsers=[];isEdit=!1;userId="";form=this.fb.group({name:["",D.required],email:["",[D.required,D.email]],roleId:["",D.required],status:["active",D.required],departmentId:[null],jobTitleId:[null],hireDate:[""],resignDate:[""],baseSalary:[null],agentUserId:[""]});ngOnInit(){this.roleService.getAll().subscribe(t=>this.roles=t),this.deptService.getAll().subscribe(t=>this.departments=t),this.jtService.getAll().subscribe(t=>this.jobTitles=t),this.userService.getAll().subscribe(t=>this.allUsers=t),this.userId=this.route.snapshot.paramMap.get("id")??"",this.userId&&(this.isEdit=!0,this.userService.getById(this.userId).subscribe(t=>{t&&this.form.patchValue(G(T({},t),{roleId:t.roleIds[0]??"",departmentId:t.departmentId??null,jobTitleId:t.jobTitleId??null,hireDate:t.hireDate?this.toDateString(t.hireDate):"",resignDate:t.resignDate?this.toDateString(t.resignDate):"",baseSalary:t.baseSalary??null,agentUserId:t.agentUserId??""}))}))}getAvailableAgents(){return this.allUsers.filter(t=>t.id!==this.userId)}toDateString(t){return new Date(t).toISOString().substring(0,10)}submit(){if(this.form.invalid)return;let Se=this.form.value,{roleId:t,hireDate:e,resignDate:o,departmentId:l,jobTitleId:u,agentUserId:E}=Se,F=Lt(Se,["roleId","hireDate","resignDate","departmentId","jobTitleId","agentUserId"]),j=l||void 0,Y=u||void 0,Ve=j?this.departments.find(oe=>oe.id===j)?.name:void 0,ne=Y?this.jobTitles.find(oe=>oe.id===Y)?.name:void 0,fe=E?this.allUsers.find(oe=>oe.id===E):void 0,Ne=G(T({},F),{roleIds:t?[t]:[],departmentId:j,departmentName:Ve,jobTitleId:Y,jobTitleName:ne,hireDate:e?new Date(e):void 0,resignDate:o?new Date(o):void 0,agentUserId:E||void 0,agentName:fe?.name});(this.isEdit?this.userService.update(this.userId,Ne):this.userService.create(Ne)).subscribe(()=>this.router.navigate(["/admin/users"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-user-form"]],decls:95,vars:9,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/users",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[1,"row"],[1,"col-12","col-xl-8"],[3,"ngSubmit","formGroup"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-header","bg-transparent","fw-500"],[1,"card-body"],[1,"row","g-3"],[1,"col-12","col-md-6"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u8ACB\u8F38\u5165\u59D3\u540D",1,"form-control"],[1,"text-danger","small","mt-1"],["type","email","formControlName","email","placeholder","user@example.com",1,"form-control"],["formControlName","status",1,"form-select"],["value","active"],["value","inactive"],[1,"flex","flex-wrap","gap-4","mt-1"],[1,"form-check"],["formControlName","departmentId",1,"form-select"],[3,"ngValue"],["formControlName","jobTitleId",1,"form-select"],["type","date","formControlName","hireDate",1,"form-control"],["type","date","formControlName","resignDate",1,"form-control"],[1,"input-group"],[1,"input-group-text"],["type","number","formControlName","baseSalary","placeholder","\u4F8B\u5982\uFF1A50000","min","0",1,"form-control"],["formControlName","agentUserId",1,"form-select"],["value",""],[3,"value"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/users",1,"btn","btn-outline-secondary"],["type","radio","name","roleId","formControlName","roleId",1,"form-check-input",3,"id","value"],[1,"form-check-label",3,"for"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"div",6)(8,"div",7)(9,"form",8),x("ngSubmit",function(){return o.submit()}),i(10,"div",9)(11,"div",10),a(12,"\u57FA\u672C\u8CC7\u6599"),r(),i(13,"div",11)(14,"div",12)(15,"div",13)(16,"label",14),a(17,"\u59D3\u540D "),i(18,"span",15),a(19,"*"),r()(),d(20,"input",16),f(21,ur,2,0,"div",17),r(),i(22,"div",13)(23,"label",14),a(24,"Email "),i(25,"span",15),a(26,"*"),r()(),d(27,"input",18),f(28,cr,2,0,"div",17),r(),i(29,"div",13)(30,"label",14),a(31,"\u72C0\u614B"),r(),i(32,"select",19)(33,"option",20),a(34,"\u5728\u8077"),r(),i(35,"option",21),a(36,"\u96E2\u8077"),r()()(),i(37,"div",13)(38,"label",14),a(39,"\u89D2\u8272 "),i(40,"span",15),a(41,"*"),r()(),i(42,"div",22),k(43,pr,4,4,"div",23,qt),r(),f(45,vr,2,0,"div",17),r()()()(),i(46,"div",9)(47,"div",10),a(48,"\u54E1\u5DE5\u8CC7\u8A0A"),r(),i(49,"div",11)(50,"div",12)(51,"div",13)(52,"label",14),a(53,"\u90E8\u9580"),r(),i(54,"select",24)(55,"option",25),a(56,"\u2014 \u672A\u6307\u5B9A \u2014"),r(),k(57,fr,2,2,"option",25,qt),r()(),i(59,"div",13)(60,"label",14),a(61,"\u8077\u7A31"),r(),i(62,"select",26)(63,"option",25),a(64,"\u2014 \u672A\u6307\u5B9A \u2014"),r(),k(65,br,2,3,"option",25,qt),r()(),i(67,"div",13)(68,"label",14),a(69,"\u5165\u8077\u65E5"),r(),d(70,"input",27),r(),i(71,"div",13)(72,"label",14),a(73,"\u96E2\u8077\u65E5"),r(),d(74,"input",28),r(),i(75,"div",13)(76,"label",14),a(77,"\u5E95\u85AA"),r(),i(78,"div",29)(79,"span",30),a(80,"NT$"),r(),d(81,"input",31),r()(),i(82,"div",13)(83,"label",14),a(84,"\u8077\u52D9\u4EE3\u7406\u4EBA"),r(),i(85,"select",32)(86,"option",33),a(87,"\u2014 \u7121\u4EE3\u7406\u4EBA \u2014"),r(),k(88,gr,2,2,"option",34,qt),r()()()()(),i(90,"div",35)(91,"button",36),a(92),r(),i(93,"a",37),a(94,"\u53D6\u6D88"),r()()()()()()),e&2){let l,u,E;s(6),c(o.isEdit?"\u7DE8\u8F2F\u54E1\u5DE5":"\u65B0\u589E\u54E1\u5DE5"),s(3),h("formGroup",o.form),s(12),b((l=o.form.get("name"))!=null&&l.invalid&&((l=o.form.get("name"))!=null&&l.touched)?21:-1),s(7),b((u=o.form.get("email"))!=null&&u.invalid&&((u=o.form.get("email"))!=null&&u.touched)?28:-1),s(15),P(o.roles),s(2),b((E=o.form.get("roleId"))!=null&&E.invalid&&((E=o.form.get("roleId"))!=null&&E.touched)?45:-1),s(10),h("ngValue",null),s(2),P(o.departments),s(6),h("ngValue",null),s(2),P(o.jobTitles),s(23),P(o.getAvailableAgents()),s(3),h("disabled",o.form.invalid),s(),w(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[ie,Q,Le,ke,K,ge,Ie,Ke,W,Z,_e,ee,X,O],encapsulation:2})};var _r=n=>[n,"edit"],xr=(n,t)=>t.id;function hr(n,t){if(n&1){let e=R();i(0,"tr")(1,"td",17),a(2),r(),i(3,"td",18),a(4),r(),i(5,"td")(6,"span",19),a(7),r()(),i(8,"td",20),a(9),B(10,"date"),r(),i(11,"td",21)(12,"div",22)(13,"a",23),g(),i(14,"svg",7),d(15,"use",24),r()(),S(),i(16,"button",25),x("click",function(){let l=y(e).$implicit,u=m();return A(u.delete(l))}),g(),i(17,"svg",7),d(18,"use",26),r()()()()()}if(n&2){let e=t.$implicit;s(2),c(e.name),s(2),c(e.description),s(3),w("",e.permissionCodes.length," \u500B\u6B0A\u9650"),s(2),c(M(10,5,e.createdAt,"yyyy-MM-dd")),s(4),h("routerLink",ae(8,_r,e.id))}}function Sr(n,t){n&1&&(i(0,"tr")(1,"td",27),a(2,"\u5C1A\u7121\u89D2\u8272\u8CC7\u6599\u3002"),r()())}var Mt=class n{roleService=v(Ge);roles$=this.roleService.getAll();delete(t){confirm(`Delete role "${t.name}"?`)&&this.roleService.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-role-list"]],decls:32,vars:3,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#shield"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"text-right"],[1,"fw-500"],[1,"text-muted","hidden","md:table-cell"],[1,"badge","bg-info"],[1,"text-muted","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","5",1,"text-center","text-muted","py-4"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u89D2\u8272\u7BA1\u7406"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u89D2\u8272 "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u540D\u7A31"),r(),i(19,"th",14),a(20,"\u63CF\u8FF0"),r(),i(21,"th"),a(22,"\u6B0A\u9650"),r(),i(23,"th",15),a(24,"\u5EFA\u7ACB\u65E5\u671F"),r(),i(25,"th",16),a(26,"\u64CD\u4F5C"),r()()(),i(27,"tbody"),k(28,hr,19,10,"tr",null,xr,!1,Sr,3,0,"tr"),B(31,"async"),r()()()()()()),e&2&&(s(28),P(Be(31,1,o.roles$)))},dependencies:[O,Oe,be],encapsulation:2})};var Cr=[{id:"1",code:"admin:access",name:"Admin Access",module:"Admin"},{id:"2",code:"users:read",name:"View Users",module:"Users"},{id:"3",code:"users:write",name:"Create/Edit Users",module:"Users"},{id:"4",code:"users:delete",name:"Delete Users",module:"Users"},{id:"5",code:"roles:read",name:"View Roles",module:"Roles"},{id:"6",code:"roles:write",name:"Create/Edit Roles",module:"Roles"},{id:"7",code:"roles:delete",name:"Delete Roles",module:"Roles"},{id:"8",code:"permissions:read",name:"View Permissions",module:"Permissions"},{id:"9",code:"permissions:write",name:"Create/Edit Permissions",module:"Permissions"},{id:"10",code:"permissions:delete",name:"Delete Permissions",module:"Permissions"},{id:"11",code:"departments:read",name:"View Departments",module:"Departments"},{id:"12",code:"departments:write",name:"Create/Edit Departments",module:"Departments"},{id:"13",code:"departments:delete",name:"Delete Departments",module:"Departments"},{id:"14",code:"job-titles:read",name:"View Job Titles",module:"JobTitles"},{id:"15",code:"job-titles:write",name:"Create/Edit Job Titles",module:"JobTitles"},{id:"16",code:"job-titles:delete",name:"Delete Job Titles",module:"JobTitles"},{id:"17",code:"approvals:read",name:"View Approvals",module:"Approvals"},{id:"18",code:"approvals:write",name:"Create/Edit Approvals",module:"Approvals"},{id:"19",code:"approvals:delete",name:"Delete Approvals",module:"Approvals"},{id:"20",code:"projects:read",name:"View Projects",module:"Projects"},{id:"21",code:"projects:write",name:"Create/Edit Projects",module:"Projects"},{id:"22",code:"projects:delete",name:"Delete Projects",module:"Projects"},{id:"23",code:"payment-requests:read",name:"View Payment Requests",module:"PaymentRequests"},{id:"24",code:"payment-requests:write",name:"Create/Edit Payment Requests",module:"PaymentRequests"},{id:"25",code:"payment-requests:delete",name:"Delete Payment Requests",module:"PaymentRequests"},{id:"26",code:"approval-tasks:read",name:"View Approval Tasks",module:"ApprovalTasks"},{id:"27",code:"approval-tasks:write",name:"Review Approval Tasks",module:"ApprovalTasks"},{id:"28",code:"leave-requests:read",name:"View Leave Requests",module:"LeaveRequests"},{id:"29",code:"leave-requests:write",name:"Create/Edit Leave Requests",module:"LeaveRequests"},{id:"30",code:"leave-requests:delete",name:"Delete Leave Requests",module:"LeaveRequests"},{id:"31",code:"travel-requests:read",name:"View Travel Requests",module:"TravelRequests"},{id:"32",code:"travel-requests:write",name:"Create/Edit Travel Requests",module:"TravelRequests"},{id:"33",code:"travel-requests:delete",name:"Delete Travel Requests",module:"TravelRequests"}],We=class n{http=v(pe);items$=new se(Cr);getAll(){return this.items$.asObservable()}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}getModules(){return[...new Set(this.items$.getValue().map(t=>t.module))]}create(t){let e=G(T({},t),{id:Date.now().toString()});return this.items$.next([...this.items$.getValue(),e]),L(e)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var Er=(n,t)=>t.id;function yr(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165\u89D2\u8272\u540D\u7A31\u3002"),r())}function Ar(n,t){if(n&1){let e=R();i(0,"div",27)(1,"input",24),x("change",function(){let l=y(e).$implicit,u=m(2);return A(u.togglePermission(l.code))}),r(),i(2,"label",28),a(3),r()()}if(n&2){let e=t.$implicit,o=m(2);s(),h("id","perm-"+e.id)("checked",o.isPermissionSelected(e.code)),s(),h("for","perm-"+e.id),s(),c(e.name)}}function wr(n,t){if(n&1){let e=R();i(0,"div",11)(1,"div",23)(2,"input",24),x("change",function(l){let u=y(e).$implicit,E=m();return A(E.toggleModule(u,l.target.checked))}),r(),i(3,"label",25),a(4),r()(),i(5,"div",26),k(6,Ar,4,4,"div",27,Er),r()()}if(n&2){let e=t.$implicit,o=m();s(2),h("id","module-"+e)("checked",o.isModuleAllSelected(e)),s(),h("for","module-"+e),s(),c(e),s(2),P(o.getPermissionsByModule(e))}}var gt=class n{fb=v(te);roleService=v(Ge);permissionService=v(We);route=v(me);router=v(ve);permissions=[];modules=[];isEdit=!1;roleId="";form=this.fb.group({name:["",D.required],description:[""],permissionCodes:[[]]});ngOnInit(){this.permissionService.getAll().subscribe(t=>{this.permissions=t,this.modules=this.permissionService.getModules()}),this.roleId=this.route.snapshot.paramMap.get("id")??"",this.roleId&&(this.isEdit=!0,this.roleService.getById(this.roleId).subscribe(t=>{t&&this.form.patchValue(T({},t))}))}getPermissionsByModule(t){return this.permissions.filter(e=>e.module===t)}isPermissionSelected(t){return(this.form.value.permissionCodes??[]).includes(t)}togglePermission(t){let e=this.form.value.permissionCodes??[],o=e.includes(t)?e.filter(l=>l!==t):[...e,t];this.form.patchValue({permissionCodes:o})}toggleModule(t,e){let o=this.getPermissionsByModule(t).map(E=>E.code),l=this.form.value.permissionCodes??[],u=e?[...new Set([...l,...o])]:l.filter(E=>!o.includes(E));this.form.patchValue({permissionCodes:u})}isModuleAllSelected(t){return this.getPermissionsByModule(t).map(o=>o.code).every(o=>this.isPermissionSelected(o))}submit(){if(this.form.invalid)return;let t=this.form.value;(this.isEdit?this.roleService.update(this.roleId,t):this.roleService.create(t)).subscribe(()=>this.router.navigate(["/admin/roles"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-role-form"]],decls:36,vars:6,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/roles",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-xl-10"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u4F8B\u5982\uFF1A\u4E3B\u7BA1",1,"form-control"],[1,"text-danger","small","mt-1"],[1,"mb-6"],["type","text","formControlName","description","placeholder","\u7C21\u77ED\u63CF\u8FF0",1,"form-control"],[1,"border","rounded","p-4"],[1,"text-muted","small","mt-1"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/roles",1,"btn","btn-outline-secondary"],[1,"flex","items-center","gap-2","mb-2"],["type","checkbox",1,"form-check-input",3,"change","id","checked"],[1,"form-check-label","fw-600",3,"for"],[1,"flex","flex-wrap","gap-4","ms-4"],[1,"form-check"],[1,"form-check-label","small",3,"for"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"label",12),a(14,"\u89D2\u8272\u540D\u7A31 "),i(15,"span",13),a(16,"*"),r()(),d(17,"input",14),f(18,yr,2,0,"div",15),r(),i(19,"div",16)(20,"label",12),a(21,"\u63CF\u8FF0"),r(),d(22,"input",17),r(),i(23,"div",5)(24,"label",12),a(25,"\u6B0A\u9650"),r(),i(26,"div",18),k(27,wr,8,4,"div",11,xe),r(),i(29,"div",19),a(30),r()()()(),i(31,"div",20)(32,"button",21),a(33),r(),i(34,"a",22),a(35,"\u53D6\u6D88"),r()()()()()()),e&2){let l;s(6),c(o.isEdit?"\u7DE8\u8F2F\u89D2\u8272":"\u65B0\u589E\u89D2\u8272"),s(),h("formGroup",o.form),s(11),b((l=o.form.get("name"))!=null&&l.invalid&&((l=o.form.get("name"))!=null&&l.touched)?18:-1),s(9),P(o.modules),s(3),w(" \u5DF2\u9078\u53D6 ",(o.form.value.permissionCodes==null?null:o.form.value.permissionCodes.length)??0," \u500B\u6B0A\u9650 "),s(2),h("disabled",o.form.invalid),s(),w(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[ie,Q,K,W,Z,ee,X,O],encapsulation:2})};var Tr=n=>[n,"edit"],Fr=(n,t)=>t.id;function Dr(n,t){if(n&1){let e=R();i(0,"tr")(1,"td")(2,"code",19),a(3),r()(),i(4,"td",20),a(5),r(),i(6,"td",21),a(7),r(),i(8,"td",22)(9,"div",23)(10,"a",24),g(),i(11,"svg",7),d(12,"use",25),r()(),S(),i(13,"button",26),x("click",function(){let l=y(e).$implicit,u=m(2);return A(u.delete(l))}),g(),i(14,"svg",7),d(15,"use",27),r()()()()()}if(n&2){let e=t.$implicit;s(3),c(e.code),s(2),c(e.name),s(2),c(e.description??"\u2014"),s(3),h("routerLink",ae(4,Tr,e.id))}}function Ir(n,t){if(n&1&&(i(0,"div",9)(1,"div",10),g(),i(2,"svg",11),d(3,"use",12),r(),a(4),r(),S(),i(5,"div",13)(6,"div",14)(7,"table",15)(8,"thead",16)(9,"tr")(10,"th"),a(11,"\u4EE3\u78BC"),r(),i(12,"th"),a(13,"\u540D\u7A31"),r(),i(14,"th",17),a(15,"\u63CF\u8FF0"),r(),i(16,"th",18),a(17,"\u64CD\u4F5C"),r()()(),i(18,"tbody"),k(19,Dr,16,6,"tr",null,Fr),r()()()()()),n&2){let e=t.$implicit,o=m();s(4),w(" ",e," "),s(15),P(o.getByModule(e))}}var $t=class n{permissionService=v(We);modules=this.permissionService.getModules();allPermissions=[];constructor(){this.permissionService.getAll().subscribe(t=>this.allPermissions=t)}getByModule(t){return this.allPermissions.filter(e=>e.module===t)}delete(t){confirm(`Delete permission "${t.name}"?`)&&this.permissionService.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-permission-list"]],decls:13,vars:0,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#lock"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm","mb-4"],[1,"card-header","bg-[--bg-base]","fw-600","flex","items-center"],[1,"sa-icon","mr-2","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#folder"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"text-right"],[1,"text-primary"],[1,"fw-500"],[1,"text-muted","hidden","md:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u6B0A\u9650\u7BA1\u7406"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u6B0A\u9650 "),r()(),k(11,Ir,21,1,"div",9,xe),r()),e&2&&(s(11),P(o.modules))},dependencies:[O],encapsulation:2})};var _t=class n{fb=v(te);service=v(We);route=v(me);router=v(ve);isEdit=!1;permId="";form=this.fb.group({code:["",D.required],name:["",D.required],module:["",D.required],description:[""]});ngOnInit(){this.permId=this.route.snapshot.paramMap.get("id")??"",this.permId&&(this.isEdit=!0,this.service.getById(this.permId).subscribe(t=>{t&&this.form.patchValue(T({},t))}))}submit(){if(this.form.invalid)return;let t=this.form.value;(this.isEdit?this.service.update(this.permId,t):this.service.create(t)).subscribe(()=>this.router.navigate(["/admin/permissions"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-permission-form"]],decls:46,vars:4,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/permissions",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-8","col-xl-6"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","code","placeholder","module:action",1,"form-control","font-monospace"],[1,"text-muted","small","mt-1"],["type","text","formControlName","name","placeholder","\u986F\u793A\u540D\u7A31",1,"form-control"],["type","text","formControlName","module","placeholder","\u4F8B\u5982\uFF1AUsers\u3001Roles",1,"form-control"],["type","text","formControlName","description","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/permissions",1,"btn","btn-outline-secondary"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"label",12),a(14,"\u4EE3\u78BC "),i(15,"span",13),a(16,"*"),r()(),d(17,"input",14),i(18,"div",15),a(19,"\u4F8B\u5982\uFF1A"),i(20,"code"),a(21,"users:read"),r(),a(22,"\u3001"),i(23,"code"),a(24,"roles:write"),r()()(),i(25,"div",11)(26,"label",12),a(27,"\u540D\u7A31 "),i(28,"span",13),a(29,"*"),r()(),d(30,"input",16),r(),i(31,"div",11)(32,"label",12),a(33,"\u6A21\u7D44 "),i(34,"span",13),a(35,"*"),r()(),d(36,"input",17),r(),i(37,"div",5)(38,"label",12),a(39,"\u63CF\u8FF0"),r(),d(40,"input",18),r()()(),i(41,"div",19)(42,"button",20),a(43),r(),i(44,"a",21),a(45,"\u53D6\u6D88"),r()()()()()()),e&2&&(s(6),c(o.isEdit?"\u7DE8\u8F2F\u6B0A\u9650":"\u65B0\u589E\u6B0A\u9650"),s(),h("formGroup",o.form),s(35),h("disabled",o.form.invalid),s(),w(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," "))},dependencies:[ie,Q,K,W,Z,ee,X,O],encapsulation:2})};var Lr={workStartTime:"09:00",workEndTime:"18:00",monthlyOvertimeLimit:46},Gt=class n{http=v(pe);settings$=new se(Lr);get(){return this.settings$.asObservable()}save(t){let e=T(T({},this.settings$.getValue()),t);return this.settings$.next(e),L(e)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};function kr(n,t){n&1&&(i(0,"div",5),g(),i(1,"svg",24),d(2,"use",26),r(),a(3," \u8A2D\u5B9A\u5DF2\u5132\u5B58\u6210\u529F\u3002 "),r())}function Pr(n,t){n&1&&(i(0,"div",21),a(1,"\u8ACB\u8F38\u5165 0 \u5230 200 \u4E4B\u9593\u7684\u6578\u503C\u3002"),r())}var Ut=class n{fb=v(te);settingsService=v(Gt);saved=!1;form=this.fb.group({workStartTime:["09:00",D.required],workEndTime:["18:00",D.required],monthlyOvertimeLimit:[46,[D.required,D.min(0),D.max(200)]]});ngOnInit(){this.settingsService.get().subscribe(t=>this.form.patchValue(t))}submit(){this.form.invalid||this.settingsService.save(this.form.value).subscribe(()=>{this.saved=!0,setTimeout(()=>this.saved=!1,3e3)})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-settings"]],decls:40,vars:4,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#settings"],[1,"mb-0"],["role","alert",1,"alert","alert-success","flex","items-center","gap-2","mb-6","py-2"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-md-6","col-xl-4"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#clock"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","time","formControlName","workStartTime",1,"form-control"],["type","time","formControlName","workEndTime",1,"form-control"],[1,"text-muted","font-normal"],["type","number","formControlName","monthlyOvertimeLimit","min","0","max","200",1,"form-control"],[1,"text-danger","small","mt-1"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary","inline-flex","items-center","gap-1",3,"disabled"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#save"],["href","/assets/icons/sprite.svg#check-circle"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1),g(),i(2,"svg",2),d(3,"use",3),r(),S(),i(4,"h4",4),a(5,"\u7CFB\u7D71\u8A2D\u5B9A"),r()(),f(6,kr,4,0,"div",5),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10),g(),i(12,"svg",11),d(13,"use",12),r(),a(14," \u5DE5\u4F5C\u6642\u9593 "),r(),S(),i(15,"div",13)(16,"div",14)(17,"label",15),a(18,"\u4E0A\u73ED\u6642\u9593 "),i(19,"span",16),a(20,"*"),r()(),d(21,"input",17),r(),i(22,"div",14)(23,"label",15),a(24,"\u4E0B\u73ED\u6642\u9593 "),i(25,"span",16),a(26,"*"),r()(),d(27,"input",18),r(),i(28,"div",4)(29,"label",15),a(30,"\u6BCF\u6708\u52A0\u73ED\u6642\u6578\u9650\u5236 "),i(31,"span",19),a(32,"\uFF08\u5C0F\u6642\uFF09"),r()(),d(33,"input",20),f(34,Pr,2,0,"div",21),r()()()()(),i(35,"div",22)(36,"button",23),g(),i(37,"svg",24),d(38,"use",25),r(),a(39," \u5132\u5B58\u8A2D\u5B9A "),r()()()()),e&2){let l;s(6),b(o.saved?6:-1),s(),h("formGroup",o.form),s(27),b((l=o.form.get("monthlyOvertimeLimit"))!=null&&l.invalid&&((l=o.form.get("monthlyOvertimeLimit"))!=null&&l.touched)?34:-1),s(2),h("disabled",o.form.invalid)}},dependencies:[ie,Q,K,ge,W,Z,_e,Hi,ee,X],encapsulation:2})};var Rr=n=>[n,"edit"],Br=(n,t)=>t.id;function jr(n,t){n&1&&(i(0,"span",18),a(1,"\u2514"),r())}function Vr(n,t){if(n&1){let e=R();i(0,"tr")(1,"td",17),f(2,jr,2,0,"span",18),a(3),r(),i(4,"td",19)(5,"code"),a(6),r()(),i(7,"td",20),a(8),r(),i(9,"td",20),a(10),r(),i(11,"td")(12,"span",21),a(13),r()(),i(14,"td",22)(15,"div",23)(16,"a",24),g(),i(17,"svg",7),d(18,"use",25),r()(),S(),i(19,"button",26),x("click",function(){let l=y(e).$implicit,u=m();return A(u.delete(l))}),g(),i(20,"svg",7),d(21,"use",27),r()()()()()}if(n&2){let e=t.$implicit;s(2),b(e.parentId?2:-1),s(),w(" ",e.name," "),s(3),c(e.code??"\u2014"),s(2),c(e.parentName??"\u2014"),s(2),c(e.description??"\u2014"),s(3),w("",e.employeeCount," \u4EBA"),s(3),h("routerLink",ae(7,Rr,e.id))}}function Nr(n,t){n&1&&(i(0,"tr")(1,"td",28),a(2,"\u5C1A\u7121\u90E8\u9580\u8CC7\u6599\u3002"),r()())}var Ht=class n{deptService=v(qe);departments$=this.deptService.getAll();delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u90E8\u9580\u300C${t.name}\u300D\u55CE\uFF1F`)&&this.deptService.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-department-list"]],decls:34,vars:3,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#git-branch"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","sm:table-cell"],[1,"hidden","md:table-cell"],[1,"text-right"],[1,"fw-500"],[1,"text-muted","me-1"],[1,"text-muted","hidden","sm:table-cell"],[1,"text-muted","hidden","md:table-cell"],[1,"badge","bg-info"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","6",1,"text-center","text-muted","py-4"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u90E8\u9580\u7BA1\u7406"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u90E8\u9580 "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u90E8\u9580\u540D\u7A31"),r(),i(19,"th",14),a(20,"\u4EE3\u78BC"),r(),i(21,"th",15),a(22,"\u6BCD\u90E8\u9580"),r(),i(23,"th",15),a(24,"\u63CF\u8FF0"),r(),i(25,"th"),a(26,"\u4EBA\u6578"),r(),i(27,"th",16),a(28,"\u64CD\u4F5C"),r()()(),i(29,"tbody"),k(30,Vr,22,9,"tr",null,Br,!1,Nr,3,0,"tr"),B(33,"async"),r()()()()()()),e&2&&(s(30),P(Be(33,1,o.departments$)))},dependencies:[O,Oe],encapsulation:2})};var Or=(n,t)=>t.id;function qr(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165\u90E8\u9580\u540D\u7A31\u3002"),r())}function Mr(n,t){if(n&1&&(i(0,"option",18),a(1),r()),n&2){let e=t.$implicit;h("ngValue",e.id),s(),c(e.name)}}var xt=class n{fb=v(te);deptService=v(qe);route=v(me);router=v(ve);departments=[];isEdit=!1;deptId=0;form=this.fb.group({name:["",D.required],code:[""],description:[""],parentId:[null],sortOrder:[0]});ngOnInit(){this.deptService.getAll().subscribe(e=>this.departments=e);let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.deptId=+t,this.deptService.getById(this.deptId).subscribe(e=>{e&&this.form.patchValue(G(T({},e),{parentId:e.parentId??null}))}))}getAvailableParents(){return this.departments.filter(t=>t.id!==this.deptId)}submit(){if(this.form.invalid)return;let t=this.form.value;(this.isEdit?this.deptService.update(this.deptId,t):this.deptService.create(t)).subscribe(()=>this.router.navigate(["/admin/departments"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-department-form"]],decls:46,vars:6,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/departments",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-8","col-xl-6"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u4F8B\u5982\uFF1A\u7814\u767C\u90E8",1,"form-control"],[1,"text-danger","small","mt-1"],["type","text","formControlName","code","placeholder","\u4F8B\u5982\uFF1ARD",1,"form-control","font-monospace"],["formControlName","parentId",1,"form-select"],[3,"ngValue"],["type","number","formControlName","sortOrder","min","0",1,"form-control"],[1,"text-muted","small","mt-1"],["formControlName","description","rows","2","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/departments",1,"btn","btn-outline-secondary"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"label",12),a(14,"\u90E8\u9580\u540D\u7A31 "),i(15,"span",13),a(16,"*"),r()(),d(17,"input",14),f(18,qr,2,0,"div",15),r(),i(19,"div",11)(20,"label",12),a(21,"\u90E8\u9580\u4EE3\u78BC"),r(),d(22,"input",16),r(),i(23,"div",11)(24,"label",12),a(25,"\u4E0A\u5C64\u90E8\u9580"),r(),i(26,"select",17)(27,"option",18),a(28,"\u2014 \u7121\uFF08\u9802\u5C64\u90E8\u9580\uFF09\u2014"),r(),k(29,Mr,2,2,"option",18,Or),r()(),i(31,"div",11)(32,"label",12),a(33,"\u6392\u5E8F\u865F"),r(),d(34,"input",19),i(35,"div",20),a(36,"\u6578\u5B57\u8D8A\u5C0F\u6392\u8D8A\u524D\u9762\u3002"),r()(),i(37,"div",5)(38,"label",12),a(39,"\u63CF\u8FF0"),r(),d(40,"textarea",21),r()()(),i(41,"div",22)(42,"button",23),a(43),r(),i(44,"a",24),a(45,"\u53D6\u6D88"),r()()()()()()),e&2){let l;s(6),c(o.isEdit?"\u7DE8\u8F2F\u90E8\u9580":"\u65B0\u589E\u90E8\u9580"),s(),h("formGroup",o.form),s(11),b((l=o.form.get("name"))!=null&&l.invalid&&((l=o.form.get("name"))!=null&&l.touched)?18:-1),s(9),h("ngValue",null),s(2),P(o.getAvailableParents()),s(13),h("disabled",o.form.invalid),s(),w(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[ie,Q,Le,ke,K,ge,Ie,W,Z,_e,ee,X,O],encapsulation:2})};var $r=n=>[n,"edit"],Gr=(n,t)=>t.id;function Ur(n,t){if(n&1){let e=R();i(0,"tr")(1,"td",17),a(2),r(),i(3,"td")(4,"span",18),a(5),r()(),i(6,"td",19),a(7),r(),i(8,"td"),a(9),r(),i(10,"td",20),a(11),B(12,"date"),r(),i(13,"td",21)(14,"div",22)(15,"a",23),g(),i(16,"svg",7),d(17,"use",24),r()(),S(),i(18,"button",25),x("click",function(){let l=y(e).$implicit,u=m();return A(u.delete(l))}),g(),i(19,"svg",7),d(20,"use",26),r()()()()()}if(n&2){let e=t.$implicit;s(2),c(e.name),s(3),w("L",e.level),s(2),c(e.description||"\u2014"),s(2),c(e.employeeCount),s(2),c(M(12,6,e.createdAt,"yyyy-MM-dd")),s(4),h("routerLink",ae(9,$r,e.id))}}function Hr(n,t){n&1&&(i(0,"tr")(1,"td",27),a(2,"\u5C1A\u7121\u8077\u7A31\u8CC7\u6599\u3002"),r()())}var Jt=class n{jobTitleService=v(Ue);jobTitles$=this.jobTitleService.getAll();delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u8077\u7A31\u300C${t.name}\u300D\u55CE\uFF1F`)&&this.jobTitleService.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-job-title-list"]],decls:34,vars:3,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#briefcase"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"text-right"],[1,"fw-500"],[1,"badge","bg-secondary-subtle","text-secondary"],[1,"text-muted","hidden","md:table-cell"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","6",1,"text-center","text-muted","py-4"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u8077\u7A31\u7BA1\u7406"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u8077\u7A31 "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u8077\u7A31\u540D\u7A31"),r(),i(19,"th"),a(20,"\u7B49\u7D1A"),r(),i(21,"th",14),a(22,"\u63CF\u8FF0"),r(),i(23,"th"),a(24,"\u54E1\u5DE5\u4EBA\u6578"),r(),i(25,"th",15),a(26,"\u5EFA\u7ACB\u6642\u9593"),r(),i(27,"th",16),a(28,"\u64CD\u4F5C"),r()()(),i(29,"tbody"),k(30,Ur,21,11,"tr",null,Gr,!1,Hr,3,0,"tr"),B(33,"async"),r()()()()()()),e&2&&(s(30),P(Be(33,1,o.jobTitles$)))},dependencies:[O,Oe,be],encapsulation:2})};function Jr(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165\u8077\u7A31\u540D\u7A31\u3002"),r())}function Yr(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165\u6709\u6548\u7B49\u7D1A\uFF08\u6700\u5C0F\u503C\u70BA 1\uFF09\u3002"),r())}var ht=class n{fb=v(te);jobTitleService=v(Ue);route=v(me);router=v(ve);isEdit=!1;jobTitleId=0;form=this.fb.group({name:["",D.required],level:[1,[D.required,D.min(1)]],description:[""]});ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.jobTitleId=+t,this.jobTitleService.getById(this.jobTitleId).subscribe(e=>{e&&this.form.patchValue(e)}))}submit(){if(this.form.invalid)return;let t=this.form.value;(this.isEdit?this.jobTitleService.update(this.jobTitleId,t):this.jobTitleService.create(t)).subscribe(()=>this.router.navigate(["/admin/job-titles"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-job-title-form"]],decls:37,vars:6,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/job-titles",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-6","col-xl-4"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u4F8B\u5982\uFF1A\u8CC7\u6DF1\u5DE5\u7A0B\u5E2B",1,"form-control"],[1,"text-danger","small","mt-1"],["type","number","formControlName","level","min","1","placeholder","\u4F8B\u5982\uFF1A2",1,"form-control"],[1,"text-muted","small","mt-1"],["formControlName","description","rows","2","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/job-titles",1,"btn","btn-outline-secondary"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"label",12),a(14,"\u8077\u7A31\u540D\u7A31 "),i(15,"span",13),a(16,"*"),r()(),d(17,"input",14),f(18,Jr,2,0,"div",15),r(),i(19,"div",11)(20,"label",12),a(21,"\u7B49\u7D1A "),i(22,"span",13),a(23,"*"),r()(),d(24,"input",16),i(25,"div",17),a(26,"\u6578\u5B57\u8D8A\u5927\u7B49\u7D1A\u8D8A\u9AD8\u3002"),r(),f(27,Yr,2,0,"div",15),r(),i(28,"div",5)(29,"label",12),a(30,"\u63CF\u8FF0"),r(),d(31,"textarea",18),r()()(),i(32,"div",19)(33,"button",20),a(34),r(),i(35,"a",21),a(36,"\u53D6\u6D88"),r()()()()()()),e&2){let l,u;s(6),c(o.isEdit?"\u7DE8\u8F2F\u8077\u7A31":"\u65B0\u589E\u8077\u7A31"),s(),h("formGroup",o.form),s(11),b((l=o.form.get("name"))!=null&&l.invalid&&((l=o.form.get("name"))!=null&&l.touched)?18:-1),s(9),b((u=o.form.get("level"))!=null&&u.invalid&&((u=o.form.get("level"))!=null&&u.touched)?27:-1),s(6),h("disabled",o.form.invalid),s(),w(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[ie,Q,K,ge,W,Z,_e,ee,X,O],encapsulation:2})};var zr=[{id:1,name:"\u8ACB\u5047\u7533\u8ACB",code:"leave_request",description:"\u54E1\u5DE5\u8ACB\u5047\u9700\u7D93\u4E3B\u7BA1\u5BE9\u6838",isActive:!0,applicationType:"leave",steps:[{id:1,stepOrder:1,departmentId:1,departmentName:"\u7BA1\u7406\u90E8",jobTitleId:4,jobTitleName:"\u90E8\u9580\u4E3B\u7BA1",note:"\u76F4\u5C6C\u4E3B\u7BA1\u6838\u53EF"},{id:2,stepOrder:2,departmentId:1,departmentName:"\u7BA1\u7406\u90E8",jobTitleId:4,jobTitleName:"\u90E8\u9580\u4E3B\u7BA1",note:"\u4EBA\u4E8B\u90E8\u9580\u78BA\u8A8D"}],createdAt:new Date("2024-01-01")},{id:2,name:"\u63A1\u8CFC\u7533\u8ACB",code:"purchase_request",description:"\u7269\u54C1\u63A1\u8CFC\u9700\u9010\u7D1A\u5BE9\u6838",isActive:!0,applicationType:"payment_request",steps:[{id:3,stepOrder:1,jobTitleId:4,jobTitleName:"\u90E8\u9580\u4E3B\u7BA1",note:"\u90E8\u9580\u4E3B\u7BA1\u5BE9\u6838"},{id:4,stepOrder:2,departmentId:1,departmentName:"\u7BA1\u7406\u90E8",jobTitleId:4,jobTitleName:"\u90E8\u9580\u4E3B\u7BA1",note:"\u7BA1\u7406\u90E8\u6838\u51C6"}],createdAt:new Date("2024-01-01")}],at=class n{http=v(pe);items$=new se(zr);getAll(){return this.items$.asObservable()}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=G(T({},t),{id:Date.now(),steps:[],createdAt:new Date});return this.items$.next([...this.items$.getValue(),e]),L(e)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}addStep(t,e){let o=G(T({},e),{id:Date.now()}),l=this.items$.getValue().map(u=>u.id===t?G(T({},u),{steps:[...u.steps,o].sort((E,F)=>E.stepOrder-F.stepOrder)}):u);return this.items$.next(l),L(l.find(u=>u.id===t))}updateStep(t,e,o){let l=this.items$.getValue().map(u=>{if(u.id!==t)return u;let E=u.steps.map(F=>F.id===e?T(T({},F),o):F).sort((F,j)=>F.stepOrder-j.stepOrder);return G(T({},u),{steps:E})});return this.items$.next(l),L(l.find(u=>u.id===t))}deleteStep(t,e){let o=this.items$.getValue().map(l=>l.id===t?G(T({},l),{steps:l.steps.filter(u=>u.id!==e)}):l);return this.items$.next(o),L(o.find(l=>l.id===t))}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var Xe={payment_request:"\u8ACB\u6B3E\u7533\u8ACB",leave:"\u8ACB\u5047\u7533\u8ACB",travel:"\u51FA\u5DEE\u7533\u8ACB"},et={payment_request:"bg-info-subtle text-info",leave:"bg-success-subtle text-success",travel:"bg-primary-subtle text-primary"};var Kr=n=>[n,"flow"],Wr=(n,t)=>t.id,Zr=(n,t)=>t.value;function Qr(n,t){n&1&&(i(0,"div",30),a(1,"\u8ACB\u8F38\u5165\u9805\u76EE\u540D\u7A31\u3002"),r())}function Xr(n,t){n&1&&(i(0,"div",30),a(1,"\u8ACB\u8F38\u5165\u4EE3\u78BC\u3002"),r())}function ea(n,t){if(n&1&&(i(0,"option",35),a(1),r()),n&2){let e=t.$implicit,o=m(),l=m(2);h("value",e.value)("disabled",l.isTypeDisabled(e.value,o)),s(),z(" ",e.label,"",l.isTypeDisabled(e.value,o)?"\uFF08\u5DF2\u8A2D\u5B9A\uFF09":""," ")}}function ta(n,t){if(n&1&&(i(0,"div",22)(1,"div",26)(2,"label",27),a(3,"\u9805\u76EE\u540D\u7A31 "),i(4,"span",28),a(5,"*"),r()(),d(6,"input",29),f(7,Qr,2,0,"div",30),r(),i(8,"div",31)(9,"label",27),a(10,"\u4EE3\u78BC "),i(11,"span",28),a(12,"*"),r()(),d(13,"input",32),f(14,Xr,2,0,"div",30),r(),i(15,"div",26)(16,"label",27),a(17,"\u63CF\u8FF0"),r(),d(18,"input",33),r(),i(19,"div",26)(20,"label",27),a(21,"\u9069\u7528\u985E\u578B"),r(),i(22,"select",34),k(23,ea,2,4,"option",35,Zr),r()(),i(25,"div",36)(26,"div",37),d(27,"input",38),i(28,"label",39),a(29,"\u555F\u7528"),r()()()()),n&2){let e,o,l=m(2);s(7),b((e=l.form.get("name"))!=null&&e.invalid&&((e=l.form.get("name"))!=null&&e.touched)?7:-1),s(7),b((o=l.form.get("code"))!=null&&o.invalid&&((o=l.form.get("code"))!=null&&o.touched)?14:-1),s(9),P(l.appTypeOptions)}}function ia(n,t){if(n&1){let e=R();i(0,"div",9)(1,"div",19),a(2),r(),i(3,"div",20)(4,"form",21),x("ngSubmit",function(){y(e);let l=m();return A(l.submit())}),f(5,ta,30,2,"div",22),B(6,"async"),i(7,"div",23)(8,"button",24),a(9),r(),i(10,"button",25),x("click",function(){y(e);let l=m();return A(l.closeForm())}),a(11,"\u53D6\u6D88"),r()()()()()}if(n&2){let e,o=m();s(2),w(" ",o.editItem?"\u7DE8\u8F2F\u7C3D\u6838\u9805\u76EE":"\u65B0\u589E\u7C3D\u6838\u9805\u76EE"," "),s(2),h("formGroup",o.form),s(),b((e=Be(6,5,o.items$))?5:-1,e),s(3),h("disabled",o.form.invalid),s(),w(" ",o.editItem?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}}function na(n,t){if(n&1&&(i(0,"span"),a(1),r()),n&2){let e=m().$implicit,o=m();re("badge "+o.appTypeClasses[e.applicationType]),s(),w(" ",o.appTypeLabels[e.applicationType]," ")}}function ra(n,t){n&1&&(i(0,"span",41),a(1,"\u901A\u7528"),r())}function aa(n,t){if(n&1){let e=R();i(0,"tr")(1,"td",40),a(2),r(),i(3,"td")(4,"code",41),a(5),r()(),i(6,"td",15),f(7,na,2,3,"span",42)(8,ra,2,0,"span",41),r(),i(9,"td",43),a(10),r(),i(11,"td")(12,"span",44),a(13),r()(),i(14,"td")(15,"span"),a(16),r()(),i(17,"td",45),a(18),B(19,"date"),r(),i(20,"td",46)(21,"div",47)(22,"a",48),g(),i(23,"svg",7),d(24,"use",49),r()(),S(),i(25,"button",50),x("click",function(){let l=y(e).$implicit,u=m();return A(u.openEdit(l))}),g(),i(26,"svg",7),d(27,"use",51),r()(),S(),i(28,"button",52),x("click",function(){let l=y(e).$implicit,u=m();return A(u.delete(l))}),g(),i(29,"svg",7),d(30,"use",53),r()()()()()}if(n&2){let e=t.$implicit;s(2),c(e.name),s(3),c(e.code),s(2),b(e.applicationType?7:8),s(3),c(e.description||"\u2014"),s(3),w("",e.steps.length," \u6B65"),s(2),re("badge "+(e.isActive?"bg-success-subtle text-success":"bg-secondary-subtle text-secondary")),s(),w(" ",e.isActive?"\u555F\u7528":"\u505C\u7528"," "),s(2),c(M(19,10,e.createdAt,"yyyy-MM-dd")),s(4),h("routerLink",ae(13,Kr,e.id))}}function oa(n,t){n&1&&(i(0,"tr")(1,"td",54),a(2,"\u5C1A\u7121\u7C3D\u6838\u9805\u76EE\u3002"),r()())}var Yt=class n{approvalService=v(at);fb=v(te);items$=this.approvalService.getAll();showForm=!1;editItem=null;appTypeLabels=Xe;appTypeClasses=et;appTypeOptions=[{value:"",label:"\u901A\u7528\uFF08\u4E0D\u7D81\u5B9A\uFF09"},{value:"payment_request",label:"\u8ACB\u6B3E\u7533\u8ACB"},{value:"leave",label:"\u8ACB\u5047\u7533\u8ACB"},{value:"travel",label:"\u51FA\u5DEE\u7533\u8ACB"}];form=this.fb.group({name:["",D.required],code:["",D.required],description:[""],isActive:[!0],applicationType:[""]});openCreate(){this.editItem=null,this.form.reset({isActive:!0,applicationType:""}),this.showForm=!0}openEdit(t){this.editItem=t,this.form.patchValue(G(T({},t),{applicationType:t.applicationType??""})),this.showForm=!0}closeForm(){this.showForm=!1}isTypeDisabled(t,e){return t?e.some(o=>o.applicationType===t&&o.id!==this.editItem?.id):!1}submit(){if(this.form.invalid)return;let t=this.form.value,e=G(T({},t),{applicationType:t.applicationType||void 0});(this.editItem?this.approvalService.update(this.editItem.id,e):this.approvalService.create(e)).subscribe(()=>this.showForm=!1)}delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u7C3D\u6838\u9805\u76EE\u300C${t.name}\u300D\u55CE\uFF1F`)&&this.approvalService.delete(t.id).subscribe()}toggleActive(t){this.approvalService.update(t.id,{isActive:!t.isActive}).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-approval-list"]],decls:39,vars:4,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#check-square"],[1,"mb-0"],[1,"btn","btn-primary","inline-flex","items-center","gap-1",3,"click"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm","mb-6"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","xl:table-cell"],[1,"hidden","lg:table-cell"],[1,"text-right"],[1,"card-header","bg-transparent","fw-500"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"flex","gap-2","mt-4"],["type","submit",1,"btn","btn-primary","btn-sm",3,"disabled"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"col-12","col-md-3"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","name","placeholder","\u4F8B\u5982\uFF1A\u8ACB\u5047\u7533\u8ACB",1,"form-control"],[1,"text-danger","small","mt-1"],[1,"col-12","col-md-2"],["type","text","formControlName","code","placeholder","\u4F8B\u5982\uFF1Aleave_request",1,"form-control","font-monospace"],["type","text","formControlName","description","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],["formControlName","applicationType",1,"form-select"],[3,"value","disabled"],[1,"col-12","col-md-1","flex","items-end"],[1,"form-check"],["type","checkbox","formControlName","isActive","id","isActive",1,"form-check-input"],["for","isActive",1,"form-check-label"],[1,"fw-500"],[1,"text-muted","small"],[3,"class"],[1,"text-muted","hidden","xl:table-cell"],[1,"badge","bg-info-subtle","text-info"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u7BA1\u7406\u6D41\u7A0B",1,"btn","btn-sm","btn-ghost-info","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#git-merge"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["colspan","8",1,"text-center","text-muted","py-4"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u7C3D\u6838\u7BA1\u7406"),r()(),i(7,"button",6),x("click",function(){return o.openCreate()}),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u9805\u76EE "),r()(),f(11,ia,12,7,"div",9),S(),i(12,"div",10)(13,"div",11)(14,"div",12)(15,"table",13)(16,"thead",14)(17,"tr")(18,"th"),a(19,"\u9805\u76EE\u540D\u7A31"),r(),i(20,"th"),a(21,"\u4EE3\u78BC"),r(),i(22,"th",15),a(23,"\u9069\u7528\u985E\u578B"),r(),i(24,"th",16),a(25,"\u63CF\u8FF0"),r(),i(26,"th"),a(27,"\u6B65\u9A5F\u6578"),r(),i(28,"th"),a(29,"\u72C0\u614B"),r(),i(30,"th",17),a(31,"\u5EFA\u7ACB\u6642\u9593"),r(),i(32,"th",18),a(33,"\u64CD\u4F5C"),r()()(),i(34,"tbody"),k(35,aa,31,15,"tr",null,Wr,!1,oa,3,0,"tr"),B(38,"async"),r()()()()()()),e&2&&(s(11),b(o.showForm?11:-1),s(24),P(Be(38,2,o.items$)))},dependencies:[O,ie,Q,Le,ke,K,$i,Ie,W,Z,ee,X,Oe,be],encapsulation:2})};var Ci=(n,t)=>t.id;function la(n,t){if(n&1&&(i(0,"p",10),a(1),r()),n&2){let e=m();s(),c(e.description)}}function sa(n,t){if(n&1&&(i(0,"option",29),a(1),r()),n&2){let e=t.$implicit;h("ngValue",e.id),s(),c(e.name)}}function ma(n,t){if(n&1&&(i(0,"option",29),a(1),r()),n&2){let e=t.$implicit;h("ngValue",e.id),s(),z("",e.name,"\uFF08L",e.level,"\uFF09")}}function da(n,t){if(n&1){let e=R();i(0,"div",16)(1,"div",19),a(2),r(),i(3,"div",20)(4,"form",21),x("ngSubmit",function(){y(e);let l=m(2);return A(l.submitStep())}),i(5,"div",22)(6,"div",23)(7,"label",24),a(8,"\u6B65\u9A5F\u9806\u5E8F "),i(9,"span",25),a(10,"*"),r()(),d(11,"input",26),r(),i(12,"div",27)(13,"label",24),a(14,"\u90E8\u9580"),r(),i(15,"select",28)(16,"option",29),a(17,"\u2014 \u4E0D\u9650\u90E8\u9580 \u2014"),r(),k(18,sa,2,2,"option",29,Ci),r()(),i(20,"div",27)(21,"label",24),a(22,"\u8077\u7A31"),r(),i(23,"select",30)(24,"option",29),a(25,"\u2014 \u4E0D\u9650\u8077\u7A31 \u2014"),r(),k(26,ma,2,3,"option",29,Ci),r()(),i(28,"div",31)(29,"label",24),a(30,"\u6B65\u9A5F\u8AAA\u660E"),r(),d(31,"input",32),r()(),i(32,"div",33),a(33,"\u90E8\u9580\u6216\u8077\u7A31\u81F3\u5C11\u9078\u4E00\u3002"),r(),i(34,"div",34)(35,"button",35),a(36),r(),i(37,"button",36),x("click",function(){y(e);let l=m(2);return A(l.closeStepForm())}),a(38,"\u53D6\u6D88"),r()()()()()}if(n&2){let e=m(2);s(2),w(" ",e.editStep?"\u7DE8\u8F2F\u6B65\u9A5F":"\u65B0\u589E\u6B65\u9A5F"," "),s(2),h("formGroup",e.stepForm),s(12),h("ngValue",null),s(2),P(e.departments),s(6),h("ngValue",null),s(2),P(e.jobTitles),s(10),w(" ",e.editStep?"\u66F4\u65B0":"\u65B0\u589E"," ")}}function ua(n,t){n&1&&(i(0,"div",17)(1,"div",37),a(2,"\u5C1A\u672A\u8A2D\u5B9A\u4EFB\u4F55\u6B65\u9A5F"),r()())}function ca(n,t){if(n&1&&(i(0,"span",45),g(),i(1,"svg",53),d(2,"use",54),r(),a(3),r()),n&2){let e=m().$implicit;s(3),w(" ",e.departmentName," ")}}function pa(n,t){if(n&1&&(i(0,"span",46),g(),i(1,"svg",53),d(2,"use",55),r(),a(3),r()),n&2){let e=m().$implicit;s(3),w(" ",e.jobTitleName," ")}}function va(n,t){if(n&1&&(i(0,"span",47),a(1),r()),n&2){let e=m().$implicit;s(),c(e.note)}}function fa(n,t){if(n&1){let e=R();i(0,"div",38)(1,"div",39)(2,"div",40),a(3),r()(),i(4,"div",41)(5,"div",42)(6,"div",43)(7,"div",44),f(8,ca,4,1,"span",45),f(9,pa,4,1,"span",46),f(10,va,2,1,"span",47),r(),i(11,"div",48)(12,"button",49),x("click",function(){let l=y(e).$implicit,u=m(3);return A(u.openEditStep(l))}),g(),i(13,"svg",14),d(14,"use",50),r()(),S(),i(15,"button",51),x("click",function(){let l=y(e).$implicit,u=m(3);return A(u.deleteStep(l))}),g(),i(16,"svg",14),d(17,"use",52),r()()()()()()()}if(n&2){let e=t.$implicit;s(3),w(" ",e.stepOrder," "),s(5),b(e.departmentName?8:-1),s(),b(e.jobTitleName?9:-1),s(),b(e.note?10:-1)}}function ba(n,t){if(n&1&&(i(0,"div",18),k(1,fa,18,4,"div",38,Ci),r()),n&2){let e=m();s(),P(e.steps)}}function ga(n,t){if(n&1){let e=R();i(0,"div",2)(1,"div",3)(2,"a",4),g(),i(3,"svg",5),d(4,"use",6),r()(),i(5,"svg",7),d(6,"use",8),r(),S(),i(7,"h4",9),a(8),r(),i(9,"span"),a(10),r()()(),f(11,la,2,1,"p",10),i(12,"div",11)(13,"h6",12),a(14),r(),i(15,"button",13),x("click",function(){y(e);let l=m();return A(l.openAddStep())}),g(),i(16,"svg",14),d(17,"use",15),r(),a(18," \u65B0\u589E\u6B65\u9A5F "),r()(),f(19,da,39,5,"div",16),f(20,ua,3,0,"div",17)(21,ba,3,0,"div",18)}if(n&2){let e=t,o=m();s(8),w("",e.name,"\uFF5C\u7C3D\u6838\u6D41\u7A0B"),s(),re("badge "+(e.isActive?"bg-success-subtle text-success":"bg-secondary-subtle text-secondary")),s(),w(" ",e.isActive?"\u555F\u7528":"\u505C\u7528"," "),s(),b(e.description?11:-1),s(3),w("\u7C3D\u6838\u6B65\u9A5F\uFF08\u5171 ",e.steps.length," \u6B65\uFF09"),s(5),b(o.showStepForm?19:-1),s(),b(e.steps.length===0?20:21)}}function _a(n,t){n&1&&(i(0,"p",1),a(1,"\u627E\u4E0D\u5230\u7C3D\u6838\u9805\u76EE\u3002"),r())}var zt=class n{route=v(me);approvalService=v(at);deptService=v(qe);jobTitleService=v(Ue);fb=v(te);itemId=0;item$=new se(void 0);departments=[];jobTitles=[];showStepForm=!1;editStep=null;stepForm=this.fb.group({stepOrder:[1,[D.required,D.min(1)]],departmentId:[null],jobTitleId:[null],note:[""]});ngOnInit(){this.itemId=+(this.route.snapshot.paramMap.get("id")??0),this.approvalService.getById(this.itemId).subscribe(t=>this.item$.next(t)),this.deptService.getAll().pipe(xi(1)).subscribe(t=>this.departments=t),this.jobTitleService.getAll().pipe(xi(1)).subscribe(t=>this.jobTitles=t)}openAddStep(){this.editStep=null;let t=(this.item$.getValue()?.steps.length??0)+1;this.stepForm.reset({stepOrder:t,departmentId:null,jobTitleId:null,note:""}),this.showStepForm=!0}openEditStep(t){this.editStep=t,this.stepForm.patchValue({stepOrder:t.stepOrder,departmentId:t.departmentId??null,jobTitleId:t.jobTitleId??null,note:t.note??""}),this.showStepForm=!0}closeStepForm(){this.showStepForm=!1}submitStep(){if(this.stepForm.invalid)return;let t=this.stepForm.value,e=t.departmentId||void 0,o=t.jobTitleId||void 0;if(!e&&!o){alert("\u90E8\u9580\u6216\u8077\u7A31\u81F3\u5C11\u9078\u4E00\u3002");return}let l=e?this.departments.find(j=>j.id===e)?.name:void 0,u=o?this.jobTitles.find(j=>j.id===o)?.name:void 0,E={stepOrder:t.stepOrder,departmentId:e,departmentName:l,jobTitleId:o,jobTitleName:u,note:t.note??""};(this.editStep?this.approvalService.updateStep(this.itemId,this.editStep.id,E):this.approvalService.addStep(this.itemId,E)).subscribe(j=>{this.item$.next(j),this.showStepForm=!1})}deleteStep(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u6B65\u9A5F ${t.stepOrder} \u55CE\uFF1F`)&&this.approvalService.deleteStep(this.itemId,t.id).subscribe(e=>this.item$.next(e))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-approval-flow"]],decls:4,vars:3,consts:[[1,"container-fluid","py-3"],[1,"text-muted"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],["routerLink","/admin/approvals",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#git-merge"],[1,"mb-0"],[1,"text-muted","small","mb-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"mb-0","text-muted"],[1,"btn","btn-outline-primary","btn-sm","inline-flex","items-center","gap-1",3,"click"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm","mb-6"],[1,"card","border-0","shadow-sm"],[1,"flex","flex-col","gap-2"],[1,"card-header","bg-transparent","fw-500"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"col-6","col-md-2"],[1,"form-label","fw-500"],[1,"text-danger"],["type","number","formControlName","stepOrder","min","1",1,"form-control"],[1,"col-12","col-md-4"],["formControlName","departmentId",1,"form-select"],[3,"ngValue"],["formControlName","jobTitleId",1,"form-select"],[1,"col-12","col-md-6"],["type","text","formControlName","note","placeholder","\u9078\u586B\u8AAA\u660E",1,"form-control"],[1,"text-muted","small","mt-2"],[1,"flex","gap-2","mt-4"],["type","submit",1,"btn","btn-primary","btn-sm"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"card-body","text-center","text-muted","py-5"],[1,"flex","gap-3","items-center"],[1,"flex","flex-col","items-center","shrink-0",2,"width","36px"],[1,"rounded-circle","bg-primary","text-white","flex","items-center","justify-center","font-bold",2,"width","32px","height","32px","font-size",".85rem"],[1,"card","border-0","shadow-sm","grow","min-w-0","mb-0"],[1,"card-body","py-2","px-3"],[1,"flex","items-center","justify-between","flex-wrap","gap-2"],[1,"flex","flex-wrap","gap-2","items-center"],[1,"badge","bg-primary-subtle","text-primary","inline-flex","items-center","gap-1",2,"white-space","nowrap"],[1,"badge","bg-warning-subtle","text-warning-emphasis","inline-flex","items-center","gap-1",2,"white-space","nowrap"],[1,"text-muted","small"],[1,"flex","gap-1"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],[1,"sa-icon",2,"width","12px","height","12px","flex-shrink","0","stroke","currentColor"],["href","/assets/icons/sprite.svg#git-branch"],["href","/assets/icons/sprite.svg#briefcase"]],template:function(e,o){if(e&1&&(i(0,"div",0),f(1,ga,22,8),B(2,"async"),Bt(3,_a,2,0,"p",1),r()),e&2){let l;s(),b((l=Be(2,1,o.item$))?1:3,l)}},dependencies:[O,ie,Q,Le,ke,K,ge,Ie,W,Z,_e,ee,X,Oe],encapsulation:2})};var xa=[{id:1,code:"P2024-001",status:"closed",departmentId:3,departmentName:"\u696D\u52D9\u90E8",budgetAmount:5e5,actualAmount:48e4,businessAmount:45e4,googleDriveUrl:"https://drive.google.com/drive/folders/example1",createdAt:new Date("2024-03-01")},{id:2,code:"P2024-002",status:"active",departmentId:2,departmentName:"\u8CC7\u8A0A\u90E8",budgetAmount:12e5,actualAmount:0,businessAmount:11e5,googleDriveUrl:"https://drive.google.com/drive/folders/example2",createdAt:new Date("2024-06-15")},{id:3,code:"P2025-001",status:"active",departmentId:1,departmentName:"\u7BA1\u7406\u90E8",budgetAmount:3e5,actualAmount:28e4,businessAmount:25e4,googleDriveUrl:"https://drive.google.com/drive/folders/example3",createdAt:new Date("2025-01-10")},{id:4,code:"P2024-003",status:"closed",departmentId:3,departmentName:"\u696D\u52D9\u90E8",budgetAmount:75e4,actualAmount:62e4,businessAmount:7e5,createdAt:new Date("2024-04-20")},{id:5,code:"P2024-004",status:"closed",departmentId:2,departmentName:"\u8CC7\u8A0A\u90E8",budgetAmount:98e4,actualAmount:95e4,businessAmount:9e5,googleDriveUrl:"https://drive.google.com/drive/folders/example5",createdAt:new Date("2024-05-08")},{id:6,code:"P2024-005",status:"closed",departmentId:4,departmentName:"\u8CA1\u52D9\u90E8",budgetAmount:42e4,actualAmount:39e4,businessAmount:38e4,createdAt:new Date("2024-07-22")},{id:7,code:"P2024-006",status:"active",departmentId:3,departmentName:"\u696D\u52D9\u90E8",budgetAmount:15e5,actualAmount:12e5,businessAmount:14e5,googleDriveUrl:"https://drive.google.com/drive/folders/example7",createdAt:new Date("2024-08-05")},{id:8,code:"P2024-007",status:"closed",departmentId:1,departmentName:"\u7BA1\u7406\u90E8",budgetAmount:2e5,actualAmount:18e4,businessAmount:16e4,createdAt:new Date("2024-09-12")},{id:9,code:"P2024-008",status:"active",departmentId:2,departmentName:"\u8CC7\u8A0A\u90E8",budgetAmount:65e4,actualAmount:6e5,businessAmount:58e4,googleDriveUrl:"https://drive.google.com/drive/folders/example9",createdAt:new Date("2024-10-01")},{id:10,code:"P2024-009",status:"active",departmentId:4,departmentName:"\u8CA1\u52D9\u90E8",budgetAmount:88e4,actualAmount:0,businessAmount:85e4,createdAt:new Date("2024-11-18")},{id:11,code:"P2024-010",status:"active",departmentId:3,departmentName:"\u696D\u52D9\u90E8",budgetAmount:34e4,actualAmount:32e4,businessAmount:31e4,googleDriveUrl:"https://drive.google.com/drive/folders/example11",createdAt:new Date("2024-12-03")},{id:12,code:"P2025-002",status:"active",departmentId:2,departmentName:"\u8CC7\u8A0A\u90E8",budgetAmount:16e5,actualAmount:8e5,businessAmount:15e5,createdAt:new Date("2025-02-14")},{id:13,code:"P2025-003",status:"active",departmentId:1,departmentName:"\u7BA1\u7406\u90E8",budgetAmount:45e4,actualAmount:44e4,businessAmount:42e4,googleDriveUrl:"https://drive.google.com/drive/folders/example13",createdAt:new Date("2025-03-07")},{id:14,code:"P2025-004",status:"active",departmentId:4,departmentName:"\u8CA1\u52D9\u90E8",budgetAmount:72e4,actualAmount:68e4,businessAmount:7e5,createdAt:new Date("2025-04-22")},{id:15,code:"P2025-005",status:"active",departmentId:3,departmentName:"\u696D\u52D9\u90E8",budgetAmount:29e4,actualAmount:26e4,businessAmount:27e4,googleDriveUrl:"https://drive.google.com/drive/folders/example15",createdAt:new Date("2025-05-30")},{id:16,code:"P2025-006",status:"active",departmentId:2,departmentName:"\u8CC7\u8A0A\u90E8",budgetAmount:11e5,actualAmount:0,businessAmount:105e4,createdAt:new Date("2025-06-11")},{id:17,code:"P2025-007",status:"active",departmentId:1,departmentName:"\u7BA1\u7406\u90E8",budgetAmount:56e4,actualAmount:53e4,businessAmount:51e4,googleDriveUrl:"https://drive.google.com/drive/folders/example17",createdAt:new Date("2025-07-04")},{id:18,code:"P2025-008",status:"active",departmentId:4,departmentName:"\u8CA1\u52D9\u90E8",budgetAmount:83e4,actualAmount:79e4,businessAmount:8e5,createdAt:new Date("2025-08-19")},{id:19,code:"P2025-009",status:"active",departmentId:3,departmentName:"\u696D\u52D9\u90E8",budgetAmount:41e4,actualAmount:38e4,businessAmount:39e4,googleDriveUrl:"https://drive.google.com/drive/folders/example19",createdAt:new Date("2025-09-25")},{id:20,code:"P2025-010",status:"active",departmentId:2,departmentName:"\u8CC7\u8A0A\u90E8",budgetAmount:135e4,actualAmount:11e5,businessAmount:13e5,createdAt:new Date("2025-10-08")},{id:21,code:"P2025-011",status:"active",departmentId:1,departmentName:"\u7BA1\u7406\u90E8",budgetAmount:67e4,actualAmount:65e4,businessAmount:63e4,googleDriveUrl:"https://drive.google.com/drive/folders/example21",createdAt:new Date("2025-11-15")},{id:22,code:"P2026-001",status:"active",departmentId:4,departmentName:"\u8CA1\u52D9\u90E8",budgetAmount:92e4,actualAmount:0,businessAmount:88e4,createdAt:new Date("2026-01-06")},{id:23,code:"P2026-002",status:"active",departmentId:3,departmentName:"\u696D\u52D9\u90E8",budgetAmount:58e4,actualAmount:2e5,businessAmount:55e4,googleDriveUrl:"https://drive.google.com/drive/folders/example23",createdAt:new Date("2026-02-01")}],Me=class n{http=v(pe);items$=new se(xa);getAll(){return this.items$.asObservable()}getPaged(t,e){let o=this.items$.getValue(),l=(t-1)*e,u=Math.max(1,Math.ceil(o.length/e));return L({items:o.slice(l,l+e),totalCount:o.length,page:t,pageSize:e,totalPages:u})}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=G(T({},t),{id:Date.now(),createdAt:new Date});return this.items$.next([...this.items$.getValue(),e]),L(e)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var Ji={active:"\u9032\u884C\u4E2D",closed:"\u5DF2\u7D50\u6848"},Yi={active:"bg-success-subtle text-success",closed:"bg-secondary-subtle text-secondary"};var ha=n=>[n,"edit"],Sa=(n,t)=>t.id;function Ca(n,t){if(n&1&&(i(0,"span",18),a(1),r()),n&2){let e=m().$implicit;s(),c(e.departmentName)}}function Ea(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function ya(n,t){if(n&1&&(a(0),B(1,"number")),n&2){let e=m().$implicit;w(" ",M(1,1,e.budgetAmount,"1.0-0")," ")}}function Aa(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function wa(n,t){if(n&1&&(a(0),B(1,"number")),n&2){let e=m().$implicit;w(" ",M(1,1,e.actualAmount,"1.0-0")," ")}}function Ta(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function Fa(n,t){if(n&1&&(a(0),B(1,"number")),n&2){let e=m().$implicit;w(" ",M(1,1,e.businessAmount,"1.0-0")," ")}}function Da(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function Ia(n,t){if(n&1&&(i(0,"a",20),g(),i(1,"svg",27),d(2,"use",28),r(),a(3," \u958B\u555F "),r()),n&2){let e=m().$implicit;h("href",e.googleDriveUrl,ze)}}function La(n,t){n&1&&(i(0,"span",19),a(1,"\u2014"),r())}function ka(n,t){if(n&1){let e=R();i(0,"tr")(1,"td",17),a(2),r(),i(3,"td")(4,"span"),a(5),r()(),i(6,"td"),f(7,Ca,2,1,"span",18)(8,Ea,2,0,"span",19),r(),i(9,"td",14),f(10,ya,2,4)(11,Aa,2,0,"span",19),r(),i(12,"td",14),f(13,wa,2,4)(14,Ta,2,0,"span",19),r(),i(15,"td",14),f(16,Fa,2,4)(17,Da,2,0,"span",19),r(),i(18,"td",15),f(19,Ia,4,1,"a",20)(20,La,2,0,"span",19),r(),i(21,"td",21)(22,"div",22)(23,"a",23),g(),i(24,"svg",7),d(25,"use",24),r()(),S(),i(26,"button",25),x("click",function(){let l=y(e).$implicit,u=m();return A(u.delete(l))}),g(),i(27,"svg",7),d(28,"use",26),r()()()()()}if(n&2){let e=t.$implicit,o=m();s(2),c(e.code),s(2),re("badge "+o.statusClass[e.status]),s(),c(o.statusLabel[e.status]),s(2),b(e.departmentName?7:8),s(3),b(e.budgetAmount!=null?10:11),s(3),b(e.actualAmount!=null?13:14),s(3),b(e.businessAmount!=null?16:17),s(3),b(e.googleDriveUrl?19:20),s(4),h("routerLink",ae(10,ha,e.id))}}function Pa(n,t){n&1&&(i(0,"tr")(1,"td",29),a(2,"\u5C1A\u7121\u5C08\u6848\u8CC7\u6599\u3002"),r()())}function Ra(n,t){n&1&&(i(0,"li",37)(1,"span",39),a(2,"\u2026"),r()())}function Ba(n,t){if(n&1){let e=R();i(0,"li",35)(1,"button",36),x("click",function(){y(e);let l=m().$implicit,u=m(2);return A(u.goTo(l))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);q("active",e===o.page()),s(2),c(e)}}function ja(n,t){if(n&1&&f(0,Ra,3,0,"li",37)(1,Ba,3,3,"li",38),n&2){let e=t.$implicit;b(e===-1?0:1)}}function Va(n,t){if(n&1){let e=R();i(0,"div",16)(1,"span",30),a(2),r(),i(3,"div",31)(4,"button",32),x("click",function(){y(e);let l=m();return A(l.prev())}),a(5,"\u2039"),r(),i(6,"span",33),a(7),r(),i(8,"button",32),x("click",function(){y(e);let l=m();return A(l.next())}),a(9,"\u203A"),r()(),i(10,"ul",34)(11,"li",35)(12,"button",36),x("click",function(){y(e);let l=m();return A(l.prev())}),a(13,"\u2039"),r()(),k(14,ja,2,1,null,null,xe),i(16,"li",35)(17,"button",36),x("click",function(){y(e);let l=m();return A(l.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();s(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),s(2),q("disabled",e.page()===1),s(3),z("",e.page()," / ",e.totalPages()),s(),q("disabled",e.page()===e.totalPages()),s(3),q("disabled",e.page()===1),s(3),P(e.pageNumbers()),s(2),q("disabled",e.page()===e.totalPages())}}var Kt=class n{projectService=v(Me);PAGE_SIZE=20;page=he(1);result=we(Pe(this.page).pipe(Te(t=>this.projectService.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedProjects=U(()=>this.result().items);totalCount=U(()=>this.result().totalCount);totalPages=U(()=>this.result().totalPages);pageNumbers=U(()=>Na(this.page(),this.totalPages()));statusLabel=Ji;statusClass=Yi;goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}delete(t){confirm(`\u78BA\u5B9A\u8981\u522A\u9664\u5C08\u6848\u300C${t.code}\u300D\u55CE\uFF1F`)&&this.projectService.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-project-list"]],decls:38,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#folder"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500","font-monospace"],[1,"badge","bg-primary-subtle","text-primary"],[1,"text-muted"],["target","_blank","rel","noopener",1,"inline-flex","items-center","gap-1","text-decoration-none","text-muted","small",3,"href"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],[1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],[1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],[1,"sa-icon",2,"stroke","currentColor","width","14px","height","14px"],["href","/assets/icons/sprite.svg#external-link"],["colspan","8",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u5C08\u6848\u7BA1\u7406"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u5C08\u6848 "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u7DE8\u865F"),r(),i(19,"th"),a(20,"\u72C0\u614B"),r(),i(21,"th"),a(22,"\u90E8\u9580"),r(),i(23,"th",14),a(24,"\u9810\u5B9A\u91D1\u984D"),r(),i(25,"th",14),a(26,"\u5BE6\u969B\u91D1\u984D"),r(),i(27,"th",14),a(28,"\u696D\u52D9\u91D1\u984D"),r(),i(29,"th",15),a(30,"Google Drive"),r(),i(31,"th",14),a(32,"\u64CD\u4F5C"),r()()(),i(33,"tbody"),k(34,ka,29,12,"tr",null,Sa,!1,Pa,3,0,"tr"),r()()(),f(37,Va,19,13,"div",16),r()()()),e&2&&(s(34),P(o.pagedProjects()),s(3),b(o.totalPages()>1?37:-1))},dependencies:[O,De],encapsulation:2})};function Na(n,t){if(t<=9)return Array.from({length:t},(l,u)=>u+1);let e=[],o=0;for(let l=1;l<=t;l++)(l===1||l===t||l>=n-2&&l<=n+2)&&(o&&l-o>1&&e.push(-1),e.push(l),o=l);return e}var Oa=(n,t)=>t.id;function qa(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165\u5C08\u6848\u7DE8\u865F\u3002"),r())}function Ma(n,t){if(n&1&&(i(0,"option",20),a(1),r()),n&2){let e=t.$implicit;h("ngValue",e.id),s(),c(e.name)}}function $a(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u9078\u64C7\u90E8\u9580\u3002"),r())}function Ga(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165\u9810\u5B9A\u91D1\u984D\uFF08\u4E0D\u53EF\u70BA\u8CA0\u6578\uFF09\u3002"),r())}function Ua(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165\u5BE6\u969B\u91D1\u984D\uFF08\u4E0D\u53EF\u70BA\u8CA0\u6578\uFF09\u3002"),r())}function Ha(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165\u696D\u52D9\u91D1\u984D\uFF08\u4E0D\u53EF\u70BA\u8CA0\u6578\uFF09\u3002"),r())}function Ja(n,t){n&1&&(i(0,"div",15),a(1,"\u8ACB\u8F38\u5165 Google Drive \u9023\u7D50\u3002"),r())}var St=class n{fb=v(te);projectService=v(Me);deptService=v(qe);route=v(me);router=v(ve);departments=[];isEdit=!1;projectId=0;form=this.fb.group({code:["",D.required],status:["active",D.required],departmentId:[null,D.required],budgetAmount:[null,[D.required,D.min(0)]],actualAmount:[null,[D.required,D.min(0)]],businessAmount:[null,[D.required,D.min(0)]],googleDriveUrl:["",D.required]});ngOnInit(){this.deptService.getAll().subscribe(e=>this.departments=e);let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.projectId=+t,this.projectService.getById(this.projectId).subscribe(e=>{e&&this.form.patchValue({code:e.code,status:e.status,departmentId:e.departmentId??null,budgetAmount:e.budgetAmount??null,actualAmount:e.actualAmount??null,businessAmount:e.businessAmount??null,googleDriveUrl:e.googleDriveUrl??""})}))}submit(){if(this.form.invalid)return;let t=this.form.value,e=this.departments.find(u=>u.id===t.departmentId),o={code:t.code,status:t.status,departmentId:t.departmentId??void 0,departmentName:e?.name,budgetAmount:t.budgetAmount??void 0,actualAmount:t.actualAmount??void 0,businessAmount:t.businessAmount??void 0,googleDriveUrl:t.googleDriveUrl||void 0};(this.isEdit?this.projectService.update(this.projectId,o):this.projectService.create(o)).subscribe(()=>this.router.navigate(["/admin/projects"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-project-form"]],decls:73,vars:11,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/projects",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-8","col-xl-6"],[1,"card","border-0","shadow-sm"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","code","placeholder","\u4F8B\u5982\uFF1AP2025-001",1,"form-control","font-monospace"],[1,"text-danger","small","mt-1"],["formControlName","status",1,"form-select"],["value","active"],["value","closed"],["formControlName","departmentId",1,"form-select"],[3,"ngValue"],["type","number","formControlName","budgetAmount","min","0",1,"form-control"],["type","number","formControlName","actualAmount","min","0",1,"form-control"],["type","number","formControlName","businessAmount","min","0",1,"form-control"],["type","url","formControlName","googleDriveUrl","placeholder","https://drive.google.com/drive/folders/...",1,"form-control"],[1,"mt-6","flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/projects",1,"btn","btn-outline-secondary"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"div",11)(13,"label",12),a(14,"\u5C08\u6848\u7DE8\u865F "),i(15,"span",13),a(16,"*"),r()(),d(17,"input",14),f(18,qa,2,0,"div",15),r(),i(19,"div",11)(20,"label",12),a(21,"\u72C0\u614B "),i(22,"span",13),a(23,"*"),r()(),i(24,"select",16)(25,"option",17),a(26,"\u9032\u884C\u4E2D"),r(),i(27,"option",18),a(28,"\u5DF2\u7D50\u6848"),r()()(),i(29,"div",11)(30,"label",12),a(31,"\u90E8\u9580 "),i(32,"span",13),a(33,"*"),r()(),i(34,"select",19)(35,"option",20),a(36,"\u2014 \u8ACB\u9078\u64C7\u90E8\u9580 \u2014"),r(),k(37,Ma,2,2,"option",20,Oa),r(),f(39,$a,2,0,"div",15),r(),i(40,"div",11)(41,"label",12),a(42,"\u9810\u5B9A\u91D1\u984D "),i(43,"span",13),a(44,"*"),r()(),d(45,"input",21),f(46,Ga,2,0,"div",15),r(),i(47,"div",11)(48,"label",12),a(49,"\u5BE6\u969B\u91D1\u984D "),i(50,"span",13),a(51,"*"),r()(),d(52,"input",22),f(53,Ua,2,0,"div",15),r(),i(54,"div",11)(55,"label",12),a(56,"\u696D\u52D9\u91D1\u984D "),i(57,"span",13),a(58,"*"),r()(),d(59,"input",23),f(60,Ha,2,0,"div",15),r(),i(61,"div",5)(62,"label",12),a(63,"Google Drive \u9023\u7D50 "),i(64,"span",13),a(65,"*"),r()(),d(66,"input",24),f(67,Ja,2,0,"div",15),r()()(),i(68,"div",25)(69,"button",26),a(70),r(),i(71,"a",27),a(72,"\u53D6\u6D88"),r()()()()()()),e&2){let l,u,E,F,j,Y;s(6),c(o.isEdit?"\u7DE8\u8F2F\u5C08\u6848":"\u65B0\u589E\u5C08\u6848"),s(),h("formGroup",o.form),s(11),b((l=o.form.get("code"))!=null&&l.invalid&&((l=o.form.get("code"))!=null&&l.touched)?18:-1),s(17),h("ngValue",null),s(2),P(o.departments),s(2),b((u=o.form.get("departmentId"))!=null&&u.invalid&&((u=o.form.get("departmentId"))!=null&&u.touched)?39:-1),s(7),b((E=o.form.get("budgetAmount"))!=null&&E.invalid&&((E=o.form.get("budgetAmount"))!=null&&E.touched)?46:-1),s(7),b((F=o.form.get("actualAmount"))!=null&&F.invalid&&((F=o.form.get("actualAmount"))!=null&&F.touched)?53:-1),s(7),b((j=o.form.get("businessAmount"))!=null&&j.invalid&&((j=o.form.get("businessAmount"))!=null&&j.touched)?60:-1),s(7),b((Y=o.form.get("googleDriveUrl"))!=null&&Y.invalid&&((Y=o.form.get("googleDriveUrl"))!=null&&Y.touched)?67:-1),s(2),h("disabled",o.form.invalid),s(),w(" ",o.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}},dependencies:[ie,Q,Le,ke,K,ge,Ie,W,Z,_e,ee,X,O],encapsulation:2})};var Ya=[{id:1,employeeId:"1",type:"vendor",projectId:1,projectCode:"P2024-001",invoices:[{id:"i1",fileName:"invoice_001.jpg",invoiceNo:"AB-12345678",amount:15e3},{id:"i2",fileName:"invoice_002.jpg",invoiceNo:"CD-87654321",amount:8500}],totalAmount:23500,approvalStatus:"approved",createdAt:new Date("2024-04-10")},{id:2,employeeId:"1",type:"travel",projectId:2,projectCode:"P2024-002",invoices:[{id:"i3",fileName:"receipt_hotel.jpg",invoiceNo:"EF-11223344",amount:4200},{id:"i4",fileName:"receipt_train.jpg",invoiceNo:"GH-55667788",amount:980}],totalAmount:5180,approvalStatus:"pending",createdAt:new Date("2024-07-05")},{id:3,employeeId:"2",type:"advance",projectId:3,projectCode:"P2025-001",invoices:[{id:"i5",fileName:"advance_001.jpg",invoiceNo:"IJ-99887766",amount:2e4}],totalAmount:2e4,approvalStatus:"rejected",createdAt:new Date("2025-02-01")}],ot=class n{http=v(pe);auth=v(nt);items$=new se(Ya);getAll(){return this.items$.asObservable()}getPaged(t,e){let o=this.auth.currentUser()?.id,l=this.items$.getValue().filter(F=>F.employeeId===o),u=(t-1)*e,E=Math.max(1,Math.ceil(l.length/e));return L({items:l.slice(u,u+e),totalCount:l.length,page:t,pageSize:e,totalPages:E})}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=this.auth.currentUser()?.id,o=G(T({},t),{id:Date.now(),employeeId:e,createdAt:new Date});return this.items$.next([...this.items$.getValue(),o]),L(o)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var zi={vendor:"\u5EE0\u5546\u8ACB\u6B3E",travel:"\u54E1\u5DE5\u5DEE\u65C5",advance:"\u54E1\u5DE5\u9810\u652F"},Ki={vendor:"bg-info-subtle text-info",travel:"bg-primary-subtle text-primary",advance:"bg-warning-subtle text-warning-emphasis"},Wt={pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},Zt={pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"};var Wi=n=>[n,"edit"],za=(n,t)=>t.id;function Ka(n,t){if(n&1){let e=R();i(0,"a",24),g(),i(1,"svg",7),d(2,"use",25),r()(),S(),i(3,"button",26),x("click",function(){y(e);let l=m().$implicit,u=m();return A(u.delete(l))}),g(),i(4,"svg",7),d(5,"use",27),r()()}if(n&2){let e=m().$implicit;h("routerLink",ae(1,Wi,e.id))}}function Wa(n,t){if(n&1&&(i(0,"a",23),g(),i(1,"svg",7),d(2,"use",28),r()()),n&2){let e=m().$implicit;h("routerLink",ae(1,Wi,e.id))}}function Za(n,t){if(n&1&&(i(0,"tr")(1,"td")(2,"span"),a(3),r()(),i(4,"td",17),a(5),r(),i(6,"td")(7,"span",18),a(8),r()(),i(9,"td",19),a(10),B(11,"number"),r(),i(12,"td")(13,"span"),a(14),r()(),i(15,"td",20),a(16),B(17,"date"),r(),i(18,"td",21)(19,"div",22),f(20,Ka,6,3)(21,Wa,3,3,"a",23),r()()()),n&2){let e=t.$implicit,o=m();s(2),re("badge "+o.typeClass[e.type]),s(),c(o.typeLabel[e.type]),s(2),c(e.projectCode),s(3),w("",e.invoices.length," \u5F35"),s(2),c(M(11,11,e.totalAmount,"1.0-0")),s(3),re("badge "+o.statusClass[e.approvalStatus]),s(),c(o.statusLabel[e.approvalStatus]),s(2),c(M(17,14,e.createdAt,"yyyy-MM-dd")),s(4),b(e.approvalStatus==="pending"||e.approvalStatus==="returned"?20:21)}}function Qa(n,t){n&1&&(i(0,"tr")(1,"td",29),a(2,"\u5C1A\u7121\u8ACB\u6B3E\u7533\u8ACB\u3002"),r()())}function Xa(n,t){n&1&&(i(0,"li",37)(1,"span",39),a(2,"\u2026"),r()())}function eo(n,t){if(n&1){let e=R();i(0,"li",35)(1,"button",36),x("click",function(){y(e);let l=m().$implicit,u=m(2);return A(u.goTo(l))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);q("active",e===o.page()),s(2),c(e)}}function to(n,t){if(n&1&&f(0,Xa,3,0,"li",37)(1,eo,3,3,"li",38),n&2){let e=t.$implicit;b(e===-1?0:1)}}function io(n,t){if(n&1){let e=R();i(0,"div",16)(1,"span",30),a(2),r(),i(3,"div",31)(4,"button",32),x("click",function(){y(e);let l=m();return A(l.prev())}),a(5,"\u2039"),r(),i(6,"span",33),a(7),r(),i(8,"button",32),x("click",function(){y(e);let l=m();return A(l.next())}),a(9,"\u203A"),r()(),i(10,"ul",34)(11,"li",35)(12,"button",36),x("click",function(){y(e);let l=m();return A(l.prev())}),a(13,"\u2039"),r()(),k(14,to,2,1,null,null,xe),i(16,"li",35)(17,"button",36),x("click",function(){y(e);let l=m();return A(l.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();s(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),s(2),q("disabled",e.page()===1),s(3),z("",e.page()," / ",e.totalPages()),s(),q("disabled",e.page()===e.totalPages()),s(3),q("disabled",e.page()===1),s(3),P(e.pageNumbers()),s(2),q("disabled",e.page()===e.totalPages())}}var Qt=class n{service=v(ot);PAGE_SIZE=20;page=he(1);result=we(Pe(this.page).pipe(Te(t=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedRequests=U(()=>this.result().items);totalCount=U(()=>this.result().totalCount);totalPages=U(()=>this.result().totalPages);pageNumbers=U(()=>no(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}typeLabel=zi;typeClass=Ki;statusLabel=Wt;statusClass=Zt;delete(t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u8ACB\u6B3E\u7533\u8ACB\u55CE\uFF1F")&&this.service.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-payment-list"]],decls:36,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprites.svg#dollar-sign"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500","font-monospace"],[1,"badge","bg-secondary-subtle","text-secondary"],[1,"text-right","fw-500"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u6AA2\u8996",1,"btn","btn-sm","btn-ghost-secondary","inline-flex","items-center",3,"routerLink"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["href","/assets/icons/sprite.svg#eye"],["colspan","7",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u8ACB\u6B3E\u7533\u8ACB"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u7533\u8ACB "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u985E\u578B"),r(),i(19,"th"),a(20,"\u5C08\u6848\u7DE8\u865F"),r(),i(21,"th"),a(22,"\u767C\u7968\u6578"),r(),i(23,"th",14),a(24,"\u7E3D\u91D1\u984D"),r(),i(25,"th"),a(26,"\u7C3D\u6838\u72C0\u614B"),r(),i(27,"th",15),a(28,"\u5EFA\u7ACB\u6642\u9593"),r(),i(29,"th",14),a(30,"\u64CD\u4F5C"),r()()(),i(31,"tbody"),k(32,Za,22,17,"tr",null,za,!1,Qa,3,0,"tr"),r()()(),f(35,io,19,13,"div",16),r()()()),e&2&&(s(32),P(o.pagedRequests()),s(3),b(o.totalPages()>1?35:-1))},dependencies:[O,De,be],encapsulation:2})};function no(n,t){if(t<=9)return Array.from({length:t},(l,u)=>u+1);let e=[],o=0;for(let l=1;l<=t;l++)(l===1||l===t||l>=n-2&&l<=n+2)&&(o&&l-o>1&&e.push(-1),e.push(l),o=l);return e}var Et=Jn(qn());function Bo(n,t){let e;return(e=t.get("id"))==null?null:e.value}var jo=(n,t)=>t.id;function Vo(n,t){if(n&1&&(i(0,"p",25),a(1),r()),n&2){let e=m();s(),c(e.projectCode||"\u2014")}}function No(n,t){if(n&1&&(i(0,"option",40),a(1),r()),n&2){let e=t.$implicit;h("ngValue",e.id),s(),z("",e.code,"",e.departmentName?"\uFF08"+e.departmentName+"\uFF09":"")}}function Oo(n,t){n&1&&(i(0,"div",41),a(1,"\u8ACB\u9078\u64C7\u5C08\u6848\u3002"),r())}function qo(n,t){if(n&1&&(i(0,"select",39)(1,"option",40),a(2,"\u2014 \u8ACB\u9078\u64C7\u5C08\u6848 \u2014"),r(),k(3,No,2,3,"option",40,jo),r(),f(5,Oo,2,0,"div",41)),n&2){let e,o=m();s(),h("ngValue",null),s(2),P(o.projects),s(2),b((e=o.form.get("projectId"))!=null&&e.invalid&&((e=o.form.get("projectId"))!=null&&e.touched)?5:-1)}}function Mo(n,t){if(n&1&&(i(0,"div",5)(1,"label",15),a(2,"\u7C3D\u6838\u72C0\u614B"),r(),i(3,"div")(4,"span",42),a(5),r()()()),n&2){let e=m();s(4),re(e.statusClass[e.approvalStatus]),s(),w(" ",e.statusLabel[e.approvalStatus]," ")}}function $o(n,t){n&1&&(i(0,"div",49),a(1,"\u8ACB\u81F3\u5C11\u4E0A\u50B3\u4E00\u5F35\u767C\u7968\u3002"),r())}function Go(n,t){if(n&1){let e=R();i(0,"label",43),g(),i(1,"svg",44),d(2,"use",45),r(),S(),i(3,"span",46),a(4,"\u9EDE\u64CA\u4E0A\u50B3\u767C\u7968\u5716\u6A94"),r(),i(5,"span",47),a(6,"\u652F\u63F4 JPG\u3001PNG\u3001PDF\uFF0C\u53EF\u591A\u9078"),r(),i(7,"input",48),x("change",function(l){y(e);let u=m();return A(u.onFilesSelected(l))}),r()(),f(8,$o,2,0,"div",49)}if(n&2){let e=m();s(8),b(e.showInvoiceError?8:-1)}}function Uo(n,t){n&1&&d(0,"th",33)}function Ho(n,t){if(n&1){let e=R();i(0,"button",61),x("click",function(){let l;y(e);let u=m().$implicit,E=m();return A(E.openPreview((l=u.get("fileName"))==null?null:l.value,(l=u.get("previewUrl"))==null?null:l.value))}),g(),i(1,"svg",62),d(2,"use",27),r(),a(3),r()}if(n&2){let e,o=m().$implicit;s(3),w(" ",(e=o.get("fileName"))==null?null:e.value," ")}}function Jo(n,t){if(n&1&&(i(0,"span",52),g(),i(1,"svg",62),d(2,"use",27),r(),a(3),r()),n&2){let e,o=m().$implicit;s(3),w(" ",(e=o.get("fileName"))==null?null:e.value," ")}}function Yo(n,t){if(n&1&&(i(0,"span",54),a(1),r()),n&2){let e,o=m().$implicit;s(),c(((e=o.get("invoiceNo"))==null?null:e.value)||"\u2014")}}function zo(n,t){n&1&&(i(0,"div",55),d(1,"span",63),a(2," \u8B58\u5225\u4E2D\u2026 "),r())}function Ko(n,t){n&1&&d(0,"input",56)}function Wo(n,t){if(n&1&&(i(0,"span",57),a(1),B(2,"number"),r()),n&2){let e,o=m().$implicit;s(),c(M(2,1,(e=o.get("amount"))==null?null:e.value,"1.0-0"))}}function Zo(n,t){n&1&&(i(0,"div",58),a(1,"\u2014"),r())}function Qo(n,t){n&1&&d(0,"input",59)}function Xo(n,t){if(n&1){let e=R();i(0,"td",60)(1,"button",64),x("click",function(){y(e);let l=m().$index,u=m();return A(u.removeInvoice(l))}),g(),i(2,"svg",65),d(3,"use",66),r()()()}if(n&2){m();let e=Vi(0);s(),h("disabled",e)}}function el(n,t){if(n&1&&(Bi(0),i(1,"tr",35)(2,"td",50),f(3,Ho,4,1,"button",51)(4,Jo,4,1,"span",52),r(),i(5,"td",53),f(6,Yo,2,1,"span",54)(7,zo,3,0,"div",55)(8,Ko,1,0,"input",56),r(),i(9,"td",53),f(10,Wo,3,4,"span",57)(11,Zo,2,0,"div",58)(12,Qo,1,0,"input",59),r(),f(13,Xo,4,1,"td",60),r()),n&2){let e,o,l=t.$implicit,u=t.$index,E=m(),F=ji(E.ocrLoadingIds.has((e=l.get("id"))==null?null:e.value));s(),h("formGroupName",u),s(2),b((o=l.get("previewUrl"))!=null&&o.value?3:4),s(3),b(E.isReadOnly?6:F?7:8),s(4),b(E.isReadOnly?10:F?11:12),s(3),b(E.isReadOnly?-1:13)}}function tl(n,t){if(n&1&&(i(0,"tr")(1,"td",67),a(2,"\u5C1A\u672A\u65B0\u589E\u767C\u7968"),r()()),n&2){let e=m();s(),Rt("colspan",e.isReadOnly?3:4)}}function il(n,t){n&1&&d(0,"td")}function nl(n,t){if(n&1&&(i(0,"tfoot")(1,"tr",30)(2,"td",68),a(3,"\u5408\u8A08"),r(),i(4,"td",69),a(5),B(6,"number"),r(),f(7,il,1,0,"td"),r()()),n&2){let e=m();s(5),c(M(6,2,e.totalAmount,"1.0-0")),s(2),b(e.isReadOnly?-1:7)}}function rl(n,t){n&1&&d(0,"span",71)}function al(n,t){if(n&1&&(i(0,"div",36)(1,"button",70),f(2,rl,1,0,"span",71),a(3),r(),i(4,"a",72),a(5,"\u53D6\u6D88"),r()()),n&2){let e=m();s(),h("disabled",e.form.invalid||e.isAnyOcrPending),s(),b(e.isAnyOcrPending?2:-1),s(),w(" ",e.isReturned?"\u4FEE\u6539\u4E26\u91CD\u9001":e.isEdit?"\u66F4\u65B0":"\u5EFA\u7ACB"," ")}}function ol(n,t){n&1&&(i(0,"div",37)(1,"a",72),a(2,"\u8FD4\u56DE\u5217\u8868"),r()())}function ll(n,t){if(n&1&&d(0,"img",80),n&2){let e=m(2);h("src",e.previewFile.url,ze)}}function sl(n,t){if(n&1&&d(0,"iframe",81),n&2){let e=m(2);h("src",e.previewFile.safeUrl,Pt)}}function ml(n,t){if(n&1&&(i(0,"div",82)(1,"a",83),g(),i(2,"svg",84),d(3,"use",85),r(),a(4," \u4E0B\u8F09\u6A94\u6848 "),r()()),n&2){let e=m(2);s(),h("href",e.previewFile.url,ze)("download",e.previewFile.name)}}function dl(n,t){if(n&1){let e=R();i(0,"div",73),x("click",function(){y(e);let l=m();return A(l.closePreview())}),i(1,"div",74),x("click",function(l){return y(e),A(l.stopPropagation())}),i(2,"div",75)(3,"div",76)(4,"h6",77),a(5),r(),i(6,"button",78),x("click",function(){y(e);let l=m();return A(l.closePreview())}),r()(),i(7,"div",79),f(8,ll,1,1,"img",80)(9,sl,1,1,"iframe",81)(10,ml,5,2,"div",82),r()()()()}if(n&2){let e=m();s(5),c(e.previewFile.name),s(3),b(e.isImageFile(e.previewFile.name)?8:e.isPdfFile(e.previewFile.name)?9:10)}}var yt=class n{fb=v(te);service=v(ot);projects$=v(Me);route=v(me);router=v(ve);cdr=v(qi);sanitizer=v(jt);projects=[];isEdit=!1;isReturned=!1;isReadOnly=!1;requestId=0;showInvoiceError=!1;approvalStatus="pending";projectCode="";ocrLoadingIds=new Set;get isAnyOcrPending(){return this.ocrLoadingIds.size>0}previewFile=null;openPreview(t,e){this.previewFile={name:t,url:e,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(e)}}closePreview(){this.previewFile=null}isImageFile(t){return/\.(jpe?g|png|gif|webp|bmp)$/i.test(t)}isPdfFile(t){return/\.pdf$/i.test(t)}statusLabel=Wt;statusClass=Zt;form=this.fb.group({type:["vendor",D.required],projectId:[null,D.required],invoices:this.fb.array([])});get invoiceArray(){return this.form.get("invoices")}get invoiceControls(){return this.invoiceArray.controls}get totalAmount(){return this.invoiceArray.controls.reduce((t,e)=>t+(+e.get("amount")?.value||0),0)}ngOnInit(){this.projects$.getAll().subscribe(e=>this.projects=e.filter(o=>o.status==="active"));let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.requestId=+t,this.service.getById(this.requestId).subscribe(e=>{e&&(this.approvalStatus=e.approvalStatus,this.isReturned=e.approvalStatus==="returned",this.isReadOnly=e.approvalStatus!=="pending"&&e.approvalStatus!=="returned",this.projectCode=e.projectCode??"",this.isReadOnly&&this.form.disable(),this.form.patchValue({type:e.type,projectId:e.projectId}),e.invoices.forEach(o=>this.invoiceArray.push(this._invoiceGroup(o.id,o.fileName,o.invoiceNo,o.amount,o.previewUrl??""))))}))}async onFilesSelected(t){let e=t.target;if(!e.files?.length)return;let o=Array.from(e.files);e.value="",this.showInvoiceError=!1;let l=o.map(F=>{let j=`${Date.now()}-${Math.random().toString(36).slice(2)}`,Y=URL.createObjectURL(F);return this.ocrLoadingIds.add(j),this.invoiceArray.push(this._invoiceGroup(j,F.name,"",0,Y)),{id:j,file:F}}),[u,E]=await Promise.all([(0,Et.createWorker)(["eng","chi_tra"]),(0,Et.createWorker)(["eng","chi_tra"])]);await E.setParameters({tessedit_pageseg_mode:Et.PSM.SPARSE_TEXT});try{for(let{id:F,file:j}of l)try{let[{data:{text:Y}},{data:{text:Ve}}]=await Promise.all([u.recognize(j),E.recognize(j)]);console.log("[OCR AUTO]",Y),console.log("[OCR SPARSE]",Ve);let ne=this._extractInvoiceData(Y),fe=this._extractInvoiceData(Ve),Ne=ne.invoiceNo||fe.invoiceNo,$e=ne.amount||fe.amount,Se=this.invoiceArray.controls.findIndex(oe=>oe.get("id")?.value===F);Se>=0&&this.invoiceArray.controls[Se].patchValue({invoiceNo:Ne,amount:$e})}catch{}finally{this.ocrLoadingIds.delete(F),this.cdr.markForCheck()}}finally{await Promise.all([u.terminate(),E.terminate()])}}removeInvoice(t){let e=this.invoiceArray.at(t).get("previewUrl")?.value;e?.startsWith("blob:")&&URL.revokeObjectURL(e),this.invoiceArray.removeAt(t)}submit(){if(this.form.invalid)return;if(this.invoiceArray.length===0){this.showInvoiceError=!0;return}this.showInvoiceError=!1;let t=this.form.value,e=this.projects.find(E=>E.id===t.projectId),o=this.invoiceArray.value.map(E=>G(T({},E),{amount:+E.amount})),l={type:t.type,projectId:t.projectId,projectCode:e?.code??"",invoices:o,totalAmount:this.totalAmount,approvalStatus:this.approvalStatus};(this.isEdit?this.service.update(this.requestId,l):this.service.create(l)).subscribe(()=>this.router.navigate(["/admin/payment-requests"]))}_invoiceGroup(t,e,o,l,u=""){return this.fb.group({id:[t],fileName:[e],invoiceNo:[o,D.required],amount:[l,[D.required,D.min(0)]],previewUrl:[u]})}_extractInvoiceData(t){let e=t.match(/[A-Z]{2}[-\s]?\d{8}/),o="";e&&(o=e[0].replace(/[-\s]/g,""));let l=[/(?:|||||)[^0-9]{0,20}([\d,]+)/,/(?:\s*|\s*|\s*\s*|\s*\s*\s*|\s*\s*\s*|\s*)[^0-9]{0,20}([\d,]+)/,/[^0-9]{0,10}([\d,]+)/,/\s*[^0-9]{0,10}([\d,]+)/,/(?:Amount|Total)[^0-9]{0,10}([\d,]+)/i,/NT\$\s*([\d,]+)/,/\$\s*([\d,]+)/],u=0;for(let E of l){let F=t.match(E);if(F){u=parseInt(F[1].replace(/,/g,""),10);break}}return{invoiceNo:o,amount:u}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-payment-form"]],decls:68,vars:10,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/payment-requests",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#dollar-sign"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],[1,"flex","flex-wrap","gap-4","mt-1"],[1,"form-check"],["type","radio","formControlName","type","value","vendor","id","typeVendor",1,"form-check-input"],["for","typeVendor",1,"form-check-label"],["type","radio","formControlName","type","value","travel","id","typeTravel",1,"form-check-input"],["for","typeTravel",1,"form-check-label"],["type","radio","formControlName","type","value","advance","id","typeAdvance",1,"form-check-input"],["for","typeAdvance",1,"form-check-label"],[1,"form-control-plaintext","fw-500","font-monospace","mb-0"],[1,"card","border-0","shadow-sm","mt-6"],["href","/assets/icons/sprite.svg#file-text"],[1,"table-responsive"],[1,"table","table-sm","mb-0"],[1,"table-light"],[2,"min-width","160px"],[2,"min-width","120px"],[2,"width","48px"],["formArrayName","invoices"],[3,"formGroupName"],[1,"mt-6","flex","gap-2"],[1,"mt-6"],["tabindex","-1",1,"modal",2,"display","block","background","rgba(0,0,0,.6)"],["formControlName","projectId",1,"form-select"],[3,"ngValue"],[1,"text-danger","small","mt-1"],[1,"badge","rounded-pill","px-3","py-2"],[1,"flex","flex-col","items-center","justify-center","rounded-3","py-4","px-4","mb-4","text-center",2,"cursor","pointer","border","2px dashed var(--bs-border-color)"],[1,"sa-icon","sa-icon-2x","text-muted","mb-2",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#upload"],[1,"fw-500"],[1,"text-muted","small","mt-1"],["type","file","multiple","","accept","image/*,application/pdf",1,"hidden",3,"change"],[1,"alert","alert-warning","py-2","small","mb-4"],[1,"align-middle","small",2,"max-width","200px","overflow","hidden","text-overflow","ellipsis","white-space","nowrap"],["type","button",1,"btn","btn-link","p-0","text-muted","small","inline-flex","items-center","gap-1",2,"text-decoration","none","max-width","100%","overflow","hidden","text-overflow","ellipsis"],[1,"text-muted","inline-flex","items-center","gap-1"],[1,"align-middle"],[1,"font-monospace","small"],[1,"flex","items-center","gap-2","text-muted","small","py-1"],["formControlName","invoiceNo","placeholder","AB12345678",1,"form-control","form-control-sm","font-monospace"],[1,"small"],[1,"py-1"],["type","number","formControlName","amount","min","0","placeholder","0",1,"form-control","form-control-sm"],[1,"text-right","align-middle"],["type","button",1,"btn","btn-link","p-0","text-muted","small","inline-flex","items-center","gap-1",2,"text-decoration","none","max-width","100%","overflow","hidden","text-overflow","ellipsis",3,"click"],[1,"sa-icon","shrink-0",2,"width","14px","height","14px","stroke","currentColor"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm"],["type","button",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click","disabled"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#x"],[1,"text-center","text-muted","py-4","small"],["colspan","2",1,"text-right","fw-500","small"],[1,"fw-600"],["type","submit",1,"btn","btn-primary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"],["routerLink","/admin/payment-requests",1,"btn","btn-outline-secondary"],["tabindex","-1",1,"modal",2,"display","block","background","rgba(0,0,0,.6)",3,"click"],[1,"modal-dialog","modal-lg","modal-dialog-centered",3,"click"],[1,"modal-content"],[1,"modal-header","py-2"],[1,"modal-title","mb-0","text-truncate"],["type","button",1,"btn-close",3,"click"],[1,"modal-body","p-0","text-center","bg-[--bg-base]"],[1,"img-fluid",2,"max-height","75vh","object-fit","contain",3,"src"],[2,"width","100%","height","75vh","border","0",3,"src"],[1,"p-5"],[1,"btn","btn-primary",3,"href","download"],[1,"sa-icon","me-1",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#download"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10),g(),i(12,"svg",11),d(13,"use",12),r(),a(14," \u57FA\u672C\u8CC7\u8A0A "),r(),S(),i(15,"div",13)(16,"div",14)(17,"label",15),a(18,"\u8ACB\u6B3E\u985E\u578B "),i(19,"span",16),a(20,"*"),r()(),i(21,"div",17)(22,"div",18),d(23,"input",19),i(24,"label",20),a(25,"\u5EE0\u5546\u8ACB\u6B3E"),r()(),i(26,"div",18),d(27,"input",21),i(28,"label",22),a(29,"\u54E1\u5DE5\u5DEE\u65C5"),r()(),i(30,"div",18),d(31,"input",23),i(32,"label",24),a(33,"\u54E1\u5DE5\u9810\u652F"),r()()()(),i(34,"div",14)(35,"label",15),a(36,"\u5C08\u6848 "),i(37,"span",16),a(38,"*"),r()(),f(39,Vo,2,1,"p",25)(40,qo,6,2),r(),f(41,Mo,6,3,"div",5),r()(),i(42,"div",26)(43,"div",10),g(),i(44,"svg",11),d(45,"use",27),r(),a(46," \u767C\u7968 "),r(),S(),i(47,"div",13),f(48,Go,9,1),i(49,"div",28)(50,"table",29)(51,"thead",30)(52,"tr")(53,"th"),a(54,"\u6A94\u6848\u540D\u7A31"),r(),i(55,"th",31),a(56,"\u767C\u7968\u865F\u78BC"),r(),i(57,"th",32),a(58,"\u91D1\u984D"),r(),f(59,Uo,1,0,"th",33),r()(),i(60,"tbody",34),k(61,el,14,6,"tr",35,Bo,!1,tl,3,1,"tr"),r(),f(64,nl,8,5,"tfoot"),r()()()(),f(65,al,6,3,"div",36)(66,ol,3,0,"div",37),r()()()(),f(67,dl,11,2,"div",38)),e&2&&(s(6),c(o.isEdit?o.isReadOnly?"\u6AA2\u8996\u8ACB\u6B3E\u7533\u8ACB":o.isReturned?"\u4FEE\u6539\u8ACB\u6B3E\u7533\u8ACB\uFF08\u9000\u56DE\uFF09":"\u7DE8\u8F2F\u8ACB\u6B3E\u7533\u8ACB":"\u65B0\u589E\u8ACB\u6B3E\u7533\u8ACB"),s(),h("formGroup",o.form),s(32),b(o.isReadOnly?39:40),s(2),b(o.isEdit?41:-1),s(7),b(o.isReadOnly?-1:48),s(11),b(o.isReadOnly?-1:59),s(2),P(o.invoiceControls),s(3),b(o.invoiceControls.length>0?64:-1),s(),b(o.isReadOnly?66:65),s(2),b(o.previewFile?67:-1))},dependencies:[ie,Q,Le,ke,K,ge,Ie,Ke,W,Z,_e,ee,X,Gi,Ui,O,De],encapsulation:2})};var ii={pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},ni={pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"},ri={vendor:"\u5EE0\u5546\u8ACB\u6B3E",travel:"\u54E1\u5DE5\u5DEE\u65C5",advance:"\u54E1\u5DE5\u9810\u652F"},ai={annual:"\u5E74\u5047",personal:"\u4E8B\u5047",sick:"\u75C5\u5047",compensatory:"\u88DC\u4F11"};var ul=(n,t)=>[n,t,"review"],cl=(n,t)=>t.applicationType+t.id;function pl(n,t){if(n&1&&(i(0,"tr")(1,"td")(2,"span"),a(3),r()(),i(4,"td",14),a(5),r(),i(6,"td",15),a(7),r(),i(8,"td")(9,"span"),a(10),r()(),i(11,"td",16),a(12),B(13,"date"),r(),i(14,"td",17)(15,"a",18),g(),i(16,"svg",19),d(17,"use"),r()()()()),n&2){let e=t.$implicit,o=m();s(2),re("badge "+o.appTypeClass[e.applicationType]),s(),w(" ",o.appTypeLabel[e.applicationType]," "),s(2),c(e.submittedBy),s(2),c(o.getSummary(e)),s(2),re("badge "+o.statusClass[e.status]),s(),c(o.statusLabel[e.status]),s(2),c(M(13,13,e.submittedAt,"yyyy-MM-dd")),s(3),re("btn btn-sm inline-flex items-center "+(e.status==="pending"?"btn-ghost-primary":"btn-ghost-secondary")),h("routerLink",Ni(16,ul,e.applicationType,e.id)),s(2),Rt("href",e.status==="pending"?"/assets/icons/sprite.svg#edit":"/assets/icons/sprite.svg#eye")}}function vl(n,t){n&1&&(i(0,"tr")(1,"td",20),a(2,"\u5C1A\u7121\u7C3D\u6838\u4F5C\u696D\u3002"),r()())}function fl(n,t){n&1&&(i(0,"li",28)(1,"span",30),a(2,"\u2026"),r()())}function bl(n,t){if(n&1){let e=R();i(0,"li",26)(1,"button",27),x("click",function(){y(e);let l=m().$implicit,u=m(2);return A(u.goTo(l))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);q("active",e===o.page()),s(2),c(e)}}function gl(n,t){if(n&1&&f(0,fl,3,0,"li",28)(1,bl,3,3,"li",29),n&2){let e=t.$implicit;b(e===-1?0:1)}}function _l(n,t){if(n&1){let e=R();i(0,"div",13)(1,"span",21),a(2),r(),i(3,"div",22)(4,"button",23),x("click",function(){y(e);let l=m();return A(l.prev())}),a(5,"\u2039"),r(),i(6,"span",24),a(7),r(),i(8,"button",23),x("click",function(){y(e);let l=m();return A(l.next())}),a(9,"\u203A"),r()(),i(10,"ul",25)(11,"li",26)(12,"button",27),x("click",function(){y(e);let l=m();return A(l.prev())}),a(13,"\u2039"),r()(),k(14,gl,2,1,null,null,xe),i(16,"li",26)(17,"button",27),x("click",function(){y(e);let l=m();return A(l.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();s(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),s(2),q("disabled",e.page()===1),s(3),z("",e.page()," / ",e.totalPages()),s(),q("disabled",e.page()===e.totalPages()),s(3),q("disabled",e.page()===1),s(3),P(e.pageNumbers()),s(2),q("disabled",e.page()===e.totalPages())}}var oi=class n{service=v(Vt);PAGE_SIZE=20;page=he(1);result=we(Pe(this.page).pipe(Te(t=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedTasks=U(()=>this.result().items);totalCount=U(()=>this.result().totalCount);totalPages=U(()=>this.result().totalPages);pageNumbers=U(()=>xl(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}statusLabel=ii;statusClass=ni;appTypeLabel=Xe;appTypeClass=et;payTypeLabel=ri;leaveTypeLabel=ai;getSummary(t){return t.paymentDetail?`${this.payTypeLabel[t.paymentDetail.paymentType]}\u30FB${t.paymentDetail.projectCode}\uFF08${t.paymentDetail.totalAmount.toLocaleString()} \u5143\uFF09`:t.leaveDetail?`${this.leaveTypeLabel[t.leaveDetail.leaveType]}\u30FB${t.leaveDetail.days} \u5929`:t.travelDetail?`${t.travelDetail.destination}\uFF08${t.travelDetail.estimatedCost.toLocaleString()} \u5143\uFF09`:"\u2014"}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-approval-task-list"]],decls:29,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#check-square"],[1,"mb-0"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"text-right"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500"],[1,"text-muted","small","hidden","md:table-cell"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[3,"routerLink"],[1,"sa-icon",2,"stroke","currentColor"],["colspan","6",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1),g(),i(2,"svg",2),d(3,"use",3),r(),S(),i(4,"h4",4),a(5,"\u7C3D\u6838\u4F5C\u696D"),r()(),i(6,"div",5)(7,"div",6)(8,"div",7)(9,"table",8)(10,"thead",9)(11,"tr")(12,"th"),a(13,"\u985E\u578B"),r(),i(14,"th"),a(15,"\u7533\u8ACB\u4EBA"),r(),i(16,"th",10),a(17,"\u6458\u8981"),r(),i(18,"th"),a(19,"\u72C0\u614B"),r(),i(20,"th",11),a(21,"\u7533\u8ACB\u6642\u9593"),r(),i(22,"th",12),a(23,"\u64CD\u4F5C"),r()()(),i(24,"tbody"),k(25,pl,18,19,"tr",null,cl,!1,vl,3,0,"tr"),r()()(),f(28,_l,19,13,"div",13),r()()()),e&2&&(s(25),P(o.pagedTasks()),s(3),b(o.totalPages()>1?28:-1))},dependencies:[O,be],encapsulation:2})};function xl(n,t){if(t<=9)return Array.from({length:t},(l,u)=>u+1);let e=[],o=0;for(let l=1;l<=t;l++)(l===1||l===t||l>=n-2&&l<=n+2)&&(o&&l-o>1&&e.push(-1),e.push(l),o=l);return e}var hl=(n,t)=>t.id,Sl=(n,t)=>t.stepOrder;function Cl(n,t){if(n&1){let e=R();i(0,"button",38),x("click",function(){y(e);let l=m().$implicit,u=m(4);return A(u.openPreview(l.fileName,l.previewUrl))}),g(),i(1,"svg",39),d(2,"use",25),r(),a(3),r()}if(n&2){let e=m().$implicit;s(3),w(" ",e.fileName," ")}}function El(n,t){if(n&1&&(i(0,"span",35),g(),i(1,"svg",39),d(2,"use",25),r(),a(3),r()),n&2){let e=m().$implicit;s(3),w(" ",e.fileName," ")}}function yl(n,t){if(n&1&&(i(0,"tr")(1,"td",33),f(2,Cl,4,1,"button",34)(3,El,4,1,"span",35),r(),i(4,"td",36),a(5),r(),i(6,"td",37),a(7),B(8,"number"),r()()),n&2){let e=t.$implicit;s(2),b(e.previewUrl?2:3),s(3),c(e.invoiceNo),s(2),c(M(8,3,e.amount,"1.0-0"))}}function Al(n,t){if(n&1&&(i(0,"div",13)(1,"div",14),g(),i(2,"svg",15),d(3,"use",16),r(),a(4," \u8ACB\u6B3E\u7533\u8ACB\u8CC7\u8A0A "),r(),S(),i(5,"div",17)(6,"div",18)(7,"div",19)(8,"div",20),a(9,"\u8ACB\u6B3E\u985E\u578B"),r(),i(10,"span",21),a(11),r()(),i(12,"div",19)(13,"div",20),a(14,"\u5C08\u6848\u7DE8\u865F"),r(),i(15,"span",22),a(16),r()(),i(17,"div",19)(18,"div",20),a(19,"\u7533\u8ACB\u4EBA"),r(),i(20,"span",21),a(21),r()(),i(22,"div",19)(23,"div",20),a(24,"\u7533\u8ACB\u6642\u9593"),r(),i(25,"span",23),a(26),B(27,"date"),r()(),i(28,"div",19)(29,"div",20),a(30,"\u7E3D\u91D1\u984D"),r(),i(31,"span",24),a(32),B(33,"number"),r()()()()(),i(34,"div",12)(35,"div",14),g(),i(36,"svg",15),d(37,"use",25),r(),a(38," \u767C\u7968\u660E\u7D30 "),r(),S(),i(39,"div",26)(40,"div",27)(41,"table",28)(42,"thead",29)(43,"tr")(44,"th"),a(45,"\u6A94\u6848\u540D\u7A31"),r(),i(46,"th"),a(47,"\u767C\u7968\u865F\u78BC"),r(),i(48,"th",30),a(49,"\u91D1\u984D"),r()()(),i(50,"tbody"),k(51,yl,9,6,"tr",null,hl),r(),i(53,"tfoot")(54,"tr",29)(55,"td",31),a(56,"\u5408\u8A08"),r(),i(57,"td",32),a(58),B(59,"number"),r()()()()()()()),n&2){let e=t,o=m(2),l=m();s(11),c(l.payTypeLabel[e.paymentType]),s(5),c(e.projectCode),s(5),c(o.submittedBy),s(5),c(M(27,6,o.submittedAt,"yyyy-MM-dd")),s(6),c(M(33,9,e.totalAmount,"1.0-0")),s(19),P(e.invoices),s(7),c(M(59,12,e.totalAmount,"1.0-0"))}}function wl(n,t){if(n&1&&f(0,Al,60,15),n&2){let e,o=m();b((e=o.paymentDetail)?0:-1,e)}}function Tl(n,t){if(n&1&&(i(0,"div",13)(1,"div",14),g(),i(2,"svg",15),d(3,"use",40),r(),a(4," \u8ACB\u5047\u7533\u8ACB\u8CC7\u8A0A "),r(),S(),i(5,"div",17)(6,"div",41)(7,"div",19)(8,"div",20),a(9,"\u5047\u5225"),r(),i(10,"span",21),a(11),r()(),i(12,"div",19)(13,"div",20),a(14,"\u7533\u8ACB\u4EBA"),r(),i(15,"span",21),a(16),r()(),i(17,"div",19)(18,"div",20),a(19,"\u5929\u6578"),r(),i(20,"span",24),a(21),r()(),i(22,"div",19)(23,"div",20),a(24,"\u958B\u59CB\u65E5\u671F"),r(),i(25,"span",23),a(26),B(27,"date"),r()(),i(28,"div",19)(29,"div",20),a(30,"\u7D50\u675F\u65E5\u671F"),r(),i(31,"span",23),a(32),B(33,"date"),r()(),i(34,"div",42)(35,"div",20),a(36,"\u8ACB\u5047\u539F\u56E0"),r(),i(37,"div",43),a(38),r()()()()()),n&2){let e=t,o=m(2),l=m();s(11),c(l.leaveTypeLabel[e.leaveType]),s(5),c(o.submittedBy),s(5),w("",e.days," \u5929"),s(5),c(M(27,6,e.startDate,"yyyy-MM-dd")),s(6),c(M(33,9,e.endDate,"yyyy-MM-dd")),s(6),c(e.reason)}}function Fl(n,t){if(n&1&&f(0,Tl,39,12,"div",13),n&2){let e,o=m();b((e=o.leaveDetail)?0:-1,e)}}function Dl(n,t){if(n&1&&(i(0,"div",19)(1,"div",20),a(2,"\u95DC\u806F\u5C08\u6848"),r(),i(3,"span",45),a(4),r()()),n&2){let e=m();s(4),c(e.projectCode)}}function Il(n,t){if(n&1&&(i(0,"div",13)(1,"div",14),g(),i(2,"svg",15),d(3,"use",44),r(),a(4," \u51FA\u5DEE\u7533\u8ACB\u8CC7\u8A0A "),r(),S(),i(5,"div",17)(6,"div",41)(7,"div",19)(8,"div",20),a(9,"\u51FA\u5DEE\u5730\u9EDE"),r(),i(10,"span",21),a(11),r()(),i(12,"div",19)(13,"div",20),a(14,"\u7533\u8ACB\u4EBA"),r(),i(15,"span",21),a(16),r()(),i(17,"div",19)(18,"div",20),a(19,"\u9810\u4F30\u8CBB\u7528"),r(),i(20,"span",24),a(21),B(22,"number"),r()(),i(23,"div",19)(24,"div",20),a(25,"\u51FA\u767C\u65E5\u671F"),r(),i(26,"span",23),a(27),B(28,"date"),r()(),i(29,"div",19)(30,"div",20),a(31,"\u8FD4\u56DE\u65E5\u671F"),r(),i(32,"span",23),a(33),B(34,"date"),r()(),f(35,Dl,5,1,"div",19),i(36,"div",42)(37,"div",20),a(38,"\u51FA\u5DEE\u76EE\u7684"),r(),i(39,"div",43),a(40),r()()()()()),n&2){let e=t,o=m(2);s(11),c(e.destination),s(5),c(o.submittedBy),s(5),w("",M(22,7,e.estimatedCost,"1.0-0")," \u5143"),s(6),c(M(28,10,e.startDate,"yyyy-MM-dd")),s(6),c(M(34,13,e.endDate,"yyyy-MM-dd")),s(2),b(e.projectCode?35:-1),s(5),c(e.purpose)}}function Ll(n,t){if(n&1&&f(0,Il,41,16,"div",13),n&2){let e,o=m();b((e=o.travelDetail)?0:-1,e)}}function kl(n,t){n&1&&(i(0,"span",55),a(1,"\u2713"),r())}function Pl(n,t){n&1&&(i(0,"span",56),a(1,"\u2717"),r())}function Rl(n,t){n&1&&f(0,kl,2,0,"span",55)(1,Pl,2,0,"span",56),n&2&&b(t.action==="approved"?0:1)}function Bl(n,t){if(n&1&&(i(0,"span",50),a(1),r()),n&2){let e=m().$implicit;s(),c(e.stepOrder)}}function jl(n,t){if(n&1&&(i(0,"span",51),a(1),r()),n&2){let e=m().$implicit;s(),c(e.stepOrder)}}function Vl(n,t){if(n&1&&(i(0,"span",53),a(1),r()),n&2){let e=m().$implicit;s(),w("\uFF08",e.departmentName,"\uFF09")}}function Nl(n,t){if(n&1&&(i(0,"div",23),a(1),r()),n&2){let e=m().$implicit;s(),c(e.note)}}function Ol(n,t){n&1&&(i(0,"span",58),a(1,"\u5DF2\u6838\u51C6"),r())}function ql(n,t){n&1&&(i(0,"span",59),a(1,"\u9000\u56DE\u4FEE\u6539"),r())}function Ml(n,t){n&1&&(i(0,"span",60),a(1,"\u5DF2\u62D2\u7D55"),r())}function $l(n,t){if(n&1&&(i(0,"div",61),a(1),r()),n&2){let e=m();s(),w("\u300C",e.reviewNote,"\u300D")}}function Gl(n,t){if(n&1&&(i(0,"div",57),a(1),B(2,"date"),f(3,Ol,2,0,"span",58)(4,ql,2,0,"span",59)(5,Ml,2,0,"span",60),r(),f(6,$l,2,1,"div",61)),n&2){let e=t;s(),z(" ",e.reviewedBy," \xB7 ",M(2,4,e.reviewedAt,"yyyy-MM-dd")," \xB7 "),s(2),b(e.action==="approved"?3:e.action==="returned"?4:5),s(3),b(e.reviewNote?6:-1)}}function Ul(n,t){n&1&&(i(0,"div",54),a(1,"\u5BE9\u6838\u4E2D\u2026"),r())}function Hl(n,t){if(n&1&&(i(0,"li",49),f(1,Rl,2,1)(2,Bl,2,1,"span",50)(3,jl,2,1,"span",51),i(4,"div",52)(5,"div",21),a(6),f(7,Vl,2,1,"span",53),r(),f(8,Nl,2,1,"div",23),f(9,Gl,7,7)(10,Ul,2,0,"div",54),r()()),n&2){let e,o,l=t.$implicit,u=t.$index,E=t.$count,F=m(2),j=m();q("mb-6",u!==E-1),s(),b((e=j.getRecord(F.approvalRecords,l.stepOrder))?1:F.currentStepOrder===l.stepOrder&&F.status==="pending"?2:3,e),s(5),w(" ",l.jobTitleName||"\u2014"," "),s(),b(l.departmentName?7:-1),s(),b(l.note?8:-1),s(),b((o=j.getRecord(F.approvalRecords,l.stepOrder))?9:F.currentStepOrder===l.stepOrder&&F.status==="pending"?10:-1,o)}}function Jl(n,t){if(n&1&&(i(0,"div",12)(1,"div",14),g(),i(2,"svg",15),d(3,"use",46),r(),a(4," \u7C3D\u6838\u6D41\u7A0B "),r(),S(),i(5,"div",17)(6,"ol",47),k(7,Hl,11,7,"li",48,Sl),r()()()),n&2){let e=m();s(7),P(e.flow.steps)}}function Yl(n,t){n&1&&(i(0,"span",60),a(1,"*"),r())}function zl(n,t){n&1&&(i(0,"div",74),a(1,"\u9000\u56DE\u4FEE\u6539\u6216\u62D2\u7D55\u6642\u8ACB\u586B\u5BEB\u539F\u56E0\u3002"),r())}function Kl(n,t){if(n&1){let e=R();i(0,"div",12)(1,"div",14),g(),i(2,"svg",15),d(3,"use",8),r(),a(4," \u5BE9\u6838 "),r(),S(),i(5,"div",17)(6,"form",62),x("ngSubmit",function(){y(e);let l=m(2);return A(l.submit())}),i(7,"div",63)(8,"label",64),a(9,"\u5BE9\u6838\u7D50\u679C "),i(10,"span",60),a(11,"*"),r()(),i(12,"div",65)(13,"div",66),d(14,"input",67),i(15,"label",68),a(16,"\u6838\u51C6"),r()(),i(17,"div",66),d(18,"input",69),i(19,"label",70),a(20,"\u9000\u56DE\u4FEE\u6539"),r()(),i(21,"div",66),d(22,"input",71),i(23,"label",72),a(24,"\u62D2\u7D55\uFF08\u7D42\u6B62\uFF09"),r()()()(),i(25,"div",63)(26,"label",64),a(27," \u5BE9\u6838\u610F\u898B "),f(28,Yl,2,0,"span",60),r(),d(29,"textarea",73),f(30,zl,2,0,"div",74),r(),i(31,"div",75)(32,"button",76),a(33,"\u63D0\u4EA4\u5BE9\u6838"),r(),i(34,"a",77),a(35,"\u53D6\u6D88"),r()()()()()}if(n&2){let e,o=m(2);s(6),h("formGroup",o.form),s(22),b(((e=o.form.get("action"))==null?null:e.value)==="rejected"||((e=o.form.get("action"))==null?null:e.value)==="returned"?28:-1),s(2),b(o.showNoteError?30:-1)}}function Wl(n,t){if(n&1&&(i(0,"div",83),a(1,"\u9000\u56DE\u539F\u56E0\uFF1A"),r(),i(2,"div",84),a(3),r()),n&2){let e=m(2);s(3),c(e.reviewNote)}}function Zl(n,t){if(n&1&&(i(0,"div",12)(1,"div",78),g(),i(2,"svg",79),d(3,"use",80),r(),a(4," \u9000\u56DE\u4FEE\u6539 "),r(),S(),i(5,"div",17)(6,"p",81),a(7,"\u6B64\u7533\u8ACB\u5DF2\u9000\u56DE\uFF0C\u5F85\u7533\u8ACB\u4EBA\u4FEE\u6539\u5F8C\u91CD\u65B0\u9001\u51FA\u3002"),r(),f(8,Wl,4,1),i(9,"div",82)(10,"a",77),a(11,"\u8FD4\u56DE\u5217\u8868"),r()()()()),n&2){let e=m();s(8),b(e.reviewNote?8:-1)}}function Ql(n,t){if(n&1&&(i(0,"div",42)(1,"div",20),a(2,"\u5BE9\u6838\u610F\u898B"),r(),i(3,"div",43),a(4),r()()),n&2){let e=m(2);s(4),c(e.reviewNote)}}function Xl(n,t){if(n&1&&(i(0,"div",12)(1,"div",14),g(),i(2,"svg",15),d(3,"use",8),r(),a(4," \u5BE9\u6838\u7D50\u679C "),r(),S(),i(5,"div",17)(6,"div",41)(7,"div",19)(8,"div",20),a(9,"\u5BE9\u6838\u7D50\u679C"),r(),i(10,"span"),a(11),r()(),i(12,"div",19)(13,"div",20),a(14,"\u5BE9\u6838\u6642\u9593"),r(),i(15,"span",23),a(16),B(17,"date"),r()(),f(18,Ql,5,1,"div",42),r(),i(19,"div",85)(20,"a",77),a(21,"\u8FD4\u56DE\u5217\u8868"),r()()()()),n&2){let e=m(),o=m();s(10),re("badge px-3 py-2 rounded-full "+o.statusClass[e.status]),s(),w(" ",o.statusLabel[e.status]," "),s(5),c(M(17,5,e.reviewedAt,"yyyy-MM-dd")),s(2),b(e.reviewNote?18:-1)}}function es(n,t){if(n&1&&(i(0,"div",3)(1,"a",4),g(),i(2,"svg",5),d(3,"use",6),r()(),i(4,"svg",7),d(5,"use",8),r(),S(),i(6,"h4",9),a(7,"\u7C3D\u6838\u5BE9\u6838"),r(),i(8,"span"),a(9),r(),i(10,"span"),a(11),r()(),i(12,"div",10)(13,"div",11),f(14,wl,1,1)(15,Fl,1,1)(16,Ll,1,1),f(17,Jl,9,0,"div",12),f(18,Kl,36,3,"div",12)(19,Zl,12,1,"div",12)(20,Xl,22,8,"div",12),r()()),n&2){let e,o=t,l=m();s(8),re("badge "+l.appTypeClass[o.applicationType]),s(),c(l.appTypeLabel[o.applicationType]),s(),re("badge "+l.statusClass[o.status]),s(),c(l.statusLabel[o.status]),s(3),b((e=o.applicationType)==="payment_request"?14:e==="leave"?15:e==="travel"?16:-1),s(3),b(o.flow?17:-1),s(),b(o.status==="pending"?18:o.status==="returned"?19:20)}}function ts(n,t){n&1&&(i(0,"p",1),a(1,"\u627E\u4E0D\u5230\u6B64\u7C3D\u6838\u4F5C\u696D\u3002"),r())}function is(n,t){if(n&1&&d(0,"img",93),n&2){let e=m(2);h("src",e.previewFile.url,ze)}}function ns(n,t){if(n&1&&d(0,"iframe",94),n&2){let e=m(2);h("src",e.previewFile.safeUrl,Pt)}}function rs(n,t){if(n&1&&(i(0,"div",95)(1,"a",96),g(),i(2,"svg",97),d(3,"use",98),r(),a(4," \u4E0B\u8F09\u6A94\u6848 "),r()()),n&2){let e=m(2);s(),h("href",e.previewFile.url,ze)("download",e.previewFile.name)}}function as(n,t){if(n&1){let e=R();i(0,"div",86),x("click",function(){y(e);let l=m();return A(l.closePreview())}),i(1,"div",87),x("click",function(l){return y(e),A(l.stopPropagation())}),i(2,"div",88)(3,"div",89)(4,"h6",90),a(5),r(),i(6,"button",91),x("click",function(){y(e);let l=m();return A(l.closePreview())}),r()(),i(7,"div",92),f(8,is,1,1,"img",93)(9,ns,1,1,"iframe",94)(10,rs,5,2,"div",95),r()()()()}if(n&2){let e=m();s(5),c(e.previewFile.name),s(3),b(e.isImageFile(e.previewFile.name)?8:e.isPdfFile(e.previewFile.name)?9:10)}}var li=class n{service=v(Vt);route=v(me);router=v(ve);fb=v(te);sanitizer=v(jt);task$;taskId=0;applicationType="";showNoteError=!1;previewFile=null;openPreview(t,e){this.previewFile={name:t,url:e,safeUrl:this.sanitizer.bypassSecurityTrustResourceUrl(e)}}closePreview(){this.previewFile=null}isImageFile(t){return/\.(jpe?g|png|gif|webp|bmp)$/i.test(t)}isPdfFile(t){return/\.pdf$/i.test(t)}statusLabel=ii;statusClass=ni;appTypeLabel=Xe;appTypeClass=et;payTypeLabel=ri;leaveTypeLabel=ai;form=this.fb.group({action:["approved",D.required],reviewNote:[""]});ngOnInit(){this.applicationType=this.route.snapshot.paramMap.get("applicationType")??"",this.taskId=+this.route.snapshot.paramMap.get("id"),this.task$=this.service.getById(this.taskId,this.applicationType)}getRecord(t,e){return t.find(o=>o.stepOrder===e)}submit(){let t=this.form.value.action,e=this.form.value.reviewNote?.trim()??"";if((t==="rejected"||t==="returned")&&!e){this.showNoteError=!0;return}this.showNoteError=!1,this.service.review(this.taskId,this.applicationType,t,e).subscribe(()=>{this.router.navigate(["/admin/approval-tasks"])})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-approval-task-review"]],decls:5,vars:4,consts:[[1,"container-fluid","py-3"],[1,"text-muted"],["tabindex","-1",1,"modal",2,"background","rgba(0,0,0,.6)"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/approval-tasks",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#check-square"],[1,"mb-0"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm","mt-6"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#dollar-sign"],[1,"card-body"],[1,"row","g-3","mb-0"],[1,"col-6","col-md-4"],[1,"text-muted","small","mb-1"],[1,"fw-500"],[1,"fw-500","font-monospace"],[1,"text-muted","small"],[1,"fw-600","fs-5"],["href","/assets/icons/sprite.svg#file-text"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-sm","mb-0"],[1,"table-light"],[1,"text-right"],["colspan","2",1,"text-right","fw-500","small"],[1,"text-right","fw-600"],[1,"small",2,"max-width","200px","overflow","hidden","text-overflow","ellipsis","white-space","nowrap"],["type","button",1,"btn","btn-link","p-0","text-muted","small","inline-flex","items-center","gap-1",2,"text-decoration","none","max-width","100%","overflow","hidden","text-overflow","ellipsis"],[1,"text-muted","inline-flex","items-center","gap-1"],[1,"font-monospace","small"],[1,"text-right","fw-500"],["type","button",1,"btn","btn-link","p-0","text-muted","small","inline-flex","items-center","gap-1",2,"text-decoration","none","max-width","100%","overflow","hidden","text-overflow","ellipsis",3,"click"],[1,"sa-icon","shrink-0",2,"width","14px","height","14px","stroke","currentColor"],["href","/assets/icons/sprite.svg#calendar"],[1,"row","g-3"],[1,"col-12"],[1,"border","rounded","p-4","bg-[--bg-base]","small"],["href","/assets/icons/sprite.svg#map-pin"],[1,"font-monospace","fw-500"],["href","/assets/icons/sprite.svg#git-merge"],[1,"list-none","p-0","mb-0"],[1,"flex","items-start","gap-3",3,"mb-6"],[1,"flex","items-start","gap-3"],[1,"badge","bg-primary","rounded-circle","flex","items-center","justify-center","shrink-0",2,"width","28px","height","28px","min-width","28px","font-size",".75rem"],[1,"badge","bg-[--bg-base]","text-[--text-muted]","rounded-circle","flex","items-center","justify-center","shrink-0",2,"width","28px","height","28px","min-width","28px","font-size",".75rem"],[1,"grow"],[1,"text-muted","font-normal"],[1,"text-primary","small","mt-1"],[1,"badge","bg-success","rounded-circle","flex","items-center","justify-center","shrink-0",2,"width","28px","height","28px","min-width","28px","font-size",".85rem"],[1,"badge","bg-danger","rounded-circle","flex","items-center","justify-center","shrink-0",2,"width","28px","height","28px","min-width","28px","font-size",".85rem"],[1,"text-muted","small","mt-1"],[1,"text-success"],[1,"text-[--yellow]"],[1,"text-danger"],[1,"text-muted","small","italic","mt-1"],[3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"flex","flex-wrap","gap-4","mt-1"],[1,"form-check"],["type","radio","formControlName","action","value","approved","id","actionApprove",1,"form-check-input"],["for","actionApprove",1,"form-check-label","fw-500","text-success"],["type","radio","formControlName","action","value","returned","id","actionReturn",1,"form-check-input"],["for","actionReturn",1,"form-check-label","fw-500","text-[--yellow]"],["type","radio","formControlName","action","value","rejected","id","actionReject",1,"form-check-input"],["for","actionReject",1,"form-check-label","fw-500","text-danger"],["formControlName","reviewNote","rows","3","placeholder","\u586B\u5BEB\u5BE9\u6838\u610F\u898B\uFF08\u9000\u56DE\u4FEE\u6539\u6216\u62D2\u7D55\u6642\u5FC5\u586B\uFF09...",1,"form-control"],[1,"text-danger","small","mt-1"],[1,"flex","gap-2"],["type","submit",1,"btn","btn-primary"],["routerLink","/admin/approval-tasks",1,"btn","btn-outline-secondary"],[1,"card-header","bg-[rgba(184,137,42,0.08)]","border-bottom","flex","items-center","gap-2","fw-600","text-[--yellow]"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#rotate-ccw"],[1,"text-muted","small","mb-2"],[1,"mt-2"],[1,"text-muted","small","mb-1","fw-500"],[1,"border","rounded","p-4","bg-[--bg-base]","small","mb-4"],[1,"mt-4"],["tabindex","-1",1,"modal",2,"background","rgba(0,0,0,.6)",3,"click"],[1,"modal-dialog","modal-lg","modal-dialog-centered",3,"click"],[1,"modal-content"],[1,"modal-header","py-2"],[1,"modal-title","mb-0","text-truncate"],["type","button",1,"btn-close",3,"click"],[1,"modal-body","p-0","text-center","bg-[--bg-base]"],[1,"max-w-full",2,"max-height","75vh","object-fit","contain",3,"src"],[2,"width","100%","height","75vh","border","0",3,"src"],[1,"p-5"],[1,"btn","btn-primary",3,"href","download"],[1,"sa-icon","mr-1",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#download"]],template:function(e,o){if(e&1&&(i(0,"div",0),f(1,es,21,9),B(2,"async"),Bt(3,ts,2,0,"p",1),r(),f(4,as,11,2,"div",2)),e&2){let l;s(),b((l=Be(2,2,o.task$))?1:3,l),s(3),b(o.previewFile?4:-1)}},dependencies:[O,ie,Q,K,Ke,W,Z,ee,X,Oe,be,De],encapsulation:2})};var os=[{id:1,employeeId:"1",leaveType:"annual",startDate:new Date("2026-03-01"),endDate:new Date("2026-03-05"),days:5,reason:"\u500B\u4EBA\u65C5\u904A",approvalStatus:"pending",createdAt:new Date("2026-02-10")},{id:2,employeeId:"1",leaveType:"sick",startDate:new Date("2026-02-20"),endDate:new Date("2026-02-21"),days:2,reason:"\u8EAB\u9AD4\u4E0D\u9069\u5C31\u91AB",approvalStatus:"approved",createdAt:new Date("2026-02-20"),reviewedAt:new Date("2026-02-20"),reviewNote:"\u6838\u51C6"},{id:3,employeeId:"2",leaveType:"compensatory",startDate:new Date("2026-02-15"),endDate:new Date("2026-02-15"),days:1,reason:"\u88DC\u4F11\u52A0\u73ED\u6642\u6578",approvalStatus:"rejected",createdAt:new Date("2026-02-13"),reviewedAt:new Date("2026-02-14"),reviewNote:"\u88DC\u4F11\u6642\u6578\u4E0D\u8DB3\uFF0C\u8ACB\u78BA\u8A8D\u5F8C\u91CD\u65B0\u7533\u8ACB"}],lt=class n{http=v(pe);auth=v(nt);items$=new se(os);getAll(){return this.items$.asObservable()}getPaged(t,e){let o=this.auth.currentUser()?.id,l=this.items$.getValue().filter(F=>F.employeeId===o),u=(t-1)*e,E=Math.max(1,Math.ceil(l.length/e));return L({items:l.slice(u,u+e),totalCount:l.length,page:t,pageSize:e,totalPages:E})}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=this.auth.currentUser()?.id,o=G(T({},t),{id:Date.now(),employeeId:e,approvalStatus:"pending",createdAt:new Date});return this.items$.next([...this.items$.getValue(),o]),L(o)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var Mn={annual:"\u5E74\u5047",personal:"\u4E8B\u5047",sick:"\u75C5\u5047",compensatory:"\u88DC\u4F11"},$n={annual:"bg-primary-subtle text-primary",personal:"bg-info-subtle text-info",sick:"bg-warning-subtle text-warning-emphasis",compensatory:"bg-secondary-subtle text-secondary"},si={pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},mi={pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"};var Gn=n=>[n,"edit"],ls=(n,t)=>t.id;function ss(n,t){if(n&1){let e=R();i(0,"a",25),g(),i(1,"svg",7),d(2,"use",26),r()(),S(),i(3,"button",27),x("click",function(){y(e);let l=m().$implicit,u=m();return A(u.delete(l))}),g(),i(4,"svg",7),d(5,"use",28),r()()}if(n&2){let e=m().$implicit;h("routerLink",ae(1,Gn,e.id))}}function ms(n,t){if(n&1&&(i(0,"a",24),g(),i(1,"svg",7),d(2,"use",29),r()()),n&2){let e=m().$implicit;h("routerLink",ae(1,Gn,e.id))}}function ds(n,t){if(n&1&&(i(0,"tr")(1,"td")(2,"span"),a(3),r()(),i(4,"td",18),a(5),B(6,"date"),r(),i(7,"td",18),a(8),B(9,"date"),r(),i(10,"td",19),a(11),B(12,"number"),r(),i(13,"td",20),a(14),r(),i(15,"td")(16,"span"),a(17),r()(),i(18,"td",21),a(19),B(20,"date"),r(),i(21,"td",22)(22,"div",23),f(23,ss,6,3)(24,ms,3,3,"a",24),r()()()),n&2){let e=t.$implicit,o=m();s(2),re("badge "+o.typeClass[e.leaveType]),s(),c(o.typeLabel[e.leaveType]),s(2),c(M(6,12,e.startDate,"yyyy-MM-dd")),s(3),c(M(9,15,e.endDate,"yyyy-MM-dd")),s(3),w("",M(12,18,e.days,"1.0-1")," \u5929"),s(3),c(e.reason),s(2),re("badge "+o.statusClass[e.approvalStatus]),s(),c(o.statusLabel[e.approvalStatus]),s(2),c(M(20,21,e.createdAt,"yyyy-MM-dd")),s(4),b(e.approvalStatus==="pending"||e.approvalStatus==="returned"?23:24)}}function us(n,t){n&1&&(i(0,"tr")(1,"td",30),a(2,"\u5C1A\u7121\u8ACB\u5047\u7533\u8ACB\u3002"),r()())}function cs(n,t){n&1&&(i(0,"li",38)(1,"span",40),a(2,"\u2026"),r()())}function ps(n,t){if(n&1){let e=R();i(0,"li",36)(1,"button",37),x("click",function(){y(e);let l=m().$implicit,u=m(2);return A(u.goTo(l))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);q("active",e===o.page()),s(2),c(e)}}function vs(n,t){if(n&1&&f(0,cs,3,0,"li",38)(1,ps,3,3,"li",39),n&2){let e=t.$implicit;b(e===-1?0:1)}}function fs(n,t){if(n&1){let e=R();i(0,"div",17)(1,"span",31),a(2),r(),i(3,"div",32)(4,"button",33),x("click",function(){y(e);let l=m();return A(l.prev())}),a(5,"\u2039"),r(),i(6,"span",34),a(7),r(),i(8,"button",33),x("click",function(){y(e);let l=m();return A(l.next())}),a(9,"\u203A"),r()(),i(10,"ul",35)(11,"li",36)(12,"button",37),x("click",function(){y(e);let l=m();return A(l.prev())}),a(13,"\u2039"),r()(),k(14,vs,2,1,null,null,xe),i(16,"li",36)(17,"button",37),x("click",function(){y(e);let l=m();return A(l.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();s(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),s(2),q("disabled",e.page()===1),s(3),z("",e.page()," / ",e.totalPages()),s(),q("disabled",e.page()===e.totalPages()),s(3),q("disabled",e.page()===1),s(3),P(e.pageNumbers()),s(2),q("disabled",e.page()===e.totalPages())}}var di=class n{service=v(lt);PAGE_SIZE=20;page=he(1);result=we(Pe(this.page).pipe(Te(t=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedRequests=U(()=>this.result().items);totalCount=U(()=>this.result().totalCount);totalPages=U(()=>this.result().totalPages);pageNumbers=U(()=>bs(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}typeLabel=Mn;typeClass=$n;statusLabel=si;statusClass=mi;delete(t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u8ACB\u5047\u7533\u8ACB\u55CE\uFF1F")&&this.service.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-leave-request-list"]],decls:38,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#calendar"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"text-muted","small"],[1,"text-right","fw-500"],[1,"text-muted","small","hidden","md:table-cell"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u6AA2\u8996",1,"btn","btn-sm","btn-ghost-secondary","inline-flex","items-center",3,"routerLink"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["href","/assets/icons/sprite.svg#eye"],["colspan","8",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u8ACB\u5047\u7533\u8ACB"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u7533\u8ACB "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u5047\u5225"),r(),i(19,"th"),a(20,"\u958B\u59CB\u65E5\u671F"),r(),i(21,"th"),a(22,"\u7D50\u675F\u65E5\u671F"),r(),i(23,"th",14),a(24,"\u5929\u6578"),r(),i(25,"th",15),a(26,"\u539F\u56E0"),r(),i(27,"th"),a(28,"\u72C0\u614B"),r(),i(29,"th",16),a(30,"\u7533\u8ACB\u6642\u9593"),r(),i(31,"th",14),a(32,"\u64CD\u4F5C"),r()()(),i(33,"tbody"),k(34,ds,25,24,"tr",null,ls,!1,us,3,0,"tr"),r()()(),f(37,fs,19,13,"div",17),r()()()),e&2&&(s(34),P(o.pagedRequests()),s(3),b(o.totalPages()>1?37:-1))},dependencies:[O,be,De],encapsulation:2})};function bs(n,t){if(t<=9)return Array.from({length:t},(l,u)=>u+1);let e=[],o=0;for(let l=1;l<=t;l++)(l===1||l===t||l>=n-2&&l<=n+2)&&(o&&l-o>1&&e.push(-1),e.push(l),o=l);return e}function gs(n,t){if(n&1&&(i(0,"div",27),g(),i(1,"svg",37),d(2,"use",38),r(),S(),i(3,"span",39),a(4,"\u76EE\u524D\u53EF\u88DC\u4F11\u6642\u6578\uFF1A"),i(5,"strong"),a(6),r()()()),n&2){let e=m();s(6),w("",e.overtimeHours," \u5C0F\u6642")}}function _s(n,t){n&1&&(i(0,"div",31),a(1,"\u8ACB\u9078\u64C7\u958B\u59CB\u65E5\u671F\u3002"),r())}function xs(n,t){n&1&&(i(0,"div",31),a(1,"\u8ACB\u9078\u64C7\u7D50\u675F\u65E5\u671F\u3002"),r())}function hs(n,t){n&1&&(i(0,"div",31),a(1,"\u8ACB\u8F38\u5165\u6709\u6548\u5929\u6578\uFF08\u6700\u5C11 0.5\uFF09\u3002"),r())}function Ss(n,t){n&1&&(i(0,"div",31),a(1,"\u8ACB\u586B\u5BEB\u8ACB\u5047\u539F\u56E0\u3002"),r())}function Cs(n,t){if(n&1&&(i(0,"div",35)(1,"button",40),a(2),r(),i(3,"a",41),a(4,"\u53D6\u6D88"),r()()),n&2){let e=m();s(),h("disabled",e.form.invalid),s(),w(" ",e.isReturned?"\u4FEE\u6539\u4E26\u91CD\u9001":e.isEdit?"\u66F4\u65B0":"\u9001\u51FA\u7533\u8ACB"," ")}}function Es(n,t){n&1&&(i(0,"div",36)(1,"a",41),a(2,"\u8FD4\u56DE\u5217\u8868"),r()())}var At=class n{fb=v(te);service=v(lt);route=v(me);router=v(ve);isEdit=!1;requestId=0;isReadOnly=!1;isReturned=!1;overtimeHours=16;statusLabel=si;statusClass=mi;form=this.fb.group({leaveType:["annual",D.required],startDate:["",D.required],endDate:["",D.required],days:[1,[D.required,D.min(.5)]],reason:["",D.required]});ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.requestId=+t,this.service.getById(this.requestId).subscribe(e=>{e&&(this.isReturned=e.approvalStatus==="returned",this.isReadOnly=e.approvalStatus!=="pending"&&e.approvalStatus!=="returned",this.form.patchValue({leaveType:e.leaveType,startDate:e.startDate instanceof Date?e.startDate.toISOString().split("T")[0]:String(e.startDate),endDate:e.endDate instanceof Date?e.endDate.toISOString().split("T")[0]:String(e.endDate),days:e.days,reason:e.reason}),this.isReadOnly&&this.form.disable())}))}submit(){if(this.form.invalid||this.isReadOnly)return;let t=this.form.value,e={leaveType:t.leaveType,startDate:new Date(t.startDate),endDate:new Date(t.endDate),days:+t.days,reason:t.reason};(this.isEdit?this.service.update(this.requestId,e):this.service.create(e)).subscribe(()=>this.router.navigate(["/admin/leave-requests"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-leave-request-form"]],decls:70,vars:8,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/leave-requests",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#calendar"],[1,"card-body"],[1,"mb-4"],[1,"form-label","fw-500"],[1,"text-danger"],[1,"flex","flex-wrap","gap-4","mt-1"],[1,"form-check"],["type","radio","formControlName","leaveType","value","annual","id","typeAnnual",1,"form-check-input"],["for","typeAnnual",1,"form-check-label"],["type","radio","formControlName","leaveType","value","personal","id","typePersonal",1,"form-check-input"],["for","typePersonal",1,"form-check-label"],["type","radio","formControlName","leaveType","value","sick","id","typeSick",1,"form-check-input"],["for","typeSick",1,"form-check-label"],["type","radio","formControlName","leaveType","value","compensatory","id","typeComp",1,"form-check-input"],["for","typeComp",1,"form-check-label"],[1,"alert","alert-info","flex","items-center","gap-2","py-2","mt-2","mb-0"],[1,"row","g-3","mb-4"],[1,"col-12","col-md-4"],["type","date","formControlName","startDate",1,"form-control"],[1,"text-danger","small","mt-1"],["type","date","formControlName","endDate",1,"form-control"],["type","number","formControlName","days","min","0.5","step","0.5","placeholder","1",1,"form-control"],["formControlName","reason","rows","3","placeholder","\u8ACB\u586B\u5BEB\u8ACB\u5047\u539F\u56E0...",1,"form-control"],[1,"mt-6","flex","gap-2"],[1,"mt-6"],[1,"sa-icon","shrink-0",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#clock"],[1,"small"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/leave-requests",1,"btn","btn-outline-secondary"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10),g(),i(12,"svg",11),d(13,"use",12),r(),a(14," \u8ACB\u5047\u8CC7\u8A0A "),r(),S(),i(15,"div",13)(16,"div",14)(17,"label",15),a(18,"\u5047\u5225 "),i(19,"span",16),a(20,"*"),r()(),i(21,"div",17)(22,"div",18),d(23,"input",19),i(24,"label",20),a(25,"\u5E74\u5047"),r()(),i(26,"div",18),d(27,"input",21),i(28,"label",22),a(29,"\u4E8B\u5047"),r()(),i(30,"div",18),d(31,"input",23),i(32,"label",24),a(33,"\u75C5\u5047"),r()(),i(34,"div",18),d(35,"input",25),i(36,"label",26),a(37,"\u88DC\u4F11"),r()()(),f(38,gs,7,1,"div",27),r(),i(39,"div",28)(40,"div",29)(41,"label",15),a(42,"\u958B\u59CB\u65E5\u671F "),i(43,"span",16),a(44,"*"),r()(),d(45,"input",30),f(46,_s,2,0,"div",31),r(),i(47,"div",29)(48,"label",15),a(49,"\u7D50\u675F\u65E5\u671F "),i(50,"span",16),a(51,"*"),r()(),d(52,"input",32),f(53,xs,2,0,"div",31),r(),i(54,"div",29)(55,"label",15),a(56,"\u5929\u6578 "),i(57,"span",16),a(58,"*"),r()(),d(59,"input",33),f(60,hs,2,0,"div",31),r()(),i(61,"div",14)(62,"label",15),a(63,"\u8ACB\u5047\u539F\u56E0 "),i(64,"span",16),a(65,"*"),r()(),d(66,"textarea",34),f(67,Ss,2,0,"div",31),r()()(),f(68,Cs,5,2,"div",35)(69,Es,3,0,"div",36),r()()()()),e&2){let l,u,E,F,j;s(6),c(o.isEdit?o.isReadOnly?"\u6AA2\u8996\u8ACB\u5047\u7533\u8ACB":o.isReturned?"\u4FEE\u6539\u8ACB\u5047\u7533\u8ACB\uFF08\u9000\u56DE\uFF09":"\u7DE8\u8F2F\u8ACB\u5047\u7533\u8ACB":"\u65B0\u589E\u8ACB\u5047\u7533\u8ACB"),s(),h("formGroup",o.form),s(31),b(((l=o.form.get("leaveType"))==null?null:l.value)==="compensatory"?38:-1),s(8),b((u=o.form.get("startDate"))!=null&&u.invalid&&((u=o.form.get("startDate"))!=null&&u.touched)?46:-1),s(7),b((E=o.form.get("endDate"))!=null&&E.invalid&&((E=o.form.get("endDate"))!=null&&E.touched)?53:-1),s(7),b((F=o.form.get("days"))!=null&&F.invalid&&((F=o.form.get("days"))!=null&&F.touched)?60:-1),s(7),b((j=o.form.get("reason"))!=null&&j.invalid&&((j=o.form.get("reason"))!=null&&j.touched)?67:-1),s(),b(o.isReadOnly?69:68)}},dependencies:[ie,Q,K,ge,Ke,W,Z,_e,ee,X,O],encapsulation:2})};var ys=[{id:1,employeeId:"1",destination:"\u53F0\u5357",startDate:new Date("2026-03-10"),endDate:new Date("2026-03-12"),estimatedCost:3e3,purpose:"\u5BA2\u6236\u73FE\u5834\u62DC\u8A2A\u8207\u9700\u6C42\u78BA\u8A8D",projectId:1,projectCode:"P2024-001",approvalStatus:"pending",createdAt:new Date("2026-03-01")},{id:2,employeeId:"2",destination:"\u53F0\u4E2D",startDate:new Date("2026-02-25"),endDate:new Date("2026-02-26"),estimatedCost:1500,purpose:"\u4F9B\u61C9\u5546\u5DE5\u5EE0\u53C3\u8A2A",projectId:2,projectCode:"P2024-002",approvalStatus:"approved",createdAt:new Date("2026-02-20"),reviewedAt:new Date("2026-02-24"),reviewNote:"\u6838\u51C6"}],st=class n{http=v(pe);auth=v(nt);items$=new se(ys);getAll(){return this.items$.asObservable()}getPaged(t,e){let o=this.auth.currentUser()?.id,l=this.items$.getValue().filter(F=>F.employeeId===o),u=(t-1)*e,E=Math.max(1,Math.ceil(l.length/e));return L({items:l.slice(u,u+e),totalCount:l.length,page:t,pageSize:e,totalPages:E})}getById(t){return L(this.items$.getValue().find(e=>e.id===t))}create(t){let e=this.auth.currentUser()?.id,o=G(T({},t),{id:Date.now(),employeeId:e,approvalStatus:"pending",createdAt:new Date});return this.items$.next([...this.items$.getValue(),o]),L(o)}update(t,e){let o=this.items$.getValue().map(l=>l.id===t?T(T({},l),e):l);return this.items$.next(o),L(o.find(l=>l.id===t))}delete(t){return this.items$.next(this.items$.getValue().filter(e=>e.id!==t)),L(void 0)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=ce({token:n,factory:n.\u0275fac,providedIn:"root"})};var ui={pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},ci={pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"};var Un=n=>[n,"edit"],As=(n,t)=>t.id;function ws(n,t){if(n&1){let e=R();i(0,"a",26),g(),i(1,"svg",7),d(2,"use",27),r()(),S(),i(3,"button",28),x("click",function(){y(e);let l=m().$implicit,u=m();return A(u.delete(l))}),g(),i(4,"svg",7),d(5,"use",29),r()()}if(n&2){let e=m().$implicit;h("routerLink",ae(1,Un,e.id))}}function Ts(n,t){if(n&1&&(i(0,"a",25),g(),i(1,"svg",7),d(2,"use",30),r()()),n&2){let e=m().$implicit;h("routerLink",ae(1,Un,e.id))}}function Fs(n,t){if(n&1&&(i(0,"tr")(1,"td",18),a(2),r(),i(3,"td",19),a(4),B(5,"date"),r(),i(6,"td",19),a(7),B(8,"date"),r(),i(9,"td",20),a(10),B(11,"number"),r(),i(12,"td",21),a(13),r(),i(14,"td",22),a(15),r(),i(16,"td")(17,"span"),a(18),r()(),i(19,"td",23)(20,"div",24),f(21,ws,6,3)(22,Ts,3,3,"a",25),r()()()),n&2){let e=t.$implicit,o=m();s(2),c(e.destination),s(2),c(M(5,10,e.startDate,"yyyy-MM-dd")),s(3),c(M(8,13,e.endDate,"yyyy-MM-dd")),s(3),c(M(11,16,e.estimatedCost,"1.0-0")),s(3),c(e.purpose),s(2),c(e.projectCode||"\u2014"),s(2),re("badge "+o.statusClass[e.approvalStatus]),s(),c(o.statusLabel[e.approvalStatus]),s(3),b(e.approvalStatus==="pending"||e.approvalStatus==="returned"?21:22)}}function Ds(n,t){n&1&&(i(0,"tr")(1,"td",31),a(2,"\u5C1A\u7121\u51FA\u5DEE\u7533\u8ACB\u3002"),r()())}function Is(n,t){n&1&&(i(0,"li",39)(1,"span",41),a(2,"\u2026"),r()())}function Ls(n,t){if(n&1){let e=R();i(0,"li",37)(1,"button",38),x("click",function(){y(e);let l=m().$implicit,u=m(2);return A(u.goTo(l))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);q("active",e===o.page()),s(2),c(e)}}function ks(n,t){if(n&1&&f(0,Is,3,0,"li",39)(1,Ls,3,3,"li",40),n&2){let e=t.$implicit;b(e===-1?0:1)}}function Ps(n,t){if(n&1){let e=R();i(0,"div",17)(1,"span",32),a(2),r(),i(3,"div",33)(4,"button",34),x("click",function(){y(e);let l=m();return A(l.prev())}),a(5,"\u2039"),r(),i(6,"span",35),a(7),r(),i(8,"button",34),x("click",function(){y(e);let l=m();return A(l.next())}),a(9,"\u203A"),r()(),i(10,"ul",36)(11,"li",37)(12,"button",38),x("click",function(){y(e);let l=m();return A(l.prev())}),a(13,"\u2039"),r()(),k(14,ks,2,1,null,null,xe),i(16,"li",37)(17,"button",38),x("click",function(){y(e);let l=m();return A(l.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();s(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),s(2),q("disabled",e.page()===1),s(3),z("",e.page()," / ",e.totalPages()),s(),q("disabled",e.page()===e.totalPages()),s(3),q("disabled",e.page()===1),s(3),P(e.pageNumbers()),s(2),q("disabled",e.page()===e.totalPages())}}var pi=class n{service=v(st);PAGE_SIZE=20;page=he(1);result=we(Pe(this.page).pipe(Te(t=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedRequests=U(()=>this.result().items);totalCount=U(()=>this.result().totalCount);totalPages=U(()=>this.result().totalPages);pageNumbers=U(()=>Rs(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}statusLabel=ui;statusClass=ci;delete(t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u51FA\u5DEE\u7533\u8ACB\u55CE\uFF1F")&&this.service.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-travel-request-list"]],decls:38,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#map-pin"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500"],[1,"text-muted","small"],[1,"text-right","fw-500"],[1,"text-muted","small","hidden","md:table-cell"],[1,"font-monospace","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u6AA2\u8996",1,"btn","btn-sm","btn-ghost-secondary","inline-flex","items-center",3,"routerLink"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["href","/assets/icons/sprite.svg#eye"],["colspan","8",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u51FA\u5DEE\u7533\u8ACB"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u7533\u8ACB "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u51FA\u5DEE\u5730\u9EDE"),r(),i(19,"th"),a(20,"\u958B\u59CB\u65E5\u671F"),r(),i(21,"th"),a(22,"\u7D50\u675F\u65E5\u671F"),r(),i(23,"th",14),a(24,"\u9810\u4F30\u8CBB\u7528"),r(),i(25,"th",15),a(26,"\u76EE\u7684"),r(),i(27,"th",16),a(28,"\u5C08\u6848"),r(),i(29,"th"),a(30,"\u72C0\u614B"),r(),i(31,"th",14),a(32,"\u64CD\u4F5C"),r()()(),i(33,"tbody"),k(34,Fs,23,19,"tr",null,As,!1,Ds,3,0,"tr"),r()()(),f(37,Ps,19,13,"div",17),r()()()),e&2&&(s(34),P(o.pagedRequests()),s(3),b(o.totalPages()>1?37:-1))},dependencies:[O,be,De],encapsulation:2})};function Rs(n,t){if(t<=9)return Array.from({length:t},(l,u)=>u+1);let e=[],o=0;for(let l=1;l<=t;l++)(l===1||l===t||l>=n-2&&l<=n+2)&&(o&&l-o>1&&e.push(-1),e.push(l),o=l);return e}var Bs=(n,t)=>t.id;function js(n,t){n&1&&(i(0,"div",19),a(1,"\u8ACB\u586B\u5BEB\u51FA\u5DEE\u5730\u9EDE\u3002"),r())}function Vs(n,t){n&1&&(i(0,"div",19),a(1,"\u8ACB\u8F38\u5165\u9810\u4F30\u8CBB\u7528\u3002"),r())}function Ns(n,t){n&1&&(i(0,"div",19),a(1,"\u8ACB\u9078\u64C7\u51FA\u767C\u65E5\u671F\u3002"),r())}function Os(n,t){n&1&&(i(0,"div",19),a(1,"\u8ACB\u9078\u64C7\u8FD4\u56DE\u65E5\u671F\u3002"),r())}function qs(n,t){if(n&1&&(i(0,"option",25),a(1),r()),n&2){let e=t.$implicit;h("ngValue",e.id),s(),z("",e.code,"",e.departmentName?"\uFF08"+e.departmentName+"\uFF09":"")}}function Ms(n,t){n&1&&(i(0,"div",19),a(1,"\u8ACB\u586B\u5BEB\u51FA\u5DEE\u76EE\u7684\u3002"),r())}function $s(n,t){if(n&1&&(i(0,"div",28)(1,"button",30),a(2),r(),i(3,"a",31),a(4,"\u53D6\u6D88"),r()()),n&2){let e=m();s(),h("disabled",e.form.invalid),s(),w(" ",e.isReturned?"\u4FEE\u6539\u4E26\u91CD\u9001":e.isEdit?"\u66F4\u65B0":"\u9001\u51FA\u7533\u8ACB"," ")}}function Gs(n,t){n&1&&(i(0,"div",29)(1,"a",31),a(2,"\u8FD4\u56DE\u5217\u8868"),r()())}var wt=class n{fb=v(te);service=v(st);projects$=v(Me);route=v(me);router=v(ve);isEdit=!1;requestId=0;isReadOnly=!1;isReturned=!1;projects=[];statusLabel=ui;statusClass=ci;form=this.fb.group({destination:["",D.required],startDate:["",D.required],endDate:["",D.required],estimatedCost:[0,[D.required,D.min(0)]],purpose:["",D.required],projectId:[null]});ngOnInit(){this.projects$.getAll().subscribe(e=>this.projects=e);let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.requestId=+t,this.service.getById(this.requestId).subscribe(e=>{e&&(this.isReturned=e.approvalStatus==="returned",this.isReadOnly=e.approvalStatus!=="pending"&&e.approvalStatus!=="returned",this.form.patchValue({destination:e.destination,startDate:e.startDate instanceof Date?e.startDate.toISOString().split("T")[0]:String(e.startDate),endDate:e.endDate instanceof Date?e.endDate.toISOString().split("T")[0]:String(e.endDate),estimatedCost:e.estimatedCost,purpose:e.purpose,projectId:e.projectId??null}),this.isReadOnly&&this.form.disable())}))}submit(){if(this.form.invalid||this.isReadOnly)return;let t=this.form.value,e=this.projects.find(u=>u.id===t.projectId),o={destination:t.destination,startDate:new Date(t.startDate),endDate:new Date(t.endDate),estimatedCost:+t.estimatedCost,purpose:t.purpose,projectId:t.projectId??void 0,projectCode:e?.code};(this.isEdit?this.service.update(this.requestId,o):this.service.create(o)).subscribe(()=>this.router.navigate(["/admin/travel-requests"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-travel-request-form"]],decls:63,vars:9,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/travel-requests",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#map-pin"],[1,"card-body"],[1,"row","g-3","mb-4"],[1,"col-12","col-md-6"],[1,"form-label","fw-500"],[1,"text-danger"],["type","text","formControlName","destination","placeholder","\u4F8B\u5982\uFF1A\u53F0\u5357\u3001\u53F0\u4E2D",1,"form-control"],[1,"text-danger","small","mt-1"],["type","number","formControlName","estimatedCost","min","0","placeholder","0",1,"form-control"],[1,"col-12","col-md-4"],["type","date","formControlName","startDate",1,"form-control"],["type","date","formControlName","endDate",1,"form-control"],["formControlName","projectId",1,"form-select"],[3,"ngValue"],[1,"mb-4"],["formControlName","purpose","rows","3","placeholder","\u8ACB\u586B\u5BEB\u51FA\u5DEE\u76EE\u7684...",1,"form-control"],[1,"mt-6","flex","gap-2"],[1,"mt-6"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/travel-requests",1,"btn","btn-outline-secondary"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10),g(),i(12,"svg",11),d(13,"use",12),r(),a(14," \u51FA\u5DEE\u8CC7\u8A0A "),r(),S(),i(15,"div",13)(16,"div",14)(17,"div",15)(18,"label",16),a(19,"\u51FA\u5DEE\u5730\u9EDE "),i(20,"span",17),a(21,"*"),r()(),d(22,"input",18),f(23,js,2,0,"div",19),r(),i(24,"div",15)(25,"label",16),a(26,"\u9810\u4F30\u8CBB\u7528\uFF08\u5143\uFF09"),i(27,"span",17),a(28,"*"),r()(),d(29,"input",20),f(30,Vs,2,0,"div",19),r()(),i(31,"div",14)(32,"div",21)(33,"label",16),a(34,"\u51FA\u767C\u65E5\u671F "),i(35,"span",17),a(36,"*"),r()(),d(37,"input",22),f(38,Ns,2,0,"div",19),r(),i(39,"div",21)(40,"label",16),a(41,"\u8FD4\u56DE\u65E5\u671F "),i(42,"span",17),a(43,"*"),r()(),d(44,"input",23),f(45,Os,2,0,"div",19),r(),i(46,"div",21)(47,"label",16),a(48,"\u95DC\u806F\u5C08\u6848\uFF08\u9078\u586B\uFF09"),r(),i(49,"select",24)(50,"option",25),a(51,"\u2014 \u4E0D\u95DC\u806F\u5C08\u6848 \u2014"),r(),k(52,qs,2,3,"option",25,Bs),r()()(),i(54,"div",26)(55,"label",16),a(56,"\u51FA\u5DEE\u76EE\u7684 "),i(57,"span",17),a(58,"*"),r()(),d(59,"textarea",27),f(60,Ms,2,0,"div",19),r()()(),f(61,$s,5,2,"div",28)(62,Gs,3,0,"div",29),r()()()()),e&2){let l,u,E,F,j;s(6),c(o.isEdit?o.isReadOnly?"\u6AA2\u8996\u51FA\u5DEE\u7533\u8ACB":o.isReturned?"\u4FEE\u6539\u51FA\u5DEE\u7533\u8ACB\uFF08\u9000\u56DE\uFF09":"\u7DE8\u8F2F\u51FA\u5DEE\u7533\u8ACB":"\u65B0\u589E\u51FA\u5DEE\u7533\u8ACB"),s(),h("formGroup",o.form),s(16),b((l=o.form.get("destination"))!=null&&l.invalid&&((l=o.form.get("destination"))!=null&&l.touched)?23:-1),s(7),b((u=o.form.get("estimatedCost"))!=null&&u.invalid&&((u=o.form.get("estimatedCost"))!=null&&u.touched)?30:-1),s(8),b((E=o.form.get("startDate"))!=null&&E.invalid&&((E=o.form.get("startDate"))!=null&&E.touched)?38:-1),s(7),b((F=o.form.get("endDate"))!=null&&F.invalid&&((F=o.form.get("endDate"))!=null&&F.touched)?45:-1),s(5),h("ngValue",null),s(2),P(o.projects),s(8),b((j=o.form.get("purpose"))!=null&&j.invalid&&((j=o.form.get("purpose"))!=null&&j.touched)?60:-1),s(),b(o.isReadOnly?62:61)}},dependencies:[ie,Q,Le,ke,K,ge,Ie,W,Z,_e,ee,X,O],encapsulation:2})};var vi={pending:"\u5F85\u5BE9\u6838",approved:"\u5DF2\u6838\u51C6",rejected:"\u5DF2\u62D2\u7D55",returned:"\u9000\u56DE\u4FEE\u6539"},fi={pending:"bg-warning-subtle text-warning-emphasis",approved:"bg-success-subtle text-success",rejected:"bg-danger-subtle text-danger",returned:"bg-secondary-subtle text-secondary"};var Hn=n=>[n,"edit"],Us=(n,t)=>t.id;function Hs(n,t){if(n&1){let e=R();i(0,"a",26),g(),i(1,"svg",7),d(2,"use",27),r()(),S(),i(3,"button",28),x("click",function(){y(e);let l=m().$implicit,u=m();return A(u.delete(l))}),g(),i(4,"svg",7),d(5,"use",29),r()()}if(n&2){let e=m().$implicit;h("routerLink",ae(1,Hn,e.id))}}function Js(n,t){if(n&1&&(i(0,"a",25),g(),i(1,"svg",7),d(2,"use",30),r()()),n&2){let e=m().$implicit;h("routerLink",ae(1,Hn,e.id))}}function Ys(n,t){if(n&1&&(i(0,"tr")(1,"td",18),a(2),B(3,"date"),r(),i(4,"td",19),a(5),r(),i(6,"td",20),a(7),B(8,"number"),r(),i(9,"td",21),a(10),r(),i(11,"td")(12,"span"),a(13),r()(),i(14,"td",22),a(15),B(16,"date"),r(),i(17,"td",23)(18,"div",24),f(19,Hs,6,3)(20,Js,3,3,"a",25),r()()()),n&2){let e=t.$implicit,o=m();s(2),c(M(3,9,e.overtimeDate,"yyyy-MM-dd")),s(3),c((e.projectCodes==null?null:e.projectCodes.join(", "))||"\u2014"),s(2),w("",M(8,12,e.estimatedHours,"1.1-1")," h"),s(3),c(e.reason),s(2),re("badge "+o.statusClass[e.approvalStatus]),s(),c(o.statusLabel[e.approvalStatus]),s(2),c(M(16,15,e.createdAt,"yyyy-MM-dd HH:mm")),s(4),b(e.approvalStatus==="pending"||e.approvalStatus==="returned"?19:20)}}function zs(n,t){n&1&&(i(0,"tr")(1,"td",31),a(2,"\u5C1A\u7121\u52A0\u73ED\u7533\u8ACB\u3002"),r()())}function Ks(n,t){n&1&&(i(0,"li",39)(1,"span",41),a(2,"\u2026"),r()())}function Ws(n,t){if(n&1){let e=R();i(0,"li",37)(1,"button",38),x("click",function(){y(e);let l=m().$implicit,u=m(2);return A(u.goTo(l))}),a(2),r()()}if(n&2){let e=m().$implicit,o=m(2);q("active",e===o.page()),s(2),c(e)}}function Zs(n,t){if(n&1&&f(0,Ks,3,0,"li",39)(1,Ws,3,3,"li",40),n&2){let e=t.$implicit;b(e===-1?0:1)}}function Qs(n,t){if(n&1){let e=R();i(0,"div",17)(1,"span",32),a(2),r(),i(3,"div",33)(4,"button",34),x("click",function(){y(e);let l=m();return A(l.prev())}),a(5,"\u2039"),r(),i(6,"span",35),a(7),r(),i(8,"button",34),x("click",function(){y(e);let l=m();return A(l.next())}),a(9,"\u203A"),r()(),i(10,"ul",36)(11,"li",37)(12,"button",38),x("click",function(){y(e);let l=m();return A(l.prev())}),a(13,"\u2039"),r()(),k(14,Zs,2,1,null,null,xe),i(16,"li",37)(17,"button",38),x("click",function(){y(e);let l=m();return A(l.next())}),a(18,"\u203A"),r()()()()}if(n&2){let e=m();s(2),Fe("\u5171 ",e.totalCount()," \u7B46\uFF0C\u7B2C ",e.page()," / ",e.totalPages()," \u9801"),s(2),q("disabled",e.page()===1),s(3),z("",e.page()," / ",e.totalPages()),s(),q("disabled",e.page()===e.totalPages()),s(3),q("disabled",e.page()===1),s(3),P(e.pageNumbers()),s(2),q("disabled",e.page()===e.totalPages())}}var bi=class n{service=v(Nt);PAGE_SIZE=20;page=he(1);result=we(Pe(this.page).pipe(Te(t=>this.service.getPaged(t,this.PAGE_SIZE))),{initialValue:{items:[],totalCount:0,page:1,pageSize:20,totalPages:1}});pagedRequests=U(()=>this.result().items);totalCount=U(()=>this.result().totalCount);totalPages=U(()=>this.result().totalPages);pageNumbers=U(()=>Xs(this.page(),this.totalPages()));goTo(t){this.page.set(t)}prev(){this.page()>1&&this.page.update(t=>t-1)}next(){this.page()<this.totalPages()&&this.page.update(t=>t+1)}statusLabel=vi;statusClass=fi;delete(t){confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u52A0\u73ED\u7533\u8ACB\u55CE\uFF1F")&&this.service.delete(t.id).subscribe()}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-overtime-request-list"]],decls:36,vars:2,consts:[[1,"container-fluid","py-3"],[1,"flex","flex-wrap","items-center","justify-between","gap-2","mb-6"],[1,"flex","items-center","gap-2"],[1,"sa-icon","sa-icon-2x","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#zap"],[1,"mb-0"],["routerLink","new",1,"btn","btn-primary","inline-flex","items-center","gap-1"],[1,"sa-icon",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#plus"],[1,"card","border-0","shadow-sm"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-hover","mb-0"],[1,"table-light"],[1,"text-right"],[1,"hidden","md:table-cell"],[1,"hidden","lg:table-cell"],[1,"flex","flex-col","gap-2","sm:flex-row","sm:items-center","sm:justify-between","px-4","py-3","border-t"],[1,"fw-500"],[1,"font-monospace","small"],[1,"text-right","fw-500"],[1,"text-muted","small","hidden","md:table-cell"],[1,"text-muted","small","hidden","lg:table-cell"],[1,"text-right",2,"white-space","nowrap"],[1,"flex","justify-end","gap-1"],["title","\u6AA2\u8996",1,"btn","btn-sm","btn-ghost-secondary","inline-flex","items-center",3,"routerLink"],["title","\u7DE8\u8F2F",1,"btn","btn-sm","btn-ghost-primary","inline-flex","items-center",3,"routerLink"],["href","/assets/icons/sprite.svg#edit"],["title","\u522A\u9664",1,"btn","btn-sm","btn-ghost-danger","inline-flex","items-center",3,"click"],["href","/assets/icons/sprite.svg#trash"],["href","/assets/icons/sprite.svg#eye"],["colspan","7",1,"text-center","text-muted","py-4"],[1,"text-muted","small","text-center","sm:text-left"],[1,"flex","sm:hidden","items-center","gap-1"],[1,"page-link","rounded",3,"click"],[1,"px-2","text-sm"],[1,"hidden","sm:flex","pagination","mb-0"],[1,"page-item"],[1,"page-link",3,"click"],[1,"page-item","disabled"],[1,"page-item",3,"active"],[1,"page-link"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2),g(),i(3,"svg",3),d(4,"use",4),r(),S(),i(5,"h4",5),a(6,"\u52A0\u73ED\u7533\u8ACB"),r()(),i(7,"a",6),g(),i(8,"svg",7),d(9,"use",8),r(),a(10," \u65B0\u589E\u7533\u8ACB "),r()(),S(),i(11,"div",9)(12,"div",10)(13,"div",11)(14,"table",12)(15,"thead",13)(16,"tr")(17,"th"),a(18,"\u52A0\u73ED\u65E5\u671F"),r(),i(19,"th"),a(20,"\u5C08\u6848"),r(),i(21,"th",14),a(22,"\u9810\u4F30\u6642\u6578"),r(),i(23,"th",15),a(24,"\u539F\u56E0"),r(),i(25,"th"),a(26,"\u72C0\u614B"),r(),i(27,"th",16),a(28,"\u7533\u8ACB\u6642\u9593"),r(),i(29,"th",14),a(30,"\u64CD\u4F5C"),r()()(),i(31,"tbody"),k(32,Ys,21,18,"tr",null,Us,!1,zs,3,0,"tr"),r()()(),f(35,Qs,19,13,"div",17),r()()()),e&2&&(s(32),P(o.pagedRequests()),s(3),b(o.totalPages()>1?35:-1))},dependencies:[O,be,De],encapsulation:2})};function Xs(n,t){if(t<=9)return Array.from({length:t},(l,u)=>u+1);let e=[],o=0;for(let l=1;l<=t;l++)(l===1||l===t||l>=n-2&&l<=n+2)&&(o&&l-o>1&&e.push(-1),e.push(l),o=l);return e}var e0=(n,t)=>t.id;function t0(n,t){n&1&&(i(0,"div",19),a(1,"\u8ACB\u9078\u64C7\u52A0\u73ED\u65E5\u671F\u3002"),r())}function i0(n,t){n&1&&(i(0,"div",19),a(1,"\u8ACB\u8F38\u5165\u9810\u4F30\u6642\u6578\uFF08\u81F3\u5C11 0.5\uFF09\u3002"),r())}function n0(n,t){if(n&1&&(i(0,"p",22),a(1),r()),n&2){let e=m();s(),c(e.displayProjectCodes.join(", ")||"\u2014")}}function r0(n,t){if(n&1){let e=R();i(0,"label",28)(1,"input",29),x("change",function(){let l=y(e).$implicit,u=m(2);return A(u.toggleProject(l.id))}),r(),i(2,"span",30),a(3),r()()}if(n&2){let e=t.$implicit,o=m(2);q("border-primary",o.selectedProjectIds.has(e.id))("bg-primary-subtle",o.selectedProjectIds.has(e.id)),s(),h("checked",o.selectedProjectIds.has(e.id)),s(2),z("",e.code,"",e.departmentName?"\uFF08"+e.departmentName+"\uFF09":"")}}function a0(n,t){if(n&1&&(i(0,"div",23),k(1,r0,4,7,"label",27,e0),r()),n&2){let e=m();s(),P(e.projects)}}function o0(n,t){n&1&&(i(0,"div",19),a(1,"\u8ACB\u586B\u5BEB\u52A0\u73ED\u539F\u56E0\u3002"),r())}function l0(n,t){if(n&1&&(i(0,"div",25)(1,"button",31),a(2),r(),i(3,"a",32),a(4,"\u53D6\u6D88"),r()()),n&2){let e=m();s(),h("disabled",e.form.invalid),s(),w(" ",e.isReturned?"\u4FEE\u6539\u4E26\u91CD\u9001":e.isEdit?"\u66F4\u65B0":"\u9001\u51FA\u7533\u8ACB"," ")}}function s0(n,t){n&1&&(i(0,"div",26)(1,"a",32),a(2,"\u8FD4\u56DE\u5217\u8868"),r()())}var Tt=class n{fb=v(te);service=v(Nt);projects$=v(Me);route=v(me);router=v(ve);isEdit=!1;requestId=0;isReadOnly=!1;isReturned=!1;projects=[];selectedProjectIds=new Set;displayProjectCodes=[];statusLabel=vi;statusClass=fi;form=this.fb.group({overtimeDate:["",D.required],estimatedHours:[1,[D.required,D.min(.5)]],reason:["",D.required]});ngOnInit(){this.projects$.getAll().subscribe(e=>this.projects=e.filter(o=>o.status==="active"));let t=this.route.snapshot.paramMap.get("id");t&&(this.isEdit=!0,this.requestId=+t,this.service.getById(this.requestId).subscribe(e=>{e&&(this.isReturned=e.approvalStatus==="returned",this.isReadOnly=e.approvalStatus!=="pending"&&e.approvalStatus!=="returned",this.form.patchValue({overtimeDate:e.overtimeDate instanceof Date?e.overtimeDate.toISOString().split("T")[0]:String(e.overtimeDate),estimatedHours:e.estimatedHours,reason:e.reason}),e.projectIds&&e.projectIds.forEach(o=>this.selectedProjectIds.add(o)),e.projectCodes&&(this.displayProjectCodes=e.projectCodes),this.isReadOnly&&this.form.disable())}))}toggleProject(t){this.isReadOnly||(this.selectedProjectIds.has(t)?this.selectedProjectIds.delete(t):this.selectedProjectIds.add(t))}submit(){if(this.form.invalid||this.isReadOnly)return;let t=this.form.value,e=Array.from(this.selectedProjectIds),o=e.map(E=>this.projects.find(F=>F.id===E)?.code).filter(Boolean),l={overtimeDate:new Date(t.overtimeDate),projectIds:e.length>0?e:void 0,projectCodes:o.length>0?o:void 0,estimatedHours:+t.estimatedHours,reason:t.reason};(this.isEdit?this.service.update(this.requestId,l):this.service.create(l)).subscribe(()=>this.router.navigate(["/admin/overtime-requests"]))}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=N({type:n,selectors:[["app-overtime-request-form"]],decls:45,vars:7,consts:[[1,"container-fluid","py-3"],[1,"flex","items-center","gap-2","mb-6"],["routerLink","/admin/overtime-requests",1,"btn","btn-sm","btn-outline-secondary"],[1,"sa-icon"],["href","/assets/icons/sprite.svg#arrow-left"],[1,"mb-0"],[3,"ngSubmit","formGroup"],[1,"row","g-4"],[1,"col-12","col-lg-10","col-xl-8"],[1,"card","border-0","shadow-sm"],[1,"card-header","bg-transparent","border-bottom","flex","items-center","gap-2","fw-600"],[1,"sa-icon","text-primary",2,"stroke","currentColor"],["href","/assets/icons/sprite.svg#zap"],[1,"card-body"],[1,"row","g-3","mb-4"],[1,"col-12","col-md-6"],[1,"form-label","fw-500"],[1,"text-danger"],["type","date","formControlName","overtimeDate",1,"form-control"],[1,"text-danger","small","mt-1"],["type","number","formControlName","estimatedHours","min","0.5","step","0.5","placeholder","1",1,"form-control"],[1,"mb-4"],[1,"form-control-plaintext","fw-500","font-monospace","mb-0"],[1,"flex","flex-wrap","gap-2"],["formControlName","reason","rows","3","placeholder","\u8ACB\u586B\u5BEB\u52A0\u73ED\u539F\u56E0...",1,"form-control"],[1,"mt-6","flex","gap-2"],[1,"mt-6"],[1,"inline-flex","items-center","gap-2","px-3","py-2","rounded-lg","border","cursor-pointer",3,"border-primary","bg-primary-subtle"],[1,"inline-flex","items-center","gap-2","px-3","py-2","rounded-lg","border","cursor-pointer"],["type","checkbox",1,"form-check-input","m-0",3,"change","checked"],[1,"small","fw-500"],["type","submit",1,"btn","btn-primary",3,"disabled"],["routerLink","/admin/overtime-requests",1,"btn","btn-outline-secondary"]],template:function(e,o){if(e&1&&(i(0,"div",0)(1,"div",1)(2,"a",2),g(),i(3,"svg",3),d(4,"use",4),r()(),S(),i(5,"h4",5),a(6),r()(),i(7,"form",6),x("ngSubmit",function(){return o.submit()}),i(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10),g(),i(12,"svg",11),d(13,"use",12),r(),a(14," \u52A0\u73ED\u8CC7\u8A0A "),r(),S(),i(15,"div",13)(16,"div",14)(17,"div",15)(18,"label",16),a(19,"\u52A0\u73ED\u65E5\u671F "),i(20,"span",17),a(21,"*"),r()(),d(22,"input",18),f(23,t0,2,0,"div",19),r(),i(24,"div",15)(25,"label",16),a(26,"\u9810\u4F30\u6642\u6578\uFF08\u5C0F\u6642\uFF09"),i(27,"span",17),a(28,"*"),r()(),d(29,"input",20),f(30,i0,2,0,"div",19),r()(),i(31,"div",21)(32,"label",16),a(33,"\u95DC\u806F\u5C08\u6848\uFF08\u53EF\u591A\u9078\uFF09"),r(),f(34,n0,2,1,"p",22)(35,a0,3,0,"div",23),r(),i(36,"div",21)(37,"label",16),a(38,"\u52A0\u73ED\u539F\u56E0 "),i(39,"span",17),a(40,"*"),r()(),d(41,"textarea",24),f(42,o0,2,0,"div",19),r()()(),f(43,l0,5,2,"div",25)(44,s0,3,0,"div",26),r()()()()),e&2){let l,u,E;s(6),c(o.isEdit?o.isReadOnly?"\u6AA2\u8996\u52A0\u73ED\u7533\u8ACB":o.isReturned?"\u4FEE\u6539\u52A0\u73ED\u7533\u8ACB\uFF08\u9000\u56DE\uFF09":"\u7DE8\u8F2F\u52A0\u73ED\u7533\u8ACB":"\u65B0\u589E\u52A0\u73ED\u7533\u8ACB"),s(),h("formGroup",o.form),s(16),b((l=o.form.get("overtimeDate"))!=null&&l.invalid&&((l=o.form.get("overtimeDate"))!=null&&l.touched)?23:-1),s(7),b((u=o.form.get("estimatedHours"))!=null&&u.invalid&&((u=o.form.get("estimatedHours"))!=null&&u.touched)?30:-1),s(4),b(o.isReadOnly?34:35),s(8),b((E=o.form.get("reason"))!=null&&E.invalid&&((E=o.form.get("reason"))!=null&&E.touched)?42:-1),s(),b(o.isReadOnly?44:43)}},dependencies:[ie,Q,K,ge,W,Z,_e,ee,X,O],encapsulation:2})};var pv=[{path:"",redirectTo:"users",pathMatch:"full"},{path:"users",component:Ot,canActivate:[H],data:{title:"\u54E1\u5DE5\u7BA1\u7406",permission:"users:read"}},{path:"users/new",component:bt,canActivate:[H],data:{title:"\u65B0\u589E\u54E1\u5DE5",permission:"users:write"}},{path:"users/:id/edit",component:bt,canActivate:[H],data:{title:"\u7DE8\u8F2F\u54E1\u5DE5",permission:"users:write"}},{path:"departments",component:Ht,canActivate:[H],data:{title:"\u90E8\u9580\u7BA1\u7406",permission:"departments:read"}},{path:"departments/new",component:xt,canActivate:[H],data:{title:"\u65B0\u589E\u90E8\u9580",permission:"departments:write"}},{path:"departments/:id/edit",component:xt,canActivate:[H],data:{title:"\u7DE8\u8F2F\u90E8\u9580",permission:"departments:write"}},{path:"job-titles",component:Jt,canActivate:[H],data:{title:"\u8077\u7A31\u7BA1\u7406",permission:"job-titles:read"}},{path:"job-titles/new",component:ht,canActivate:[H],data:{title:"\u65B0\u589E\u8077\u7A31",permission:"job-titles:write"}},{path:"job-titles/:id/edit",component:ht,canActivate:[H],data:{title:"\u7DE8\u8F2F\u8077\u7A31",permission:"job-titles:write"}},{path:"approvals",component:Yt,canActivate:[H],data:{title:"\u7C3D\u6838\u7BA1\u7406",permission:"approvals:read"}},{path:"approvals/:id/flow",component:zt,canActivate:[H],data:{title:"\u7C3D\u6838\u6D41\u7A0B",permission:"approvals:read"}},{path:"roles",component:Mt,canActivate:[H],data:{title:"\u89D2\u8272\u7BA1\u7406",permission:"superadmin"}},{path:"roles/new",component:gt,canActivate:[H],data:{title:"\u65B0\u589E\u89D2\u8272",permission:"superadmin"}},{path:"roles/:id/edit",component:gt,canActivate:[H],data:{title:"\u7DE8\u8F2F\u89D2\u8272",permission:"superadmin"}},{path:"permissions",component:$t,canActivate:[H],data:{title:"\u6B0A\u9650\u7BA1\u7406",permission:"superadmin"}},{path:"permissions/new",component:_t,canActivate:[H],data:{title:"\u65B0\u589E\u6B0A\u9650",permission:"superadmin"}},{path:"permissions/:id/edit",component:_t,canActivate:[H],data:{title:"\u7DE8\u8F2F\u6B0A\u9650",permission:"superadmin"}},{path:"projects",component:Kt,canActivate:[H],data:{title:"\u5C08\u6848\u7BA1\u7406",permission:"projects:read"}},{path:"projects/new",component:St,canActivate:[H],data:{title:"\u65B0\u589E\u5C08\u6848",permission:"projects:write"}},{path:"projects/:id/edit",component:St,canActivate:[H],data:{title:"\u7DE8\u8F2F\u5C08\u6848",permission:"projects:write"}},{path:"payment-requests",component:Qt,canActivate:[H],data:{title:"\u8ACB\u6B3E\u7533\u8ACB",permission:"payment-requests:read"}},{path:"payment-requests/new",component:yt,canActivate:[H],data:{title:"\u65B0\u589E\u8ACB\u6B3E\u7533\u8ACB",permission:"payment-requests:write"}},{path:"payment-requests/:id/edit",component:yt,canActivate:[H],data:{title:"\u7DE8\u8F2F\u8ACB\u6B3E\u7533\u8ACB",permission:"payment-requests:read"}},{path:"leave-requests",component:di,canActivate:[H],data:{title:"\u8ACB\u5047\u7533\u8ACB",permission:"leave-requests:read"}},{path:"leave-requests/new",component:At,canActivate:[H],data:{title:"\u65B0\u589E\u8ACB\u5047\u7533\u8ACB",permission:"leave-requests:write"}},{path:"leave-requests/:id/edit",component:At,canActivate:[H],data:{title:"\u7DE8\u8F2F\u8ACB\u5047\u7533\u8ACB",permission:"leave-requests:read"}},{path:"travel-requests",component:pi,canActivate:[H],data:{title:"\u51FA\u5DEE\u7533\u8ACB",permission:"travel-requests:read"}},{path:"travel-requests/new",component:wt,canActivate:[H],data:{title:"\u65B0\u589E\u51FA\u5DEE\u7533\u8ACB",permission:"travel-requests:write"}},{path:"travel-requests/:id/edit",component:wt,canActivate:[H],data:{title:"\u7DE8\u8F2F\u51FA\u5DEE\u7533\u8ACB",permission:"travel-requests:read"}},{path:"overtime-requests",component:bi,canActivate:[H],data:{title:"\u52A0\u73ED\u7533\u8ACB",permission:"overtime-requests:read"}},{path:"overtime-requests/new",component:Tt,canActivate:[H],data:{title:"\u65B0\u589E\u52A0\u73ED\u7533\u8ACB",permission:"overtime-requests:write"}},{path:"overtime-requests/:id/edit",component:Tt,canActivate:[H],data:{title:"\u7DE8\u8F2F\u52A0\u73ED\u7533\u8ACB",permission:"overtime-requests:read"}},{path:"approval-tasks",component:oi,canActivate:[H],data:{title:"\u7C3D\u6838\u4F5C\u696D",permission:"approval-tasks:read"}},{path:"approval-tasks/:applicationType/:id/review",component:li,canActivate:[H],data:{title:"\u5BE9\u6838",permission:"approval-tasks:write"}},{path:"settings",component:Ut,canActivate:[H],data:{title:"\u7CFB\u7D71\u8A2D\u5B9A",permission:"admin:access"}}];export{pv as ADMIN_ROUTES};
